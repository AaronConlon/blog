<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta name="description" content="javascript node deno linux web developer"/><meta charSet="utf-8"/><link rel="icon" href="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text y=%22.9em%22 font-size=%2290%22&gt;🎯&lt;/text&gt;&lt;/svg&gt;"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css"/><title>工作中需要用到的Git知识</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reset-css@5.0.1/reset.min.css"/><link rel="stylesheet" href="/blog/post.css"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-J0BNBT8YXG"></script><script><!-- Global site tag (gtag.js) - Google Analytics -->
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-J0BNBT8YXG');</script><style></style><link rel="preload" href="/blog/_next/static/css/8ef88aaa27e60d0e48db.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/8ef88aaa27e60d0e48db.css" data-n-g=""/><link rel="preload" href="/blog/_next/static/css/5af383a6793efef21f55.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/5af383a6793efef21f55.css" data-n-p=""/><noscript data-n-css="true"></noscript><link rel="preload" href="/blog/_next/static/chunks/main-c37f7d67026ad75148c3.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/webpack-eb080e3f091731f228fb.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/framework.1daf1ec1ecf144ee9147.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/commons.cb58dfc173e18379cc5b.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/6335da8543c52d3af527c387f688061357787349.aa32db8a194765817dea.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/pages/_app-ec227152ab7c3ab4ac27.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.f2335cbaf06875528bc0.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/pages/posts/%5Bslug%5D-a3b98341ead03cf4e1a2.js" as="script"/></head><body><div id="__next"><style data-emotion-css="d6jcgn">html{line-height:1.15;-webkit-text-size-adjust:100%;}body{margin:0;}main{display:block;}h1{font-size:2em;margin:0.67em 0;}hr{box-sizing:content-box;height:0;overflow:visible;}pre{font-family:monospace,monospace;font-size:1em;}a{background-color:transparent;}abbr[title]{border-bottom:none;-webkit-text-decoration:underline;text-decoration:underline;-webkit-text-decoration:underline dotted;-webkit-text-decoration:underline dotted;text-decoration:underline dotted;}b,strong{font-weight:bolder;}code,kbd,samp{font-family:monospace,monospace;font-size:1em;}small{font-size:80%;}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline;}sub{bottom:-0.25em;}sup{top:-0.5em;}img{border-style:none;}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0;}button,input{overflow:visible;}button,select{text-transform:none;}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0;}fieldset{padding:0.35em 0.75em 0.625em;}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal;}progress{vertical-align:baseline;}textarea{overflow:auto;}[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0;}[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{-webkit-appearance:none !important;}input[type="number"]{-moz-appearance:textfield;}[type="search"]{-webkit-appearance:textfield;outline-offset:-2px;}[type="search"]::-webkit-search-decoration{-webkit-appearance:none !important;}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit;}details{display:block;}summary{display:list-item;}template{display:none;}[hidden]{display:none !important;}html{box-sizing:border-box;font-family:sans-serif;}*,*::before,*::after{box-sizing:border-box;}blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0;}button{background:transparent;padding:0;}fieldset{margin:0;padding:0;}ol,ul{margin:0;padding:0;}html{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";line-height:1.5;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%;text-rendering:optimizelegibility;}hr{border-top-width:1px;}img{border-style:solid;}textarea{resize:vertical;}button,[role="button"]{cursor:pointer;}button::-moz-focus-inner{border:0 !important;}table{border-collapse:collapse;}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit;}a{color:inherit;-webkit-text-decoration:inherit;text-decoration:inherit;}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit;}pre,code,kbd,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle;}img,video{max-width:100%;height:auto;}html{line-height:1.5;color:#1A202C;}*,*::before,*::after{border-width:0;border-style:solid;border-color:#E2E8F0;}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#A0AEC0;}input::-ms-input-placeholder,textarea::-ms-input-placeholder{color:#A0AEC0;}input::-webkit-input-placeholder,textarea::-webkit-input-placeholder{color:#A0AEC0;}input::-moz-placeholder,textarea::-moz-placeholder{color:#A0AEC0;}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#A0AEC0;}input::placeholder,textarea::placeholder{color:#A0AEC0;}</style><div class="css-0"><div class="layout_container__1BBI- css-0"><header><div class="css-0"><style data-emotion-css="em7ozm">.css-em7ozm{font-size:2.25rem;line-height:1.25;font-weight:700;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";text-align:center;margin:0 auto;padding:1.4rem 1rem;color:#0069d6;}@media screen and (min-width:48em){.css-em7ozm{font-size:3rem;}}</style><h1 class="css-em7ozm"><a href="/blog">妙才<style data-emotion-css="1i1myri">.css-1i1myri{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";font-size:30%;}</style><sub class="css-1i1myri">blog</sub></a></h1></div></header><a class="github-fork-ribbon" href="https://github.com/youyiqin/blog" data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a><main><div class="css-0"><style data-emotion-css="t9c2rr">.css-t9c2rr{width:100%;margin:0 auto;padding-bottom:2rem;max-width:960px;}</style><div class="css-t9c2rr"><style data-emotion-css="8atqhb">.css-8atqhb{width:100%;}</style><img alt="" class="css-8atqhb"/></div><style data-emotion-css="1td051d">.css-1td051d{width:100%;margin:0 auto;max-width:960px;}</style><div class="css-1td051d"><style data-emotion-css="1299f13">.css-1299f13{font-size:1.875rem;line-height:2.5rem!important;font-weight:700;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";text-align:center;overflow:hidden;}@media screen and (min-width:30em){.css-1299f13{line-height:3rem!important;}}@media screen and (min-width:48em){.css-1299f13{font-size:2.25rem;}}</style><h1 class="css-1299f13">工作中需要用到的Git知识</h1><style data-emotion-css="7e9jz6">.css-7e9jz6{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:2rem;margin:0 auto;margin-right:0.4rem;float:right;}</style><div id="tags" class="css-7e9jz6"><style data-emotion-css="qgikqf">.css-qgikqf{display:inline-block;padding-left:8px;padding-right:0.25rem;text-transform:uppercase;font-size:0.6rem;border-radius:5px;font-weight:700;white-space:nowrap;vertical-align:middle;background-color:#c6f6d5;color:#22543d;height:2rem;line-height:2rem;min-width:4rem;}</style><div class="css-qgikqf">Git</div></div><style data-emotion-css="8ddayy">.css-8ddayy{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;min-height:2rem;max-width:100%;border-radius:0.25rem;font-weight:500;min-width:2rem;padding-left:0.75rem;padding-right:0.75rem;background-color:#c6f6d5;color:#22543d;margin-bottom:2rem;font-size:0.6rem;margin-left:0.4rem;}</style><div class="css-8ddayy">最后更新: <!-- -->2022/2/10</div><div><h3 id="">前言</h3><p>入职新公司之后醒悟到自己之前对<code>Git</code>的了解依然太少，故整理一下工作中会用到的所有<code>Git</code>操作知识。</p><style data-emotion-css="1xvrksk">.css-1xvrksk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding:1.5rem;}</style><div class="css-1xvrksk"><style data-emotion-css="1v59okt">.css-1v59okt{width:42px;height:42px;padding:0.5rem;}</style><div class="css-1v59okt"><svg viewBox="0 0 36 36"><path fill="#FFAC33" d="M8.916 12.88c-.111 1.652 1.768 3.126-.712 2.959-2.48-.167-7.836-2.533-7.768-3.53s3.708-2.757 6.188-2.59c2.48.166 2.404 1.508 2.292 3.161zm20.122 16.049c-.202-.032-.392.015-.564.095-2.325.232-3.225-1.885-3.225-1.885-.439-.336-.981-2.009-1.589-1.215l.187 1.402c.187 1.402 2.57 3.224 2.57 3.224l-1.215 1.589c-.336.439-.252 1.066.187 1.402.439.336 1.066.252 1.402-.187l.673-.88-.039.249c-.087.546.285 1.058.831 1.145.546.087 1.058-.285 1.145-.831l.47-2.963c.085-.546-.287-1.058-.833-1.145zm-6.278.623c-.196-.058-.39-.037-.572.018-2.335-.082-2.944-2.3-2.944-2.3-.39-.392-.703-2.123-1.412-1.417l-.003 1.414c-.003 1.414 2.115 3.539 2.115 3.539l-1.417 1.412c-.392.39-.393 1.023-.003 1.414.39.392 1.023.393 1.414.003l.785-.782-.073.242c-.159.529.141 1.086.67 1.246.529.159 1.087-.141 1.246-.67l.862-2.873c.162-.53-.138-1.087-.668-1.246z"></path><path fill="#DD2E44" d="M35.009 6.729c-.383-.17-.758-.057-1.05.244-.054.056-4.225 6.306-14.532 4.944-.34-.045 3.139 11.968 3.199 11.962.124-.014 3.07-.368 6.14-2.553 2.818-2.005 6.284-5.991 6.797-13.598.028-.418-.171-.828-.554-.999z"></path><path fill="#DD2E44" d="M34.477 21.108c-.204-.336-.59-.56-.979-.471-1.293.295-3.197.543-4.53.453-6.357-.428-9.361-4.129-9.392-4.16-.275-.282.466 11.552.816 11.576 9.194.62 13.862-6.027 14.057-6.31.222-.326.233-.751.028-1.088z"></path><path fill="#DD2E44" d="M24.586 19.016c-.371 5.51 1.316 9.861-4.194 9.489-5.51-.371-10.145-4.92-9.774-10.431s14.34-4.568 13.968.942z"></path><path fill="#DD2E44" d="M23.257 12.412c-.353 5.235-3.922 9.257-9.156 8.904-5.235-.353-9.193-4.882-8.84-10.117.353-5.235 4.832-8.444 10.067-8.091 4.001.269 8.24 4.683 7.929 9.304z"></path><circle fill="#292F33" cx="10.67" cy="8.989" r="2"></circle><path fill="#A0041E" d="M18.179 16.645s7.63 5.648 12.387-4.459c.396-.842 1.685.793.099 4.162s-8.175 6.44-12.04 1.536c-.815-1.035-.446-1.239-.446-1.239z"></path><path fill="#DD2E44" d="M15.327 3.107s6.246.254 7.798-.477.136 2.932-3.262 3.789-4.536-3.312-4.536-3.312z"></path><path fill="#DD2E44" d="M17.428 5.788s4.501.136 6.054-.594.136 2.932-3.262 3.789c-3.399.857-2.792-3.195-2.792-3.195z"></path></svg></div><style data-emotion-css="pbmhrg">.css-pbmhrg{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:#fff2f2;border-radius:8px;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="css-pbmhrg"><p><a href="https://learngitbranching.js.org/?locale=zh_CN">Learn Git Branching</a>: 强推边学边玩的游戏教程</p></div></div><h3 id="">浅尝辄止</h3><h4 id="commit">commit</h4><p>提交记录可以视为项目的快照，如下如所示：</p><p>初始阶段：</p><style data-emotion-css="sjjdi9">.css-sjjdi9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding:1.5rem;}</style><div class="css-sjjdi9"><img alt="image-20220210135808631" src="/blog/mdImgs/image-20220210135808631.png" style="zoom:50%;:"/></div><p>增加了新的内容，再次使用<code>git commit</code>任务提交新内容之后：</p><div class="css-sjjdi9"><img alt="image-20220210135912104" src="/blog/mdImgs/image-20220210135912104.png" style="zoom:50%;:"/></div><p>新的节点生成了。</p><h4 id="branch">branch</h4><p>开发新的需求时，创建新的分支去提交此需求的代码是一个非常好的办法。继续看示例，如下是默认情况：</p><div class="css-sjjdi9"><img alt="image-20220210140153996" src="/blog/mdImgs/image-20220210140153996.png" style="zoom:50%;:"/></div><p>现在，我们要新增一个功能，为此我们想创建一个名为<code>newImage</code>的新分支：</p><p><code>git branch newImage</code></p><div class="css-sjjdi9"><img alt="image-20220210140307559" src="/blog/mdImgs/image-20220210140307559.png" style="zoom:50%;:"/></div><p>创建了分支之后，还需要切换分支到目标分支上去开发新功能：</p><div class="css-1xvrksk"><div class="css-1v59okt"><svg viewBox="0 0 36 36"><path fill="#FFAC33" d="M8.916 12.88c-.111 1.652 1.768 3.126-.712 2.959-2.48-.167-7.836-2.533-7.768-3.53s3.708-2.757 6.188-2.59c2.48.166 2.404 1.508 2.292 3.161zm20.122 16.049c-.202-.032-.392.015-.564.095-2.325.232-3.225-1.885-3.225-1.885-.439-.336-.981-2.009-1.589-1.215l.187 1.402c.187 1.402 2.57 3.224 2.57 3.224l-1.215 1.589c-.336.439-.252 1.066.187 1.402.439.336 1.066.252 1.402-.187l.673-.88-.039.249c-.087.546.285 1.058.831 1.145.546.087 1.058-.285 1.145-.831l.47-2.963c.085-.546-.287-1.058-.833-1.145zm-6.278.623c-.196-.058-.39-.037-.572.018-2.335-.082-2.944-2.3-2.944-2.3-.39-.392-.703-2.123-1.412-1.417l-.003 1.414c-.003 1.414 2.115 3.539 2.115 3.539l-1.417 1.412c-.392.39-.393 1.023-.003 1.414.39.392 1.023.393 1.414.003l.785-.782-.073.242c-.159.529.141 1.086.67 1.246.529.159 1.087-.141 1.246-.67l.862-2.873c.162-.53-.138-1.087-.668-1.246z"></path><path fill="#DD2E44" d="M35.009 6.729c-.383-.17-.758-.057-1.05.244-.054.056-4.225 6.306-14.532 4.944-.34-.045 3.139 11.968 3.199 11.962.124-.014 3.07-.368 6.14-2.553 2.818-2.005 6.284-5.991 6.797-13.598.028-.418-.171-.828-.554-.999z"></path><path fill="#DD2E44" d="M34.477 21.108c-.204-.336-.59-.56-.979-.471-1.293.295-3.197.543-4.53.453-6.357-.428-9.361-4.129-9.392-4.16-.275-.282.466 11.552.816 11.576 9.194.62 13.862-6.027 14.057-6.31.222-.326.233-.751.028-1.088z"></path><path fill="#DD2E44" d="M24.586 19.016c-.371 5.51 1.316 9.861-4.194 9.489-5.51-.371-10.145-4.92-9.774-10.431s14.34-4.568 13.968.942z"></path><path fill="#DD2E44" d="M23.257 12.412c-.353 5.235-3.922 9.257-9.156 8.904-5.235-.353-9.193-4.882-8.84-10.117.353-5.235 4.832-8.444 10.067-8.091 4.001.269 8.24 4.683 7.929 9.304z"></path><circle fill="#292F33" cx="10.67" cy="8.989" r="2"></circle><path fill="#A0041E" d="M18.179 16.645s7.63 5.648 12.387-4.459c.396-.842 1.685.793.099 4.162s-8.175 6.44-12.04 1.536c-.815-1.035-.446-1.239-.446-1.239z"></path><path fill="#DD2E44" d="M15.327 3.107s6.246.254 7.798-.477.136 2.932-3.262 3.789-4.536-3.312-4.536-3.312z"></path><path fill="#DD2E44" d="M17.428 5.788s4.501.136 6.054-.594.136 2.932-3.262 3.789c-3.399.857-2.792-3.195-2.792-3.195z"></path></svg></div><div class="css-pbmhrg"><p>git checkout -b newImage: 创建并切换分支</p></div></div><p><code>git checkout newImage</code>或<code>git switch newImage</code></p><div class="css-sjjdi9"><img alt="image-20220210140521088" src="/blog/mdImgs/image-20220210140521088.png" style="zoom:50%;:"/></div><p>现在，所有新增的内容再<code>commit</code>，则会以当前分支为起点创建新的节点<code>c2</code>：</p><div class="css-sjjdi9"><img alt="image-20220210140612918" src="/blog/mdImgs/image-20220210140612918.png" style="zoom:50%;:"/></div><h4 id="merge">merge</h4><p>当新分支功能实现之后，我们可以将此分支合并到项目主分支上去。</p><p>合并分支不止有一种方法，现在来看第一种：<code>git merge</code>。</p><p>继续看示例：</p><div class="css-sjjdi9"><img alt="image-20220210141214004" src="/blog/mdImgs/image-20220210141214004.png" style="zoom:50%;:"/></div><p>当前我们的<code>bugFix</code>分支开发完成，为了合并到<code>main</code>分支，我们先切换到了<code>main</code>分支。</p><p>然后：</p><p><code>git merge bugFix</code></p><div class="css-sjjdi9"><img alt="image-20220210141330337" src="/blog/mdImgs/image-20220210141330337.png" style="zoom:50%;:"/></div><p>此时，<code>main</code>分支当前节点会接上<code>bugFix</code>的<code>c2</code>节点，此时<code>main</code>节点就包含了<code>bugFix</code>节点上的所有内容。但是，这时候还不算成功合并这俩分支。</p><p>我们需要继续执行<code>bugFix</code>分支上的合并命令：</p><p><code>git switch bugFix;git merge main</code></p><div class="css-sjjdi9"><img alt="image-20220210141605243" src="/blog/mdImgs/image-20220210141605243.png" style="zoom:50%;:"/></div><p>现在，每一个分支都包含了所有代码了。</p><h4 id="rebase">rebase</h4><p><em>rebase 将会取出一系列提交记录，复制并且放到另一个地方</em>。</p><p>看示例：</p><p>现在我们有两个分支如下所示：</p><div class="css-sjjdi9"><img alt="image-20220210144128221" src="/blog/mdImgs/image-20220210144128221.png" style="zoom:50%;:"/></div><p>在<code>bugFix</code>分支上执行命令：<code>git rebase main</code></p><div class="css-sjjdi9"><img alt="image-20220210144738544" src="/blog/mdImgs/image-20220210144738544.png" style="zoom:50%;:"/></div><p>现在，<code>Copy</code>了 <code>C3</code>节点的所有工作内容放在了<code>main</code>分支后，并且作为一个新的节点，<code>C3&#x27;</code>是<code>C3</code>的副本，此时这两个节点同时存在。</p><p>接着，我们可以切到<code>main</code>分支上再<code>rebase</code>到<code>bugFix</code>分支上！</p><p><code>git switch main;git rebase bugFix</code></p><div class="css-sjjdi9"><img alt="image-20220210145113041" src="/blog/mdImgs/image-20220210145113041.png" style="zoom:50%;:"/></div><p>此时，我们就完成了分支的合并。</p><h3 id="">循序渐进</h3><p>接下来的目标是弄懂如何在提交树上移动。</p><h4 id="-head">分离 HEAD</h4><div class="css-1xvrksk"><div class="css-1v59okt"><svg viewBox="0 0 36 36"><path fill="#FFAC33" d="M8.916 12.88c-.111 1.652 1.768 3.126-.712 2.959-2.48-.167-7.836-2.533-7.768-3.53s3.708-2.757 6.188-2.59c2.48.166 2.404 1.508 2.292 3.161zm20.122 16.049c-.202-.032-.392.015-.564.095-2.325.232-3.225-1.885-3.225-1.885-.439-.336-.981-2.009-1.589-1.215l.187 1.402c.187 1.402 2.57 3.224 2.57 3.224l-1.215 1.589c-.336.439-.252 1.066.187 1.402.439.336 1.066.252 1.402-.187l.673-.88-.039.249c-.087.546.285 1.058.831 1.145.546.087 1.058-.285 1.145-.831l.47-2.963c.085-.546-.287-1.058-.833-1.145zm-6.278.623c-.196-.058-.39-.037-.572.018-2.335-.082-2.944-2.3-2.944-2.3-.39-.392-.703-2.123-1.412-1.417l-.003 1.414c-.003 1.414 2.115 3.539 2.115 3.539l-1.417 1.412c-.392.39-.393 1.023-.003 1.414.39.392 1.023.393 1.414.003l.785-.782-.073.242c-.159.529.141 1.086.67 1.246.529.159 1.087-.141 1.246-.67l.862-2.873c.162-.53-.138-1.087-.668-1.246z"></path><path fill="#DD2E44" d="M35.009 6.729c-.383-.17-.758-.057-1.05.244-.054.056-4.225 6.306-14.532 4.944-.34-.045 3.139 11.968 3.199 11.962.124-.014 3.07-.368 6.14-2.553 2.818-2.005 6.284-5.991 6.797-13.598.028-.418-.171-.828-.554-.999z"></path><path fill="#DD2E44" d="M34.477 21.108c-.204-.336-.59-.56-.979-.471-1.293.295-3.197.543-4.53.453-6.357-.428-9.361-4.129-9.392-4.16-.275-.282.466 11.552.816 11.576 9.194.62 13.862-6.027 14.057-6.31.222-.326.233-.751.028-1.088z"></path><path fill="#DD2E44" d="M24.586 19.016c-.371 5.51 1.316 9.861-4.194 9.489-5.51-.371-10.145-4.92-9.774-10.431s14.34-4.568 13.968.942z"></path><path fill="#DD2E44" d="M23.257 12.412c-.353 5.235-3.922 9.257-9.156 8.904-5.235-.353-9.193-4.882-8.84-10.117.353-5.235 4.832-8.444 10.067-8.091 4.001.269 8.24 4.683 7.929 9.304z"></path><circle fill="#292F33" cx="10.67" cy="8.989" r="2"></circle><path fill="#A0041E" d="M18.179 16.645s7.63 5.648 12.387-4.459c.396-.842 1.685.793.099 4.162s-8.175 6.44-12.04 1.536c-.815-1.035-.446-1.239-.446-1.239z"></path><path fill="#DD2E44" d="M15.327 3.107s6.246.254 7.798-.477.136 2.932-3.262 3.789-4.536-3.312-4.536-3.312z"></path><path fill="#DD2E44" d="M17.428 5.788s4.501.136 6.054-.594.136 2.932-3.262 3.789c-3.399.857-2.792-3.195-2.792-3.195z"></path></svg></div><div class="css-pbmhrg"><p>HEAD 永远指向当前分支上最近一次的提交记录（头部~）</p></div></div><p>通常情况下，HEAD 指向分支名。所谓分离 HEAD 指的是让 HEAD 指向某个具体的提交记录而不是分支名。</p><p>如下图：</p><div class="css-sjjdi9"><img alt="image-20220210150937337" src="/blog/mdImgs/image-20220210150937337.png" style="zoom:50%;:"/></div><p>此时 HEAD 指向 main，main 指向 C1！</p><p>我们可以通过<code>git checkout C1</code>（C1 指代提交记录的哈希值）来分离 HEAD！</p><div class="css-sjjdi9"><img alt="image-20220210151253672" src="/blog/mdImgs/image-20220210151253672.png" style="zoom:50%;:"/></div><h4 id="">相对引用</h4><p>在实际项目中，并不存在默认的图示化支持，所以需要用<code>git log</code>来查看日志。</p><div class="css-1xvrksk"><div class="css-1v59okt"><svg viewBox="0 0 36 36"><path fill="#FFAC33" d="M8.916 12.88c-.111 1.652 1.768 3.126-.712 2.959-2.48-.167-7.836-2.533-7.768-3.53s3.708-2.757 6.188-2.59c2.48.166 2.404 1.508 2.292 3.161zm20.122 16.049c-.202-.032-.392.015-.564.095-2.325.232-3.225-1.885-3.225-1.885-.439-.336-.981-2.009-1.589-1.215l.187 1.402c.187 1.402 2.57 3.224 2.57 3.224l-1.215 1.589c-.336.439-.252 1.066.187 1.402.439.336 1.066.252 1.402-.187l.673-.88-.039.249c-.087.546.285 1.058.831 1.145.546.087 1.058-.285 1.145-.831l.47-2.963c.085-.546-.287-1.058-.833-1.145zm-6.278.623c-.196-.058-.39-.037-.572.018-2.335-.082-2.944-2.3-2.944-2.3-.39-.392-.703-2.123-1.412-1.417l-.003 1.414c-.003 1.414 2.115 3.539 2.115 3.539l-1.417 1.412c-.392.39-.393 1.023-.003 1.414.39.392 1.023.393 1.414.003l.785-.782-.073.242c-.159.529.141 1.086.67 1.246.529.159 1.087-.141 1.246-.67l.862-2.873c.162-.53-.138-1.087-.668-1.246z"></path><path fill="#DD2E44" d="M35.009 6.729c-.383-.17-.758-.057-1.05.244-.054.056-4.225 6.306-14.532 4.944-.34-.045 3.139 11.968 3.199 11.962.124-.014 3.07-.368 6.14-2.553 2.818-2.005 6.284-5.991 6.797-13.598.028-.418-.171-.828-.554-.999z"></path><path fill="#DD2E44" d="M34.477 21.108c-.204-.336-.59-.56-.979-.471-1.293.295-3.197.543-4.53.453-6.357-.428-9.361-4.129-9.392-4.16-.275-.282.466 11.552.816 11.576 9.194.62 13.862-6.027 14.057-6.31.222-.326.233-.751.028-1.088z"></path><path fill="#DD2E44" d="M24.586 19.016c-.371 5.51 1.316 9.861-4.194 9.489-5.51-.371-10.145-4.92-9.774-10.431s14.34-4.568 13.968.942z"></path><path fill="#DD2E44" d="M23.257 12.412c-.353 5.235-3.922 9.257-9.156 8.904-5.235-.353-9.193-4.882-8.84-10.117.353-5.235 4.832-8.444 10.067-8.091 4.001.269 8.24 4.683 7.929 9.304z"></path><circle fill="#292F33" cx="10.67" cy="8.989" r="2"></circle><path fill="#A0041E" d="M18.179 16.645s7.63 5.648 12.387-4.459c.396-.842 1.685.793.099 4.162s-8.175 6.44-12.04 1.536c-.815-1.035-.446-1.239-.446-1.239z"></path><path fill="#DD2E44" d="M15.327 3.107s6.246.254 7.798-.477.136 2.932-3.262 3.789-4.536-3.312-4.536-3.312z"></path><path fill="#DD2E44" d="M17.428 5.788s4.501.136 6.054-.594.136 2.932-3.262 3.789c-3.399.857-2.792-3.195-2.792-3.195z"></path></svg></div><div class="css-pbmhrg"><p>切记分支用 branch，HEAD 用 checkout</p></div></div><p>每一条<code>commit</code>都有自己唯一的哈希值，除了使用哈希值之外，还可以用相对引用。</p><ul><li><code>^</code>向上移动一个提交记录</li><li><code>~3</code> 可以是任意合理的数字，示例为向上移动三个提交记录</li></ul><p>看示例：</p><div class="css-sjjdi9"><img alt="image-20220210151826055" src="/blog/mdImgs/image-20220210151826055.png" style="zoom:50%;:"/></div><p>现在，我们可以使用<code>git checkout main^</code>来切换到<code>main</code>分支的父节点。</p><div class="css-sjjdi9"><img alt="image-20220210151958145" src="/blog/mdImgs/image-20220210151958145.png" style="zoom:50%;:"/></div><p>比如我们有这样一个场景：</p><div class="css-sjjdi9"><img alt="image-20220210152303465" src="/blog/mdImgs/image-20220210152303465.png" style="zoom:50%;:"/></div><p>现在需要让<code>main</code>分支恢复到节点<code>C1</code>:</p><p><code>git branch -f main HEAD~3</code>即可强制让<code>main</code>分支相对引用上层第三个节点。</p><div class="css-sjjdi9"><img alt="image-20220210152439000" src="/blog/mdImgs/image-20220210152439000.png" style="zoom:50%;:"/></div><h4 id="">撤销变更</h4><p>人总有犯错的时候，Git 允许我们撤销不必要的变更。</p><p>撤销变更的方式分为：</p><ul><li>reset</li><li>revert</li></ul><h5 id="reset">reset</h5><p>首先是<code>reset</code>!</p><div class="css-sjjdi9"><img alt="image-20220210153918207" src="/blog/mdImgs/image-20220210153918207.png" style="zoom:50%;:"/></div><p>然后执行重置命令：<code>git reset HEAD^</code></p><div class="css-sjjdi9"><img alt="image-20220210153956095" src="/blog/mdImgs/image-20220210153956095.png" style="zoom:50%;:"/></div><h5 id="revert">revert</h5><div class="css-1xvrksk"><div class="css-1v59okt"><svg viewBox="0 0 36 36"><path fill="#FFAC33" d="M8.916 12.88c-.111 1.652 1.768 3.126-.712 2.959-2.48-.167-7.836-2.533-7.768-3.53s3.708-2.757 6.188-2.59c2.48.166 2.404 1.508 2.292 3.161zm20.122 16.049c-.202-.032-.392.015-.564.095-2.325.232-3.225-1.885-3.225-1.885-.439-.336-.981-2.009-1.589-1.215l.187 1.402c.187 1.402 2.57 3.224 2.57 3.224l-1.215 1.589c-.336.439-.252 1.066.187 1.402.439.336 1.066.252 1.402-.187l.673-.88-.039.249c-.087.546.285 1.058.831 1.145.546.087 1.058-.285 1.145-.831l.47-2.963c.085-.546-.287-1.058-.833-1.145zm-6.278.623c-.196-.058-.39-.037-.572.018-2.335-.082-2.944-2.3-2.944-2.3-.39-.392-.703-2.123-1.412-1.417l-.003 1.414c-.003 1.414 2.115 3.539 2.115 3.539l-1.417 1.412c-.392.39-.393 1.023-.003 1.414.39.392 1.023.393 1.414.003l.785-.782-.073.242c-.159.529.141 1.086.67 1.246.529.159 1.087-.141 1.246-.67l.862-2.873c.162-.53-.138-1.087-.668-1.246z"></path><path fill="#DD2E44" d="M35.009 6.729c-.383-.17-.758-.057-1.05.244-.054.056-4.225 6.306-14.532 4.944-.34-.045 3.139 11.968 3.199 11.962.124-.014 3.07-.368 6.14-2.553 2.818-2.005 6.284-5.991 6.797-13.598.028-.418-.171-.828-.554-.999z"></path><path fill="#DD2E44" d="M34.477 21.108c-.204-.336-.59-.56-.979-.471-1.293.295-3.197.543-4.53.453-6.357-.428-9.361-4.129-9.392-4.16-.275-.282.466 11.552.816 11.576 9.194.62 13.862-6.027 14.057-6.31.222-.326.233-.751.028-1.088z"></path><path fill="#DD2E44" d="M24.586 19.016c-.371 5.51 1.316 9.861-4.194 9.489-5.51-.371-10.145-4.92-9.774-10.431s14.34-4.568 13.968.942z"></path><path fill="#DD2E44" d="M23.257 12.412c-.353 5.235-3.922 9.257-9.156 8.904-5.235-.353-9.193-4.882-8.84-10.117.353-5.235 4.832-8.444 10.067-8.091 4.001.269 8.24 4.683 7.929 9.304z"></path><circle fill="#292F33" cx="10.67" cy="8.989" r="2"></circle><path fill="#A0041E" d="M18.179 16.645s7.63 5.648 12.387-4.459c.396-.842 1.685.793.099 4.162s-8.175 6.44-12.04 1.536c-.815-1.035-.446-1.239-.446-1.239z"></path><path fill="#DD2E44" d="M15.327 3.107s6.246.254 7.798-.477.136 2.932-3.262 3.789-4.536-3.312-4.536-3.312z"></path><path fill="#DD2E44" d="M17.428 5.788s4.501.136 6.054-.594.136 2.932-3.262 3.789c-3.399.857-2.792-3.195-2.792-3.195z"></path></svg></div><div class="css-pbmhrg"><p>Reset 通常用于修改本地提交记录，如果需要撤销更改并且分享给别人，则需要<code>git revert</code></p></div></div><div class="css-sjjdi9"><img alt="image-20220210154110580" src="/blog/mdImgs/image-20220210154110580.png" style="zoom:50%;:"/></div><p>执行命令<code>git revert HEAD</code>:</p><div class="css-sjjdi9"><img alt="image-20220210155612888" src="/blog/mdImgs/image-20220210155612888.png" style="zoom:50%;:"/></div><p>使用<code>revert</code>将会新增一个提交，这个提交基于撤销的目标位置，也就是说<code>C2&#x27;</code>的状态和<code>C1</code>是相同的。</p><h3 id="">渐入佳境</h3><p>或许上述命令已经能够让你应对百分之工作中 90% 的 Git 问题，但是在处理复杂工作流时，还需要了解更多内容。</p><p>接下来我们谈谈如何整理提交记录。</p><h4 id="cherry-pick">Cherry-pick</h4><p>如果你想将一些提交复制到当前所在的位置(HEAD)下面的话，可以试试<code>Cherry-pick</code>，来看看这个场景：</p><div class="css-sjjdi9"><img alt="image-20220210164646032" src="/blog/mdImgs/image-20220210164646032.png" style="zoom:50%;:"/></div><p>我想把<code>side</code>分支上的工作复制到<code>main</code>分支，显然<code>rebase</code>也可以实现。</p><p>但是我们来看看<code>cherry-pick</code>如何处理这个需求：</p><p><code>git cherry-pick c2 c4</code></p><div class="css-sjjdi9"><img alt="image-20220210165225268" src="/blog/mdImgs/image-20220210165225268.png" style="zoom:50%;:"/></div><p>这样就能将<code>C2</code>和<code>C4</code>的内容复制到了当前分支下，这样一来<code>main</code>分支就包含了<code>C2</code>和<code>C4</code>的内容。</p><h4 id="-rebase">交互式 Rebase</h4><p>当我们不知道提交记录哈希值时，可以选择使用交互式的<code>rebase</code>操作来实现相同的效果。</p><p>交互式<code>rebase</code>指的是带参数的<code>rebase</code>，核心参数是<code>--interactive</code>(-i 简写)。</p><p><code>git</code>会选择默认的编辑器去处理顺序。</p><p><div class="css-sjjdi9"><img alt="image-20220210174950934" src="/blog/mdImgs/image-20220210174950934.png"/></div></p><p>我们可以删除某些<code>pick</code>行，也可以修改行为，更换顺序来处理<code>rebase</code>的问题。</p><h3 id="">杂项</h3><h4 id="">提交的技巧</h4><h5 id="-1">场景 1</h5><p>有这么一个场景，代码出现了某个棘手的<code>BUG</code>，为了方便调试而在代码中添加了一些调试命令并向控制台打印了这些信息，当问题解决之后代码提交之前，我们如何更快地排除那些调试代码呢？</p><p>当我们发现<code>bug</code>出现在文件<code>a.js</code>，但是调试信息遍布整个目录，这时候我们可以让<code>git</code>复制解决问题的那一个提交记录即可。</p><div class="css-sjjdi9"><img alt="image-20220210180636221" src="/blog/mdImgs/image-20220210180636221.png" style="zoom:50%;:"/></div><p>我们只需要<code>bugFix</code>这个提交，因此为了将之合并到<code>main</code>分支上去，我们可以：</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-bash">$ git rebase -i main --solution-ordering C4
$ git rebase bugFix main</code></pre></div></div></details><div class="css-sjjdi9"><img alt="image-20220210182452714" src="/blog/mdImgs/image-20220210182452714.png" style="zoom:50%;:"/></div><p>甚至，只需要将<code>bugFix</code>分支的内容复制到<code>main</code>分支后面即可：</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-bash">$ git switch main
$ git cherry-pick C4</code></pre></div></div></details><div class="css-sjjdi9"><img alt="image-20220210181703119" src="/blog/mdImgs/image-20220210181703119.png" style="zoom:50%;:"/></div><h5 id="-2">场景 2</h5><p>我在<code>newImage</code>分支上提交了一些更新，然后又基于此节点创建了<code>caption</code>分支，然后又提交了一次。</p><p>但是由于某些原因，我得在原来的提交记录上(<code>newImage分支</code>)做一些更新(我不希望这些更新记录在当前的位置)。</p><p>我们可以这样实现这个需求：</p><ul><li>用<code>git rebase -i</code>重新排序之前的提交，将目标记录挪到最前面</li><li>用<code>git commit --amend</code> 进行小修改</li><li>再用<code>git rebase -i</code>恢复原来的顺序</li><li>最后把<code>main</code>移动到最前端</li></ul><p>最初的状态图如下：</p><div class="css-sjjdi9"><img alt="image-20220210212704433" src="/blog/mdImgs/image-20220210212704433.png" style="zoom:67%;:"/></div><p>命令如下：</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-bash">$ git rebase -i c1
# 更换 c2 和 c3 的顺序
$ git commit --amend
# 此时，更新头部
$ git rebase -i c1
# 恢复 c2 和 c3 的顺序
$ git rebase caption main
# 合并分支 main 和 caption</code></pre></div></div></details><p><div class="css-sjjdi9"><img alt="image-20220210214641095" src="/blog/mdImgs/image-20220210214641095.png"/></div></p><h5 id="-3">场景 3</h5><p>当我们将想要的提交记录移动到最前端时，可以用<code>--amend</code>修改它，但是这样可能会造成由<code>rebase</code>产生的冲突。</p><p>除了使用上述方案，还可以选择<code>cherry-pick</code>来实现。</p><div class="css-1xvrksk"><div class="css-1v59okt"><svg viewBox="0 0 36 36"><path fill="#FFAC33" d="M8.916 12.88c-.111 1.652 1.768 3.126-.712 2.959-2.48-.167-7.836-2.533-7.768-3.53s3.708-2.757 6.188-2.59c2.48.166 2.404 1.508 2.292 3.161zm20.122 16.049c-.202-.032-.392.015-.564.095-2.325.232-3.225-1.885-3.225-1.885-.439-.336-.981-2.009-1.589-1.215l.187 1.402c.187 1.402 2.57 3.224 2.57 3.224l-1.215 1.589c-.336.439-.252 1.066.187 1.402.439.336 1.066.252 1.402-.187l.673-.88-.039.249c-.087.546.285 1.058.831 1.145.546.087 1.058-.285 1.145-.831l.47-2.963c.085-.546-.287-1.058-.833-1.145zm-6.278.623c-.196-.058-.39-.037-.572.018-2.335-.082-2.944-2.3-2.944-2.3-.39-.392-.703-2.123-1.412-1.417l-.003 1.414c-.003 1.414 2.115 3.539 2.115 3.539l-1.417 1.412c-.392.39-.393 1.023-.003 1.414.39.392 1.023.393 1.414.003l.785-.782-.073.242c-.159.529.141 1.086.67 1.246.529.159 1.087-.141 1.246-.67l.862-2.873c.162-.53-.138-1.087-.668-1.246z"></path><path fill="#DD2E44" d="M35.009 6.729c-.383-.17-.758-.057-1.05.244-.054.056-4.225 6.306-14.532 4.944-.34-.045 3.139 11.968 3.199 11.962.124-.014 3.07-.368 6.14-2.553 2.818-2.005 6.284-5.991 6.797-13.598.028-.418-.171-.828-.554-.999z"></path><path fill="#DD2E44" d="M34.477 21.108c-.204-.336-.59-.56-.979-.471-1.293.295-3.197.543-4.53.453-6.357-.428-9.361-4.129-9.392-4.16-.275-.282.466 11.552.816 11.576 9.194.62 13.862-6.027 14.057-6.31.222-.326.233-.751.028-1.088z"></path><path fill="#DD2E44" d="M24.586 19.016c-.371 5.51 1.316 9.861-4.194 9.489-5.51-.371-10.145-4.92-9.774-10.431s14.34-4.568 13.968.942z"></path><path fill="#DD2E44" d="M23.257 12.412c-.353 5.235-3.922 9.257-9.156 8.904-5.235-.353-9.193-4.882-8.84-10.117.353-5.235 4.832-8.444 10.067-8.091 4.001.269 8.24 4.683 7.929 9.304z"></path><circle fill="#292F33" cx="10.67" cy="8.989" r="2"></circle><path fill="#A0041E" d="M18.179 16.645s7.63 5.648 12.387-4.459c.396-.842 1.685.793.099 4.162s-8.175 6.44-12.04 1.536c-.815-1.035-.446-1.239-.446-1.239z"></path><path fill="#DD2E44" d="M15.327 3.107s6.246.254 7.798-.477.136 2.932-3.262 3.789-4.536-3.312-4.536-3.312z"></path><path fill="#DD2E44" d="M17.428 5.788s4.501.136 6.054-.594.136 2.932-3.262 3.789c-3.399.857-2.792-3.195-2.792-3.195z"></path></svg></div><div class="css-pbmhrg"><p>牢记<code>cherry-pick</code>可以将树上的提交记录追加到<code>HEAD</code>上来。</p></div></div><p><div class="css-sjjdi9"><img alt="image-20220210215346574" src="/blog/mdImgs/image-20220210215346574.png"/></div></p><p>现在，我们需要在<code>newImage</code>分支节点<code>C2</code>上做一些修改，首先让我们切换到<code>main</code>上。</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-bash"># 切换到 main
$ git switch main
# 将 C2 挪到 main 的下一步
$ git cherry-pick C2
# 提交修改
$ git commit --amend
# 将 C3 移动到当前节点末尾
$ git cherry-pick C3</code></pre></div></div></details><p>现在，我们实现了针对性修改中间节点记录。</p><p><div class="css-sjjdi9"><img alt="image-20220210215752988" src="/blog/mdImgs/image-20220210215752988.png"/></div></p><h4 id="tag">Tag</h4><p>分支易变，为了便于定位到记录，我们可以创建标签（<code>Tag</code>），每一个标签都可以视为一个里程碑，我们可以像用分支一样用标签，并且它不会移动，标签页是一个锚点。</p><p>让我们为提交记录<code>C1</code>创建一个标签<code>v1</code>:</p><p><div class="css-sjjdi9"><img alt="image-20220210224729142" src="/blog/mdImgs/image-20220210224729142.png"/></div></p><p>执行命令：</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-bash">$ git tag v1 C1</code></pre></div></div></details><p><div class="css-sjjdi9"><img alt="image-20220210224814517" src="/blog/mdImgs/image-20220210224814517.png"/></div></p><p>如果我们再想快速切换到具有特殊意义的地方，就可以通过<code>checkout tagName</code>快速完成切换。</p><p>此外，<code>git describe &lt;ref&gt;</code>可以展示最近的一个标签信息。<code>ref</code>是可选的记录引用，你可以写哈希值、标签、分支，甚至什么都不写，默认为当前<code>HEAD</code>位置。</p><p>输出的结果如下：</p><p><code>&lt;标签名&gt;_&lt;ref和标签之间的提交记录数&gt;_g&lt;ref的哈希特征值&gt;</code></p><p>如果我们有这样一个场景：</p><p><div class="css-sjjdi9"><img alt="image-20220210225857113" src="/blog/mdImgs/image-20220210225857113.png"/></div></p><p>那么会有以下输入和输出：</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-bash">$ git describe main
# 输出 v1_2_gC2
$ git describe side
# 输出 v2_1_gC4</code></pre></div></div></details><h4 id="-rebase">多分支 rebase</h4><p>我们为了开发某些功能，每一个功能都创建了单独的分支，现在要将这些分支全部合并到<code>main</code>分支上去。</p><p><div class="css-sjjdi9"><img alt="image-20220210231612410" src="/blog/mdImgs/image-20220210231612410.png"/></div></p><p>现在，我们有主分支<code>main</code>，其他任务分支：</p><ul><li><code>bugFix</code></li><li><code>side</code></li><li><code>another</code></li></ul><p>为了将任务分支合并到主分支下，可以逐步<code>rebase</code>：</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-bash">$ git rebase main bugFix # 将 bugFix rebase 到 main 下
$ git rebase bugFix side # 将 side rebase 到 bugFix 下
$ git rebase side another # 类似
$ git rebase HEAD main # 可以使用 HEAD 代替分支名，这时候 HEAD 总是在当前适宜的位置</code></pre></div></div></details><h4 id="">多上层记录</h4><p>看看这个场景：</p><p><div class="css-sjjdi9"><img alt="image-20220210233314336" src="/blog/mdImgs/image-20220210233314336.png"/></div></p><p>如果我们执行:<code>git checkout main^</code>，那么<code>HEAD</code>将会分离到<code>C1</code>，如果想分离到<code>C2</code>该怎么做？</p><p>答案很简单：<code>git checkout main^2</code></p><p>继续看示例：</p><p><div class="css-sjjdi9"><img alt="image-20220210233534390" src="/blog/mdImgs/image-20220210233534390.png"/></div></p><p>如果想快速切换到 <code>C3</code>，我们可以：</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-bash">$ git checkout HEAD^
$ git chekcout HEAD^2 # 选择第二个方向
$ git checkout HEAD~2 # 继续向上 2 个记录
# 甚至可以将这些操作连起来
$ git checkout HEAD~^2~2</code></pre></div></div></details><h4 id="">最终试炼</h4><p>现在是最后一关，前方是复杂且纠缠不清的分支。</p><p>现在我们的 <code>main</code> 分支是比 <code>one</code>、<code>two</code> 和 <code>three</code> 要多几个提交。出于某种原因，我们需要把 <code>main</code> 分支上最近的几次提交做不同的调整后，分别添加到各个的分支上。</p><p><code>one</code> 需要重新排序并删除 <code>C5</code>，<code>two</code> 仅需要重排排序，而 <code>three</code> 只需要提交一次。</p><p><div class="css-sjjdi9"><img alt="image-20220210235203491" src="/blog/mdImgs/image-20220210235203491.png"/></div></p><p>为了实现目的，我们得单独处理这些分支，一步步来：</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-bash">$ git rebase -i one c5 # 然后删除 c5，再重新排序
$ git rebase -i two c5 # 重排序
$ git rebase c2&#x27;&#x27; two # 处理好分支的位置
$ git rebase c2 three # 同上</code></pre></div></div></details><p>结果是：</p><p><div class="css-sjjdi9"><img alt="image-20220210235444896" src="/blog/mdImgs/image-20220210235444896.png"/></div></p><h3 id="">下一步</h3><p>此前都提及本地仓库的操作，接下来我们继续学习远程仓库的知识。</p><p>远程仓库是我们重要的数据备份源，即使本地也可以将文件恢复到指定的版本，但是所有信息都是保存在本地的，当我们本地信息丢失的时候，依靠远程仓库依然可以回复数据。</p><h4 id="clone">clone</h4><p><code>git clone</code>命令或许是每一个接触<code>github</code>的开发者最先熟悉的命令，其作用是在本地创建一个远程仓库的拷贝。</p><p><div class="css-sjjdi9"><img alt="image-20220212173912157" src="/blog/mdImgs/image-20220212173912157.png"/></div></p><p>虚线是远程仓库，当我们克隆仓库到本地的时候，本地仓库多了一个分支：<code>o/main</code>，这种分支我们称为远程分支。每一个远程分支都默认遵循命名规范：<code>remotName/branchName</code>，通常远程仓库名为<code>origin</code>。</p><p><code>checkout</code>远程<code>origin/main</code>将会分离<code>HEAD</code>到新的节点上去，这是因为<code>origin/main</code>只有在远程分支更新之后才会更新。</p><p><div class="css-sjjdi9"><img alt="image-20220212174633117" src="/blog/mdImgs/image-20220212174633117.png"/></div></p><h4 id="fetch">fetch</h4><p>Git 远程仓库可以接收本地仓库的数据，本地仓库也可以接收远程仓库的数据。当我们从远程仓库获取数据时，本地的远程分支也会更新。</p><p><div class="css-sjjdi9"><img alt="image-20220212175246921" src="/blog/mdImgs/image-20220212175246921.png"/></div></p><p>显然，上述场景下远程仓库具有新内容，本地需要获取更新可以使用<code>git fetch</code>命令。</p><p><div class="css-sjjdi9"><img alt="image-20220212175339167" src="/blog/mdImgs/image-20220212175339167.png"/></div></p><p>现在，本地的远程分支也更新到了远程仓库最新的状态。但是我们需要知道，<code>fetch</code>并不会更新本地分支<code>main</code>的状态，也不会更新当前磁盘上的文件，因此本地仓库和远程仓库并没有完成同步，即使数据已经通过<code>http</code>或<code>git</code>协议下载到了本地。</p><div class="css-1xvrksk"><div class="css-1v59okt"><svg viewBox="0 0 36 36"><path fill="#FFAC33" d="M8.916 12.88c-.111 1.652 1.768 3.126-.712 2.959-2.48-.167-7.836-2.533-7.768-3.53s3.708-2.757 6.188-2.59c2.48.166 2.404 1.508 2.292 3.161zm20.122 16.049c-.202-.032-.392.015-.564.095-2.325.232-3.225-1.885-3.225-1.885-.439-.336-.981-2.009-1.589-1.215l.187 1.402c.187 1.402 2.57 3.224 2.57 3.224l-1.215 1.589c-.336.439-.252 1.066.187 1.402.439.336 1.066.252 1.402-.187l.673-.88-.039.249c-.087.546.285 1.058.831 1.145.546.087 1.058-.285 1.145-.831l.47-2.963c.085-.546-.287-1.058-.833-1.145zm-6.278.623c-.196-.058-.39-.037-.572.018-2.335-.082-2.944-2.3-2.944-2.3-.39-.392-.703-2.123-1.412-1.417l-.003 1.414c-.003 1.414 2.115 3.539 2.115 3.539l-1.417 1.412c-.392.39-.393 1.023-.003 1.414.39.392 1.023.393 1.414.003l.785-.782-.073.242c-.159.529.141 1.086.67 1.246.529.159 1.087-.141 1.246-.67l.862-2.873c.162-.53-.138-1.087-.668-1.246z"></path><path fill="#DD2E44" d="M35.009 6.729c-.383-.17-.758-.057-1.05.244-.054.056-4.225 6.306-14.532 4.944-.34-.045 3.139 11.968 3.199 11.962.124-.014 3.07-.368 6.14-2.553 2.818-2.005 6.284-5.991 6.797-13.598.028-.418-.171-.828-.554-.999z"></path><path fill="#DD2E44" d="M34.477 21.108c-.204-.336-.59-.56-.979-.471-1.293.295-3.197.543-4.53.453-6.357-.428-9.361-4.129-9.392-4.16-.275-.282.466 11.552.816 11.576 9.194.62 13.862-6.027 14.057-6.31.222-.326.233-.751.028-1.088z"></path><path fill="#DD2E44" d="M24.586 19.016c-.371 5.51 1.316 9.861-4.194 9.489-5.51-.371-10.145-4.92-9.774-10.431s14.34-4.568 13.968.942z"></path><path fill="#DD2E44" d="M23.257 12.412c-.353 5.235-3.922 9.257-9.156 8.904-5.235-.353-9.193-4.882-8.84-10.117.353-5.235 4.832-8.444 10.067-8.091 4.001.269 8.24 4.683 7.929 9.304z"></path><circle fill="#292F33" cx="10.67" cy="8.989" r="2"></circle><path fill="#A0041E" d="M18.179 16.645s7.63 5.648 12.387-4.459c.396-.842 1.685.793.099 4.162s-8.175 6.44-12.04 1.536c-.815-1.035-.446-1.239-.446-1.239z"></path><path fill="#DD2E44" d="M15.327 3.107s6.246.254 7.798-.477.136 2.932-3.262 3.789-4.536-3.312-4.536-3.312z"></path><path fill="#DD2E44" d="M17.428 5.788s4.501.136 6.054-.594.136 2.932-3.262 3.789c-3.399.857-2.792-3.195-2.792-3.195z"></path></svg></div><div class="css-pbmhrg"><p>当然，我们可以用 cherry-pick o/main</p><p>可以用 git rebase o/main</p><p>甚至是 git merge o/main</p></div></div><p>为了同步远程和本地数据，我们可以用另一个命令。</p><h4 id="pull">pull</h4><p><code>git pull</code>等于<code>git fetch;git merge o/main</code>二者的和。</p><p><div class="css-sjjdi9"><img alt="image-20220212180042763" src="/blog/mdImgs/image-20220212180042763.png"/></div></p><p>上述场景表示远程分支具有更新，本地<code>main</code>分支也有更新，执行<code>git pull</code>后的关系如下：</p><p><div class="css-sjjdi9"><img alt="image-20220212180147692" src="/blog/mdImgs/image-20220212180147692.png"/></div></p><p>此时，本地同步了远程的数据，并且本地的远程分支也更新到了远程的相同节点。</p><p>为了完全同步本地和远程数据，我们还需要将本地新的内容传到远程仓库。</p><h4 id="push">push</h4><div class="css-1xvrksk"><div class="css-1v59okt"><svg viewBox="0 0 36 36"><path fill="#FFAC33" d="M8.916 12.88c-.111 1.652 1.768 3.126-.712 2.959-2.48-.167-7.836-2.533-7.768-3.53s3.708-2.757 6.188-2.59c2.48.166 2.404 1.508 2.292 3.161zm20.122 16.049c-.202-.032-.392.015-.564.095-2.325.232-3.225-1.885-3.225-1.885-.439-.336-.981-2.009-1.589-1.215l.187 1.402c.187 1.402 2.57 3.224 2.57 3.224l-1.215 1.589c-.336.439-.252 1.066.187 1.402.439.336 1.066.252 1.402-.187l.673-.88-.039.249c-.087.546.285 1.058.831 1.145.546.087 1.058-.285 1.145-.831l.47-2.963c.085-.546-.287-1.058-.833-1.145zm-6.278.623c-.196-.058-.39-.037-.572.018-2.335-.082-2.944-2.3-2.944-2.3-.39-.392-.703-2.123-1.412-1.417l-.003 1.414c-.003 1.414 2.115 3.539 2.115 3.539l-1.417 1.412c-.392.39-.393 1.023-.003 1.414.39.392 1.023.393 1.414.003l.785-.782-.073.242c-.159.529.141 1.086.67 1.246.529.159 1.087-.141 1.246-.67l.862-2.873c.162-.53-.138-1.087-.668-1.246z"></path><path fill="#DD2E44" d="M35.009 6.729c-.383-.17-.758-.057-1.05.244-.054.056-4.225 6.306-14.532 4.944-.34-.045 3.139 11.968 3.199 11.962.124-.014 3.07-.368 6.14-2.553 2.818-2.005 6.284-5.991 6.797-13.598.028-.418-.171-.828-.554-.999z"></path><path fill="#DD2E44" d="M34.477 21.108c-.204-.336-.59-.56-.979-.471-1.293.295-3.197.543-4.53.453-6.357-.428-9.361-4.129-9.392-4.16-.275-.282.466 11.552.816 11.576 9.194.62 13.862-6.027 14.057-6.31.222-.326.233-.751.028-1.088z"></path><path fill="#DD2E44" d="M24.586 19.016c-.371 5.51 1.316 9.861-4.194 9.489-5.51-.371-10.145-4.92-9.774-10.431s14.34-4.568 13.968.942z"></path><path fill="#DD2E44" d="M23.257 12.412c-.353 5.235-3.922 9.257-9.156 8.904-5.235-.353-9.193-4.882-8.84-10.117.353-5.235 4.832-8.444 10.067-8.091 4.001.269 8.24 4.683 7.929 9.304z"></path><circle fill="#292F33" cx="10.67" cy="8.989" r="2"></circle><path fill="#A0041E" d="M18.179 16.645s7.63 5.648 12.387-4.459c.396-.842 1.685.793.099 4.162s-8.175 6.44-12.04 1.536c-.815-1.035-.446-1.239-.446-1.239z"></path><path fill="#DD2E44" d="M15.327 3.107s6.246.254 7.798-.477.136 2.932-3.262 3.789-4.536-3.312-4.536-3.312z"></path><path fill="#DD2E44" d="M17.428 5.788s4.501.136 6.054-.594.136 2.932-3.262 3.789c-3.399.857-2.792-3.195-2.792-3.195z"></path></svg></div><div class="css-pbmhrg"><p>开发者们像地精一样在洞穴里捣鼓着自己的作品，终于在某个时刻可以回到地面跟大家分享自己的成果。</p></div></div><p><code>git push</code>可以将本地仓库的数据推送到远程仓库，并且在远程仓库合并本地的这个提交记录，在合并完成之后你的数据就能够被其他人从远程仓库下载了。</p><p>显然，这跟<code>fetch</code>相比，可以反向理解二者之间的差异。</p><p>有时候，我们的<code>push</code>会失败，来看看这个场景。</p><p><div class="css-sjjdi9"><img alt="image-20220212212014191" src="/blog/mdImgs/image-20220212212014191.png"/></div></p><p>本地的远程分支基于远程仓库的节点<code>C1</code>，此时再<code>push</code>过去，远程将拒绝我们的推送。远程仓库会提示让我们先将远程的数据<code>fetch</code>下来。</p><p>然后通过<code>git rebase o/main</code>将远程的数据和本地合并。现在本地分支和本地远程分支在同一个位置了。此时再<code>push</code>到远程就可以将本地的更新和远程同步。</p><p>有没有更简短的方法？</p><p>有。</p><p><code>git pull --rebase;git push</code>即可将远程的内容更新到本地，再推送本地的更新同步本地和远程的仓库。</p><p><div class="css-sjjdi9"><img alt="image-20220212213344839" src="/blog/mdImgs/image-20220212213344839.png"/></div></p><p>现在，本地提交了新内容，远程也有所更新。本地的远程分支<code>o/main</code>已经不跟远程仓库同步。</p><p>为了同步数据，我们需要执行以下命令：</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-bash">$ git pull --rebase
$ git push</code></pre></div></div></details><p>第一步将得到这样的结果：</p><div class="css-sjjdi9"><img alt="image-20220212213542581" src="/blog/mdImgs/image-20220212213542581.png" style="zoom:50%;:"/></div><p>第二步则实现了需求：</p><div class="css-sjjdi9"><img alt="image-20220212213617316" src="/blog/mdImgs/image-20220212213617316.png" style="zoom:50%;:"/></div><h3 id="remote-rejected">Remote Rejected</h3><p>当提交了本地内容再试着<code>push</code>到远程仓库时，会提示<code>Remote rejected!</code></p><p>当<code>main</code>被锁定的时候，需要一些<code>pull request</code>流程来合并修改。</p><div class="css-1xvrksk"><div class="css-1v59okt"><svg viewBox="0 0 36 36"><path fill="#FFAC33" d="M8.916 12.88c-.111 1.652 1.768 3.126-.712 2.959-2.48-.167-7.836-2.533-7.768-3.53s3.708-2.757 6.188-2.59c2.48.166 2.404 1.508 2.292 3.161zm20.122 16.049c-.202-.032-.392.015-.564.095-2.325.232-3.225-1.885-3.225-1.885-.439-.336-.981-2.009-1.589-1.215l.187 1.402c.187 1.402 2.57 3.224 2.57 3.224l-1.215 1.589c-.336.439-.252 1.066.187 1.402.439.336 1.066.252 1.402-.187l.673-.88-.039.249c-.087.546.285 1.058.831 1.145.546.087 1.058-.285 1.145-.831l.47-2.963c.085-.546-.287-1.058-.833-1.145zm-6.278.623c-.196-.058-.39-.037-.572.018-2.335-.082-2.944-2.3-2.944-2.3-.39-.392-.703-2.123-1.412-1.417l-.003 1.414c-.003 1.414 2.115 3.539 2.115 3.539l-1.417 1.412c-.392.39-.393 1.023-.003 1.414.39.392 1.023.393 1.414.003l.785-.782-.073.242c-.159.529.141 1.086.67 1.246.529.159 1.087-.141 1.246-.67l.862-2.873c.162-.53-.138-1.087-.668-1.246z"></path><path fill="#DD2E44" d="M35.009 6.729c-.383-.17-.758-.057-1.05.244-.054.056-4.225 6.306-14.532 4.944-.34-.045 3.139 11.968 3.199 11.962.124-.014 3.07-.368 6.14-2.553 2.818-2.005 6.284-5.991 6.797-13.598.028-.418-.171-.828-.554-.999z"></path><path fill="#DD2E44" d="M34.477 21.108c-.204-.336-.59-.56-.979-.471-1.293.295-3.197.543-4.53.453-6.357-.428-9.361-4.129-9.392-4.16-.275-.282.466 11.552.816 11.576 9.194.62 13.862-6.027 14.057-6.31.222-.326.233-.751.028-1.088z"></path><path fill="#DD2E44" d="M24.586 19.016c-.371 5.51 1.316 9.861-4.194 9.489-5.51-.371-10.145-4.92-9.774-10.431s14.34-4.568 13.968.942z"></path><path fill="#DD2E44" d="M23.257 12.412c-.353 5.235-3.922 9.257-9.156 8.904-5.235-.353-9.193-4.882-8.84-10.117.353-5.235 4.832-8.444 10.067-8.091 4.001.269 8.24 4.683 7.929 9.304z"></path><circle fill="#292F33" cx="10.67" cy="8.989" r="2"></circle><path fill="#A0041E" d="M18.179 16.645s7.63 5.648 12.387-4.459c.396-.842 1.685.793.099 4.162s-8.175 6.44-12.04 1.536c-.815-1.035-.446-1.239-.446-1.239z"></path><path fill="#DD2E44" d="M15.327 3.107s6.246.254 7.798-.477.136 2.932-3.262 3.789-4.536-3.312-4.536-3.312z"></path><path fill="#DD2E44" d="M17.428 5.788s4.501.136 6.054-.594.136 2.932-3.262 3.789c-3.399.857-2.792-3.195-2.792-3.195z"></path></svg></div><div class="css-pbmhrg"><p>这样有利于大团队做<code>code review</code>。</p></div></div><p>什么才是正确的做法✅？</p><p>我们应该按流程新建一个分支！然后<code>push</code>这个分支并且申请<code>pull request</code>。</p><p>如果我们直接一把梭，强行<code>push</code>，那么本地的分支就会卡住，我们需要新建一个分支<code>feature</code>，推送到服务器，并且<code>reset</code>本地的<code>main</code>分支和远程服务器保持一致。</p><p>继续看示例：</p><div class="css-sjjdi9"><img alt="image-20220213145918251" src="/blog/mdImgs/image-20220213145918251.png" style="zoom:67%;:"/></div><p>现在，本地有所更新，且远程仓库的<code>main</code>分支是被锁定的。</p><p>为了将本地的内容提交一个合并请求，需要单独将本地当前内容用一个分支去处理。</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-bash"># 先创建并且切换到 feature 分支上
$ git checkout -b feature
# 推送此分支
$ git push origin feature
$ git switch main
# 恢复到 origin/main 分支
$ git reset main^</code></pre></div></div></details><h3 id="">合并分支</h3><p>在大型项目中，开发人员通常会在<code>main</code>上分出来的任务分支上开发，完成后做一次集成。</p><p>继续看场景：</p><p><div class="css-sjjdi9"><img alt="image-20220213150626046" src="/blog/mdImgs/image-20220213150626046.png"/></div></p><p>现在，我们需要逐一将本地特征分支上传到远程仓库，并且完成合并同步。</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-bash"># 首先，将远程数据 fetch 下来
$ git fetch
# 将 side1 分支 rebase 到当前远程主分支后面
$ git rebase o/main side1
# 逐一 rebase 分支和本地 main 分支
$ git rebase side1 side2
$ git rebase side2 side3
$ git rebase side3 main
# 推送本地成果到远程
$ git push</code></pre></div></div></details><p><div class="css-sjjdi9"><img alt="image-20220213155038688" src="/blog/mdImgs/image-20220213155038688.png"/></div></p><p>除了使用<code>rebase</code>来解决这个问题，还可以用<code>merge</code>去合并。</p><div class="css-1xvrksk"><div class="css-1v59okt"><svg viewBox="0 0 36 36"><path fill="#FFAC33" d="M8.916 12.88c-.111 1.652 1.768 3.126-.712 2.959-2.48-.167-7.836-2.533-7.768-3.53s3.708-2.757 6.188-2.59c2.48.166 2.404 1.508 2.292 3.161zm20.122 16.049c-.202-.032-.392.015-.564.095-2.325.232-3.225-1.885-3.225-1.885-.439-.336-.981-2.009-1.589-1.215l.187 1.402c.187 1.402 2.57 3.224 2.57 3.224l-1.215 1.589c-.336.439-.252 1.066.187 1.402.439.336 1.066.252 1.402-.187l.673-.88-.039.249c-.087.546.285 1.058.831 1.145.546.087 1.058-.285 1.145-.831l.47-2.963c.085-.546-.287-1.058-.833-1.145zm-6.278.623c-.196-.058-.39-.037-.572.018-2.335-.082-2.944-2.3-2.944-2.3-.39-.392-.703-2.123-1.412-1.417l-.003 1.414c-.003 1.414 2.115 3.539 2.115 3.539l-1.417 1.412c-.392.39-.393 1.023-.003 1.414.39.392 1.023.393 1.414.003l.785-.782-.073.242c-.159.529.141 1.086.67 1.246.529.159 1.087-.141 1.246-.67l.862-2.873c.162-.53-.138-1.087-.668-1.246z"></path><path fill="#DD2E44" d="M35.009 6.729c-.383-.17-.758-.057-1.05.244-.054.056-4.225 6.306-14.532 4.944-.34-.045 3.139 11.968 3.199 11.962.124-.014 3.07-.368 6.14-2.553 2.818-2.005 6.284-5.991 6.797-13.598.028-.418-.171-.828-.554-.999z"></path><path fill="#DD2E44" d="M34.477 21.108c-.204-.336-.59-.56-.979-.471-1.293.295-3.197.543-4.53.453-6.357-.428-9.361-4.129-9.392-4.16-.275-.282.466 11.552.816 11.576 9.194.62 13.862-6.027 14.057-6.31.222-.326.233-.751.028-1.088z"></path><path fill="#DD2E44" d="M24.586 19.016c-.371 5.51 1.316 9.861-4.194 9.489-5.51-.371-10.145-4.92-9.774-10.431s14.34-4.568 13.968.942z"></path><path fill="#DD2E44" d="M23.257 12.412c-.353 5.235-3.922 9.257-9.156 8.904-5.235-.353-9.193-4.882-8.84-10.117.353-5.235 4.832-8.444 10.067-8.091 4.001.269 8.24 4.683 7.929 9.304z"></path><circle fill="#292F33" cx="10.67" cy="8.989" r="2"></circle><path fill="#A0041E" d="M18.179 16.645s7.63 5.648 12.387-4.459c.396-.842 1.685.793.099 4.162s-8.175 6.44-12.04 1.536c-.815-1.035-.446-1.239-.446-1.239z"></path><path fill="#DD2E44" d="M15.327 3.107s6.246.254 7.798-.477.136 2.932-3.262 3.789-4.536-3.312-4.536-3.312z"></path><path fill="#DD2E44" d="M17.428 5.788s4.501.136 6.054-.594.136 2.932-3.262 3.789c-3.399.857-2.792-3.195-2.792-3.195z"></path></svg></div><div class="css-pbmhrg"><p>merge 和 rebase 都可以，但是 rebase 构建的关系图谱更简洁，而 merge 则可以保存分支之间的记录独立性，没有最佳的方式，只有最适合你的方式。</p></div></div><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-bash">$ git fetch
$ git switch main
$ git pull
$ git merge side1
$ git merge side2
$ git merge side3
$ git push</code></pre></div></div></details><p><div class="css-sjjdi9"><img alt="image-20220213154831567" src="/blog/mdImgs/image-20220213154831567.png"/></div></p><div class="css-1xvrksk"><div class="css-1v59okt"><svg viewBox="0 0 36 36"><path fill="#FFAC33" d="M8.916 12.88c-.111 1.652 1.768 3.126-.712 2.959-2.48-.167-7.836-2.533-7.768-3.53s3.708-2.757 6.188-2.59c2.48.166 2.404 1.508 2.292 3.161zm20.122 16.049c-.202-.032-.392.015-.564.095-2.325.232-3.225-1.885-3.225-1.885-.439-.336-.981-2.009-1.589-1.215l.187 1.402c.187 1.402 2.57 3.224 2.57 3.224l-1.215 1.589c-.336.439-.252 1.066.187 1.402.439.336 1.066.252 1.402-.187l.673-.88-.039.249c-.087.546.285 1.058.831 1.145.546.087 1.058-.285 1.145-.831l.47-2.963c.085-.546-.287-1.058-.833-1.145zm-6.278.623c-.196-.058-.39-.037-.572.018-2.335-.082-2.944-2.3-2.944-2.3-.39-.392-.703-2.123-1.412-1.417l-.003 1.414c-.003 1.414 2.115 3.539 2.115 3.539l-1.417 1.412c-.392.39-.393 1.023-.003 1.414.39.392 1.023.393 1.414.003l.785-.782-.073.242c-.159.529.141 1.086.67 1.246.529.159 1.087-.141 1.246-.67l.862-2.873c.162-.53-.138-1.087-.668-1.246z"></path><path fill="#DD2E44" d="M35.009 6.729c-.383-.17-.758-.057-1.05.244-.054.056-4.225 6.306-14.532 4.944-.34-.045 3.139 11.968 3.199 11.962.124-.014 3.07-.368 6.14-2.553 2.818-2.005 6.284-5.991 6.797-13.598.028-.418-.171-.828-.554-.999z"></path><path fill="#DD2E44" d="M34.477 21.108c-.204-.336-.59-.56-.979-.471-1.293.295-3.197.543-4.53.453-6.357-.428-9.361-4.129-9.392-4.16-.275-.282.466 11.552.816 11.576 9.194.62 13.862-6.027 14.057-6.31.222-.326.233-.751.028-1.088z"></path><path fill="#DD2E44" d="M24.586 19.016c-.371 5.51 1.316 9.861-4.194 9.489-5.51-.371-10.145-4.92-9.774-10.431s14.34-4.568 13.968.942z"></path><path fill="#DD2E44" d="M23.257 12.412c-.353 5.235-3.922 9.257-9.156 8.904-5.235-.353-9.193-4.882-8.84-10.117.353-5.235 4.832-8.444 10.067-8.091 4.001.269 8.24 4.683 7.929 9.304z"></path><circle fill="#292F33" cx="10.67" cy="8.989" r="2"></circle><path fill="#A0041E" d="M18.179 16.645s7.63 5.648 12.387-4.459c.396-.842 1.685.793.099 4.162s-8.175 6.44-12.04 1.536c-.815-1.035-.446-1.239-.446-1.239z"></path><path fill="#DD2E44" d="M15.327 3.107s6.246.254 7.798-.477.136 2.932-3.262 3.789-4.536-3.312-4.536-3.312z"></path><path fill="#DD2E44" d="M17.428 5.788s4.501.136 6.054-.594.136 2.932-3.262 3.789c-3.399.857-2.792-3.195-2.792-3.195z"></path></svg></div><div class="css-pbmhrg"><p>笔者更喜欢显式的 merge 方案</p></div></div><h3 id="push-">push 参数</h3><p><code>push</code>命令的参数格式如下：<code>git push remote place</code>!</p><p>看一条命令：<code>git push origin main</code>!</p><p>这条命令或许会让你感到熟悉，其意义是切到本地的<code>main</code>分支，获取提交。再到远程仓库<code>origin</code>中找到<code>main</code>分支，将远程仓库中没有的提交记录传上去。</p><p><div class="css-sjjdi9"><img alt="image-20220213161534631" src="/blog/mdImgs/image-20220213161534631.png"/></div></p><p>此时，如果我们需要将本地的两个分支分别推送到远程仓库，则可以:</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-bash">$ git push origin main
$ git push origin foo</code></pre></div></div></details><p><div class="css-sjjdi9"><img alt="image-20220213161523557" src="/blog/mdImgs/image-20220213161523557.png"/></div></p><p>当<code>place</code>参数为<code>main</code>时，我们同时指定了提交记录的来源和去向。</p><h3 id="qa">Q&amp;A</h3><ul><li>如何方便地添加<code>.gitignore</code>？
<ul><li><a href="https://www.toptal.com/developers/gitignore">gitignore.io - 为你的项目创建必要的 .gitignore 文件</a></li><li>手动编辑，更新一些独特的配置</li></ul></li><li>本地已经存在的项目如何和远程仓库关联？
<ul><li><code>git remote add origin &lt;your-repo-git-url&gt;</code></li></ul></li><li>查看提交的内容？
<ul><li><code>git show &lt;hash_id&gt;</code></li></ul></li><li>查看提交的日志和 ID 列表？
<ul><li><code>git reflog</code></li></ul></li><li>修改刚刚提交的<code>commit message</code>？
<ul><li><code>git commit --amend -m &#x27;new log&#x27;</code></li></ul></li><li>想把当前工作区的内容重置到上一个记录版本？
<ul><li><code>git reset --hard HEAD</code></li><li><code>git checkout --targetFileName</code></li></ul></li><li>撤销被添加到暂存区的文件？
<ul><li><code>git reset --mixed HEAD</code></li></ul></li><li>如何撤销已经提交到远程主机的文件？
<ul><li><code>git revert &lt;commit_id&gt;</code></li><li><code>git revert HEAD</code></li></ul></li><li>如何在不 commit 的情况下保存现场？
<ul><li><code>git stash</code> 保存，<code>git stash pop</code>恢复</li></ul></li></ul><h3 id="">最后</h3><p>这玩意没这么简单，想增强应用能力多吃点亏吧！（对自己说的</p></div></div></div></main><style data-emotion-css="1fic0ux">.css-1fic0ux{border:0;opacity:0.6;border-bottom:0.0625rem solid;width:auto;margin-top:0.5rem;margin-bottom:0.5rem;border-color:inherit;}</style><hr class="css-1fic0ux"/><style data-emotion-css="1w0yaz1">.css-1w0yaz1{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;max-width:1100px;margin:0 auto;}@media screen and (min-width:30em){.css-1w0yaz1{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}}@media screen and (min-width:48em){.css-1w0yaz1{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}}@media screen and (min-width:62em){.css-1w0yaz1{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}}</style><div class="css-1w0yaz1"><style data-emotion-css="5ez2yz">.css-5ez2yz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;max-width:440px;margin:2rem auto;}</style><div class="css-5ez2yz"><style data-emotion-css="bi78j0">.css-bi78j0{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";margin-bottom:0.5rem;}</style><p class="css-bi78j0">友链</p><style data-emotion-css="2imjyh">.css-2imjyh{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}</style><div class="css-2imjyh"><style data-emotion-css="y9ryki">.css-y9ryki{font-size:calc(3rem / 2.5);line-height:3rem;vertical-align:top;display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;border-radius:9999px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;position:relative;width:3rem;height:3rem;background-color:#A0AEC0;color:#fff;}</style><div style="cursor:pointer" class="css-y9ryki"><style data-emotion-css="uwwqev">.css-uwwqev{width:100%;height:100%;}</style><div class="css-uwwqev"><svg fill="#fff" viewBox="0 0 128 128" role="img"><g><path d="M103,102.1388 C93.094,111.92 79.3504,118 64.1638,118 C48.8056,118 34.9294,111.768 25,101.7892 L25,95.2 C25,86.8096 31.981,80 40.6,80 L87.4,80 C96.019,80 103,86.8096 103,95.2 L103,102.1388 Z"></path><path d="M63.9961647,24 C51.2938136,24 41,34.2938136 41,46.9961647 C41,59.7061864 51.2938136,70 63.9961647,70 C76.6985159,70 87,59.7061864 87,46.9961647 C87,34.2938136 76.6985159,24 63.9961647,24"></path></g></svg></div></div></div></div><style data-emotion-css="1a1kbs3">.css-1a1kbs3{margin:2rem;text-align:center;margin-left:auto;}</style><div class="css-1a1kbs3"><p id="msg">谢谢你能看到这里!<span role="img" aria-label="emoji">🤗</span> 如果你有任何想与我讨论的内容,请给我发邮件.<span role="img" aria-label="emoji">🕊</span></p><br/><a style="text-decoration:none" href="mailto:rivenqinyy@gmail.com"><style data-emotion-css="meafa5">.css-meafa5{display:inline-block;padding-left:0.25rem;padding-right:0.25rem;text-transform:uppercase;font-size:0.75rem;border-radius:0.125rem;font-weight:700;white-space:nowrap;vertical-align:middle;background-color:#c6f6d5;color:#22543d;}</style><div class="css-meafa5">我的邮件</div><span role="img" aria-label="my email">📮</span></a><br/><br/><style data-emotion-css="1fb5c92">.css-1fb5c92{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";color:#4A5568;font-size:.7rem;}</style><p class="css-1fb5c92">妙才 © 2020. All rights reserved.</p></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"工作中需要用到的Git知识","content":"\n### 前言\n\n入职新公司之后醒悟到自己之前对`Git`的了解依然太少，故整理一下工作中会用到的所有`Git`操作知识。\n\n\u003e [Learn Git Branching](https://learngitbranching.js.org/?locale=zh_CN): 强推边学边玩的游戏教程\n\n\n\n### 浅尝辄止\n\n#### commit \n\n提交记录可以视为项目的快照，如下如所示：\n\n初始阶段：\n\n\u003cimg src=\"mdImgs/image-20220210135808631.png\" alt=\"image-20220210135808631\" style=\"zoom:50%;\" /\u003e\n\n增加了新的内容，再次使用`git commit`任务提交新内容之后：\n\n\u003cimg src=\"mdImgs/image-20220210135912104.png\" alt=\"image-20220210135912104\" style=\"zoom:50%;\" /\u003e\n\n新的节点生成了。\n\n#### branch\n\n开发新的需求时，创建新的分支去提交此需求的代码是一个非常好的办法。继续看示例，如下是默认情况：\n\n\u003cimg src=\"mdImgs/image-20220210140153996.png\" alt=\"image-20220210140153996\" style=\"zoom:50%;\" /\u003e\n\n现在，我们要新增一个功能，为此我们想创建一个名为`newImage`的新分支：\n\n`git branch newImage`\n\n\u003cimg src=\"mdImgs/image-20220210140307559.png\" alt=\"image-20220210140307559\" style=\"zoom:50%;\" /\u003e\n\n创建了分支之后，还需要切换分支到目标分支上去开发新功能：\n\n\u003e git checkout -b newImage: 创建并切换分支\n\n`git checkout newImage`或`git switch newImage`\n\n\u003cimg src=\"mdImgs/image-20220210140521088.png\" alt=\"image-20220210140521088\" style=\"zoom:50%;\" /\u003e\n\n现在，所有新增的内容再`commit`，则会以当前分支为起点创建新的节点`c2`：\n\n\u003cimg src=\"mdImgs/image-20220210140612918.png\" alt=\"image-20220210140612918\" style=\"zoom:50%;\" /\u003e\n\n#### merge\n\n当新分支功能实现之后，我们可以将此分支合并到项目主分支上去。\n\n合并分支不止有一种方法，现在来看第一种：`git merge`。\n\n继续看示例：\n\n\u003cimg src=\"mdImgs/image-20220210141214004.png\" alt=\"image-20220210141214004\" style=\"zoom:50%;\" /\u003e\n\n当前我们的`bugFix`分支开发完成，为了合并到`main`分支，我们先切换到了`main`分支。\n\n然后：\n\n`git merge bugFix`\n\n\u003cimg src=\"mdImgs/image-20220210141330337.png\" alt=\"image-20220210141330337\" style=\"zoom:50%;\" /\u003e\n\n此时，`main`分支当前节点会接上`bugFix`的`c2`节点，此时`main`节点就包含了`bugFix`节点上的所有内容。但是，这时候还不算成功合并这俩分支。\n\n我们需要继续执行`bugFix`分支上的合并命令：\n\n`git switch bugFix;git merge main`\n\n\u003cimg src=\"mdImgs/image-20220210141605243.png\" alt=\"image-20220210141605243\" style=\"zoom:50%;\" /\u003e\n\n现在，每一个分支都包含了所有代码了。\n\n#### rebase\n\n*rebase 将会取出一系列提交记录，复制并且放到另一个地方*。\n\n看示例：\n\n现在我们有两个分支如下所示：\n\n\u003cimg src=\"mdImgs/image-20220210144128221.png\" alt=\"image-20220210144128221\" style=\"zoom:50%;\" /\u003e\n\n在`bugFix`分支上执行命令：`git rebase main`\n\n\u003cimg src=\"mdImgs/image-20220210144738544.png\" alt=\"image-20220210144738544\" style=\"zoom:50%;\" /\u003e\n\n现在，`Copy`了 `C3`节点的所有工作内容放在了`main`分支后，并且作为一个新的节点，`C3'`是`C3`的副本，此时这两个节点同时存在。\n\n接着，我们可以切到`main`分支上再`rebase`到`bugFix`分支上！\n\n`git switch main;git rebase bugFix`\n\n\u003cimg src=\"mdImgs/image-20220210145113041.png\" alt=\"image-20220210145113041\" style=\"zoom:50%;\" /\u003e\n\n此时，我们就完成了分支的合并。\n\n### 循序渐进\n\n接下来的目标是弄懂如何在提交树上移动。\n\n#### 分离 HEAD\n\n\u003e HEAD 永远指向当前分支上最近一次的提交记录（头部~）\n\n通常情况下，HEAD 指向分支名。所谓分离 HEAD 指的是让 HEAD 指向某个具体的提交记录而不是分支名。\n\n如下图：\n\n\u003cimg src=\"mdImgs/image-20220210150937337.png\" alt=\"image-20220210150937337\" style=\"zoom:50%;\" /\u003e\n\n此时 HEAD 指向 main，main 指向 C1！\n\n我们可以通过`git checkout C1`（C1 指代提交记录的哈希值）来分离 HEAD！\n\n\u003cimg src=\"mdImgs/image-20220210151253672.png\" alt=\"image-20220210151253672\" style=\"zoom:50%;\" /\u003e\n\n#### 相对引用\n\n在实际项目中，并不存在默认的图示化支持，所以需要用`git log`来查看日志。\n\n\u003e 切记分支用 branch，HEAD 用 checkout\n\n每一条`commit`都有自己唯一的哈希值，除了使用哈希值之外，还可以用相对引用。\n\n- `^`向上移动一个提交记录\n- `~3` 可以是任意合理的数字，示例为向上移动三个提交记录 \n\n看示例：\n\n\u003cimg src=\"mdImgs/image-20220210151826055.png\" alt=\"image-20220210151826055\" style=\"zoom:50%;\" /\u003e\n\n现在，我们可以使用`git checkout main^`来切换到`main`分支的父节点。\n\n\u003cimg src=\"mdImgs/image-20220210151958145.png\" alt=\"image-20220210151958145\" style=\"zoom:50%;\" /\u003e\n\n比如我们有这样一个场景：\n\n\u003cimg src=\"mdImgs/image-20220210152303465.png\" alt=\"image-20220210152303465\" style=\"zoom:50%;\" /\u003e\n\n现在需要让`main`分支恢复到节点`C1`:\n\n`git branch -f main HEAD~3`即可强制让`main`分支相对引用上层第三个节点。\n\n\u003cimg src=\"mdImgs/image-20220210152439000.png\" alt=\"image-20220210152439000\" style=\"zoom:50%;\" /\u003e\n\n#### 撤销变更\n\n人总有犯错的时候，Git 允许我们撤销不必要的变更。\n\n撤销变更的方式分为：\n\n- reset\n- revert\n\n##### reset\n\n首先是`reset`!\n\n\u003cimg src=\"mdImgs/image-20220210153918207.png\" alt=\"image-20220210153918207\" style=\"zoom:50%;\" /\u003e\n\n然后执行重置命令：`git reset HEAD^`\n\n\u003cimg src=\"mdImgs/image-20220210153956095.png\" alt=\"image-20220210153956095\" style=\"zoom:50%;\" /\u003e\n\n##### revert\n\n\u003e Reset 通常用于修改本地提交记录，如果需要撤销更改并且分享给别人，则需要`git revert`\n\n\u003cimg src=\"mdImgs/image-20220210154110580.png\" alt=\"image-20220210154110580\" style=\"zoom:50%;\" /\u003e\n\n执行命令`git revert HEAD`:\n\n\u003cimg src=\"mdImgs/image-20220210155612888.png\" alt=\"image-20220210155612888\" style=\"zoom:50%;\" /\u003e\n\n使用`revert`将会新增一个提交，这个提交基于撤销的目标位置，也就是说`C2'`的状态和`C1`是相同的。\n\n### 渐入佳境\n\n或许上述命令已经能够让你应对百分之工作中 90% 的 Git 问题，但是在处理复杂工作流时，还需要了解更多内容。\n\n接下来我们谈谈如何整理提交记录。\n\n#### Cherry-pick\n\n如果你想将一些提交复制到当前所在的位置(HEAD)下面的话，可以试试`Cherry-pick`，来看看这个场景：\n\n\u003cimg src=\"mdImgs/image-20220210164646032.png\" alt=\"image-20220210164646032\" style=\"zoom:50%;\" /\u003e\n\n我想把`side`分支上的工作复制到`main`分支，显然`rebase`也可以实现。\n\n但是我们来看看`cherry-pick`如何处理这个需求：\n\n`git cherry-pick c2 c4`\n\n\u003cimg src=\"mdImgs/image-20220210165225268.png\" alt=\"image-20220210165225268\" style=\"zoom:50%;\" /\u003e\n\n这样就能将`C2`和`C4`的内容复制到了当前分支下，这样一来`main`分支就包含了`C2`和`C4`的内容。\n\n#### 交互式 Rebase\n\n当我们不知道提交记录哈希值时，可以选择使用交互式的`rebase`操作来实现相同的效果。\n\n交互式`rebase`指的是带参数的`rebase`，核心参数是`--interactive`(-i 简写)。\n\n`git`会选择默认的编辑器去处理顺序。\n\n![image-20220210174950934](mdImgs/image-20220210174950934.png)\n\n我们可以删除某些`pick`行，也可以修改行为，更换顺序来处理`rebase`的问题。\n\n### 杂项\n\n#### 提交的技巧\n\n##### 场景 1\n\n有这么一个场景，代码出现了某个棘手的`BUG`，为了方便调试而在代码中添加了一些调试命令并向控制台打印了这些信息，当问题解决之后代码提交之前，我们如何更快地排除那些调试代码呢？\n\n当我们发现`bug`出现在文件`a.js`，但是调试信息遍布整个目录，这时候我们可以让`git`复制解决问题的那一个提交记录即可。\n\n\u003cimg src=\"mdImgs/image-20220210180636221.png\" alt=\"image-20220210180636221\" style=\"zoom:50%;\" /\u003e\n\n我们只需要`bugFix`这个提交，因此为了将之合并到`main`分支上去，我们可以：\n\n```bash\n$ git rebase -i main --solution-ordering C4\n$ git rebase bugFix main\n```\n\n\u003cimg src=\"mdImgs/image-20220210182452714.png\" alt=\"image-20220210182452714\" style=\"zoom:50%;\" /\u003e\n\n甚至，只需要将`bugFix`分支的内容复制到`main`分支后面即可：\n\n```bash\n$ git switch main\n$ git cherry-pick C4\n```\n\n\u003cimg src=\"mdImgs/image-20220210181703119.png\" alt=\"image-20220210181703119\" style=\"zoom:50%;\" /\u003e\n\n##### 场景 2\n\n我在`newImage`分支上提交了一些更新，然后又基于此节点创建了`caption`分支，然后又提交了一次。\n\n但是由于某些原因，我得在原来的提交记录上(`newImage分支`)做一些更新(我不希望这些更新记录在当前的位置)。\n\n我们可以这样实现这个需求：\n\n- 用`git rebase -i`重新排序之前的提交，将目标记录挪到最前面\n- 用`git commit --amend` 进行小修改\n- 再用`git rebase -i`恢复原来的顺序\n- 最后把`main`移动到最前端\n\n最初的状态图如下：\n\n\u003cimg src=\"mdImgs/image-20220210212704433.png\" alt=\"image-20220210212704433\" style=\"zoom: 67%;\" /\u003e\n\n命令如下：\n\n```bash\n$ git rebase -i c1\n# 更换 c2 和 c3 的顺序\n$ git commit --amend\n# 此时，更新头部\n$ git rebase -i c1\n# 恢复 c2 和 c3 的顺序\n$ git rebase caption main\n# 合并分支 main 和 caption\n```\n\n![image-20220210214641095](mdImgs/image-20220210214641095.png)\n\n##### 场景 3\n\n当我们将想要的提交记录移动到最前端时，可以用`--amend`修改它，但是这样可能会造成由`rebase`产生的冲突。\n\n除了使用上述方案，还可以选择`cherry-pick`来实现。\n\n\u003e 牢记`cherry-pick`可以将树上的提交记录追加到`HEAD`上来。\n\n![image-20220210215346574](mdImgs/image-20220210215346574.png)\n\n现在，我们需要在`newImage`分支节点`C2`上做一些修改，首先让我们切换到`main`上。\n\n```bash\n# 切换到 main\n$ git switch main\n# 将 C2 挪到 main 的下一步\n$ git cherry-pick C2\n# 提交修改\n$ git commit --amend\n# 将 C3 移动到当前节点末尾\n$ git cherry-pick C3\n```\n\n现在，我们实现了针对性修改中间节点记录。\n\n![image-20220210215752988](mdImgs/image-20220210215752988.png)\n\n#### Tag\n\n分支易变，为了便于定位到记录，我们可以创建标签（`Tag`），每一个标签都可以视为一个里程碑，我们可以像用分支一样用标签，并且它不会移动，标签页是一个锚点。\n\n让我们为提交记录`C1`创建一个标签`v1`:\n\n![image-20220210224729142](mdImgs/image-20220210224729142.png)\n\n执行命令：\n\n```bash\n$ git tag v1 C1\n```\n\n![image-20220210224814517](mdImgs/image-20220210224814517.png)\n\n如果我们再想快速切换到具有特殊意义的地方，就可以通过`checkout tagName`快速完成切换。\n\n此外，`git describe \u003cref\u003e`可以展示最近的一个标签信息。`ref`是可选的记录引用，你可以写哈希值、标签、分支，甚至什么都不写，默认为当前`HEAD`位置。\n\n输出的结果如下：\n\n`\u003c标签名\u003e_\u003cref和标签之间的提交记录数\u003e_g\u003cref的哈希特征值\u003e`\n\n如果我们有这样一个场景：\n\n![image-20220210225857113](mdImgs/image-20220210225857113.png)\n\n那么会有以下输入和输出：\n\n```bash\n$ git describe main\n# 输出 v1_2_gC2\n$ git describe side\n# 输出 v2_1_gC4\n```\n\n#### 多分支 rebase\n\n我们为了开发某些功能，每一个功能都创建了单独的分支，现在要将这些分支全部合并到`main`分支上去。\n\n![image-20220210231612410](mdImgs/image-20220210231612410.png)\n\n现在，我们有主分支`main`，其他任务分支：\n\n- `bugFix`\n- `side`\n- `another`\n\n为了将任务分支合并到主分支下，可以逐步`rebase`：\n\n```bash\n$ git rebase main bugFix # 将 bugFix rebase 到 main 下\n$ git rebase bugFix side # 将 side rebase 到 bugFix 下\n$ git rebase side another # 类似\n$ git rebase HEAD main # 可以使用 HEAD 代替分支名，这时候 HEAD 总是在当前适宜的位置\n```\n\n#### 多上层记录\n\n看看这个场景：\n\n![image-20220210233314336](mdImgs/image-20220210233314336.png)\n\n如果我们执行:`git checkout main^`，那么`HEAD`将会分离到`C1`，如果想分离到`C2`该怎么做？\n\n答案很简单：`git checkout main^2`\n\n继续看示例：\n\n![image-20220210233534390](mdImgs/image-20220210233534390.png)\n\n如果想快速切换到 `C3`，我们可以：\n\n```bash\n$ git checkout HEAD^\n$ git chekcout HEAD^2 # 选择第二个方向\n$ git checkout HEAD~2 # 继续向上 2 个记录\n# 甚至可以将这些操作连起来\n$ git checkout HEAD~^2~2\n```\n\n#### 最终试炼\n\n现在是最后一关，前方是复杂且纠缠不清的分支。\n\n现在我们的 `main` 分支是比 `one`、`two` 和 `three` 要多几个提交。出于某种原因，我们需要把 `main` 分支上最近的几次提交做不同的调整后，分别添加到各个的分支上。\n\n`one` 需要重新排序并删除 `C5`，`two` 仅需要重排排序，而 `three` 只需要提交一次。\n\n![image-20220210235203491](mdImgs/image-20220210235203491.png)\n\n为了实现目的，我们得单独处理这些分支，一步步来：\n\n```bash\n$ git rebase -i one c5 # 然后删除 c5，再重新排序\n$ git rebase -i two c5 # 重排序\n$ git rebase c2'' two # 处理好分支的位置\n$ git rebase c2 three # 同上\n```\n\n结果是：\n\n![image-20220210235444896](mdImgs/image-20220210235444896.png)\n\n### 下一步\n\n此前都提及本地仓库的操作，接下来我们继续学习远程仓库的知识。\n\n远程仓库是我们重要的数据备份源，即使本地也可以将文件恢复到指定的版本，但是所有信息都是保存在本地的，当我们本地信息丢失的时候，依靠远程仓库依然可以回复数据。\n\n#### clone\n\n`git clone`命令或许是每一个接触`github`的开发者最先熟悉的命令，其作用是在本地创建一个远程仓库的拷贝。\n\n![image-20220212173912157](mdImgs/image-20220212173912157.png)\n\n虚线是远程仓库，当我们克隆仓库到本地的时候，本地仓库多了一个分支：`o/main`，这种分支我们称为远程分支。每一个远程分支都默认遵循命名规范：`remotName/branchName`，通常远程仓库名为`origin`。\n\n`checkout`远程`origin/main`将会分离`HEAD`到新的节点上去，这是因为`origin/main`只有在远程分支更新之后才会更新。\n\n![image-20220212174633117](mdImgs/image-20220212174633117.png)\n\n#### fetch\n\nGit 远程仓库可以接收本地仓库的数据，本地仓库也可以接收远程仓库的数据。当我们从远程仓库获取数据时，本地的远程分支也会更新。\n\n![image-20220212175246921](mdImgs/image-20220212175246921.png)\n\n显然，上述场景下远程仓库具有新内容，本地需要获取更新可以使用`git fetch`命令。\n\n![image-20220212175339167](mdImgs/image-20220212175339167.png)\n\n现在，本地的远程分支也更新到了远程仓库最新的状态。但是我们需要知道，`fetch`并不会更新本地分支`main`的状态，也不会更新当前磁盘上的文件，因此本地仓库和远程仓库并没有完成同步，即使数据已经通过`http`或`git`协议下载到了本地。\n\n\u003e 当然，我们可以用 cherry-pick o/main\n\u003e\n\u003e 可以用 git rebase o/main\n\u003e\n\u003e 甚至是 git merge o/main\n\n为了同步远程和本地数据，我们可以用另一个命令。\n\n#### pull\n\n`git pull`等于`git fetch;git merge o/main`二者的和。\n\n![image-20220212180042763](mdImgs/image-20220212180042763.png)\n\n\n\n上述场景表示远程分支具有更新，本地`main`分支也有更新，执行`git pull`后的关系如下：\n\n![image-20220212180147692](mdImgs/image-20220212180147692.png)\n\n此时，本地同步了远程的数据，并且本地的远程分支也更新到了远程的相同节点。\n\n为了完全同步本地和远程数据，我们还需要将本地新的内容传到远程仓库。\n\n#### push\n\n\u003e 开发者们像地精一样在洞穴里捣鼓着自己的作品，终于在某个时刻可以回到地面跟大家分享自己的成果。\n\n`git push`可以将本地仓库的数据推送到远程仓库，并且在远程仓库合并本地的这个提交记录，在合并完成之后你的数据就能够被其他人从远程仓库下载了。\n\n显然，这跟`fetch`相比，可以反向理解二者之间的差异。\n\n有时候，我们的`push`会失败，来看看这个场景。\n\n![image-20220212212014191](mdImgs/image-20220212212014191.png)\n\n本地的远程分支基于远程仓库的节点`C1`，此时再`push`过去，远程将拒绝我们的推送。远程仓库会提示让我们先将远程的数据`fetch`下来。\n\n然后通过`git rebase o/main`将远程的数据和本地合并。现在本地分支和本地远程分支在同一个位置了。此时再`push`到远程就可以将本地的更新和远程同步。\n\n有没有更简短的方法？\n\n有。\n\n`git pull --rebase;git push`即可将远程的内容更新到本地，再推送本地的更新同步本地和远程的仓库。\n\n![image-20220212213344839](mdImgs/image-20220212213344839.png)\n\n现在，本地提交了新内容，远程也有所更新。本地的远程分支`o/main`已经不跟远程仓库同步。\n\n为了同步数据，我们需要执行以下命令：\n\n```bash\n$ git pull --rebase\n$ git push\n```\n\n第一步将得到这样的结果：\n\n\u003cimg src=\"mdImgs/image-20220212213542581.png\" alt=\"image-20220212213542581\" style=\"zoom:50%;\" /\u003e\n\n第二步则实现了需求：\n\n\u003cimg src=\"mdImgs/image-20220212213617316.png\" alt=\"image-20220212213617316\" style=\"zoom:50%;\" /\u003e\n\n### Remote Rejected\n\n当提交了本地内容再试着`push`到远程仓库时，会提示`Remote rejected!`\n\n当`main`被锁定的时候，需要一些`pull request`流程来合并修改。\n\n\u003e 这样有利于大团队做`code review`。\n\n什么才是正确的做法✅？\n\n我们应该按流程新建一个分支！然后`push`这个分支并且申请`pull request`。\n\n如果我们直接一把梭，强行`push`，那么本地的分支就会卡住，我们需要新建一个分支`feature`，推送到服务器，并且`reset`本地的`main`分支和远程服务器保持一致。\n\n继续看示例：\n\n\u003cimg src=\"mdImgs/image-20220213145918251.png\" alt=\"image-20220213145918251\" style=\"zoom:67%;\" /\u003e\n\n现在，本地有所更新，且远程仓库的`main`分支是被锁定的。\n\n为了将本地的内容提交一个合并请求，需要单独将本地当前内容用一个分支去处理。\n\n```bash\n# 先创建并且切换到 feature 分支上\n$ git checkout -b feature\n# 推送此分支\n$ git push origin feature\n$ git switch main\n# 恢复到 origin/main 分支\n$ git reset main^\n```\n\n\n\n### 合并分支\n\n在大型项目中，开发人员通常会在`main`上分出来的任务分支上开发，完成后做一次集成。\n\n继续看场景：\n\n![image-20220213150626046](mdImgs/image-20220213150626046.png)\n\n现在，我们需要逐一将本地特征分支上传到远程仓库，并且完成合并同步。\n\n```bash\n# 首先，将远程数据 fetch 下来\n$ git fetch\n# 将 side1 分支 rebase 到当前远程主分支后面\n$ git rebase o/main side1\n# 逐一 rebase 分支和本地 main 分支\n$ git rebase side1 side2\n$ git rebase side2 side3\n$ git rebase side3 main\n# 推送本地成果到远程\n$ git push\n```\n\n![image-20220213155038688](mdImgs/image-20220213155038688.png)\n\n除了使用`rebase`来解决这个问题，还可以用`merge`去合并。\n\n\u003e merge 和 rebase 都可以，但是 rebase 构建的关系图谱更简洁，而 merge 则可以保存分支之间的记录独立性，没有最佳的方式，只有最适合你的方式。\n\n```bash\n$ git fetch\n$ git switch main\n$ git pull\n$ git merge side1\n$ git merge side2\n$ git merge side3\n$ git push\n```\n\n![image-20220213154831567](mdImgs/image-20220213154831567.png)\n\n\u003e 笔者更喜欢显式的 merge 方案\n\n### push 参数\n\n`push`命令的参数格式如下：`git push remote place `!\n\n看一条命令：`git push origin main`!\n\n这条命令或许会让你感到熟悉，其意义是切到本地的`main`分支，获取提交。再到远程仓库`origin`中找到`main`分支，将远程仓库中没有的提交记录传上去。\n\n![image-20220213161534631](mdImgs/image-20220213161534631.png)\n\n此时，如果我们需要将本地的两个分支分别推送到远程仓库，则可以:\n\n```bash\n$ git push origin main\n$ git push origin foo\n```\n\n![image-20220213161523557](mdImgs/image-20220213161523557.png)\n\n当`place`参数为`main`时，我们同时指定了提交记录的来源和去向。\n\n### Q\u0026A\n\n- 如何方便地添加`.gitignore`？\n  - [gitignore.io - 为你的项目创建必要的 .gitignore 文件](https://www.toptal.com/developers/gitignore)\n  - 手动编辑，更新一些独特的配置\n- 本地已经存在的项目如何和远程仓库关联？\n  - `git remote add origin \u003cyour-repo-git-url\u003e`\n- 查看提交的内容？\n  - `git show \u003chash_id\u003e`\n- 查看提交的日志和 ID 列表？\n  - `git reflog`\n- 修改刚刚提交的`commit message`？\n  - `git commit --amend -m 'new log'`\n- 想把当前工作区的内容重置到上一个记录版本？\n  - `git reset --hard HEAD`\n  - `git checkout --targetFileName`\n- 撤销被添加到暂存区的文件？\n  - `git reset --mixed HEAD`\n- 如何撤销已经提交到远程主机的文件？\n  - `git revert \u003ccommit_id\u003e`\n  - `git revert HEAD`\n- 如何在不 commit 的情况下保存现场？\n  - `git stash` 保存，`git stash pop`恢复\n\n\n\n### 最后\n\n这玩意没这么简单，想增强应用能力多吃点亏吧！（对自己说的\n","title":"工作中需要用到的Git知识","date":"2022/2/10","tags":["Git"],"mainImg":"https://images.unsplash.com/photo-1607705703571-c5a8695f18f6?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwxNjUyNjZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2NDQ0NzI0MDU\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=1080","coverImg":"https://images.unsplash.com/photo-1607705703571-c5a8695f18f6?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwxNjUyNjZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2NDQ0NzI0MDU\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=400","intro":"Git 日常操作须知！"}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"工作中需要用到的Git知识"},"buildId":"GG72nMgj-Tc-G-RfY6uev","assetPrefix":"/blog","nextExport":false,"isFallback":false,"gsp":true,"head":[["meta",{"name":"viewport","content":"width=device-width"}],["meta",{"name":"description","content":"javascript node deno linux web developer"}],["meta",{"charSet":"utf-8"}],["link",{"rel":"icon","href":"data:image/svg+xml,\u003csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22\u003e\u003ctext y=%22.9em%22 font-size=%2290%22\u003e🎯\u003c/text\u003e\u003c/svg\u003e"}],["link",{"rel":"stylesheet","href":"https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css"}],["title",{"children":"工作中需要用到的Git知识"}],["link",{"rel":"stylesheet","href":"https://cdn.jsdelivr.net/npm/reset-css@5.0.1/reset.min.css"}],["link",{"rel":"stylesheet","href":"/blog/post.css"}],["script",{"async":true,"src":"https://www.googletagmanager.com/gtag/js?id=G-J0BNBT8YXG"}],["script",{"dangerouslySetInnerHTML":{"__html":"\u003c!-- Global site tag (gtag.js) - Google Analytics --\u003e\n            window.dataLayer = window.dataLayer || [];\n            function gtag(){dataLayer.push(arguments);}\n            gtag('js', new Date());\n            gtag('config', 'G-J0BNBT8YXG');"}}],["style",{}]]}</script><script nomodule="" src="/blog/_next/static/chunks/polyfills-86dac49abe0e0232b575.js"></script><script src="/blog/_next/static/chunks/main-c37f7d67026ad75148c3.js" async=""></script><script src="/blog/_next/static/chunks/webpack-eb080e3f091731f228fb.js" async=""></script><script src="/blog/_next/static/chunks/framework.1daf1ec1ecf144ee9147.js" async=""></script><script src="/blog/_next/static/chunks/commons.cb58dfc173e18379cc5b.js" async=""></script><script src="/blog/_next/static/chunks/6335da8543c52d3af527c387f688061357787349.aa32db8a194765817dea.js" async=""></script><script src="/blog/_next/static/chunks/pages/_app-ec227152ab7c3ab4ac27.js" async=""></script><script src="/blog/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.f2335cbaf06875528bc0.js" async=""></script><script src="/blog/_next/static/chunks/pages/posts/%5Bslug%5D-a3b98341ead03cf4e1a2.js" async=""></script><script src="/blog/_next/static/GG72nMgj-Tc-G-RfY6uev/_buildManifest.js" async=""></script><script src="/blog/_next/static/GG72nMgj-Tc-G-RfY6uev/_ssgManifest.js" async=""></script></body></html>