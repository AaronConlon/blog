<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta name="description" content="javascript node deno linux web developer"/><meta charSet="utf-8"/><link rel="icon" href="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text y=%22.9em%22 font-size=%2290%22&gt;ğŸ¯&lt;/text&gt;&lt;/svg&gt;"/><title>javascript å®šæ—¶å™¨ä¸ç³»ç»Ÿæ—¶é—´è¡¥å¿</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reset-css@5.0.1/reset.min.css"/><link rel="stylesheet" href="/blog/post.css"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-J0BNBT8YXG"></script><script><!-- Global site tag (gtag.js) - Google Analytics -->
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-J0BNBT8YXG');</script><link rel="preload" href="/blog/_next/static/css/15b7ac151cc27d0bf446.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/15b7ac151cc27d0bf446.css" data-n-g=""/><link rel="preload" href="/blog/_next/static/css/59a87fe619da797e3375.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/59a87fe619da797e3375.css" data-n-p=""/><noscript data-n-css="true"></noscript><link rel="preload" href="/blog/_next/static/chunks/main-c37f7d67026ad75148c3.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/webpack-eb080e3f091731f228fb.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/framework.1daf1ec1ecf144ee9147.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/commons.cb58dfc173e18379cc5b.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/6335da8543c52d3af527c387f688061357787349.aa32db8a194765817dea.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/pages/_app-ebdd114948c696bf4519.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.7a872eda8469b3325c5d.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/pages/posts/%5Bslug%5D-5d143f0d2b02a907308e.js" as="script"/></head><body><div id="__next"><style data-emotion-css="d6jcgn">html{line-height:1.15;-webkit-text-size-adjust:100%;}body{margin:0;}main{display:block;}h1{font-size:2em;margin:0.67em 0;}hr{box-sizing:content-box;height:0;overflow:visible;}pre{font-family:monospace,monospace;font-size:1em;}a{background-color:transparent;}abbr[title]{border-bottom:none;-webkit-text-decoration:underline;text-decoration:underline;-webkit-text-decoration:underline dotted;-webkit-text-decoration:underline dotted;text-decoration:underline dotted;}b,strong{font-weight:bolder;}code,kbd,samp{font-family:monospace,monospace;font-size:1em;}small{font-size:80%;}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline;}sub{bottom:-0.25em;}sup{top:-0.5em;}img{border-style:none;}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0;}button,input{overflow:visible;}button,select{text-transform:none;}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0;}fieldset{padding:0.35em 0.75em 0.625em;}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal;}progress{vertical-align:baseline;}textarea{overflow:auto;}[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0;}[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{-webkit-appearance:none !important;}input[type="number"]{-moz-appearance:textfield;}[type="search"]{-webkit-appearance:textfield;outline-offset:-2px;}[type="search"]::-webkit-search-decoration{-webkit-appearance:none !important;}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit;}details{display:block;}summary{display:list-item;}template{display:none;}[hidden]{display:none !important;}html{box-sizing:border-box;font-family:sans-serif;}*,*::before,*::after{box-sizing:border-box;}blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0;}button{background:transparent;padding:0;}fieldset{margin:0;padding:0;}ol,ul{margin:0;padding:0;}html{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";line-height:1.5;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%;text-rendering:optimizelegibility;}hr{border-top-width:1px;}img{border-style:solid;}textarea{resize:vertical;}button,[role="button"]{cursor:pointer;}button::-moz-focus-inner{border:0 !important;}table{border-collapse:collapse;}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit;}a{color:inherit;-webkit-text-decoration:inherit;text-decoration:inherit;}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit;}pre,code,kbd,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle;}img,video{max-width:100%;height:auto;}html{line-height:1.5;color:#1A202C;}*,*::before,*::after{border-width:0;border-style:solid;border-color:#E2E8F0;}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#A0AEC0;}input::-ms-input-placeholder,textarea::-ms-input-placeholder{color:#A0AEC0;}input::-webkit-input-placeholder,textarea::-webkit-input-placeholder{color:#A0AEC0;}input::-moz-placeholder,textarea::-moz-placeholder{color:#A0AEC0;}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#A0AEC0;}input::placeholder,textarea::placeholder{color:#A0AEC0;}</style><div><div class="layout_container__1BBI- css-0"><header><div class="css-0"><style data-emotion-css="em7ozm">.css-em7ozm{font-size:2.25rem;line-height:1.25;font-weight:700;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";text-align:center;margin:0 auto;padding:1.4rem 1rem;color:#0069d6;}@media screen and (min-width:48em){.css-em7ozm{font-size:3rem;}}</style><h1 class="css-em7ozm"><a href="/blog">å¦™æ‰<style data-emotion-css="1i1myri">.css-1i1myri{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";font-size:30%;}</style><sub class="css-1i1myri">blog</sub></a></h1></div></header><main><div class="css-0"><style data-emotion-css="t9c2rr">.css-t9c2rr{width:100%;margin:0 auto;padding-bottom:2rem;max-width:960px;}</style><div class="css-t9c2rr"><style data-emotion-css="8atqhb">.css-8atqhb{width:100%;}</style><img alt="" class="css-8atqhb"/></div><style data-emotion-css="1td051d">.css-1td051d{width:100%;margin:0 auto;max-width:960px;}</style><div class="css-1td051d"><style data-emotion-css="1299f13">.css-1299f13{font-size:1.875rem;line-height:2.5rem!important;font-weight:700;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";text-align:center;overflow:hidden;}@media screen and (min-width:30em){.css-1299f13{line-height:3rem!important;}}@media screen and (min-width:48em){.css-1299f13{font-size:2.25rem;}}</style><h1 class="css-1299f13">javascript å®šæ—¶å™¨ä¸ç³»ç»Ÿæ—¶é—´è¡¥å¿</h1><style data-emotion-css="7e9jz6">.css-7e9jz6{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:2rem;margin:0 auto;margin-right:0.4rem;float:right;}</style><div id="tags" class="css-7e9jz6"><style data-emotion-css="qgikqf">.css-qgikqf{display:inline-block;padding-left:8px;padding-right:0.25rem;text-transform:uppercase;font-size:0.6rem;border-radius:5px;font-weight:700;white-space:nowrap;vertical-align:middle;background-color:#c6f6d5;color:#22543d;height:2rem;line-height:2rem;min-width:4rem;}</style><div class="css-qgikqf">JavaScript</div></div><style data-emotion-css="8ddayy">.css-8ddayy{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;min-height:2rem;max-width:100%;border-radius:0.25rem;font-weight:500;min-width:2rem;padding-left:0.75rem;padding-right:0.75rem;background-color:#c6f6d5;color:#22543d;margin-bottom:2rem;font-size:0.6rem;margin-left:0.4rem;}</style><div class="css-8ddayy">æœ€åæ›´æ–°: <!-- -->2021/4/23</div><div><p>ä»Šå¤©æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹<code>JavaScript</code>ä¸­çš„å‡ ä¸ªå®šæ—¶å™¨ç›¸å…³çš„å‡½æ•°åŠŸèƒ½ä½¿ç”¨ä»¥åŠçŸ¥è¯†ç‚¹åˆ†æï¼Œå¹¶ä¸”ä½¿ç”¨<code>æ—¶é—´è¡¥å¿</code>æœºåˆ¶åˆ›å»º<code>å°½å¯èƒ½å‡†ç¡®</code>çš„å®šæ—¶å™¨ä»»åŠ¡ã€‚</p><h2 id="1-">1. è®¡æ—¶å™¨å‡½æ•°</h2><p>æˆ‘ä»¬éœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œ<code>è®¡æ—¶å™¨å‡½æ•°</code>å¹¶ä¸æ˜¯<code>ECMAScript</code>è§„èŒƒæˆ–è€…<code>v8</code>å¼•æ“å®ç°çš„ä¸€éƒ¨åˆ†ï¼Œæ— è®ºæ˜¯åœ¨æµè§ˆå™¨ç«¯è¿˜æ˜¯åœ¨<code>Nodejs</code>ç«¯ï¼Œ<code>setTimeout</code>å’Œ<code>setInterval</code>è¿™ç±»å®šæ—¶å™¨å‡½æ•°éƒ½æ˜¯<code>globalThis</code>æ¥å£çš„ä¸€éƒ¨åˆ†.</p><blockquote><p>globalThis: ES2020 å¢åŠ çš„æ ‡å‡†ï¼Œæ—¨åœ¨ç»Ÿä¸€ä¸åŒç¯å¢ƒä¸‹çš„å…¨å±€å¯¹è±¡è®¿é—®å…¥å£ï¼Œä¾‹å¦‚ nodejs ä¹‹ globalï¼Œæµè§ˆå™¨ä¹‹ Window / this / frames, web workers ä¹‹ selfã€‚</p></blockquote><h3 id="11-settimeout">1.1 setTimeout</h3><p>é¦–å…ˆæ˜¯<code>setTimeout</code>å‡½æ•°ï¼Œç”¨äºåœ¨æŒ‡å®šçš„æ—¶é—´å»¶è¿Ÿåæ‰§è¡Œä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå…¶è¯­æ³•ä¸ºï¼š</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">let timeoutID = setTimeout(function[, delay, arg1, arg2, ...]);
let timeoutID = setTimeout(function[, delay]);
let timeoutID = setTimeout(code[, delay]);</code></pre></div></div></details><p>é¦–ä¸ªå‚æ•°é€šå¸¸æ˜¯ä¸€ä¸ª<code>å‡½æ•°</code>ï¼Œå¦ä¸€ç§ä¸æ¨èçš„å±é™©é€‰æ‹©æ˜¯é¦–ä¸ªå‚æ•°ä¼ å…¥å¯æ‰§è¡Œçš„å­—ç¬¦ä¸²,è¿™å°†ä¼šåœ¨æŒ‡å®šçš„ delay æ¯«ç§’åç¼–è¯‘æ‰§è¡Œå­—ç¬¦ä¸²ã€‚</p><p><code>delay</code>å‚æ•°æ˜¯å»¶è¿Ÿçš„æ¯«ç§’æ•°ï¼Œçœç•¥æˆ–è€…ä½¿ç”¨è´Ÿæ•°éƒ½å°†é»˜è®¤è®¾ç½®ä¸º 0ï¼Œæ„ä¸ºå°½å¿«æ‰§è¡Œã€‚</p><p>ç¬¬ä¸‰å¯é€‰å‚æ•°åˆ™æ˜¯ä¼ å…¥æ­¤å›è°ƒå‡½æ•°çš„å‚æ•°ï¼ˆIE9 åŠå…¶ä»¥ä¸‹ç‰ˆæœ¬ä¸æ”¯æŒæ­¤ç‰¹æ€§ï¼‰ã€‚</p><p>æ­¤å‡½æ•°è¿”å›ä¸€ä¸ª<code>timeoutID</code>æ˜¯ä¸€ä¸ªå”¯ä¸€çš„æ­£æ•´æ•°ï¼Œå¯ä»¥ä½¿ç”¨<code>clearTimeout(timeoutID)</code>æ¥å–æ¶ˆæ­¤å®šæ—¶å™¨ã€‚</p><h3 id="12-setinterval">1.2 setInterval</h3><p><code>setInterval</code>è¯­æ³•ä¸Šä¸<code>setTimeout</code>ç±»ä¼¼ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ­¤å‡½æ•°åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”ä¸‹å°†ç›¸åŒçš„å›è°ƒå‡½æ•°åŠ å…¥å®ä»»åŠ¡é˜Ÿåˆ—ã€‚</p><p>åœ¨æŸäº›åœºæ™¯ä¸‹æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>setInterval()</code>å‡½æ•°å¤„ç†ä¸€äº›éœ€è¦é—´æ­‡æ€§æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¹¶ä¸”å¯ä»¥ä¿å­˜å…¶è¿”å›å€¼<code>intervalID</code>ï¼Œé€šè¿‡<code>clearInterval(intervalID)</code>å‡½æ•°ç»ˆæ­¢æ­¤åŠŸèƒ½ã€‚</p><h3 id="13-setimmediate">1.3 setImmediate</h3><p><code>setImmediate</code>ç”¨äº<code>Nodejs</code>ç«¯ï¼Œå…¶å…·æœ‰ä¸<code>setTimeout(fn,0)</code>æå…¶ç±»ä¼¼çš„åŠŸèƒ½ï¼ŒäºŒè€…éƒ½å°†åŠ å…¥åˆ°å®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œä½†æ˜¯åœ¨<code>Nodejs</code>ä¸­äºŒè€…å´åˆå¤„äºä¸åŒçš„æ‰§è¡Œé˜¶æ®µï¼Œåœ¨ä¸€ä¸ªå¼‚æ­¥æµç¨‹ä¸­ï¼Œ<code>setImmediate()</code>ä¼šæ¯”<code>setTimeout(fn, 0)</code>å…ˆæ‰§è¡Œï¼Œä¹Ÿè®¸ä½ ä¼šå¯¹äºŒè€…çš„æ‰§è¡Œé¡ºåºæœ‰æ‰€ç–‘æƒ‘ï¼Œä¸æ€¥ï¼Œå¾…ä¼šæˆ‘ä»¬æ¥çœ‹çœ‹å…¶ä¸­çš„åŸç†ã€‚</p><blockquote><p>Nodejs ä¸­ setTimeout(fn) æˆ–è€… setTimeout(fn, 0) ä¼šè¢«å¼ºåˆ¶æ”¹ä¸º<code>setTimeout(fn, 1)</code></p></blockquote><h3 id="14--this">1.4 å®šæ—¶å™¨ this</h3><p>ä¸Šè¿°å‡ ä¸ªå®šæ—¶å™¨ç›¸å…³çš„å‡½æ•°åœ¨æ—¥å¸¸çš„ä½¿ç”¨æ—¶ï¼Œéœ€è¦æ³¨æ„<code>this</code>å˜é‡çš„æŒ‡å‘é—®é¢˜å¯èƒ½å¼•å‘çš„ä¸ä¸€è‡´å¼‚å¸¸ã€‚</p><p>é¦–å…ˆï¼Œä¼ å…¥çš„å›è°ƒå‡½æ•°çš„<code>this</code>æŒ‡å‘æ€§åœ¨ä¸åŒç‰ˆæœ¬çš„<code>nodejs</code>å’Œä¸åŒç‰ˆæœ¬<code>æµè§ˆå™¨</code>ä¹‹é—´æœ‰æ‰€ä¸åŒï¼Œå¹¶ä¸”å—åˆ°<code>ä¸¥æ ¼æ¨¡å¼</code>çš„å½±å“ï¼Œæœ€å¥½çš„é€‰æ‹©æ˜¯åœ¨å¿…è¦æƒ…å†µä¸‹ä½¿ç”¨<code>es6 bind()</code>å‡½æ•°æ˜¾å¼çš„ç»‘å®š<code>this</code>ï¼Œäº¦æˆ–æ˜¯ä¸åœ¨å›è°ƒå‡½æ•°ä¸­ä½¿ç”¨<code>this</code>ã€‚</p><h3 id="15-">1.5 æœ€å°å»¶è¿Ÿæ—¶é—´</h3><blockquote><ol start="1"><li>If timeout is less than 0, then set timeout to 0.</li><li>If nesting level is greater than 5, and timeout is less than 4, then set timeout to 4.</li></ol></blockquote><p>æ ¹æ®<code>whatwg</code>çš„è§„èŒƒè¯´æ˜ï¼Œå»¶æ—¶å‚æ•°åœ¨è¶…è¿‡ 5 å±‚çš„åµŒå¥—åæœ€å°å»¶è¿Ÿæ—¶é—´ä¸º<code>4ms</code>ã€‚</p><p>æœªè¢«æ¿€æ´»çš„åå°æµè§ˆå™¨æ ‡ç­¾å‡ºäºé™ä½æ¶ˆè€—å’ŒèŠ‚çœç”µé‡ç­‰åŸå› ï¼Œæœ€å°å»¶æ—¶é™åˆ¶ä¸º<code>1000 ms</code>ã€‚è¿™ä¸ªè®¾è®¡ä¹Ÿè®¸ä¼šå¯¹æŸäº›åœºæ™¯ä¸‹é¡µé¢è½¬å‘åå°å†è½¬åˆ°å‰å°çš„æ—¶å€™å®šæ—¶å™¨å¼‚å¸¸ï¼Œè¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸‹åŠŸèƒ½ç›‘å¬é¡µé¢å˜åŠ¨ï¼š</p><ul><li>window.focus + window.blur</li><li>visibilityChange event</li></ul><p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸º<code>document</code>æ·»åŠ <code>visibilityChange</code>äº‹ä»¶ç›‘å¬,é¡µé¢æ¢å¤çš„æ—¶å€™ä¿®æ­£è®¡æ—¶å™¨ã€‚</p><h2 id="2-">2. å®šæ—¶å™¨çº¿ç¨‹å’Œæ‰§è¡Œæ—¶æœº</h2><p>å¯¹äºæµè§ˆå™¨æ¥è¯´ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹<code>chromium</code>çš„è¿›ç¨‹ç¤ºæ„å›¾ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/128265bfc2be4ede80c06927c6e78d0b~tplv-k3u1fbpfcp-zoom-1.image"/></p><p><code>å®šæ—¶è§¦å‘å™¨</code>çº¿ç¨‹å’Œ<code>JS</code>å¼•æ“çº¿ç¨‹æ˜¯åˆ†å¼€çš„ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ç¼–å†™çš„<code>å®šæ—¶å™¨</code>å‡½æ•°å¹¶ä¸ä¼šé˜»å¡<code>JS</code>ä¸»çº¿ç¨‹çš„åŸå› ã€‚</p><p>å†æ¥çœ‹çœ‹<code>nodejs</code>äº‹ä»¶å¾ªç¯ç¤ºæ„å›¾ï¼š</p><p><img src="https://raw.githubusercontent.com/youyiqin/markdown_imgs/master/carbon.png"/></p><p>æˆ‘ä»¬å›åˆ°è¿™ä¸ªé—®é¢˜ï¼š <code>Nodejs</code>ç«¯ï¼Œ<code>setTimeout(fn)</code>å’Œ <code>setImmediate(fn)</code>è°å…ˆæ‰§è¡Œï¼Ÿ</p><p>é¦–å…ˆæˆ‘ä»¬è¦æ˜ç¡®ï¼Œ<code>timers</code>å®šæ—¶å™¨æ‰§è¡Œ<code>setTimeout</code>å’Œ<code>setInterval</code>çš„å›è°ƒï¼Œ<code>check</code>é˜¶æ®µæ‰§è¡Œ<code>setImmediate</code>çš„å›è°ƒã€‚</p><p>ä»ä¸Šè¿°<code>Nodejs</code>äº‹ä»¶å¾ªç¯æµç¨‹å›¾å¯ä»¥çœ‹å‡ºï¼Œ<code>timers</code>å’Œ<code>check</code>äºŒè€…çš„æ‰§è¡Œä¸åœ¨ä¸€ä¸ªé˜¶æ®µã€‚</p><p>åœ¨ä¸€ä¸ªå¼‚æ­¥æµç¨‹é‡Œï¼Œ<code>setImmediate</code>ä¼šå…ˆæ‰§è¡Œã€‚</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">function foo() {
  setTimeout(function() {
    console.log(&#x27;setTimeout&#x27;)
  }, 0)

  setImmediate(function() {
    console.log(&#x27;setImmediate&#x27;)
  })
}
setTimeout(foo)
// output
setImmediate
setTimeout</code></pre></div></div></details><p>ç®€è€Œè¨€ä¹‹ï¼Œå¤–å±‚ä¸€ä¸ª<code>setTimeout</code>æ‰§è¡Œçš„æ—¶å€™åœ¨<code>timers</code>é˜¶æ®µï¼Œå†…éƒ¨<code>setTimeout</code>ç›´æ¥æ”¾åˆ°äº†ä¸‹ä¸€ä¸ª<code>timers</code>é˜¶æ®µï¼Œè€Œ<code>setImmediate</code>æ”¾åœ¨äº†å½“å‰å¾ªç¯çš„<code>check</code>å°¾éƒ¨ï¼Œå› æ­¤å…ˆè¾“å‡º<code>setImmediate</code>ã€‚</p><p>å†æ¥ï¼š</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">function foo() {
  setTimeout(function() {
    console.log(&#x27;setTimeout&#x27;)
  }, 0)

  setImmediate(function() {
    console.log(&#x27;setImmediate&#x27;)
  })
}
foo()</code></pre></div></div></details><p>åœ¨åŒæ­¥æµç¨‹ä¸­ç›´æ¥è°ƒç”¨ï¼ŒäºŒè€…çš„è¾“å‡ºæ˜¯ä¸å›ºå®šé¡ºåºçš„ã€‚ä¹Ÿè®¸é¦–æ¬¡æ˜¯<code>setTimeout</code>å…ˆè¾“å‡ºï¼Œä½†æ˜¯å†è¯•ä¸€æ¬¡å°±ä¸ä¸€å®šäº†ã€‚</p><p>æ‰§è¡ŒåŒæ­¥ä»£ç çš„æ—¶å€™ï¼ŒäºŒè€…åˆ†åˆ«åŠ å…¥åˆ°<code>timers</code>å’Œ<code>check</code>å†…ï¼ŒåŒæ­¥ä»£ç è¿›å…¥äº‹ä»¶å¾ªç¯ä¹‹åç›´æ¥æ£€æŸ¥<code>timers</code>,å¦‚æœåŒæ­¥ä»£ç åœ¨è¿›å…¥äº‹ä»¶å¾ªç¯ä¹‹å‰å·²ç»è¿‡å»äº†<code>1msï¼ˆNodejs è§„å®šçš„é»˜è®¤å€¼ï¼‰</code>ï¼Œåˆ™ç›´æ¥æ‰§è¡Œè¾“å‡º<code>setTimeout</code>ï¼Œå¦‚æœåŒæ­¥ä»£ç åœ¨è¿›å…¥äº‹ä»¶å¾ªç¯çš„æ—¶å€™è¿˜æœªè¾¾åˆ°è¿™<code>1ms</code>çš„å›è°ƒæ‰§è¡Œæ¡ä»¶ï¼Œåˆ™ä¼šå°†ä¸Šè¿°<code>timeout</code>å®‰æ’åˆ°ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯é˜¶æ®µã€‚</p><h2 id="3-settimeout-">3. setTimeout å’Œæ—¶é—´è¡¥å¿</h2><p>æœºç¼˜å·§åˆä¸‹çœ‹åˆ°ä¸€ç¯‡æ–‡ç« æåŠ<code>setTimeout</code>ç”±äºä¸»çº¿ç¨‹è€—æ—¶ä»»åŠ¡çš„é˜»å¡å¼•èµ·çš„å»¶æ—¶è¶…å‡ºé¢„æœŸçš„æ–‡ç« ï¼Œå…¶æå‡ºäº†ä¸€ä¸ªåˆ©ç”¨ç³»ç»Ÿæ—¶é—´è¿›è¡ŒåŠ¨æ€è°ƒæ•´å»¶æ—¶çš„æ–¹æ³•ä»¥å®ç°å°½å¯èƒ½å‡†ç¡®çš„<code>setInterval</code>å‡½æ•°æ•ˆæœï¼ˆåŸæ–‡æ”¾åœ¨å‚è€ƒéƒ¨åˆ†ï¼‰ã€‚</p><p><img src="https://raw.githubusercontent.com/youyiqin/markdown_imgs/master/20210425000050.png"/></p><p>å¦‚å›¾æ‰€ç¤ºï¼Œé˜»å¡ä»£ç çš„è€—æ—¶æ˜¯ä¸å¯é¢„æµ‹çš„ï¼ŒæŒ‰ç…§é»˜è®¤çš„å»¶æ—¶å‚æ•°åŠ¿å¿…å¯¼è‡´ä¸€éƒ¨åˆ†çš„æ—¶é—´å·®å¼‚å¸¸ã€‚</p><p>åˆ©ç”¨æ—¶é—´è¡¥å¿æœºåˆ¶ï¼Œå¯¹<code>setTimeout</code>çš„ç¬¬äºŒä¸ªå‚æ•°è¿›è¡ŒåŠ¨æ€ä¿®æ­£ï¼Œå¯ä»¥å°½å¯èƒ½å‡å°é˜»å¡ä»£ç çš„å½±å“ã€‚</p><p><img src="https://raw.githubusercontent.com/youyiqin/markdown_imgs/master/20210425000950.png"/></p><p>å®ä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">function interval() {
     const speed = 500;
  let counter = 1;
  const start = new Date().getTime();
  function instance() {
    const ideal = (counter * speed);
    const real = new Date().getTime() - start;
    const diff = real - ideal;
    counter++
    setTimeout(instance, speed - diff)
  }
  setTimeout(instance, speed)
}</code></pre></div></div></details><p>è¿™æ˜¯ä¸€ç§æœ‰è¶£çš„æƒ³æ³•ï¼Œä¹Ÿè®¸åœ¨å…¶ä»–ç‰¹å®šåœºæ™¯ä¸‹ä½¿ç”¨<code>requestAnimationFrame()</code>æˆ–è€…<code>web workers</code>æ¥å¤„ç†é˜»å¡ä»£ç çš„é—®é¢˜ã€‚</p><h2 id="">å‚è€ƒ</h2><ul><li><p><a href="https://www.sitepoint.com/creating-accurate-timers-in-javascript/">Creating Accurate Timers in JavaScript - SitePoint</a></p></li><li><p><a href="https://www.tutorialrepublic.com/javascript-tutorial/javascript-timers.php">JavaScript Timer Functions - Tutorial Republic</a></p></li><li><p><a href="https://www.freecodecamp.org/news/javascript-timers-everything-you-need-to-know-5f31eaa37162/">JavaScript Timers: Everything you need to know</a></p></li><li><p><a href="https://juejin.cn/post/6844904100195205133">setTimeoutå’ŒsetImmediateåˆ°åº•è°å…ˆæ‰§è¡Œï¼Œæœ¬æ–‡è®©ä½ å½»åº•ç†è§£Event Loop</a></p></li><li><p><a href="https://mp.weixin.qq.com/s/u7jtQkWM0k_joOd5gr4VJA">å¿è€…ç§˜ç±ï¼šå¦‚ä½•å®ç°å‡†æ—¶çš„setTimeout</a></p></li></ul></div></div></div></main><style data-emotion-css="1fic0ux">.css-1fic0ux{border:0;opacity:0.6;border-bottom:0.0625rem solid;width:auto;margin-top:0.5rem;margin-bottom:0.5rem;border-color:inherit;}</style><hr class="css-1fic0ux"/><style data-emotion-css="11i96b0">.css-11i96b0{margin:2rem;text-align:center;}</style><div class="css-11i96b0"><p id="msg">è°¢è°¢ä½ èƒ½çœ‹åˆ°è¿™é‡Œ!<span role="img" aria-label="emoji">ğŸ¤—</span>Â å¦‚æœä½ æœ‰ä»»ä½•æƒ³ä¸æˆ‘è®¨è®ºçš„å†…å®¹,è¯·ç»™æˆ‘å‘é‚®ä»¶.<span role="img" aria-label="emoji">ğŸ•Š</span></p><br/><a style="text-decoration:none" href="mailto:rivenqinyy@gmail.com"><style data-emotion-css="meafa5">.css-meafa5{display:inline-block;padding-left:0.25rem;padding-right:0.25rem;text-transform:uppercase;font-size:0.75rem;border-radius:0.125rem;font-weight:700;white-space:nowrap;vertical-align:middle;background-color:#c6f6d5;color:#22543d;}</style><div class="css-meafa5">æˆ‘çš„é‚®ä»¶</div><span role="img" aria-label="my email">ğŸ“®</span></a><br/><br/><style data-emotion-css="1fb5c92">.css-1fb5c92{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";color:#4A5568;font-size:.7rem;}</style><p class="css-1fb5c92">å¦™æ‰ Â© 2020. All rights reserved.</p></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"javascript-å®šæ—¶å™¨ä¸ç³»ç»Ÿæ—¶é—´è¡¥å¿","content":"\nä»Šå¤©æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹`JavaScript`ä¸­çš„å‡ ä¸ªå®šæ—¶å™¨ç›¸å…³çš„å‡½æ•°åŠŸèƒ½ä½¿ç”¨ä»¥åŠçŸ¥è¯†ç‚¹åˆ†æï¼Œå¹¶ä¸”ä½¿ç”¨`æ—¶é—´è¡¥å¿`æœºåˆ¶åˆ›å»º`å°½å¯èƒ½å‡†ç¡®`çš„å®šæ—¶å™¨ä»»åŠ¡ã€‚\n\n## 1. è®¡æ—¶å™¨å‡½æ•°\n\næˆ‘ä»¬éœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œ`è®¡æ—¶å™¨å‡½æ•°`å¹¶ä¸æ˜¯`ECMAScript`è§„èŒƒæˆ–è€…`v8`å¼•æ“å®ç°çš„ä¸€éƒ¨åˆ†ï¼Œæ— è®ºæ˜¯åœ¨æµè§ˆå™¨ç«¯è¿˜æ˜¯åœ¨`Nodejs`ç«¯ï¼Œ`setTimeout`å’Œ`setInterval`è¿™ç±»å®šæ—¶å™¨å‡½æ•°éƒ½æ˜¯`globalThis`æ¥å£çš„ä¸€éƒ¨åˆ†.\n\n\u003e globalThis: ES2020 å¢åŠ çš„æ ‡å‡†ï¼Œæ—¨åœ¨ç»Ÿä¸€ä¸åŒç¯å¢ƒä¸‹çš„å…¨å±€å¯¹è±¡è®¿é—®å…¥å£ï¼Œä¾‹å¦‚ nodejs ä¹‹ globalï¼Œæµè§ˆå™¨ä¹‹ Window / this / frames, web workers ä¹‹ selfã€‚\n\n### 1.1 setTimeout\n\né¦–å…ˆæ˜¯`setTimeout`å‡½æ•°ï¼Œç”¨äºåœ¨æŒ‡å®šçš„æ—¶é—´å»¶è¿Ÿåæ‰§è¡Œä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå…¶è¯­æ³•ä¸ºï¼š\n\n```js\nlet timeoutID = setTimeout(function[, delay, arg1, arg2, ...]);\nlet timeoutID = setTimeout(function[, delay]);\nlet timeoutID = setTimeout(code[, delay]);\n```\n\né¦–ä¸ªå‚æ•°é€šå¸¸æ˜¯ä¸€ä¸ª`å‡½æ•°`ï¼Œå¦ä¸€ç§ä¸æ¨èçš„å±é™©é€‰æ‹©æ˜¯é¦–ä¸ªå‚æ•°ä¼ å…¥å¯æ‰§è¡Œçš„å­—ç¬¦ä¸²,è¿™å°†ä¼šåœ¨æŒ‡å®šçš„ delay æ¯«ç§’åç¼–è¯‘æ‰§è¡Œå­—ç¬¦ä¸²ã€‚\n\n`delay`å‚æ•°æ˜¯å»¶è¿Ÿçš„æ¯«ç§’æ•°ï¼Œçœç•¥æˆ–è€…ä½¿ç”¨è´Ÿæ•°éƒ½å°†é»˜è®¤è®¾ç½®ä¸º 0ï¼Œæ„ä¸ºå°½å¿«æ‰§è¡Œã€‚\n\nç¬¬ä¸‰å¯é€‰å‚æ•°åˆ™æ˜¯ä¼ å…¥æ­¤å›è°ƒå‡½æ•°çš„å‚æ•°ï¼ˆIE9 åŠå…¶ä»¥ä¸‹ç‰ˆæœ¬ä¸æ”¯æŒæ­¤ç‰¹æ€§ï¼‰ã€‚\n\næ­¤å‡½æ•°è¿”å›ä¸€ä¸ª`timeoutID`æ˜¯ä¸€ä¸ªå”¯ä¸€çš„æ­£æ•´æ•°ï¼Œå¯ä»¥ä½¿ç”¨`clearTimeout(timeoutID)`æ¥å–æ¶ˆæ­¤å®šæ—¶å™¨ã€‚\n\n### 1.2 setInterval\n\n`setInterval`è¯­æ³•ä¸Šä¸`setTimeout`ç±»ä¼¼ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ­¤å‡½æ•°åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”ä¸‹å°†ç›¸åŒçš„å›è°ƒå‡½æ•°åŠ å…¥å®ä»»åŠ¡é˜Ÿåˆ—ã€‚\n\nåœ¨æŸäº›åœºæ™¯ä¸‹æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`setInterval()`å‡½æ•°å¤„ç†ä¸€äº›éœ€è¦é—´æ­‡æ€§æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¹¶ä¸”å¯ä»¥ä¿å­˜å…¶è¿”å›å€¼`intervalID`ï¼Œé€šè¿‡`clearInterval(intervalID)`å‡½æ•°ç»ˆæ­¢æ­¤åŠŸèƒ½ã€‚\n\n### 1.3 setImmediate\n\n`setImmediate`ç”¨äº`Nodejs`ç«¯ï¼Œå…¶å…·æœ‰ä¸`setTimeout(fn,0)`æå…¶ç±»ä¼¼çš„åŠŸèƒ½ï¼ŒäºŒè€…éƒ½å°†åŠ å…¥åˆ°å®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œä½†æ˜¯åœ¨`Nodejs`ä¸­äºŒè€…å´åˆå¤„äºä¸åŒçš„æ‰§è¡Œé˜¶æ®µï¼Œåœ¨ä¸€ä¸ªå¼‚æ­¥æµç¨‹ä¸­ï¼Œ`setImmediate()`ä¼šæ¯”`setTimeout(fn, 0)`å…ˆæ‰§è¡Œï¼Œä¹Ÿè®¸ä½ ä¼šå¯¹äºŒè€…çš„æ‰§è¡Œé¡ºåºæœ‰æ‰€ç–‘æƒ‘ï¼Œä¸æ€¥ï¼Œå¾…ä¼šæˆ‘ä»¬æ¥çœ‹çœ‹å…¶ä¸­çš„åŸç†ã€‚\n\n\u003e Nodejs ä¸­ setTimeout(fn) æˆ–è€… setTimeout(fn, 0) ä¼šè¢«å¼ºåˆ¶æ”¹ä¸º`setTimeout(fn, 1)`\n\n### 1.4 å®šæ—¶å™¨ this\n\nä¸Šè¿°å‡ ä¸ªå®šæ—¶å™¨ç›¸å…³çš„å‡½æ•°åœ¨æ—¥å¸¸çš„ä½¿ç”¨æ—¶ï¼Œéœ€è¦æ³¨æ„`this`å˜é‡çš„æŒ‡å‘é—®é¢˜å¯èƒ½å¼•å‘çš„ä¸ä¸€è‡´å¼‚å¸¸ã€‚\n\né¦–å…ˆï¼Œä¼ å…¥çš„å›è°ƒå‡½æ•°çš„`this`æŒ‡å‘æ€§åœ¨ä¸åŒç‰ˆæœ¬çš„`nodejs`å’Œä¸åŒç‰ˆæœ¬`æµè§ˆå™¨`ä¹‹é—´æœ‰æ‰€ä¸åŒï¼Œå¹¶ä¸”å—åˆ°`ä¸¥æ ¼æ¨¡å¼`çš„å½±å“ï¼Œæœ€å¥½çš„é€‰æ‹©æ˜¯åœ¨å¿…è¦æƒ…å†µä¸‹ä½¿ç”¨`es6 bind()`å‡½æ•°æ˜¾å¼çš„ç»‘å®š`this`ï¼Œäº¦æˆ–æ˜¯ä¸åœ¨å›è°ƒå‡½æ•°ä¸­ä½¿ç”¨`this`ã€‚\n\n### 1.5 æœ€å°å»¶è¿Ÿæ—¶é—´\n\n\u003e 1. If timeout is less than 0, then set timeout to 0.\n\u003e 2. If nesting level is greater than 5, and timeout is less than 4, then set timeout to 4.\n\næ ¹æ®`whatwg`çš„è§„èŒƒè¯´æ˜ï¼Œå»¶æ—¶å‚æ•°åœ¨è¶…è¿‡ 5 å±‚çš„åµŒå¥—åæœ€å°å»¶è¿Ÿæ—¶é—´ä¸º`4ms`ã€‚\n\næœªè¢«æ¿€æ´»çš„åå°æµè§ˆå™¨æ ‡ç­¾å‡ºäºé™ä½æ¶ˆè€—å’ŒèŠ‚çœç”µé‡ç­‰åŸå› ï¼Œæœ€å°å»¶æ—¶é™åˆ¶ä¸º`1000 ms`ã€‚è¿™ä¸ªè®¾è®¡ä¹Ÿè®¸ä¼šå¯¹æŸäº›åœºæ™¯ä¸‹é¡µé¢è½¬å‘åå°å†è½¬åˆ°å‰å°çš„æ—¶å€™å®šæ—¶å™¨å¼‚å¸¸ï¼Œè¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸‹åŠŸèƒ½ç›‘å¬é¡µé¢å˜åŠ¨ï¼š\n\n- window.focus + window.blur\n- visibilityChange event\n\nä¸¾ä¸ªä¾‹å­ï¼Œä¸º`document`æ·»åŠ `visibilityChange`äº‹ä»¶ç›‘å¬,é¡µé¢æ¢å¤çš„æ—¶å€™ä¿®æ­£è®¡æ—¶å™¨ã€‚\n\n## 2. å®šæ—¶å™¨çº¿ç¨‹å’Œæ‰§è¡Œæ—¶æœº\n\nå¯¹äºæµè§ˆå™¨æ¥è¯´ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹`chromium`çš„è¿›ç¨‹ç¤ºæ„å›¾ï¼š\n\n![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/128265bfc2be4ede80c06927c6e78d0b~tplv-k3u1fbpfcp-zoom-1.image)\n\n`å®šæ—¶è§¦å‘å™¨`çº¿ç¨‹å’Œ`JS`å¼•æ“çº¿ç¨‹æ˜¯åˆ†å¼€çš„ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ç¼–å†™çš„`å®šæ—¶å™¨`å‡½æ•°å¹¶ä¸ä¼šé˜»å¡`JS`ä¸»çº¿ç¨‹çš„åŸå› ã€‚\n\nå†æ¥çœ‹çœ‹`nodejs`äº‹ä»¶å¾ªç¯ç¤ºæ„å›¾ï¼š\n\n![](https://raw.githubusercontent.com/youyiqin/markdown_imgs/master/carbon.png)\n\næˆ‘ä»¬å›åˆ°è¿™ä¸ªé—®é¢˜ï¼š `Nodejs`ç«¯ï¼Œ`setTimeout(fn)`å’Œ `setImmediate(fn)`è°å…ˆæ‰§è¡Œï¼Ÿ\n\né¦–å…ˆæˆ‘ä»¬è¦æ˜ç¡®ï¼Œ`timers`å®šæ—¶å™¨æ‰§è¡Œ`setTimeout`å’Œ`setInterval`çš„å›è°ƒï¼Œ`check`é˜¶æ®µæ‰§è¡Œ`setImmediate`çš„å›è°ƒã€‚\n\nä»ä¸Šè¿°`Nodejs`äº‹ä»¶å¾ªç¯æµç¨‹å›¾å¯ä»¥çœ‹å‡ºï¼Œ`timers`å’Œ`check`äºŒè€…çš„æ‰§è¡Œä¸åœ¨ä¸€ä¸ªé˜¶æ®µã€‚\n\nåœ¨ä¸€ä¸ªå¼‚æ­¥æµç¨‹é‡Œï¼Œ`setImmediate`ä¼šå…ˆæ‰§è¡Œã€‚\n\n```js\nfunction foo() {\n  setTimeout(function() {\n    console.log('setTimeout')\n  }, 0)\n\n  setImmediate(function() {\n    console.log('setImmediate')\n  })\n}\nsetTimeout(foo)\n// output\nsetImmediate\nsetTimeout\n```\n\nç®€è€Œè¨€ä¹‹ï¼Œå¤–å±‚ä¸€ä¸ª`setTimeout`æ‰§è¡Œçš„æ—¶å€™åœ¨`timers`é˜¶æ®µï¼Œå†…éƒ¨`setTimeout`ç›´æ¥æ”¾åˆ°äº†ä¸‹ä¸€ä¸ª`timers`é˜¶æ®µï¼Œè€Œ`setImmediate`æ”¾åœ¨äº†å½“å‰å¾ªç¯çš„`check`å°¾éƒ¨ï¼Œå› æ­¤å…ˆè¾“å‡º`setImmediate`ã€‚\n\nå†æ¥ï¼š\n\n```js\nfunction foo() {\n  setTimeout(function() {\n    console.log('setTimeout')\n  }, 0)\n\n  setImmediate(function() {\n    console.log('setImmediate')\n  })\n}\nfoo()\n```\n\nåœ¨åŒæ­¥æµç¨‹ä¸­ç›´æ¥è°ƒç”¨ï¼ŒäºŒè€…çš„è¾“å‡ºæ˜¯ä¸å›ºå®šé¡ºåºçš„ã€‚ä¹Ÿè®¸é¦–æ¬¡æ˜¯`setTimeout`å…ˆè¾“å‡ºï¼Œä½†æ˜¯å†è¯•ä¸€æ¬¡å°±ä¸ä¸€å®šäº†ã€‚\n\næ‰§è¡ŒåŒæ­¥ä»£ç çš„æ—¶å€™ï¼ŒäºŒè€…åˆ†åˆ«åŠ å…¥åˆ°`timers`å’Œ`check`å†…ï¼ŒåŒæ­¥ä»£ç è¿›å…¥äº‹ä»¶å¾ªç¯ä¹‹åç›´æ¥æ£€æŸ¥`timers`,å¦‚æœåŒæ­¥ä»£ç åœ¨è¿›å…¥äº‹ä»¶å¾ªç¯ä¹‹å‰å·²ç»è¿‡å»äº†`1msï¼ˆNodejs è§„å®šçš„é»˜è®¤å€¼ï¼‰`ï¼Œåˆ™ç›´æ¥æ‰§è¡Œè¾“å‡º`setTimeout`ï¼Œå¦‚æœåŒæ­¥ä»£ç åœ¨è¿›å…¥äº‹ä»¶å¾ªç¯çš„æ—¶å€™è¿˜æœªè¾¾åˆ°è¿™`1ms`çš„å›è°ƒæ‰§è¡Œæ¡ä»¶ï¼Œåˆ™ä¼šå°†ä¸Šè¿°`timeout`å®‰æ’åˆ°ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯é˜¶æ®µã€‚\n\n\n\n## 3. setTimeout å’Œæ—¶é—´è¡¥å¿\n\næœºç¼˜å·§åˆä¸‹çœ‹åˆ°ä¸€ç¯‡æ–‡ç« æåŠ`setTimeout`ç”±äºä¸»çº¿ç¨‹è€—æ—¶ä»»åŠ¡çš„é˜»å¡å¼•èµ·çš„å»¶æ—¶è¶…å‡ºé¢„æœŸçš„æ–‡ç« ï¼Œå…¶æå‡ºäº†ä¸€ä¸ªåˆ©ç”¨ç³»ç»Ÿæ—¶é—´è¿›è¡ŒåŠ¨æ€è°ƒæ•´å»¶æ—¶çš„æ–¹æ³•ä»¥å®ç°å°½å¯èƒ½å‡†ç¡®çš„`setInterval`å‡½æ•°æ•ˆæœï¼ˆåŸæ–‡æ”¾åœ¨å‚è€ƒéƒ¨åˆ†ï¼‰ã€‚\n\n![](https://raw.githubusercontent.com/youyiqin/markdown_imgs/master/20210425000050.png)\n\nå¦‚å›¾æ‰€ç¤ºï¼Œé˜»å¡ä»£ç çš„è€—æ—¶æ˜¯ä¸å¯é¢„æµ‹çš„ï¼ŒæŒ‰ç…§é»˜è®¤çš„å»¶æ—¶å‚æ•°åŠ¿å¿…å¯¼è‡´ä¸€éƒ¨åˆ†çš„æ—¶é—´å·®å¼‚å¸¸ã€‚\n\nåˆ©ç”¨æ—¶é—´è¡¥å¿æœºåˆ¶ï¼Œå¯¹`setTimeout`çš„ç¬¬äºŒä¸ªå‚æ•°è¿›è¡ŒåŠ¨æ€ä¿®æ­£ï¼Œå¯ä»¥å°½å¯èƒ½å‡å°é˜»å¡ä»£ç çš„å½±å“ã€‚\n\n![](https://raw.githubusercontent.com/youyiqin/markdown_imgs/master/20210425000950.png)\n\nå®ä¾‹ä»£ç å¦‚ä¸‹ï¼š\n\n```js\nfunction interval() {\n \tconst speed = 500;\n  let counter = 1;\n  const start = new Date().getTime();\n  function instance() {\n    const ideal = (counter * speed);\n    const real = new Date().getTime() - start;\n    const diff = real - ideal;\n    counter++\n    setTimeout(instance, speed - diff)\n  }\n  setTimeout(instance, speed)\n}\n```\n\nè¿™æ˜¯ä¸€ç§æœ‰è¶£çš„æƒ³æ³•ï¼Œä¹Ÿè®¸åœ¨å…¶ä»–ç‰¹å®šåœºæ™¯ä¸‹ä½¿ç”¨`requestAnimationFrame()`æˆ–è€…`web workers`æ¥å¤„ç†é˜»å¡ä»£ç çš„é—®é¢˜ã€‚\n\n## å‚è€ƒ\n\n- [Creating Accurate Timers in JavaScript - SitePoint](https://www.sitepoint.com/creating-accurate-timers-in-javascript/)\n\n- [JavaScript Timer Functions - Tutorial Republic](https://www.tutorialrepublic.com/javascript-tutorial/javascript-timers.php)\n\n- [JavaScript Timers: Everything you need to know](https://www.freecodecamp.org/news/javascript-timers-everything-you-need-to-know-5f31eaa37162/)\n\n- [setTimeoutå’ŒsetImmediateåˆ°åº•è°å…ˆæ‰§è¡Œï¼Œæœ¬æ–‡è®©ä½ å½»åº•ç†è§£Event Loop](https://juejin.cn/post/6844904100195205133)\n\n- [å¿è€…ç§˜ç±ï¼šå¦‚ä½•å®ç°å‡†æ—¶çš„setTimeout](https://mp.weixin.qq.com/s/u7jtQkWM0k_joOd5gr4VJA)\n\n\n\n","title":"javascript å®šæ—¶å™¨ä¸ç³»ç»Ÿæ—¶é—´è¡¥å¿","date":"2021/4/23","tags":["JavaScript"],"mainImg":"https://images.unsplash.com/photo-1617108029768-c12fff3d7754?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwxNjUyNjZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2MTkxMzc5ODE\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=1080","coverImg":"https://images.unsplash.com/photo-1617108029768-c12fff3d7754?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwxNjUyNjZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2MTkxMzc5ODE\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=400","intro":"å®šæ—¶å™¨æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¼—å¤šå‰ç½®çŸ¥è¯†ä¹‹ä¸€ï¼Œä»Šå¤©è®©æˆ‘ä»¬æ¥è¯¦ç»†å­¦ä¹ ä¸€ä¸‹ JavaScript timer çš„çŸ¥è¯†ï¼Œç‚¹ä¸Šè¿™ä¸€æŠ€èƒ½ç‚¹ã€‚"}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"javascript-å®šæ—¶å™¨ä¸ç³»ç»Ÿæ—¶é—´è¡¥å¿"},"buildId":"lXI81fotMM0W7XMAerzsZ","assetPrefix":"/blog","nextExport":false,"isFallback":false,"gsp":true,"head":[["meta",{"name":"viewport","content":"width=device-width"}],["meta",{"name":"description","content":"javascript node deno linux web developer"}],["meta",{"charSet":"utf-8"}],["link",{"rel":"icon","href":"data:image/svg+xml,\u003csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22\u003e\u003ctext y=%22.9em%22 font-size=%2290%22\u003eğŸ¯\u003c/text\u003e\u003c/svg\u003e"}],["title",{"children":"javascript å®šæ—¶å™¨ä¸ç³»ç»Ÿæ—¶é—´è¡¥å¿"}],["link",{"rel":"stylesheet","href":"https://cdn.jsdelivr.net/npm/reset-css@5.0.1/reset.min.css"}],["link",{"rel":"stylesheet","href":"/blog/post.css"}],["script",{"async":true,"src":"https://www.googletagmanager.com/gtag/js?id=G-J0BNBT8YXG"}],["script",{"dangerouslySetInnerHTML":{"__html":"\u003c!-- Global site tag (gtag.js) - Google Analytics --\u003e\n            window.dataLayer = window.dataLayer || [];\n            function gtag(){dataLayer.push(arguments);}\n            gtag('js', new Date());\n            gtag('config', 'G-J0BNBT8YXG');"}}]]}</script><script nomodule="" src="/blog/_next/static/chunks/polyfills-86dac49abe0e0232b575.js"></script><script src="/blog/_next/static/chunks/main-c37f7d67026ad75148c3.js" async=""></script><script src="/blog/_next/static/chunks/webpack-eb080e3f091731f228fb.js" async=""></script><script src="/blog/_next/static/chunks/framework.1daf1ec1ecf144ee9147.js" async=""></script><script src="/blog/_next/static/chunks/commons.cb58dfc173e18379cc5b.js" async=""></script><script src="/blog/_next/static/chunks/6335da8543c52d3af527c387f688061357787349.aa32db8a194765817dea.js" async=""></script><script src="/blog/_next/static/chunks/pages/_app-ebdd114948c696bf4519.js" async=""></script><script src="/blog/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.7a872eda8469b3325c5d.js" async=""></script><script src="/blog/_next/static/chunks/pages/posts/%5Bslug%5D-5d143f0d2b02a907308e.js" async=""></script><script src="/blog/_next/static/lXI81fotMM0W7XMAerzsZ/_buildManifest.js" async=""></script><script src="/blog/_next/static/lXI81fotMM0W7XMAerzsZ/_ssgManifest.js" async=""></script></body></html>