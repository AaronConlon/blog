<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta name="description" content="javascript node deno linux web developer"/><meta charSet="utf-8"/><link rel="icon" href="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text y=%22.9em%22 font-size=%2290%22&gt;ğŸ¯&lt;/text&gt;&lt;/svg&gt;"/><title>Javascript,I promise - å¼‚æ­¥ç¼–ç¨‹</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reset-css@5.0.1/reset.min.css"/><link rel="stylesheet" href="/blog/post.css"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-J0BNBT8YXG"></script><script><!-- Global site tag (gtag.js) - Google Analytics -->
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());        
            gtag('config', 'G-J0BNBT8YXG');</script><meta name="next-head-count" content="9"/><link rel="preload" href="/blog/_next/static/css/e329e062f634851cc5d0.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/e329e062f634851cc5d0.css" data-n-g=""/><link rel="preload" href="/blog/_next/static/css/d5a8ab09696082e07b0c.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/d5a8ab09696082e07b0c.css" data-n-p=""/><noscript data-n-css="true"></noscript><link rel="preload" href="/blog/_next/static/chunks/main-bc20978b5b49cb620506.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/webpack-eb080e3f091731f228fb.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/framework.9ec1f7868b3e9d138cdd.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/commons.d877dcdd17afd7219ae3.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/6335da8543c52d3af527c387f688061357787349.7e9e1b66dd81783d6900.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/pages/_app-4e649ed46ef47e92b24e.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.c2ce14a235a03ef7811d.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/pages/posts/%5Bslug%5D-ece295f9976e557edb76.js" as="script"/></head><body><div id="__next"><style data-emotion-css="d6jcgn">html{line-height:1.15;-webkit-text-size-adjust:100%;}body{margin:0;}main{display:block;}h1{font-size:2em;margin:0.67em 0;}hr{box-sizing:content-box;height:0;overflow:visible;}pre{font-family:monospace,monospace;font-size:1em;}a{background-color:transparent;}abbr[title]{border-bottom:none;-webkit-text-decoration:underline;text-decoration:underline;-webkit-text-decoration:underline dotted;-webkit-text-decoration:underline dotted;text-decoration:underline dotted;}b,strong{font-weight:bolder;}code,kbd,samp{font-family:monospace,monospace;font-size:1em;}small{font-size:80%;}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline;}sub{bottom:-0.25em;}sup{top:-0.5em;}img{border-style:none;}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0;}button,input{overflow:visible;}button,select{text-transform:none;}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0;}fieldset{padding:0.35em 0.75em 0.625em;}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal;}progress{vertical-align:baseline;}textarea{overflow:auto;}[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0;}[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{-webkit-appearance:none !important;}input[type="number"]{-moz-appearance:textfield;}[type="search"]{-webkit-appearance:textfield;outline-offset:-2px;}[type="search"]::-webkit-search-decoration{-webkit-appearance:none !important;}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit;}details{display:block;}summary{display:list-item;}template{display:none;}[hidden]{display:none !important;}html{box-sizing:border-box;font-family:sans-serif;}*,*::before,*::after{box-sizing:border-box;}blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0;}button{background:transparent;padding:0;}fieldset{margin:0;padding:0;}ol,ul{margin:0;padding:0;}html{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";line-height:1.5;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%;text-rendering:optimizelegibility;}hr{border-top-width:1px;}img{border-style:solid;}textarea{resize:vertical;}button,[role="button"]{cursor:pointer;}button::-moz-focus-inner{border:0 !important;}table{border-collapse:collapse;}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit;}a{color:inherit;-webkit-text-decoration:inherit;text-decoration:inherit;}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit;}pre,code,kbd,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle;}img,video{max-width:100%;height:auto;}html{line-height:1.5;color:#1A202C;}*,*::before,*::after{border-width:0;border-style:solid;border-color:#E2E8F0;}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#A0AEC0;}input::-ms-input-placeholder,textarea::-ms-input-placeholder{color:#A0AEC0;}input::-webkit-input-placeholder,textarea::-webkit-input-placeholder{color:#A0AEC0;}input::-moz-placeholder,textarea::-moz-placeholder{color:#A0AEC0;}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#A0AEC0;}input::placeholder,textarea::placeholder{color:#A0AEC0;}</style><div><div class="layout_container__1BBI- css-0"><header><div class="css-0"><style data-emotion-css="em7ozm">.css-em7ozm{font-size:2.25rem;line-height:1.25;font-weight:700;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";text-align:center;margin:0 auto;padding:1.4rem 1rem;color:#0069d6;}@media screen and (min-width:48em){.css-em7ozm{font-size:3rem;}}</style><h1 class="css-em7ozm"><a href="/blog">å¦™æ‰<style data-emotion-css="1i1myri">.css-1i1myri{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";font-size:30%;}</style><sub class="css-1i1myri">blog</sub></a></h1></div></header><main><div class="css-0"><style data-emotion-css="t9c2rr">.css-t9c2rr{width:100%;margin:0 auto;padding-bottom:2rem;max-width:960px;}</style><div class="css-t9c2rr"><style data-emotion-css="8atqhb">.css-8atqhb{width:100%;}</style><img alt="" class="css-8atqhb"/></div><style data-emotion-css="1td051d">.css-1td051d{width:100%;margin:0 auto;max-width:960px;}</style><div class="css-1td051d"><style data-emotion-css="1299f13">.css-1299f13{font-size:1.875rem;line-height:2.5rem!important;font-weight:700;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";text-align:center;overflow:hidden;}@media screen and (min-width:30em){.css-1299f13{line-height:3rem!important;}}@media screen and (min-width:48em){.css-1299f13{font-size:2.25rem;}}</style><h1 class="css-1299f13">Javascript,I promise - å¼‚æ­¥ç¼–ç¨‹</h1><style data-emotion-css="7e9jz6">.css-7e9jz6{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:2rem;margin:0 auto;margin-right:0.4rem;float:right;}</style><div id="tags" class="css-7e9jz6"><style data-emotion-css="qgikqf">.css-qgikqf{display:inline-block;padding-left:8px;padding-right:0.25rem;text-transform:uppercase;font-size:0.6rem;border-radius:5px;font-weight:700;white-space:nowrap;vertical-align:middle;background-color:#c6f6d5;color:#22543d;height:2rem;line-height:2rem;min-width:4rem;}</style><div class="css-qgikqf">JavaScript</div></div><style data-emotion-css="8ddayy">.css-8ddayy{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;min-height:2rem;max-width:100%;border-radius:0.25rem;font-weight:500;min-width:2rem;padding-left:0.75rem;padding-right:0.75rem;background-color:#c6f6d5;color:#22543d;margin-bottom:2rem;font-size:0.6rem;margin-left:0.4rem;}</style><div class="css-8ddayy">æœ€åæ›´æ–°: <!-- -->2021/4/9</div><div style="margin:0 1rem"><p>å¤§å®¶å¥½ï¼Œä»Šå¤©æˆ‘ä»¬è¦åˆ†äº«çš„çŸ¥è¯†ç‚¹æ˜¯<code>Promise</code>ä¸å¼‚æ­¥ç¼–ç¨‹ã€‚</p>
<p><code>Promise</code>æ˜¯å¯¹å°šä¸å­˜åœ¨ç»“æœçš„å¯¹è±¡çš„ä¸€ä¸ªæ›¿èº«ï¼Œä¹Ÿè®¸ä½ æ›¾çœ‹åˆ°ç±»ä¼¼çš„æœ¯è¯­ï¼Œä¾‹å¦‚<code>future</code>/<code>delay</code>/<code>deferred</code>ç­‰ï¼Œå®é™…ä¸Šè¿™äº›æœ¯è¯­æè¿°çš„æ˜¯ä¸€ä¸ªç›¸åŒçš„æ¦‚å¿µï¼Œéƒ½æ˜¯ä¸€ç§å¼‚æ­¥ç¨‹åºæ‰§è¡Œçš„æœºåˆ¶ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬åˆ†äº«çš„çŸ¥è¯†å°†æ¶‰åŠä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>å‡½æ•°å›è°ƒ</li>
<li>Promise æµ…æ</li>
<li>Async / await</li>
<li>Promisify</li>
</ul>
<h1>1. å›è°ƒ</h1>
<p>JavaScript è¯­è¨€ä¸ºäº†è®©éƒ¨åˆ†ä»»åŠ¡æŒ‰å¼‚æ­¥çš„æ–¹å¼è¿›è¡Œï¼Œæä¾›äº†ç¼–å†™<code>å›è°ƒå‡½æ•°</code>çš„æ–¹æ³•ï¼Œè®©æŸäº›ä»»åŠ¡åœ¨è¾¾æˆä¸€äº›æ¡ä»¶ä¹‹åå†æ‰§è¡Œå¼€å‘è€…æŒ‡å®šçš„<code>å›è°ƒå‡½æ•°</code>ã€‚</p>
<p>ä¸¾ä¸¤ä¸ªä¾‹å­:</p>
<pre><code class="hljs language-js"><span class="lineNumber">1</span><span class="hljs-keyword">const</span> callbackFn = <span class="hljs-function">() =></span> {
<span class="lineNumber">2</span>  <span class="hljs-comment">// balabala</span>
<span class="lineNumber">3</span>}
<span class="lineNumber">4</span><span class="hljs-comment">// browser</span>
<span class="lineNumber">5</span><span class="hljs-built_in">setTimeout</span>(callbackFn, <span class="hljs-number">1000</span>)
<span class="lineNumber">6</span> 
<span class="lineNumber">7</span><span class="hljs-comment">// nodejs</span>
<span class="lineNumber">8</span><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>)
<span class="lineNumber">9</span>fs.readFile(<span class="hljs-string">'filename'</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =></span> {
<span class="lineNumber">10</span>  <span class="hljs-keyword">if</span>(err) <span class="hljs-keyword">throw</span> err;
<span class="lineNumber">11</span>  <span class="hljs-comment">// balabala</span>
<span class="lineNumber">12</span>})
<span class="lineNumber">13</span><span class="hljs-comment">// more</span>
<span class="lineNumber">14</span><span class="hljs-built_in">console</span>.log(<span class="hljs-number">1</span>)</code></pre> 

<p>å¦‚ä¸Šæ‰€ç¤ºï¼Œè¦ä¹ˆå»¶è¿Ÿæ‰§è¡Œå›è°ƒï¼Œè¦ä¹ˆè¯»å–æ–‡ä»¶åæ‰§è¡Œå›è°ƒï¼ŒäºŒè€…éƒ½ä¸ä¼šç«‹å³æ‰§è¡Œä»è€Œé˜»å¡ä¸»çº¿ç¨‹ï¼Œè€Œæ˜¯å„è‡ªå…·æœ‰è‡ªå·±çš„æ‰§è¡Œæ¡ä»¶ï¼Œæ»¡è¶³æ¡ä»¶åæ”¾å…¥ä»»åŠ¡å¾ªç¯é˜Ÿåˆ—ä¸­ç­‰å¾…ä¸»çº¿ç¨‹ç©ºé—²æ‰å¾—ä»¥å–å‡ºå¹¶æ‰§è¡Œã€‚</p>
<p>ä¸Šè¿°å›è°ƒå‡½æ•°åœ¨æŸäº›åœºæ™¯ä¸‹æ›¾è®©å¼€å‘è€…å†™å‡ºå¦‚ä¸‹ç±»å‹çš„ä»£ç ï¼š</p>
<pre><code class="hljs language-js"><span class="lineNumber">1</span>
<span class="lineNumber">2</span>fs.readFile(<span class="hljs-string">'file1.txt'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>)</span>{
<span class="lineNumber">3</span>  <span class="hljs-keyword">if</span>(err) <span class="hljs-keyword">throw</span> err;
<span class="lineNumber">4</span>  <span class="hljs-comment">// ...ä¸€äº›æ“ä½œ</span>
<span class="lineNumber">5</span>  fs.readFile(<span class="hljs-string">'file2.txt'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, data</span>) </span>{
<span class="lineNumber">6</span>    <span class="hljs-keyword">if</span>(err) <span class="hljs-keyword">throw</span> err;
<span class="lineNumber">7</span>    <span class="hljs-comment">// ...ä¸€äº›æ“ä½œ</span>
<span class="lineNumber">8</span>    fs.readFile(<span class="hljs-string">'file3.txt'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, data</span>) </span>{
<span class="lineNumber">9</span>      <span class="hljs-keyword">if</span>(err) <span class="hljs-keyword">throw</span> err;
<span class="lineNumber">10</span>      <span class="hljs-comment">// ...ä¸€äº›æ“ä½œ</span>
<span class="lineNumber">11</span>      fs.readFile(<span class="hljs-string">'file4.txt'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, data</span>) </span>{
<span class="lineNumber">12</span>        <span class="hljs-keyword">if</span>(err) <span class="hljs-keyword">throw</span> err;
<span class="lineNumber">13</span>        <span class="hljs-comment">// ...ä¸€äº›æ“ä½œ</span>
<span class="lineNumber">14</span>      });
<span class="lineNumber">15</span>    });
<span class="lineNumber">16</span>  });
<span class="lineNumber">17</span>})</code></pre> 

<p>ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿå› ä¸ºæŸäº›åœºæ™¯ä¸‹éœ€è¦å¯¹å¼‚æ­¥æ“ä½œè¿›è¡Œæ’åºï¼Œéœ€è¦ä¿è¯è¿è¡Œé€»è¾‘å…·æœ‰ä¸€å®šçš„é¡ºåºï¼Œå¹¶ä¸”è¿˜éœ€è¦å¯¹æ¯ä¸€ä¸ªå›è°ƒè¿›è¡Œé”™è¯¯å¤„ç†ã€‚</p>
<p>ä¸Šè¿°æ¡ˆä¾‹çœç•¥äº†çœŸå®çš„é€»è¾‘ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºè¿™ç§å›è°ƒçš„åµŒå¥—è®©ä»£ç å¾ˆå®¹æ˜“å¤±æ§ï¼Œå¹¶ä¸”éš¾ä»¥é˜…è¯»å’Œç»´æŠ¤ã€‚</p>
<p>æ— è®ºæ˜¯å†™ä¸‹è¿™æ®µä»£ç çš„äººè¿˜æ˜¯é˜…è¯»è¿™æ®µä»£ç çš„äººéƒ½è¢«å…¶æ‰€"æŠ˜ç£¨"ï¼Œæˆ‘ä»¬å°†æ­¤ç±»ä»£ç ç»“æ„ç§°ä¸º<code>â€œå›è°ƒåœ°ç‹±â€</code>ã€‚</p>
<p>å³ä½¿æˆ‘ä»¬å°†ä¹‹æ‘Šå¼€ï¼Œä¸ºæ¯ä¸€ä¸ªå›è°ƒå‡½æ•°éƒ½ç¼–å†™ä¸€ä¸ªå…·åçš„ç‹¬ç«‹å‡½æ•°æ¥è°ƒç”¨ï¼Œä¾ç„¶å¯è¯»æ€§ä¸ä½³ï¼š</p>
<pre><code class="hljs language-js"><span class="lineNumber">1</span>fs.readFile(<span class="hljs-string">'file1.txt'</span>, step1);
<span class="lineNumber">2</span> 
<span class="lineNumber">3</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">step1</span>(<span class="hljs-params">err, data</span>) </span>{
<span class="lineNumber">4</span>  <span class="hljs-keyword">if</span>(err) <span class="hljs-keyword">throw</span> err;
<span class="lineNumber">5</span>  <span class="hljs-comment">// ...</span>
<span class="lineNumber">6</span>  fs.readFile(<span class="hljs-string">'file2.txt'</span>, step2)
<span class="lineNumber">7</span>}
<span class="lineNumber">8</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">step2</span>(<span class="hljs-params">err, data</span>) </span>{
<span class="lineNumber">9</span>  <span class="hljs-keyword">if</span>(err) <span class="hljs-keyword">throw</span> err;
<span class="lineNumber">10</span>  <span class="hljs-comment">// ...</span>
<span class="lineNumber">11</span>  fs.readFile(<span class="hljs-string">'file3.txt'</span>, step3)
<span class="lineNumber">12</span>}
<span class="lineNumber">13</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">step3</span>(<span class="hljs-params">err, data</span>) </span>{
<span class="lineNumber">14</span>  <span class="hljs-keyword">if</span>(err) <span class="hljs-keyword">throw</span> err;
<span class="lineNumber">15</span>  <span class="hljs-comment">// ...</span>
<span class="lineNumber">16</span>  fs.readFile(<span class="hljs-string">'file4.txt'</span>, step4)
<span class="lineNumber">17</span>}
<span class="lineNumber">18</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">step4</span>(<span class="hljs-params">err, data</span>) </span>{
<span class="lineNumber">19</span>  <span class="hljs-keyword">if</span>(err) <span class="hljs-keyword">throw</span> err;
<span class="lineNumber">20</span>  <span class="hljs-comment">// ...</span>
<span class="lineNumber">21</span>}</code></pre> 

<p>è¿™äº›ç‹¬ç«‹å‡½æ•°çš„å‘½åä¹Ÿè®¸ä¼šè®©å¼€å‘è€…è§‰å¾—éå¸¸ä¸é€‚ï¼Œä¸ºäº†å±•å¼€å±‚å±‚åµŒå¥—ï¼Œæˆ‘ä»¬ç¼–å†™äº†è®¸å¤šå‡ ä¹ä¸ä¼šè¢«<code>é‡ç”¨</code>çš„å‡½æ•°ï¼Œå³ä½¿ç°ä»£ç¼–è¾‘å™¨åœ¨ä»£ç è·³è½¬çš„åŠŸèƒ½ä¸Šéå¸¸æ–¹ä¾¿ï¼Œé˜…è¯»æ­¤ç±»ä»£ç çš„æ—¶å€™ä¾ç„¶ä¼šè®©æˆ‘ä»¬ä¸æ–­çš„è½¬ç§»è§†çº¿ã€‚</p>
<blockquote>
<p>â€œæ‡’æƒ°â€ä½¿äººè¿›æ­¥ã€‚</p>
</blockquote>
<p>ä½¿ç”¨<code>Promise</code>,å¯ä»¥é¿å…æ­¤ç±»é—®é¢˜ï¼Œæ˜¾è‘—å‡å°‘ç¼–ç é‡ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§ã€‚</p>
<h1>2. Promise</h1>
<blockquote>
<p>IE æµè§ˆå™¨ä¸æ”¯æŒ<code>Promise</code>,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>bluebird</code>æˆ–<code>es6-promise</code>ç­‰ç¬¬ä¸‰æ–¹åº“.</p>
</blockquote>
<h2>2.1 promise æµ…æ</h2>
<p>ä½¿ç”¨<code>new</code>å®ä¾‹åŒ–çš„<code>Promise</code>å¯¹è±¡å…·æœ‰ä¸‰ç§çŠ¶æ€:</p>
<ul>
<li><code>Fulfilled</code> - <code>has resolution</code>: resolve æˆåŠŸ,è°ƒç”¨ <code>onFulfilled</code>å‡½æ•°</li>
<li><code>Rejected</code> - <code>has rejection</code>: reject, è°ƒç”¨<code>onRejected</code>å‡½æ•°</li>
<li><code>Pending</code> - <code>unresolved</code>: åˆå§‹åŒ–çŠ¶æ€</li>
</ul>
<blockquote>
<p>çŸ­æ¨ªçº¿å·¦è¾¹æ˜¯<code>Promise/A+</code>æœ¯è¯­,è€Œå³è¾¹åˆ™æ˜¯<code>ES6 Promise</code>æœ¯è¯­.</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/youyiqin/markdown_imgs/master/image-1582215000590-ffa807c19d5f6959de485fc66664e123.png" alt=""></p>
<p>åˆå§‹çŠ¶æ€ä¸º<code>pending</code>,è½¬ä¸º<code>Fulfilled</code>æˆ–è€…<code>Rejected</code>ä¹‹åä¸ä¼šå†æœ‰å˜åŒ–.<code>Fulfilled</code>å’Œ<code>Rejected</code>çŠ¶æ€ä¹Ÿè¢«ç§°ä¸º<code>Settled</code>ã€‚</p>
<p><code>Promise</code>çš„çŠ¶æ€æµè½¬å¹¶ä¸å¤æ‚ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦æ³¨æ„å…¶ä¸­ä¸€äº›ç»†èŠ‚ã€‚</p>
<blockquote>
<p>æœ¬æ–‡ä¸ä¼šå¯¹<code>promise</code>åšé¢é¢ä¿±åˆ°çš„ä»‹ç»,æ¨èé˜…è¯»å®˜æ–¹æ–‡æ¡£.</p>
</blockquote>
<p>é¦–å…ˆ,æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ª<code>promise</code>å®ä¾‹:</p>
<pre><code class="hljs language-js"><span class="lineNumber">1</span><span class="hljs-comment">// å®ä¾‹åŒ–</span>
<span class="lineNumber">2</span><span class="hljs-keyword">const</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =></span> {
<span class="lineNumber">3</span>  <span class="hljs-comment">// balabala</span>
<span class="lineNumber">4</span>  <span class="hljs-function"><span class="hljs-title">if</span>(<span class="hljs-params">...</span>)</span> {
<span class="lineNumber">5</span>    <span class="hljs-comment">// å®ä¾‹çŠ¶æ€å˜æ›´ï¼Œè®¾ç½®å€¼</span>
<span class="lineNumber">6</span>    resolve(value) <span class="hljs-comment">// success</span>
<span class="lineNumber">7</span>    resolve(...) <span class="hljs-comment">// å¿½ç•¥</span>
<span class="lineNumber">8</span>  } <span class="hljs-keyword">else</span> {
<span class="lineNumber">9</span>  	reject(reason) <span class="hljs-comment">// failure</span>
<span class="lineNumber">10</span>  }
<span class="lineNumber">11</span>})
<span class="lineNumber">12</span><span class="hljs-comment">// é“¾å¼è°ƒç”¨ï¼Œå®ä¾‹æ–¹æ³• then è¿”å›ä¸€ä¸ªæ–°çš„å®ä¾‹</span>
<span class="lineNumber">13</span>promise
<span class="lineNumber">14</span>  .then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) </span>{
<span class="lineNumber">15</span>		<span class="hljs-comment">// balabala</span>
<span class="lineNumber">16</span>  })
<span class="lineNumber">17</span>	.then(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) </span>{
<span class="lineNumber">18</span>		<span class="hljs-comment">// balabala</span>
<span class="lineNumber">19</span>  })
<span class="lineNumber">20</span>	.catch(<span class="hljs-function"><span class="hljs-params">reason</span> =></span> {
<span class="lineNumber">21</span>  	<span class="hljs-comment">// balabala</span>
<span class="lineNumber">22</span>  })
<span class="lineNumber">23</span>	.finally(<span class="hljs-function">() =></span> {})</code></pre> 

<p>ä¸Šè¿°ç¤ºä¾‹å±•ç¤ºäº†<code>promise</code>çš„ä¸€äº›ç‰¹æ€§ï¼Œå¦‚å®ä¾‹åŒ–ã€çŠ¶æ€è½¬æ¢èµ‹å€¼ã€é“¾å¼è°ƒç”¨å’Œå¼‚å¸¸å¤„ç†ï¼Œä¸‹é¢æˆ‘ä»¬ä¼šè®²åˆ°é™æ€æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•ã€‚</p>
<h2>2.1 Promise æ„é€ å™¨</h2>
<p>æˆ‘ä»¬é€šè¿‡<code>new Promise(executor)</code>å®ä¾‹åŒ–ä¸€ä¸ª<code>promise</code>çš„æ—¶å€™,å…¶çŠ¶æ€ä¸º<code>pending</code>.åœ¨å®ä¾‹åŒ–çš„æ—¶å€™ä¼ å…¥ä¸€ä¸ªå‡½æ•°<code>executorï¼ˆæ‰§è¡Œå™¨ï¼‰</code>ï¼Œæ­¤å‡½æ•°å°†ä¼šè·å–ä¸¤ä¸ªå®å‚<code>resolve</code>å’Œ<code>reject</code>å‡½æ•°ï¼ŒäºŒè€…éƒ½å¯ä»¥æ”¹å˜å®ä¾‹çš„çŠ¶æ€å’Œå€¼ã€‚</p>
<blockquote>
<p>ä¸æä¾› <code>executor</code> å°†æŠ›å‡º <code>typeError</code></p>
</blockquote>
<p>ä¸Šè¿°ä»£ç çš„ç‰‡æ®µï¼š</p>
<pre><code class="hljs language-js"><span class="lineNumber">1</span><span class="hljs-comment">// å®ä¾‹åŒ–</span>
<span class="lineNumber">2</span><span class="hljs-keyword">const</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =></span> {
<span class="lineNumber">3</span>  <span class="hljs-comment">// balabala</span>
<span class="lineNumber">4</span>  <span class="hljs-function"><span class="hljs-title">if</span>(<span class="hljs-params">...</span>)</span> {
<span class="lineNumber">5</span>    <span class="hljs-comment">// å®ä¾‹çŠ¶æ€å˜æ›´ï¼Œè®¾ç½®å€¼</span>
<span class="lineNumber">6</span>    resolve(value) <span class="hljs-comment">// success</span>
<span class="lineNumber">7</span>    resolve(...) <span class="hljs-comment">// å¿½ç•¥</span>
<span class="lineNumber">8</span>  } <span class="hljs-keyword">else</span> {
<span class="lineNumber">9</span>  	reject(reason) <span class="hljs-comment">// failure</span>
<span class="lineNumber">10</span>  }
<span class="lineNumber">11</span>})</code></pre> 

<p>éœ€è¦å…³æ³¨ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li><code>Executor</code>å‡½æ•°çš„å‚æ•°æ²¡æœ‰é™åˆ¶ï¼Œä½†é€šå¸¸æˆ‘ä»¬ä¼šå£°æ˜ä¸¤ä¸ªå½¢å‚å‡½æ•°ï¼š<code>resolve</code>å’Œ<code>reject</code>ï¼Œ<code>executor</code>å†…éƒ¨ä½¿ç”¨æ­¤äºŒè€…å¯ä»¥æ˜¾å¼åœ°è½¬æ¢<code>Promise</code>å®ä¾‹çš„çŠ¶æ€ï¼Œè®¾ç½®å…¶å€¼ã€‚ï¼ˆä¸ä½¿ç”¨è¿™ä¸¤ä¸ªå‡½æ•°æ¥è½¬æ¢å®ä¾‹çŠ¶æ€æ„å‘³ç€æ­¤å®ä¾‹çš„çŠ¶æ€ä¸ä¼šæ”¹å˜ï¼Œè¿™ä¹Ÿå†™å¹¶æ²¡æœ‰å¤šå¤§æ„ä¹‰ï¼‰ã€‚</li>
<li><code>resolve</code>å’Œ<code>reject</code>å‡½æ•°çš„å®å‚å¯ä»¥æ˜¯ä¸åŒç±»å‹çš„å€¼ï¼Œä½†æ˜¯ä¼šè¢«è¿›ä¸€æ­¥å¤„ç†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ˜¾ç¤ºè½¬æ¢çŠ¶æ€è®¾ç½®å€¼çš„æ—¶å€™ï¼Œä¼ å…¥çš„å‚æ•°ä¸ä¸€å®šä¼šç›´æ¥ä½œä¸º<code>settled</code>çŠ¶æ€çš„å€¼ã€‚</li>
<li><code>pending</code>çŠ¶æ€åˆ°<code>settled</code>çŠ¶æ€æ˜¯ä¸å¯é€†çš„ï¼Œå¹¶ä¸”åœ¨<code>executor</code>ä¸­çš„<code>resolve</code>å’Œ<code>reject</code>å‡½æ•°åªèƒ½æ‰§è¡Œä¸€æ¬¡ï¼Œåç»­å†æ‰§è¡Œå°†ä¼šè¢«å¿½ç•¥ã€‚</li>
</ul>
<blockquote>
<p><code>executor</code>å‡½æ•°æ˜¯åŒæ­¥æ‰§è¡Œçš„ã€‚<code>resolve</code>å’Œ<code>reject</code>å‡½æ•°æ¥æ”¶ä»»æ„ç±»å‹çš„å€¼ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹ç»™<code>resolve</code>å‡½æ•°ä¼ å…¥ä»¥ä¸‹ä¸‰ç§ä¸åŒçš„å€¼ä¼šæœ‰æ€æ ·çš„ç»“æœã€‚</p>
<ul>
<li>åŸå§‹ç±»å‹å€¼</li>
<li>Promise å®ä¾‹</li>
<li>thenable å¯¹è±¡</li>
</ul>
<p>é¦–å…ˆæ˜¯<code>åŸå§‹ç±»å‹å€¼</code>ï¼š</p>
<pre><code class="hljs language-js"><span class="lineNumber">1</span><span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =></span> {
<span class="lineNumber">2</span>  resolve(<span class="hljs-built_in">Symbol</span>())
<span class="lineNumber">3</span>  <span class="hljs-comment">// resolve(1)</span>
<span class="lineNumber">4</span>  <span class="hljs-comment">// resolve('1')</span>
<span class="lineNumber">5</span>  <span class="hljs-comment">// resolve(null)</span>
<span class="lineNumber">6</span>  <span class="hljs-comment">// resolve(undefined)</span>
<span class="lineNumber">7</span>  <span class="hljs-comment">// resolve(1n)</span>
<span class="lineNumber">8</span>  <span class="hljs-comment">// resolve(true)</span>
<span class="lineNumber">9</span>  <span class="hljs-comment">// reject ä¹Ÿæ˜¯å¦‚æ­¤</span>
<span class="lineNumber">10</span>})
<span class="lineNumber">11</span> 
<span class="lineNumber">12</span>p.then(<span class="hljs-function">(<span class="hljs-params">v</span>) =></span> {
<span class="lineNumber">13</span>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'resolve'</span>ï¼Œ v);
<span class="lineNumber">14</span>}).catch(<span class="hljs-function">(<span class="hljs-params">i</span>) =></span> {
<span class="lineNumber">15</span>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'reject'</span>, i);
<span class="lineNumber">16</span>})</code></pre> 

<p>åŸå§‹ç±»å‹æ•°æ®ä¼ å…¥<code>resolve</code>å‡½æ•°ï¼Œéƒ½èƒ½é¡ºåˆ©å°†çŠ¶æ€è½¬ä¸º<code>fulfilled</code>å¹¶ä¸”è®¾ç½®ä¸ºå½“å‰çŠ¶æ€ä¸‹çš„å€¼ã€‚ä½¿ç”¨<code>reject</code>å‡½æ•°åˆ™å°†çŠ¶æ€è½¬ä¸º<code>rejected</code>,å€¼åˆ™æ˜¯åŸå§‹ç±»å‹çš„å€¼ã€‚</p>
<p>å…¶æ¬¡ï¼Œæ¥çœ‹çœ‹ä¼ å…¥<code>Promise</code>å¯¹è±¡ã€‚</p>
<pre><code class="hljs language-js"><span class="lineNumber">1</span><span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =></span> {
<span class="lineNumber">2</span>  resolve(<span class="hljs-built_in">Promise</span>.resolve(<span class="hljs-number">1</span>))
<span class="lineNumber">3</span>  <span class="hljs-comment">// or</span>
<span class="lineNumber">4</span>  reject(<span class="hljs-built_in">Promise</span>.resolve(<span class="hljs-number">1</span>))
<span class="lineNumber">5</span>})
<span class="lineNumber">6</span>p.then(<span class="hljs-function">(<span class="hljs-params">v</span>) =></span> {
<span class="lineNumber">7</span>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'resolve'</span>, v);
<span class="lineNumber">8</span>}).catch(<span class="hljs-function">(<span class="hljs-params">i</span>) =></span> {
<span class="lineNumber">9</span>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'reject'</span>, i)
<span class="lineNumber">10</span>})
<span class="lineNumber">11</span><span class="hljs-comment">// output</span>
<span class="lineNumber">12</span>resolve <span class="hljs-number">1</span></code></pre> 

<p>å¦‚æœä¼ å…¥ç»™<code>promise</code>çš„å‚æ•°ä¹Ÿæ˜¯ä¸€ä¸ª<code>Promise</code>å®ä¾‹ï¼Œåˆ™ç›¸å½“äºä¸€ä¸ªç©ºåŒ…è£…ï¼Œæœ€ç»ˆå°†å¾—åˆ°ä¸€ä¸ªç›¸åŒçŠ¶æ€å’Œå€¼çš„<code>Promise</code>å®ä¾‹ã€‚</p>
<blockquote>
<p><code>reject(Promise.resolve(1))</code> ä¸ä¼šç…§æ¬<code>resolve</code>çš„ç‰¹æ€§ï¼Œå¯¹äºä¼ å…¥ä¸€ä¸ª<code>Promise</code>å®ä¾‹çš„æƒ…å½¢ï¼Œä¼šå°†ä¹‹ä½œä¸º<code>Rejected</code>çŠ¶æ€ä¸‹çš„<code>reason</code>ã€‚</p>
</blockquote>
<pre><code class="hljs language-js"><span class="lineNumber">1</span><span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =></span> {
<span class="lineNumber">2</span>  resolve(<span class="hljs-built_in">Promise</span>.reject(<span class="hljs-number">1</span>))
<span class="lineNumber">3</span>})
<span class="lineNumber">4</span><span class="hljs-comment">// output</span>
<span class="lineNumber">5</span>reject <span class="hljs-number">1</span></code></pre> 

<p>æ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹ä¼ å…¥ä¸€ä¸ªæ™®é€šçš„ <code>thenable</code> å¯¹è±¡ã€‚</p>
<blockquote>
<p>å…·æœ‰<code>then</code>æ–¹æ³•çš„å¯¹è±¡ç§°ä¸º<code>thenable</code>å¯¹è±¡ï¼Œ<code>Promise</code>å®ä¾‹å¯¹è±¡ä¹Ÿæ˜¯ä¸€ç§<code>thenable</code>å¯¹è±¡ã€‚</p>
</blockquote>
<pre><code class="hljs language-js"><span class="lineNumber">1</span><span class="hljs-keyword">const</span> obj = {
<span class="lineNumber">2</span>  <span class="hljs-attr">name</span>: <span class="hljs-string">'Miao'</span>,
<span class="lineNumber">3</span>  <span class="hljs-function"><span class="hljs-title">then</span>(<span class="hljs-params"></span>)</span> {
<span class="lineNumber">4</span>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'this is then'</span>, <span class="hljs-built_in">arguments</span>);
<span class="lineNumber">5</span>    <span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>](<span class="hljs-number">1</span>)
<span class="lineNumber">6</span>  }
<span class="lineNumber">7</span>}
<span class="lineNumber">8</span><span class="hljs-keyword">const</span> p = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =></span> {
<span class="lineNumber">9</span>  resolve(obj)
<span class="lineNumber">10</span>})
<span class="lineNumber">11</span> 
<span class="lineNumber">12</span>p.then(<span class="hljs-function">(<span class="hljs-params">v</span>) =></span> {
<span class="lineNumber">13</span>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'resolve'</span>, v);
<span class="lineNumber">14</span>}).catch(<span class="hljs-function">(<span class="hljs-params">i</span>) =></span> {
<span class="lineNumber">15</span>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'reject'</span>, i)
<span class="lineNumber">16</span>})
<span class="lineNumber">17</span><span class="hljs-comment">// output</span>
<span class="lineNumber">18</span><span class="hljs-built_in">this</span> is then [Arguments] {
<span class="lineNumber">19</span>  <span class="hljs-string">'0'</span>: [<span class="hljs-built_in">Function</span> (anonymous)],
<span class="lineNumber">20</span>  <span class="hljs-string">'1'</span>: [<span class="hljs-built_in">Function</span> (anonymous)]
<span class="lineNumber">21</span>}
<span class="lineNumber">22</span>resolve <span class="hljs-number">1</span></code></pre> 

<p><code>executor</code>å†…<code>resolve</code>ä¸€ä¸ª<code>thenable</code>å¯¹è±¡ï¼Œåˆ™ä¼šå°†<code>then</code>æ–¹æ³•è§†ä½œä¸€ä¸ª<code>executor</code>ï¼Œåœ¨å…¶å†…éƒ¨å¯ä»¥æ˜¾ç¤ºç¼–å†™<code>resolve</code>å’Œ<code>reject</code>çš„é€»è¾‘æ¥æ”¹å˜æ•´ä¸ª<code>Promise</code>å®ä¾‹çš„çŠ¶æ€å’Œå€¼ã€‚</p>
<h2>2.2 Promise å®ä¾‹æ–¹æ³•</h2>
<p><code>Promise</code>å®ä¾‹æœ‰ä¸‰ä¸ªå®ä¾‹æ–¹æ³•ï¼š</p>
<ul>
<li><code>then</code></li>
<li><code>catch</code></li>
<li><code>finally</code></li>
</ul>
<blockquote>
<p>é‡ç”³ï¼š<code>promise</code>å®ä¾‹çš„çŠ¶æ€è½¬æ¢æ˜¯å•å‘çš„,ä¸€æ—¦<code>settled</code>åˆ™ä¸å¯é€†è½¬,åŒæ—¶æˆ‘ä»¬å¯ä»¥å¤šæ¬¡åˆ©ç”¨æ­¤<code>settled</code>çŠ¶æ€çš„å®ä¾‹ã€‚</p>
</blockquote>
<p>é¦–å…ˆæ˜¯<code>then(onFulfilled, onRejected)</code>æ–¹æ³•ï¼Œæ­¤æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œåœ¨<code>Promise</code>çŠ¶æ€ä¸º<code>pending</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ­¤æ–¹æ³•ç†è§£ä¸ºæ³¨å†ŒçŠ¶æ€è½¬å˜ä¸º<code>Fulfilled</code>å’Œ<code>Rejected</code>åæ‰§è¡Œçš„å›è°ƒå‡½æ•°ï¼Œå¹¶ä¸”è¿™äº›å›è°ƒå‡½æ•°çš„æ‰§è¡Œæ˜¯å¼‚æ­¥çš„ã€‚</p>
<blockquote>
<p><code>Promise</code>åªèƒ½è½¬æ¢ä¸€æ¬¡ï¼Œå› æ­¤ä¸Šè¿°ä¸¤ä¸ªå‚æ•°çš„æ“ä½œæ˜¯äº’æ–¥çš„ã€‚</p>
</blockquote>
<p>åœ¨å®ç°ä¸Š<code>Node</code>å¯ä»¥é€šè¿‡<code>process.nextTick</code>æ¥åˆ›å»ºæ–°çš„å¾®ä»»åŠ¡ï¼Œåœ¨æµè§ˆå™¨ç«¯åˆ™å¯ä»¥é€šè¿‡<code>MutationObserver</code>åŠŸèƒ½åˆ›å»ºå¾®ä»»åŠ¡ã€‚</p>
<p>ä»¥ä¸‹ä¸¤ç§<code>then</code>å‡½æ•°çš„ä¼ å‚éƒ½ä¼šè¢«å¿½ç•¥, å¹¶ä¸”å¼‚æ­¥è¿”å›ä¸€ä¸ªç›¸åŒå€¼çš„<code>Promise</code>æ–°å®ä¾‹ï¼š</p>
<pre><code class="hljs language-js"><span class="lineNumber">1</span><span class="hljs-comment">// ä¼ éå‡½æ•°å¤„ç†å¯¹è±¡</span>
<span class="lineNumber">2</span><span class="hljs-built_in">Promise</span>.resolve(<span class="hljs-number">1</span>).then(<span class="hljs-string">'sss'</span>)
<span class="lineNumber">3</span><span class="hljs-comment">// ä¸ä¼ å€¼</span>
<span class="lineNumber">4</span><span class="hljs-built_in">Promise</span>.resolve(<span class="hljs-number">1</span>).then()
<span class="lineNumber">5</span> 
<span class="lineNumber">6</span><span class="hljs-keyword">const</span> p = <span class="hljs-built_in">Promise</span>.resolve(<span class="hljs-number">1</span>)
<span class="lineNumber">7</span><span class="hljs-keyword">let</span> c = p.then()
<span class="lineNumber">8</span><span class="hljs-built_in">console</span>.log(p);
<span class="lineNumber">9</span><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =></span> {
<span class="lineNumber">10</span>  <span class="hljs-built_in">console</span>.log(c);
<span class="lineNumber">11</span>}, <span class="hljs-number">200</span>);
<span class="lineNumber">12</span><span class="hljs-comment">// output</span>
<span class="lineNumber">13</span><span class="hljs-built_in">Promise</span> { <span class="hljs-number">1</span> }
<span class="lineNumber">14</span><span class="hljs-built_in">Promise</span> { <span class="hljs-number">1</span> }</code></pre> 

<p>ä¸æ¨èç¼–å†™ä¸Šè¿°<code>then</code>æ–¹æ³•ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“æ­¤ç§æƒ…å½¢<code>Promise</code>ä¼šå¦‚ä½•å¤„ç†æ•´ä½“çš„é€»è¾‘æµç¨‹ã€‚</p>
<blockquote>
<p>æ— è®º<code>Promise</code>å®ä¾‹å¤„äºä½•ç§çŠ¶æ€ï¼Œæˆ‘ä»¬æ³¨å†Œå›è°ƒå‡½æ•°éƒ½å°†å¼‚æ­¥æ‰§è¡Œã€‚</p>
</blockquote>
<p>å…¶æ¬¡ï¼Œ<code>catch</code>æ–¹æ³•å¯ä»¥ç†è§£ä¸º<code>then</code>æ–¹æ³•çš„è¯­æ³•ç³–å½¢å¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†<code>then(undefiled, onRejected)</code>è§†ä¸º<code>catch(onRejected)</code>ä¸€ç§å½¢å¼ï¼Œå¼€å‘è€…å¯ä»¥è‡ªç”±é€‰æ‹©å¦‚ä½•ç¼–å†™<code>Promise</code>å®ä¾‹ä»<code>pending</code>è½¬ä¸º<code>settled</code>çŠ¶æ€åçš„å¼‚æ­¥å›è°ƒå‡½æ•°ã€‚</p>
<p>æœ€åï¼Œ<code>finally</code>æ–¹æ³•åˆ™ç›¸å½“äºæ³¨å†Œä¸€ä¸ª<code>Promise</code>å®ä¾‹<code>settled</code>ä¹‹åçš„æ¸…ç†æ–¹æ³•ï¼Œé€šå¸¸æˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¸€ä¸ªå…·æœ‰æ¸…ç†åŠŸèƒ½çš„å‡½æ•°ä½œä¸ºå‚æ•°ã€‚</p>
<blockquote>
<p><code>finally</code>è¿”å›ä¸€ä¸ªæ–°çš„<code>Promise</code>å®ä¾‹ï¼Œ<code>finally</code>è®¾è®¡ä¸ºä¸€ä¸ªä¸çŠ¶æ€æ— å…³çš„æ–¹æ³•ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹åªæ˜¯ä¼ é€’ä¸Šå±‚çš„<code>Promise</code>ï¼Œé™¤éæ˜¾å¼åœ°è¿”å›ä¸€ä¸ªæ–°çš„<code>Promise</code>å®ä¾‹ï¼Œæˆ–è€…æŠ›å‡ºå¼‚å¸¸è¿”å›<code>Rejected</code>çŠ¶æ€çš„å®ä¾‹ã€‚</p>
</blockquote>
<p>è®©æˆ‘ä»¬æ¥å†™ä¸€ä¸ªç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-js"><span class="lineNumber">1</span><span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve ,reject</span>) =></span> resolve(<span class="hljs-number">1</span>))
<span class="lineNumber">2</span>  .then(<span class="hljs-function">() =></span> {
<span class="lineNumber">3</span>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'1'</span>);
<span class="lineNumber">4</span>  })
<span class="lineNumber">5</span>  .then(<span class="hljs-function">(<span class="hljs-params">v</span>) =></span> {
<span class="lineNumber">6</span>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'2'</span>, v);
<span class="lineNumber">7</span>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'my error'</span>)
<span class="lineNumber">8</span>  })
<span class="lineNumber">9</span>  .then(<span class="hljs-function">() =></span> {
<span class="lineNumber">10</span>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'3'</span>);
<span class="lineNumber">11</span>  })
<span class="lineNumber">12</span>  .catch(<span class="hljs-function"><span class="hljs-params">err</span> =></span> {
<span class="lineNumber">13</span>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'catch any error'</span>);
<span class="lineNumber">14</span>    <span class="hljs-keyword">return</span> <span class="hljs-number">4</span> <span class="hljs-comment">// æˆ–è€… return Promise.resolve(4)</span>
<span class="lineNumber">15</span>  })
<span class="lineNumber">16</span>  .then(<span class="hljs-function">(<span class="hljs-params">v</span>) =></span> {
<span class="lineNumber">17</span>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'4'</span>, v);
<span class="lineNumber">18</span>    <span class="hljs-keyword">return</span> <span class="hljs-number">5</span>
<span class="lineNumber">19</span>  })
<span class="lineNumber">20</span>  .finally(<span class="hljs-function">() =></span> {
<span class="lineNumber">21</span>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'finally'</span>);
<span class="lineNumber">22</span>  })
<span class="lineNumber">23</span>  .then(<span class="hljs-function"><span class="hljs-params">v</span> =></span> {
<span class="lineNumber">24</span>    <span class="hljs-built_in">console</span>.log(<span class="hljs-number">5</span>, v);
<span class="lineNumber">25</span>  })
<span class="lineNumber">26</span><span class="hljs-comment">// output</span>
<span class="lineNumber">27</span><span class="hljs-number">1</span>
<span class="lineNumber">28</span><span class="hljs-number">2</span> <span class="hljs-literal">undefined</span>
<span class="lineNumber">29</span><span class="hljs-keyword">catch</span> any error
<span class="lineNumber">30</span><span class="hljs-number">4</span> <span class="hljs-number">4</span>
<span class="lineNumber">31</span><span class="hljs-keyword">finally</span>
<span class="lineNumber">32</span><span class="hljs-number">5</span> <span class="hljs-number">5</span></code></pre> 

<blockquote>
<p><code>Promise</code>å®ä¾‹æ”¯æŒé“¾å¼è°ƒç”¨,æ¯ä¸ª<code>then</code>å‡½æ•°å†…éƒ¨æœ€åå°†è¿”å›ä¸€ä¸ªå…¨æ–°çš„<code>promise</code>å®ä¾‹ã€‚</p>
</blockquote>
<p><code>then</code>æ–¹æ³•é»˜è®¤è¿”å›ä¸€ä¸ªå€¼ä¸º<code>undefined</code>,çŠ¶æ€ä¸º<code>fulfilled</code>çš„<code>Promise</code>å®ä¾‹.</p>
<blockquote>
<p><code>å›è°ƒå‡½æ•°</code>çš„å†™æ³•ç¼–å†™å¯ä»¥ä¸€æ¬¡æ€§ç›‘å¬æ‰€æœ‰å›è°ƒå‡½æ•°çš„é”™è¯¯å¤„ç†é€»è¾‘æ˜¯å¾ˆå›°éš¾çš„,<code>Promiseå®ä¾‹</code>çš„å®ä¾‹æ–¹æ³•<code>catch</code>èƒ½å¤„ç†é“¾å¼è°ƒç”¨ä¹‹å‰æ‰€æœ‰çš„<code>then</code>å‡½æ•°é”™è¯¯å’Œæ˜¾å¼çš„<code>reject</code>è¡Œä¸º.</p>
</blockquote>
<p><code>catch</code>æ–¹æ³•èƒ½å¤„ç†é“¾å¼è°ƒç”¨ä¹‹å‰æ‰€æœ‰çš„å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å‰é¢çš„<code>Promise</code>çŠ¶æ€è½¬ä¸º<code>rejected</code>çš„æ—¶å€™ï¼Œä¼š"è·³è¿‡"<code>then</code>æ–¹æ³•ï¼Œä»è€Œæ‰§è¡Œ<code>catch</code>æ–¹æ³•æ³¨å†Œçš„å¼‚æ­¥å›è°ƒã€‚</p>
<blockquote>
<p><code>Promise</code>çš„å¼‚æ­¥æ³¨å†Œç›‘å¬å‡½æ•°çš„æ‰§è¡Œé¡ºåºå–å†³äºä½¿ç”¨å®ä¾‹æ–¹æ³•æ·»åŠ çš„é¡ºåºã€‚</p>
</blockquote>
<h2>2.3 Promise é™æ€æ–¹æ³•</h2>
<p><code>Promise</code>ç±»å…·æœ‰ä¸¤ä¸ªèƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹çš„é™æ€æ–¹æ³•:</p>
<ul>
<li>Promise.resolve(value)</li>
<li>Promise.reject(reason)</li>
</ul>
<p>äºŒè€…åŒºåˆ«åœ¨äºè¿”å›çš„<code>promise</code>å®ä¾‹çš„çŠ¶æ€,å‰è€…ä¸º<code>fulfilled</code>,åè€…ä¸º<code>rejected</code>.</p>
<p><code>Promise.resolve(value)</code>å¯ä»¥è§†ä¸ºä»¥ä¸‹ä»£ç çš„ç®€å†™:</p>
<pre><code class="hljs language-js"><span class="lineNumber">1</span><span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =></span> {
<span class="lineNumber">2</span>  resolve(value)
<span class="lineNumber">3</span>})</code></pre> 

<p><code>Promise.reject(reason)</code>äº¦ç±»ä¼¼ã€‚</p>
<p>å†æ¬¡é‡ç”³ï¼Œä¼ å…¥çš„å®å‚<code>ï¼ˆvalue/reasonï¼‰</code>å¯ä»¥æœ‰å‡ ç§æƒ…å½¢ï¼š</p>
<ul>
<li>å¦‚æœ<code>value</code>æ˜¯ä¸€ä¸ªåŸå§‹æ•°æ®ç±»å‹çš„å€¼ï¼Œåˆ™è®¾ç½®<code>Promise</code>å®ä¾‹å€¼ä¸ºæ­¤å€¼ï¼ŒçŠ¶æ€è®¾ç½®ä¸º<code>fulfilled</code></li>
<li>å¦‚æœ<code>value</code>æ˜¯ä¸€ä¸ª<code>Promise</code>å®ä¾‹ï¼Œåˆ™æ²¿ç”¨æ­¤å®ä¾‹çš„çŠ¶æ€å’Œå€¼ã€‚</li>
<li>å¦‚æœä¼ å…¥çš„å®å‚æ˜¯ä¸€ä¸ªé<code>Promise</code>çš„<code>thenable</code>å¯¹è±¡ï¼Œåˆ™è°ƒç”¨æ­¤å¯¹è±¡çš„<code>then</code>æ–¹æ³•ï¼Œå¹¶ä¸”ä¼ å…¥<code>resolve</code>å’Œ<code>reject</code>ä½œä¸ºå®å‚,å°†<code>then</code>æ–¹æ³•ä½œä¸º<code>executor</code>ï¼Œåœ¨å†…éƒ¨å¯ä»¥è®¾ç½®å½“å‰å®ä¾‹çš„çŠ¶æ€å’Œå€¼, å¿…é¡»æ˜¾ç¤ºè°ƒç”¨<code>resolve</code>æˆ–è€…<code>reject</code>æ–¹æ³•ï¼Œä½¿ç”¨<code>return</code>å…¶ä»–å€¼åˆ™æ— æ•ˆã€‚</li>
</ul>
<pre><code class="hljs language-js"><span class="lineNumber">1</span><span class="hljs-keyword">const</span> obj = {
<span class="lineNumber">2</span>  <span class="hljs-attr">name</span>: <span class="hljs-string">'o'</span>,
<span class="lineNumber">3</span>  <span class="hljs-function"><span class="hljs-title">then</span>(<span class="hljs-params"></span>)</span> {
<span class="lineNumber">4</span>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'this is then'</span>, <span class="hljs-built_in">arguments</span>);
<span class="lineNumber">5</span>    <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>](<span class="hljs-number">1</span>)
<span class="lineNumber">6</span>  }
<span class="lineNumber">7</span>}
<span class="lineNumber">8</span><span class="hljs-keyword">const</span> p = <span class="hljs-built_in">Promise</span>.resolve(obj)
<span class="lineNumber">9</span>p
<span class="lineNumber">10</span>	.then(<span class="hljs-function"><span class="hljs-params">r</span> =></span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'resolve'</span>, r))
<span class="lineNumber">11</span>  .catch(<span class="hljs-function"><span class="hljs-params">r</span> =></span> {
<span class="lineNumber">12</span>		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'reject'</span>, r);
<span class="lineNumber">13</span>	})
<span class="lineNumber">14</span> 
<span class="lineNumber">15</span><span class="hljs-comment">// output</span>
<span class="lineNumber">16</span><span class="hljs-built_in">this</span> is then [Arguments] {
<span class="lineNumber">17</span>  <span class="hljs-string">'0'</span>: [<span class="hljs-built_in">Function</span> (anonymous)],
<span class="lineNumber">18</span>  <span class="hljs-string">'1'</span>: [<span class="hljs-built_in">Function</span> (anonymous)]
<span class="lineNumber">19</span>}
<span class="lineNumber">20</span>reject <span class="hljs-number">1</span></code></pre> 

<p>æ­¤å¤–,<code>Promise</code>ç±»è¿˜æœ‰å¦‚ä¸‹å‡ ä¸ªé™æ€æ–¹æ³•:</p>
<ul>
<li><code>Promise.all(iterable)</code></li>
<li><code>Promise.race(iterable)</code></li>
<li><code>Promise.any(iterable)</code></li>
<li><code>Promise.allSettled(iterable)</code></li>
</ul>
<p>è¿™å‡ ä¸ªé™æ€æ–¹æ³•å„æœ‰å…¶åº”ç”¨åœºæ™¯.</p>
<blockquote>
<p>æ˜¯å¦æ”¯æŒè¿™äº›é™æ€æ–¹æ³•å–å†³äºå½“å‰ç¯å¢ƒ,ä¾‹å¦‚åœ¨<code>IE</code>æµè§ˆå™¨ä¸‹æ— æ³•ä½¿ç”¨<code>Promise</code>ï¼Œåœ¨<code>Node14</code>ä¸‹æ— æ³•ä½¿ç”¨<code>Promise.allSettled</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“æ¥è¿›è¡Œæ›¿æ¢ï¼Œä¾‹å¦‚<code>bluebird</code>ã€‚</p>
</blockquote>
<h3>2.2.1 all</h3>
<p>é¦–å…ˆ,<code>Promise.all(iterable)</code>æ–¹æ³•æ¥æ”¶ä¸€ä¸ª<code>iterable</code>å¯¹è±¡ï¼ˆé€šå¸¸æ˜¯æ•°ç»„ï¼‰ä½œä¸ºå‚æ•°,æœ€ç»ˆè¿”å›ä¸€ä¸ªæ–°çš„<code>promise å®ä¾‹</code>.</p>
<blockquote>
<p>å¦‚æœ<code>iterable</code>å¯¹è±¡æ˜¯ç©ºçš„,åˆ™è¿”å›çš„ç»“æœæ˜¯ç©ºæ•°ç»„(å°½ç®¡æˆ‘ä»¬ä¸å¤ªä¼šè¿™ä¹ˆåš).</p>
</blockquote>
<p>æˆ‘ä»¬é€šè¿‡ç¤ºä¾‹ä»£ç æ¥ç†è§£è§„èŒƒ:</p>
<pre><code class="hljs language-js"><span class="lineNumber">1</span><span class="hljs-keyword">let</span> p1 = <span class="hljs-built_in">Promise</span>.all([
<span class="lineNumber">2</span>  <span class="hljs-number">1</span>,
<span class="lineNumber">3</span>  <span class="hljs-built_in">Promise</span>.resolve(<span class="hljs-number">2</span>)
<span class="lineNumber">4</span>])</code></pre> 

<p>åˆæˆçš„<code>Promise</code>å°†åœ¨æ‰€æœ‰å†…éƒ¨<code>Promise</code>å®ä¾‹è½¬åŒ–ä¸º<code>Fulfilled</code>çŠ¶æ€åè½¬æ¢ä¸º<code>Fulfilled</code>çŠ¶æ€ï¼Œå…¶å€¼æ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡è½¬åŒ–ä¸º<code>Promise</code>è§£å†³ä¹‹åçš„å€¼çš„æ•°ç»„ã€‚</p>
<blockquote>
<p>å¯è¿­ä»£å¯¹è±¡å°†ä¼šé€šè¿‡<code>Promise.resolve</code>æ–¹æ³•è½¬æ¢ä¸º<code>Promise</code>å®ä¾‹ã€‚</p>
</blockquote>
<p>å¦‚æœä¸€æ—¦å…¶ä¸­ä¹‹ä¸€å‡ºç°<code>rejected</code>çŠ¶æ€çš„<code>promise å®ä¾‹</code>,åˆ™åˆæˆçš„<code>Promise</code>å®ä¾‹çš„çŠ¶æ€è½¬åŒ–ä¸º<code>rejected</code>,ä¸”å€¼ä¸ºæœ€å…ˆå‡ºç°çš„<code>rejected</code>çŠ¶æ€å®ä¾‹çš„å€¼.</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>Promise.all</code>æ¥æ‰§è¡Œä¸€ç»„å¼‚æ­¥æ“ä½œ,è¿™äº›æ“ä½œçš„æ—¶é—´èŠ±è´¹å–å†³äºæœ€é•¿çš„é‚£ä¸ªå…ƒç´ ,å¹¶ä¸”æœ€ç»ˆå¦‚æœä¸€åˆ‡é¡ºåˆ©,åˆ™ç»“æœçš„é¡ºåºæ˜¯ä¸å˜çš„.</p>
<p><code>Promise.all()</code>æ–¹æ³•é€‚ç”¨äº<code>åˆå¹¶è¯·æ±‚</code>çš„åœºæ™¯,ä¾‹å¦‚æŸäº›é¡¹ç›®ä¸­,æäº¤çš„å¤šä¸ªæ•°æ®éœ€è¦è°ƒç”¨äº‘ç«¯æ¥å£è¿›è¡Œæ•°æ®æ ¡éªŒ,å½“æ‰€æœ‰æ•°æ®éƒ½é€šè¿‡æ ¡éªŒçš„æ—¶å€™æ‰èƒ½æ‰§è¡Œä¸‹ä¸€æ­¥æ“ä½œ,æ¥çœ‹çœ‹ä»£ç :</p>
<pre><code class="hljs language-js"><span class="lineNumber">1</span><span class="hljs-comment">// æœ‰ä¸€ä¸ªè¿”å› promise å¯¹è±¡çš„ asyncApi å‡½æ•°</span>
<span class="lineNumber">2</span><span class="hljs-comment">// æ¯ä¸€ä¸ª test å‡½æ•°éƒ½æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„æµ‹è¯•</span>
<span class="lineNumber">3</span><span class="hljs-keyword">const</span> test = <span class="hljs-function">(<span class="hljs-params">value</span>) =></span> asyncApi(value)
<span class="lineNumber">4</span><span class="hljs-built_in">Promise</span>.all([
<span class="lineNumber">5</span>  test(<span class="hljs-string">'xxx'</span>),
<span class="lineNumber">6</span>  test(<span class="hljs-string">'xx'</span>),
<span class="lineNumber">7</span>  test(<span class="hljs-string">'x'</span>)
<span class="lineNumber">8</span>]).then(<span class="hljs-function"><span class="hljs-params">results</span> =></span> {
<span class="lineNumber">9</span>  results.forEach(<span class="hljs-function"><span class="hljs-params">result</span> =></span> {
<span class="lineNumber">10</span>    <span class="hljs-comment">// balabala ä½ çš„ä»£ç é€»è¾‘</span>
<span class="lineNumber">11</span>    <span class="hljs-comment">// éƒ½é€šè¿‡äº†</span>
<span class="lineNumber">12</span>  })
<span class="lineNumber">13</span>  <span class="hljs-comment">// do more...</span>
<span class="lineNumber">14</span>}).catch(<span class="hljs-function"><span class="hljs-params">error</span> =></span> {
<span class="lineNumber">15</span>  <span class="hljs-comment">// å¤±è´¥çš„å€¼, balabala</span>
<span class="lineNumber">16</span>  <span class="hljs-built_in">console</span>.log(error)
<span class="lineNumber">17</span>})</code></pre> 

<h3>2.2.2 race</h3>
<p><code>Promise.race(iterable)</code>å¦‚å…¶å,ç±»ä¼¼äº<code>Promise.all()</code>,æ¥æ”¶åŒç±»å‹å‚æ•°,ä¸€æ—¦è¿­ä»£å™¨ä¸­æŸä¸ª<code>promise</code>çŠ¶æ€è½¬åŒ–ä¸º<code>settled</code>,ç«‹å³è¿”å›æ­¤<code>Promise</code>å®ä¾‹.</p>
<blockquote>
<p>ä¼ å…¥çš„è¿­ä»£ä¸ºç©ºçš„è¯,è¿”å›çš„<code>promise</code>å§‹ç»ˆ<code>pending</code>.</p>
</blockquote>
<p><code>Promise.race()</code>éå¸¸é€‚åˆåšå¼‚æ­¥è¯·æ±‚çš„<code>è¶…æ—¶</code>å¤„ç†.æ¥çœ‹ä¸€ä¸ªä¾‹å­:</p>
<pre><code class="hljs language-js"><span class="lineNumber">1</span><span class="hljs-comment">// asyncApi() è¿”å› promise</span>
<span class="lineNumber">2</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">timeout</span>(<span class="hljs-params">ms</span>) </span>{
<span class="lineNumber">3</span>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =></span> {
<span class="lineNumber">4</span>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =></span> {
<span class="lineNumber">5</span>      reject(<span class="hljs-string">`timeout: <span class="hljs-subst">${ms}</span> ms`</span>)
<span class="lineNumber">6</span>    }, ms)
<span class="lineNumber">7</span>  })
<span class="lineNumber">8</span>}
<span class="lineNumber">9</span> 
<span class="lineNumber">10</span><span class="hljs-built_in">Promise</span>.race([
<span class="lineNumber">11</span>  asyncApi(<span class="hljs-string">'xx'</span>),
<span class="lineNumber">12</span>  timeout(<span class="hljs-number">5000</span>)
<span class="lineNumber">13</span>]).then(<span class="hljs-function"><span class="hljs-params">res</span> =></span> {
<span class="lineNumber">14</span>  <span class="hljs-comment">// success</span>
<span class="lineNumber">15</span>}).catch(<span class="hljs-function"><span class="hljs-params">error</span> =></span> {
<span class="lineNumber">16</span>  <span class="hljs-comment">// timeout or error</span>
<span class="lineNumber">17</span>})</code></pre> 

<h3>2.2.3 any</h3>
<p><code>Promise.any(iterable)</code>æ˜¯<code>Promise.all()</code>çš„åé¢,å…¶è¯­æ³•æ— å¼‚.</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœä¼ å…¥çš„è¿­ä»£å™¨æ˜¯ç©ºçš„,åˆ™è¿”å›<code>rejected</code>çš„<code>promise </code>å®ä¾‹.åªè¦æœ‰ä¸€ä¸ªæˆåŠŸ,åˆ™è¿”å›æ­¤ç»“æœ.å¦‚æœè¿­ä»£å™¨å†…çš„<code>promise</code>å…¨éƒ¨è¿”å›<code>rejected</code>çŠ¶æ€,åˆ™æœ€ç»ˆè¿”å›<code>rejected</code>çš„<code>promise</code>å®ä¾‹.</p>
<p>å› æ­¤,æ­¤æ–¹æ³•é€‚ç”¨äºéªŒè¯å¤šä¸ªå¼‚æ­¥ç»“æœä¸­æ˜¯å¦æœ‰<code>fulfilled</code>çš„<code>promise</code>å®ä¾‹.</p>
<p>å¦‚æœæˆ‘ä»¬éœ€è¦å‘å¤šä¸ªæ•°æ®æºè·å–æŸä¸€ä¸ªæ•°æ®,åˆ™å¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•æœ€å¿«é€Ÿçš„è·å–åˆ°æ•°æ®,äº¦æˆ–è€…æ‰€æœ‰å¼‚æ­¥è¯·æ±‚éƒ½å¤±è´¥.</p>
<h3>2.2.4 allSettled</h3>
<p><code>Promise.allSettled(iterable)</code>æ–¹æ³•è¿”å›ä¸€ä¸ªåœ¨æ‰€æœ‰ç»™å®šçš„<code>promise</code>è½¬ä¸º<code>settled</code>çŠ¶æ€åçš„æ•°ç»„,æ•°ç»„å…ƒç´ æ˜¯æ¯ä¸€ä¸ª<code>promise</code>ç»“æœ.</p>
<p>å¦‚æœæˆ‘ä»¬æœ‰å¤šä¸ªäº’ä¸ä¾èµ–çš„<code>å¼‚æ­¥ä»»åŠ¡</code>,æˆ–è€…æˆ‘ä»¬æ€»æƒ³çŸ¥é“æ¯ä¸ª<code>promise</code>çš„ç»“æœ,è€Œä¸éœ€è¦å…¶ä¸­çš„<code>rejected</code>çŠ¶æ€<code>promise</code>å»å¼•å‘<code>catch</code>,æ¥çœ‹çœ‹<code>MDN</code>çš„ä¾‹å­:</p>
<pre><code class="hljs language-js"><span class="lineNumber">1</span><span class="hljs-keyword">const</span> promise1 = <span class="hljs-built_in">Promise</span>.resolve(<span class="hljs-number">3</span>);
<span class="lineNumber">2</span><span class="hljs-keyword">const</span> promise2 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =></span> <span class="hljs-built_in">setTimeout</span>(reject, <span class="hljs-number">100</span>, <span class="hljs-string">'foo'</span>));
<span class="lineNumber">3</span><span class="hljs-keyword">const</span> promises = [promise1, promise2];
<span class="lineNumber">4</span> 
<span class="lineNumber">5</span><span class="hljs-built_in">Promise</span>.allSettled(promises).
<span class="lineNumber">6</span>  then(<span class="hljs-function">(<span class="hljs-params">results</span>) =></span> results.forEach(<span class="hljs-function">(<span class="hljs-params">result</span>) =></span> <span class="hljs-built_in">console</span>.log(result)));</code></pre> 

<p>è¾“å‡ºæ˜¯:</p>
<pre><code class="hljs language-shell"><span class="lineNumber">1</span><span class="hljs-meta">></span><span class="bash"> Object { status: <span class="hljs-string">"fulfilled"</span>, value: 3 }</span>
<span class="lineNumber">2</span><span class="hljs-meta">></span><span class="bash"> Object { status: <span class="hljs-string">"rejected"</span>, reason: <span class="hljs-string">"foo"</span> }</span></code></pre> 

<p>å¦‚ä¸Šæ‰€ç¤º,çŠ¶æ€ä¸º<code>fulfilled</code>æ—¶,å…·æœ‰<code>value</code>,çŠ¶æ€ä¸º<code>rejected</code>æ—¶,å…·æœ‰<code>reason</code>.</p>
<p>è¿˜è®°å¾—æˆ‘ä»¬åœ¨<code>Promise.all()</code>ä¸­çš„è¿­ä»£å™¨è¿”å›çš„æ˜¯<code>promise.catch(err => err)</code>å—?å…¶å®,ä½¿ç”¨<code>Promise.allSettled()</code>ç›¸å¯¹æ›´å¥½.</p>
<h2>2.3 Promise çš„ä¼˜åŠ£</h2>
<p><code>Promise</code>çš„å‡ºç°ä¿ƒè¿›äº†<code>å¼‚æ­¥</code>ç¼–ç¨‹çš„å‘å±•,æˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨ç«¯å’Œ<code>node</code>ç«¯çœ‹åˆ°ç»Ÿä¸€çš„<code>Promise</code>ä»£ç .è¿˜è®°å¾—<code>callback</code>å›è°ƒå‡½æ•°çš„å‚æ•°çº¦å®šå—?</p>
<pre><code class="hljs language-js"><span class="lineNumber">1</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params">param, (err, data) => {
<span class="lineNumber">2</span>  <span class="hljs-keyword">if</span>(err) {
<span class="lineNumber">3</span>    <span class="hljs-regexp">//</span> balabala
<span class="lineNumber">4</span>  }
<span class="lineNumber">5</span>  <span class="hljs-regexp">//</span> balabala
<span class="lineNumber">6</span>}</span>)</span></code></pre> 

<p>è¿™ç§å‚æ•°çº¦å®šæ˜¯è„†å¼±çš„,å¼€å‘è€…å¯ä»¥ä¸æŒ‰æ­¤çº¦å®šç¼–å†™å›è°ƒå‡½æ•°,è¿™ç±»éšè—<code>bug</code>å¯èƒ½å°±æ­¤è€Œç”Ÿ.</p>
<p><code>Promise</code>çš„å‡ºç°,æˆ‘ä»¬å¿…é¡»ä½¿ç”¨å…¶å®ä¾‹æ–¹æ³•<code>then</code>å’Œ<code>catch</code>å»æŒ‰è§„èŒƒç¼–ç ,å¦åˆ™å°†ä¼šå‡ºé”™,å¼€å‘è€…ä¹Ÿå¯ä»¥çœ‹åˆ°æ˜æ˜¾çš„é”™è¯¯æç¤ºä¿¡æ¯.</p>
<p>æˆ‘ä»¬å†æ¥çœ‹çœ‹å¦‚ä¸‹ä¸¤ä¸ªä¾‹å­:</p>
<pre><code class="hljs language-js"><span class="lineNumber">1</span><span class="hljs-comment">// callback</span>
<span class="lineNumber">2</span>fs.readFile(name, opts?, <span class="hljs-function">(<span class="hljs-params">err, string|Buffer</span>) =></span> <span class="hljs-keyword">void</span>)
<span class="lineNumber">3</span><span class="hljs-comment">// Promise</span>
<span class="lineNumber">4</span>readFilePromisified(name, opts?): <span class="hljs-built_in">Promise</span>&#x3C;string | Buffer></code></pre> 

<p><code>Promise</code>æ–¹æ¡ˆè®©å‡½æ•°å‚æ•°å’Œå›è°ƒè§£è€¦å¼€æ¥,æ‰€æœ‰çš„å‚æ•°éƒ½ç”¨äºæ­¤å‡½æ•°çš„è¾“å…¥.</p>
<p><code>Promise</code>åœ¨å¤„ç†å•æ¬¡å¼‚æ­¥ä»»åŠ¡çš„æ—¶å€™è¡¨ç°è‰¯å¥½,ä½†æ˜¯å¯¹äºå¤šæ¬¡è§¦å‘çš„ä»»åŠ¡ä¾¿æ˜¾å¾—ä¹åŠ›,ä¹Ÿè®¸æˆ‘ä»¬éœ€è¦å­¦ä¹ ä¸€äº›<code>å“åº”å¼ç¼–ç¨‹</code>æŠ€æœ¯,ä»¥è§£å†³æ­¤ç±»é—®é¢˜.</p>
<p>å¯¹äº<code>ES6 Promise</code>æ¥è¯´,ç¼ºä¹ä¸¤é¡¹å¾ˆå®ç”¨çš„åŠŸèƒ½:</p>
<ul>
<li>å–æ¶ˆä»»åŠ¡(åœ¨ç»„ä»¶è¢«åˆ é™¤åå–æ¶ˆå¼‚æ­¥ä»»åŠ¡ç­‰)ï¼ŒTC39 å§”å‘˜ä¼šå®é™…ä¸Šå‡†å¤‡å¢åŠ æ­¤ç‰¹æ€§ï¼Œä½†æœ€ç»ˆææ¡ˆè¢«æ’¤å›äº†ï¼Œä½†æ˜¯æ²¡å…³ç³»ï¼Œ<code>Bluebird</code>å®ç°äº†æ­¤åŠŸèƒ½ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹æ­¤ç‰¹æ€§è¿›è¡Œè¡¥å……ï¼Œä¾‹å¦‚åˆ©ç”¨<code>setTimeout</code>å®šæ—¶å™¨å‡½æ•°å¯ä»¥è¢«å–æ¶ˆçš„ç‰¹æ€§ï¼Œç¼–å†™ä¸€äº›é€»è¾‘ä»£ç å’Œ<code>Promise</code>å–æ¶ˆçŠ¶æ€è½¬æ¢çš„åŠŸèƒ½å‡½æ•°ã€‚</li>
<li>è¿›åº¦è¿½è¸ª(æ˜¾ç¤ºè¿›åº¦æ¡ç­‰)ï¼ŒåŸç”Ÿä¸æ”¯æŒæ­¤ç‰¹æ€§çš„åŸå› æ˜¯æ‹…å¿ƒæ­¤ç‰¹æ€§ä¼šå¯¼è‡´<code>Promise</code>çš„é“¾å¼è°ƒç”¨å’Œç±»ä¼¼<code>all</code>é™æ€æ–¹æ³•çš„å¤æ‚åº¦å¢åŠ ã€‚</li>
</ul>
<p>åŸç”Ÿ<code>Promise</code>æš‚æœªæ”¯æŒä¸Šè¿°ä¸¤é¡¹ç‰¹æ€§,ä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥çœ‹çœ‹ç±»ä¼¼<code>Bluebird</code>è¿™æ ·çš„ç¬¬ä¸‰æ–¹åº“ï¼Œå®ƒä»¬åŠŸèƒ½å¼ºå¤§å¹¶ä¸”è¢«å¹¿æ³›ä½¿ç”¨ï¼Œå€¼å¾—ä¿¡èµ–ã€‚</p>
<h1>3. async / await</h1>
<p>æåŠå¼‚æ­¥å‡½æ•°ï¼Œ<code>async/await</code>è¯­æ³•å…³é”®å­—ä¸€å®šæ˜¯ç»•ä¸å¼€çš„çŸ¥è¯†ç‚¹ï¼Œè¿™æ˜¯ä¸€ç§ä½¿ç”¨ <code>Promise</code>çš„ç‰¹æ®Šè¯­æ³•ï¼Œå¹¶ä¸”éå¸¸å®¹æ˜“ç†è§£å’Œä½¿ç”¨ã€‚</p>
<p>æˆ‘ä»¬ç›´æ¥çœ‹ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-js"><span class="lineNumber">1</span><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params"></span>) </span>{
<span class="lineNumber">2</span>  <span class="hljs-comment">// balabala</span>
<span class="lineNumber">3</span>  <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
<span class="lineNumber">4</span>}</code></pre> 

<blockquote>
<p>å¯ä»¥ç†è§£ä¸º async å‡½æ•°æœ€åæ˜¾å¼è¿”å›çš„å€¼ç»è¿‡ Promise.resolve å‡½æ•°çš„è½¬åŒ–ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ Promise å®ä¾‹</p>
</blockquote>
<p>åœ¨å‡½æ•°å‰æ·»åŠ <code>async</code>æ ‡è¯†æ­¤å‡½æ•°æ€»æ˜¯è¿”å›ä¸€ä¸ª<code>Promise</code>å®ä¾‹,å³ä½¿æˆ‘ä»¬æ˜¾ç¤ºæŒ‡å®šå…¶ä»–çš„ç±»å‹å€¼çš„è¿”å›å€¼ï¼Œä¹Ÿä¼šè¢«åŒ…è£…æˆä¸€ä¸ª<code>Promise</code>å¹¶è¿”å›ï¼Œå½“ç„¶ï¼Œä¾ç„¶æ¨èæ˜¾ç¤ºåœ°æŒ‡å®šè¿”å›<code>Promise</code>ã€‚</p>
<p>ä½¿ç”¨<code>async</code>å…³é”®å­—å¯ä»¥è®©å‡½æ•°å…·æœ‰<code>å¼‚æ­¥</code>ç‰¹å¾ï¼Œä½†æ€»ä½“ä¸Šä»£ç ä¾ç„¶æ˜¯<code>åŒæ­¥</code>æ±‚å€¼çš„ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<pre><code class="hljs language-js"><span class="lineNumber">1</span><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params"></span>) </span>{
<span class="lineNumber">2</span>  <span class="hljs-built_in">console</span>.log(<span class="hljs-number">1</span>)
<span class="lineNumber">3</span>}
<span class="lineNumber">4</span>foo()
<span class="lineNumber">5</span><span class="hljs-built_in">console</span>.log(<span class="hljs-number">2</span>)
<span class="lineNumber">6</span><span class="hljs-comment">// output</span>
<span class="lineNumber">7</span><span class="hljs-number">1</span>
<span class="lineNumber">8</span><span class="hljs-number">2</span></code></pre> 

<blockquote>
<p>å¼‚æ­¥å‡½æ•°å…·æœ‰æš‚åœå’Œæ¢å¤æ‰§è¡Œçš„åŠŸèƒ½æ˜¯ååˆ†å¿…è¦çš„ã€‚</p>
</blockquote>
<p>ä½¿ç”¨<code>await</code>å…³é”®å­—å¯ä»¥æš‚åœå¼‚æ­¥å‡½æ•°çš„æ‰§è¡Œå¹¶ä¸”ç­‰å¾…è¿”å›çš„<code>Promise</code>å®ä¾‹è¿›å…¥<code>settled</code>çŠ¶æ€ã€‚</p>
<p>å…³é”®è¯<code>await</code>åªåœ¨<code>async</code>å‡½æ•°å†…æœ‰æ•ˆï¼š</p>
<pre><code class="hljs language-js"><span class="lineNumber">1</span><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params"></span>) </span>{
<span class="lineNumber">2</span>  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> axios.get(<span class="hljs-string">'your url'</span>)
<span class="lineNumber">3</span>}</code></pre> 

<p>åœ¨æ—¥å¸¸å·¥ä½œä¸­æ— è®ºæ˜¯æµè§ˆå™¨è¿˜æ˜¯<code>Nodejs</code>ï¼Œéƒ½å¯ä»¥çœ‹åˆ°<code>await</code>çš„èº«å½±ã€‚</p>
<p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬æ›´æ¨èä½¿ç”¨<code>async/await</code>è¯­æ³•ï¼Œå®ƒåˆæœ‰æ€æ ·çš„ç»†èŠ‚éœ€è¦æˆ‘ä»¬å…³æ³¨çš„å‘¢ï¼Ÿ</p>
<p>æ¥çœ‹ä»¥ä¸‹å‡ ç‚¹ç‰¹æ€§ï¼š</p>
<ul>
<li>é¡¶å±‚<code>await</code>ï¼šæ­¤ææ¡ˆå½“å‰ä¾ç„¶æ˜¯ <code>stage 3</code>ï¼Œåœ¨æ­£å¼è¿›å…¥ç¨³å®šç‰ˆä¹‹å‰ï¼Œé¡¶å±‚å¯¹äº<code>await</code>çš„ä½¿ç”¨ä¾ç„¶éœ€è¦ç«‹å³æ‰§è¡Œè¡¨è¾¾å¼ï¼ˆIIFEï¼‰ï¼Œä¸å¹¸çš„æ˜¯ï¼Œè¿™ç§æ¨¡å¼å¯¼è‡´å›¾å½¢æ‰§è¡Œå’Œåº”ç”¨ç¨‹åºçš„é™æ€å¯åˆ†ææ€§çš„ç¡®å®šæ€§é™ä½ã€‚ç”±äºè¿™äº›åŸå› ï¼Œç¼ºå°‘é¡¶å±‚ <code>await</code> è¢«è®¤ä¸ºæ¯”è¯¥åŠŸèƒ½å¸¦æ¥çš„å±å®³æœ‰æ›´é«˜çš„é£é™©ã€‚</li>
<li>é¡¶å±‚ <code>await</code> ä»…é™äº ES æ¨¡å—ã€‚æ˜ç¡®ä¸æ”¯æŒ<code>CommonJS</code>æ¨¡å—ã€‚</li>
<li><code>await</code>æ”¯æŒ<code>thenable</code>å¯¹è±¡,å¦‚æœå…¶åæ˜¯ä¸€ä¸ª<code>thenable</code>å¯¹è±¡ï¼Œåˆ™ä¼šæ‰§è¡Œæ­¤å¯¹è±¡çš„<code>then</code>æ–¹æ³•ï¼Œå¹¶ä¸”ä¼ å…¥<code>resolve</code>å’Œ<code>reject</code>å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ª<code>settled</code>çš„<code>Promise</code>å®ä¾‹ã€‚</li>
<li><code>await</code>å’Œ<code>Promise.all</code>ç­‰é™æ€æ–¹æ³•é…åˆè‰¯å¥½ã€‚</li>
</ul>
<pre><code class="hljs language-js"><span class="lineNumber">1</span><span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.all([
<span class="lineNumber">2</span>  promise1,
<span class="lineNumber">3</span>  promise2,
<span class="lineNumber">4</span>  ...
<span class="lineNumber">5</span>])</code></pre> 

<ul>
<li>Error å¤„ç†</li>
</ul>
<blockquote>
<p><code>async/await</code>é…åˆ<code>try...catch..</code>å¯ä»¥æ›´æ¸…æ™°åœ°åŒæ—¶å¤„ç†åŒæ­¥å’Œå¼‚æ­¥çš„å¼‚å¸¸</p>
</blockquote>
<p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<pre><code class="hljs language-js"><span class="lineNumber">1</span><span class="hljs-keyword">const</span> makeRequest = <span class="hljs-keyword">async</span> () => {
<span class="lineNumber">2</span>  <span class="hljs-keyword">try</span> {
<span class="lineNumber">3</span>    <span class="hljs-keyword">const</span> data = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-keyword">await</span> getJSON())
<span class="lineNumber">4</span>    <span class="hljs-built_in">console</span>.log(data)
<span class="lineNumber">5</span>  } <span class="hljs-keyword">catch</span> (e) {
<span class="lineNumber">6</span>    <span class="hljs-built_in">console</span>.log(e)
<span class="lineNumber">7</span>  }
<span class="lineNumber">8</span>}</code></pre> 

<p>æ— è®ºæ˜¯å¼‚æ­¥å‡½æ•°<code>getJSON()</code>è¿˜æ˜¯åŒæ­¥å‡½æ•°<code>JSON.parse()</code>éƒ½èƒ½è¢«åŒä¸€ä¸ª<code>try...catch...</code>ç»“æ„å¯¹å¼‚å¸¸è¿›è¡Œå¤„ç†ï¼Œä»£ç é€»è¾‘ç›¸å¯¹ä½¿ç”¨<code>Promise.then / catch</code>çš„æ–¹å¼æ¥è¯´ä¼šæ›´æ¸…æ™°ï¼Œå¯è¯»æ€§æ›´å¼ºã€‚</p>
<p>ä¹Ÿè®¸å¯è¯»æ€§çš„è¯„åˆ¤æ›´å®¹æ˜“æºæ‚ä¸»è§‚æ„è¯†ï¼Œä½†æ˜¯å¯¹äºå¼‚æ­¥<code>Debug</code>ä»£ç æ¥è¯´ï¼Œ<code>async/await</code>æ˜¾ç„¶æ›´è½»æ¾ã€‚</p>
<p>ä¸ºä»€ä¹ˆï¼Ÿæˆ‘æƒ³æœ‰ä»¥ä¸‹ä¸¤ç‚¹ç†ç”±ï¼š</p>
<ul>
<li>åœ¨<code>then</code>ä¸­éš¾ä»¥å¯¹ç®­å¤´å‡½æ•°ä¸‹æ–­ç‚¹</li>
<li>å³ä½¿æ˜¯åœ¨ <code>then</code>ä¸­ä¸‹äº†æ–­ç‚¹ï¼Œç±»ä¼¼å•æ­¥æ­¥å…¥çš„æ“ä½œä¹Ÿä¸ä¼šå¾—åˆ°é¢„æœŸçš„ç»“æœï¼ŒåŸå› åœ¨äºè¿™ç§è°ƒè¯•æ–¹å¼åªèƒ½åœ¨åŒæ­¥ä»£ç ä¸­ä½¿ç”¨ã€‚</li>
</ul>
<p>æˆ‘ä»¬æ¥çœ‹ä¸¤ä¸ªç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-js"><span class="lineNumber">1</span><span class="hljs-keyword">const</span> makeRequest = <span class="hljs-function">() =></span> {
<span class="lineNumber">2</span>   <span class="hljs-keyword">return</span> callAPromise()
<span class="lineNumber">3</span>     .then(<span class="hljs-function">() =></span> callAPromise())
<span class="lineNumber">4</span>     .then(<span class="hljs-function">() =></span> callAPromise())
<span class="lineNumber">5</span>}
<span class="lineNumber">6</span><span class="hljs-comment">// async / await</span>
<span class="lineNumber">7</span><span class="hljs-keyword">const</span> makeRequest = <span class="hljs-keyword">async</span>() => {
<span class="lineNumber">8</span>   <span class="hljs-keyword">await</span> callAPromise()
<span class="lineNumber">9</span>   <span class="hljs-keyword">await</span> callAPromise()
<span class="lineNumber">10</span>}</code></pre> 

<p>åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­ç”±äº<code>await</code>çš„ç‰¹æ®Šæ€§ï¼Œæˆ‘ä»¬å¯ä»¥åƒè°ƒè¯•åŒæ­¥ä»£ç è¿™ä¹ˆæ–¹ä¾¿è‡ªç„¶ã€‚</p>
<blockquote>
<p>å¦å¤–ï¼Œä½¿ç”¨<code>async / await</code>è¯­æ³•ï¼Œæˆ‘ä»¬åº”è¯¥ç•™å¿ƒå¼‚æ­¥ä»£ç çš„å¹³è¡ŒåŠ é€Ÿé—®é¢˜ã€‚</p>
</blockquote>
<p>æ¥çœ‹ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-js"><span class="lineNumber">1</span><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">delay</span>(<span class="hljs-params">id</span>) </span>{
<span class="lineNumber">2</span>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =></span> {
<span class="lineNumber">3</span>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =></span> {
<span class="lineNumber">4</span>      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`task <span class="hljs-subst">${id}</span> finished.`</span>)
<span class="lineNumber">5</span>    }, <span class="hljs-number">1000</span>)
<span class="lineNumber">6</span>  })
<span class="lineNumber">7</span>}
<span class="lineNumber">8</span><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">demo1</span>(<span class="hljs-params"></span>) </span>{
<span class="lineNumber">9</span>  <span class="hljs-keyword">await</span> delay(<span class="hljs-number">1</span>)
<span class="lineNumber">10</span>  <span class="hljs-keyword">await</span> delay(<span class="hljs-number">2</span>)
<span class="lineNumber">11</span>  <span class="hljs-keyword">await</span> delay(<span class="hljs-number">3</span>)
<span class="lineNumber">12</span>}
<span class="lineNumber">13</span>demo1()
<span class="lineNumber">14</span><span class="hljs-comment">// å¦ä¸€ä¸ª demo</span>
<span class="lineNumber">15</span><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">demo2</span>(<span class="hljs-params"></span>) </span>{
<span class="lineNumber">16</span>  <span class="hljs-keyword">const</span> p1 = delay(<span class="hljs-number">1</span>)
<span class="lineNumber">17</span>  <span class="hljs-keyword">const</span> p2 = delay(<span class="hljs-number">2</span>)
<span class="lineNumber">18</span>  <span class="hljs-keyword">const</span> p3 = delay(<span class="hljs-number">3</span>)
<span class="lineNumber">19</span>  <span class="hljs-keyword">await</span> p1
<span class="lineNumber">20</span>  <span class="hljs-keyword">await</span> p2
<span class="lineNumber">21</span>  <span class="hljs-keyword">await</span> p3
<span class="lineNumber">22</span>}</code></pre> 

<p>å¯¹äºæ²¡æœ‰å¼‚æ­¥æ‰§è¡Œé¡ºåºéœ€æ±‚çš„<code>async/await</code>è¯­æ³•æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€æ¬¡æ€§åˆå§‹åŒ–å…¶å¼‚æ­¥ä»»åŠ¡ï¼Œç„¶åå†åˆ†åˆ«ç­‰å¾…å…¶ç»“æœå³å¯ã€‚</p>
<blockquote>
<p>åœ¨é‡è§†<code>æ€§èƒ½</code>çš„åº”ç”¨ä¸­ï¼Œä½¿ç”¨<code>async/await</code>è¯­æ³•å¯ä»¥å‡å°‘å†…å­˜çš„å ç”¨ã€‚</p>
</blockquote>
<p>åœ¨ä½¿ç”¨<code>new Promise</code>åˆå§‹åŒ–æ—¶ï¼Œæˆ‘ä»¬åˆ›å»º<code>Promise</code>å®ä¾‹çš„å‡½æ•°å³ä½¿æ˜¯åœ¨å¤„ç†ç¨‹åºè½¬æ¢<code>Promise</code>å®ä¾‹çš„çŠ¶æ€æ—¶ä¾ç„¶è¢«ä¿å­˜åœ¨æ ˆè¿½è¸ªä¿¡æ¯å†…ï¼Œç„¶è€Œæˆ‘ä»¬çŸ¥é“è¿™äº›ä¿¡æ¯éšç€åˆå§‹åŒ–å‡½æ•°çš„è¿”å›å…¶å®å·²ç»æ²¡æœ‰å¿…è¦å­˜åœ¨äº†ï¼Œä½†æ˜¯<code>Javascript</code>å¼•æ“ä¼šåœ¨åˆ›å»º<code>Promise</code>æ—¶å°½å¯èƒ½ä¿å­˜å®Œæ•´çš„è°ƒç”¨æ ˆï¼Œåœ¨æŠ›å‡ºé”™è¯¯æ—¶è°ƒç”¨æ ˆå¯ä»¥ç”±è¿è¡Œæ—¶çš„é”™è¯¯å¤„ç†é€»è¾‘è·å–ï¼Œæ•…æˆ‘ä»¬èƒ½åœ¨æ ˆè¿½è¸ªä¿¡æ¯ä¸­çœ‹åˆ°å®ƒä»¬ï¼Œæœ€ç»ˆå ç”¨ä¸€äº›å†…å­˜ï¼Œå¢åŠ äº†è®¡ç®—å’Œå­˜å‚¨æˆæœ¬ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨<code>async/await</code>è¯­æ³•ï¼š</p>
<pre><code class="hljs language-js"><span class="lineNumber">1</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fooPromiseExecutor</span>(<span class="hljs-params">resolve, reject</span>) </span>{
<span class="lineNumber">2</span>  <span class="hljs-built_in">setTimeout</span>(reject, <span class="hljs-number">1000</span>, <span class="hljs-string">'bar'</span>)
<span class="lineNumber">3</span>}
<span class="lineNumber">4</span> 
<span class="lineNumber">5</span><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span>(<span class="hljs-params"></span>) </span>{
<span class="lineNumber">6</span>  <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(fooPromiseExecutor)
<span class="lineNumber">7</span>}
<span class="lineNumber">8</span>foo()
<span class="lineNumber">9</span><span class="hljs-comment">/// Uncaught (in promise) bar</span>
<span class="lineNumber">10</span><span class="hljs-comment">// foo</span>
<span class="lineNumber">11</span><span class="hljs-comment">// async function (async)</span>
<span class="lineNumber">12</span><span class="hljs-comment">// foo</span></code></pre> 

<p>ç”±äº<code>fooPromiseExecutor</code>å·²ç»è¿”å›ï¼Œæ•…ä¸åœ¨é”™è¯¯ä¿¡æ¯ä¸­äº†ã€‚</p>
<p><code>Javascript</code>è¿è¡Œæ—¶å¯ä»¥ç®€å•åœ°åœ¨åµŒå¥—å‡½æ•°ä¸­å­˜å‚¨æŒ‡å‘åŒ…å«å‡½æ•°çš„æŒ‡é’ˆï¼Œå°±å¦‚åŒå¯¹å¾…åŒæ­¥å‡½æ•°ä¸€æ ·ï¼ŒæŒ‡é’ˆæ—¶æœºå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œç”¨äºåœ¨å‡ºé”™çš„æ—¶å€™ç”Ÿæˆé”™è¯¯ä¿¡æ¯ï¼Œå¦‚æ­¤ä¸€æ¥ä¾¿çœå»äº†è¿™â€œå¾®å°â€çš„æ¶ˆè€—ã€‚</p>
<p>æœ€åæˆ‘æƒ³è¯´ï¼Œç›¸å¯¹äºä½¿ç”¨<code>Promise</code>çš„å®ä¾‹æ–¹æ³•æ¥ç¼–å†™å¼‚æ­¥ä»£ç ï¼Œä½¿ç”¨<code>async/await</code>çš„è¯­æ³•ï¼Œæ˜¾ç„¶ä»£ç é‡å°†ä¼šå‡å°‘ğŸ¶ï¼Œä½•ä¹è€Œä¸ä¸ºï¼Ÿ</p>
<h1>4. Promisify</h1>
<p><code>Promise</code>å¾ˆæ£’ï¼Œä½†æ˜¯éµå¾ªå¸¸è§çš„é”™è¯¯ä¼˜å…ˆçš„å›è°ƒé£æ ¼çš„å‡½æ•°ä¾ç„¶å¯ä»¥åœ¨è®¸å¤šåœºæ™¯ä¸‹æ´»è·ƒç€ï¼Œæ— è®ºæ˜¯å…¶å¼€å‘è€…åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™è¿˜æœªå‡ºç°<code>Promise</code>ï¼Œäº¦æˆ–æ˜¯å¼€å‘è€…æ›´å–œæ¬¢å›è°ƒé£æ ¼çš„èŒƒå¼ï¼Œè·Ÿè¿™äº›å›è°ƒé£æ ¼çš„å‡½æ•°æ‰“äº¤é“ä¼¼ä¹æ— å¯é¿å…ã€‚</p>
<blockquote>
<p>Nodejs å®˜æ–¹æä¾›äº† util.promisify å·¥å…·å‡½æ•°ç”¨äºå°†ä¼ ç»Ÿå›è°ƒé£æ ¼çš„å‡½æ•°è½¬æ¢ä¸ºè¿”å›<code>Promise</code>çš„å‡½æ•°ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ªå°†<code>callback</code>é£æ ¼çš„å‡½æ•°è½¬æ¢ä¸º<code>Promise</code>é£æ ¼çš„å‡½æ•°çš„å·¥å…·å‡½æ•°ã€‚</p>
<pre><code class="hljs language-js"><span class="lineNumber">1</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">promisify</span>(<span class="hljs-params">f, multiArgs = <span class="hljs-literal">false</span></span>)</span>{
<span class="lineNumber">2</span>  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) </span>{
<span class="lineNumber">3</span>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =></span> {
<span class="lineNumber">4</span>      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">callback</span>(<span class="hljs-params">err, ...results</span>) </span>{
<span class="lineNumber">5</span>        err ? reject(err) : resolve(multiArgs ? results : results[<span class="hljs-number">0</span>])
<span class="lineNumber">6</span>      }
<span class="lineNumber">7</span>      args.push(callback)
<span class="lineNumber">8</span>      f.call(<span class="hljs-built_in">this</span>, ...args)
<span class="lineNumber">9</span>    })
<span class="lineNumber">10</span>  }
<span class="lineNumber">11</span>}
<span class="lineNumber">12</span> 
<span class="lineNumber">13</span><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>)
<span class="lineNumber">14</span><span class="hljs-keyword">const</span> fsPromise = promisify(fs.readdir)
<span class="lineNumber">15</span>fsPromise(<span class="hljs-string">'.'</span>).then(<span class="hljs-function"><span class="hljs-params">r</span> =></span> {
<span class="lineNumber">16</span>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'resolve'</span>, r);
<span class="lineNumber">17</span>}).catch(<span class="hljs-function"><span class="hljs-params">r</span> =></span> {
<span class="lineNumber">18</span>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'reject'</span>, r);
<span class="lineNumber">19</span>})
<span class="lineNumber">20</span><span class="hljs-comment">// output</span>
<span class="lineNumber">21</span>resolve [
<span class="lineNumber">22</span>  <span class="hljs-string">'index.js'</span>
<span class="lineNumber">23</span>]</code></pre> 

<p>åœ¨è¿™ä¸ªè½¬æ¢è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†åŸæ¥çš„å‡½æ•°åŒ…è£¹è¿›å»ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªå¯æ‰§è¡Œçš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¥æ”¶çš„å‚æ•°è·ŸåŸæ¥çš„<code>å›è°ƒé£æ ¼</code>å‡½æ•°ä¸€è‡´ï¼Œåªæ˜¯å°†ä¹‹è½¬æ¢ä¸º<code>Promise</code>é£æ ¼çš„å‡½æ•°åï¼Œä¼ å‚å¯ä»¥çœç•¥<code>å›è°ƒå‡½æ•°</code>ï¼Œæˆ‘ä»¬åœ¨å†…éƒ¨æ„å»ºäº†ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå¹¶ä¸”å°†ä¹‹ä½œä¸ºåŸå‡½æ•°çš„å›è°ƒéƒ¨åˆ†ä½œä¸ºå‚æ•°ä¼ ç»™äº†è¿”å›å‡½æ•°ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä¼ ç»Ÿå›è°ƒé£æ ¼çš„å‡½æ•°è½¬åŒ–ä¸ºè¿”å›<code>Promise</code>çš„å‡½æ•°äº†ï¼Œæˆ‘ä»¬å¯ä»¥æ”¾å¿ƒä½¿ç”¨<code>Promise</code>çš„æ–°ç‰¹æ€§äº†ã€‚</p>
<h1>å‚è€ƒ</h1>
<ul>
<li><a href="chrome-extension://bocbaocobfecmglnmeaeppambideimao/pdf/viewer.html?file=file%3A%2F%2F%2FUsers%2Fyi%2FDesktop%2Fexploring-es6.pdf">Exploring ES6 - exploring-es6.pdf</a></li>
<li><a href="https://stackoverflow.com/questions/2069763/difference-between-event-handlers-and-callbacks">architecture - Difference between event handlers and callbacks - Stack Overflow</a></li>
<li><a href="https://stackoverflow.com/questions/6348494/addeventlistener-vs-onclick">javascript - addEventListener vs onclick - Stack Overflow</a></li>
<li><a href="http://bluebirdjs.com/docs/getting-started.html">Getting Started | bluebird</a></li>
<li>JavaScript é«˜çº§ç¨‹åºè®¾è®¡</li>
<li><a href="https://zh.javascript.info/">ç°ä»£ JavaScript æ•™ç¨‹</a></li>
<li><a href="https://www.geeksforgeeks.org/javascript-promise-resolve-method/">JavaScript | promise resolve() Method - GeeksforGeeks</a></li>
<li><a href="https://itnext.io/error-handling-with-async-await-in-js-26c3f20bc06a">Error handling with Async/Await in JS | by Ian Segers | ITNEXT</a></li>
<li><a href="https://nodejs.dev/learn/understanding-javascript-promises">Understanding JavaScript Promises</a></li>
<li><a href="http://nodejs.cn/api/util/util_promisify_original.html">util.promisify(original) | Node.js API æ–‡æ¡£</a></li>
</ul>
</div></div></div></main><style data-emotion-css="1fic0ux">.css-1fic0ux{border:0;opacity:0.6;border-bottom:0.0625rem solid;width:auto;margin-top:0.5rem;margin-bottom:0.5rem;border-color:inherit;}</style><hr class="css-1fic0ux"/><style data-emotion-css="11i96b0">.css-11i96b0{margin:2rem;text-align:center;}</style><div class="css-11i96b0"><p id="msg">è°¢è°¢ä½ èƒ½çœ‹åˆ°è¿™é‡Œ!<span role="img" aria-label="emoji">ğŸ¤—</span>Â å¦‚æœä½ æœ‰ä»»ä½•æƒ³ä¸æˆ‘è®¨è®ºçš„å†…å®¹,è¯·ç»™æˆ‘å‘é‚®ä»¶.<span role="img" aria-label="emoji">ğŸ•Š</span></p><br/><a style="text-decoration:none" href="mailto:rivenqinyy@gmail.com"><style data-emotion-css="meafa5">.css-meafa5{display:inline-block;padding-left:0.25rem;padding-right:0.25rem;text-transform:uppercase;font-size:0.75rem;border-radius:0.125rem;font-weight:700;white-space:nowrap;vertical-align:middle;background-color:#c6f6d5;color:#22543d;}</style><div class="css-meafa5">æˆ‘çš„é‚®ä»¶</div><span role="img" aria-label="my email">ğŸ“®</span></a><br/><br/><style data-emotion-css="1fb5c92">.css-1fb5c92{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";color:#4A5568;font-size:.7rem;}</style><p class="css-1fb5c92">å¦™æ‰ Â© 2020. All rights reserved.</p></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"Javascript,I-promise","contentHtml":"\u003cp\u003eå¤§å®¶å¥½ï¼Œä»Šå¤©æˆ‘ä»¬è¦åˆ†äº«çš„çŸ¥è¯†ç‚¹æ˜¯\u003ccode\u003ePromise\u003c/code\u003eä¸å¼‚æ­¥ç¼–ç¨‹ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ePromise\u003c/code\u003eæ˜¯å¯¹å°šä¸å­˜åœ¨ç»“æœçš„å¯¹è±¡çš„ä¸€ä¸ªæ›¿èº«ï¼Œä¹Ÿè®¸ä½ æ›¾çœ‹åˆ°ç±»ä¼¼çš„æœ¯è¯­ï¼Œä¾‹å¦‚\u003ccode\u003efuture\u003c/code\u003e/\u003ccode\u003edelay\u003c/code\u003e/\u003ccode\u003edeferred\u003c/code\u003eç­‰ï¼Œå®é™…ä¸Šè¿™äº›æœ¯è¯­æè¿°çš„æ˜¯ä¸€ä¸ªç›¸åŒçš„æ¦‚å¿µï¼Œéƒ½æ˜¯ä¸€ç§å¼‚æ­¥ç¨‹åºæ‰§è¡Œçš„æœºåˆ¶ã€‚\u003c/p\u003e\n\u003cp\u003eæ¥ä¸‹æ¥æˆ‘ä»¬åˆ†äº«çš„çŸ¥è¯†å°†æ¶‰åŠä»¥ä¸‹å†…å®¹ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå‡½æ•°å›è°ƒ\u003c/li\u003e\n\u003cli\u003ePromise æµ…æ\u003c/li\u003e\n\u003cli\u003eAsync / await\u003c/li\u003e\n\u003cli\u003ePromisify\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1\u003e1. å›è°ƒ\u003c/h1\u003e\n\u003cp\u003eJavaScript è¯­è¨€ä¸ºäº†è®©éƒ¨åˆ†ä»»åŠ¡æŒ‰å¼‚æ­¥çš„æ–¹å¼è¿›è¡Œï¼Œæä¾›äº†ç¼–å†™\u003ccode\u003eå›è°ƒå‡½æ•°\u003c/code\u003eçš„æ–¹æ³•ï¼Œè®©æŸäº›ä»»åŠ¡åœ¨è¾¾æˆä¸€äº›æ¡ä»¶ä¹‹åå†æ‰§è¡Œå¼€å‘è€…æŒ‡å®šçš„\u003ccode\u003eå›è°ƒå‡½æ•°\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cp\u003eä¸¾ä¸¤ä¸ªä¾‹å­:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"lineNumber\"\u003e1\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e callbackFn = \u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e2\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e// balabala\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e3\u003c/span\u003e}\n\u003cspan class=\"lineNumber\"\u003e4\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e// browser\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e5\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003esetTimeout\u003c/span\u003e(callbackFn, \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e)\n\u003cspan class=\"lineNumber\"\u003e6\u003c/span\u003e \n\u003cspan class=\"lineNumber\"\u003e7\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e// nodejs\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e8\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e fs = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'fs'\u003c/span\u003e)\n\u003cspan class=\"lineNumber\"\u003e9\u003c/span\u003efs.readFile(\u003cspan class=\"hljs-string\"\u003e'filename'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eerr, data\u003c/span\u003e) =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e10\u003c/span\u003e  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(err) \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e err;\n\u003cspan class=\"lineNumber\"\u003e11\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e// balabala\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e12\u003c/span\u003e})\n\u003cspan class=\"lineNumber\"\u003e13\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e// more\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e14\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\u003c/code\u003e\u003c/pre\u003e \n\n\u003cp\u003eå¦‚ä¸Šæ‰€ç¤ºï¼Œè¦ä¹ˆå»¶è¿Ÿæ‰§è¡Œå›è°ƒï¼Œè¦ä¹ˆè¯»å–æ–‡ä»¶åæ‰§è¡Œå›è°ƒï¼ŒäºŒè€…éƒ½ä¸ä¼šç«‹å³æ‰§è¡Œä»è€Œé˜»å¡ä¸»çº¿ç¨‹ï¼Œè€Œæ˜¯å„è‡ªå…·æœ‰è‡ªå·±çš„æ‰§è¡Œæ¡ä»¶ï¼Œæ»¡è¶³æ¡ä»¶åæ”¾å…¥ä»»åŠ¡å¾ªç¯é˜Ÿåˆ—ä¸­ç­‰å¾…ä¸»çº¿ç¨‹ç©ºé—²æ‰å¾—ä»¥å–å‡ºå¹¶æ‰§è¡Œã€‚\u003c/p\u003e\n\u003cp\u003eä¸Šè¿°å›è°ƒå‡½æ•°åœ¨æŸäº›åœºæ™¯ä¸‹æ›¾è®©å¼€å‘è€…å†™å‡ºå¦‚ä¸‹ç±»å‹çš„ä»£ç ï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"lineNumber\"\u003e1\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e2\u003c/span\u003efs.readFile(\u003cspan class=\"hljs-string\"\u003e'file1.txt'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eerr, data\u003c/span\u003e)\u003c/span\u003e{\n\u003cspan class=\"lineNumber\"\u003e3\u003c/span\u003e  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(err) \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e err;\n\u003cspan class=\"lineNumber\"\u003e4\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e// ...ä¸€äº›æ“ä½œ\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e5\u003c/span\u003e  fs.readFile(\u003cspan class=\"hljs-string\"\u003e'file2.txt'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eerr, data\u003c/span\u003e) \u003c/span\u003e{\n\u003cspan class=\"lineNumber\"\u003e6\u003c/span\u003e    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(err) \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e err;\n\u003cspan class=\"lineNumber\"\u003e7\u003c/span\u003e    \u003cspan class=\"hljs-comment\"\u003e// ...ä¸€äº›æ“ä½œ\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e8\u003c/span\u003e    fs.readFile(\u003cspan class=\"hljs-string\"\u003e'file3.txt'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eerr, data\u003c/span\u003e) \u003c/span\u003e{\n\u003cspan class=\"lineNumber\"\u003e9\u003c/span\u003e      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(err) \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e err;\n\u003cspan class=\"lineNumber\"\u003e10\u003c/span\u003e      \u003cspan class=\"hljs-comment\"\u003e// ...ä¸€äº›æ“ä½œ\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e11\u003c/span\u003e      fs.readFile(\u003cspan class=\"hljs-string\"\u003e'file4.txt'\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eerr, data\u003c/span\u003e) \u003c/span\u003e{\n\u003cspan class=\"lineNumber\"\u003e12\u003c/span\u003e        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(err) \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e err;\n\u003cspan class=\"lineNumber\"\u003e13\u003c/span\u003e        \u003cspan class=\"hljs-comment\"\u003e// ...ä¸€äº›æ“ä½œ\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e14\u003c/span\u003e      });\n\u003cspan class=\"lineNumber\"\u003e15\u003c/span\u003e    });\n\u003cspan class=\"lineNumber\"\u003e16\u003c/span\u003e  });\n\u003cspan class=\"lineNumber\"\u003e17\u003c/span\u003e})\u003c/code\u003e\u003c/pre\u003e \n\n\u003cp\u003eä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿå› ä¸ºæŸäº›åœºæ™¯ä¸‹éœ€è¦å¯¹å¼‚æ­¥æ“ä½œè¿›è¡Œæ’åºï¼Œéœ€è¦ä¿è¯è¿è¡Œé€»è¾‘å…·æœ‰ä¸€å®šçš„é¡ºåºï¼Œå¹¶ä¸”è¿˜éœ€è¦å¯¹æ¯ä¸€ä¸ªå›è°ƒè¿›è¡Œé”™è¯¯å¤„ç†ã€‚\u003c/p\u003e\n\u003cp\u003eä¸Šè¿°æ¡ˆä¾‹çœç•¥äº†çœŸå®çš„é€»è¾‘ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºè¿™ç§å›è°ƒçš„åµŒå¥—è®©ä»£ç å¾ˆå®¹æ˜“å¤±æ§ï¼Œå¹¶ä¸”éš¾ä»¥é˜…è¯»å’Œç»´æŠ¤ã€‚\u003c/p\u003e\n\u003cp\u003eæ— è®ºæ˜¯å†™ä¸‹è¿™æ®µä»£ç çš„äººè¿˜æ˜¯é˜…è¯»è¿™æ®µä»£ç çš„äººéƒ½è¢«å…¶æ‰€\"æŠ˜ç£¨\"ï¼Œæˆ‘ä»¬å°†æ­¤ç±»ä»£ç ç»“æ„ç§°ä¸º\u003ccode\u003eâ€œå›è°ƒåœ°ç‹±â€\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cp\u003eå³ä½¿æˆ‘ä»¬å°†ä¹‹æ‘Šå¼€ï¼Œä¸ºæ¯ä¸€ä¸ªå›è°ƒå‡½æ•°éƒ½ç¼–å†™ä¸€ä¸ªå…·åçš„ç‹¬ç«‹å‡½æ•°æ¥è°ƒç”¨ï¼Œä¾ç„¶å¯è¯»æ€§ä¸ä½³ï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"lineNumber\"\u003e1\u003c/span\u003efs.readFile(\u003cspan class=\"hljs-string\"\u003e'file1.txt'\u003c/span\u003e, step1);\n\u003cspan class=\"lineNumber\"\u003e2\u003c/span\u003e \n\u003cspan class=\"lineNumber\"\u003e3\u003c/span\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003estep1\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eerr, data\u003c/span\u003e) \u003c/span\u003e{\n\u003cspan class=\"lineNumber\"\u003e4\u003c/span\u003e  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(err) \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e err;\n\u003cspan class=\"lineNumber\"\u003e5\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e6\u003c/span\u003e  fs.readFile(\u003cspan class=\"hljs-string\"\u003e'file2.txt'\u003c/span\u003e, step2)\n\u003cspan class=\"lineNumber\"\u003e7\u003c/span\u003e}\n\u003cspan class=\"lineNumber\"\u003e8\u003c/span\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003estep2\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eerr, data\u003c/span\u003e) \u003c/span\u003e{\n\u003cspan class=\"lineNumber\"\u003e9\u003c/span\u003e  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(err) \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e err;\n\u003cspan class=\"lineNumber\"\u003e10\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e11\u003c/span\u003e  fs.readFile(\u003cspan class=\"hljs-string\"\u003e'file3.txt'\u003c/span\u003e, step3)\n\u003cspan class=\"lineNumber\"\u003e12\u003c/span\u003e}\n\u003cspan class=\"lineNumber\"\u003e13\u003c/span\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003estep3\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eerr, data\u003c/span\u003e) \u003c/span\u003e{\n\u003cspan class=\"lineNumber\"\u003e14\u003c/span\u003e  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(err) \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e err;\n\u003cspan class=\"lineNumber\"\u003e15\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e16\u003c/span\u003e  fs.readFile(\u003cspan class=\"hljs-string\"\u003e'file4.txt'\u003c/span\u003e, step4)\n\u003cspan class=\"lineNumber\"\u003e17\u003c/span\u003e}\n\u003cspan class=\"lineNumber\"\u003e18\u003c/span\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003estep4\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eerr, data\u003c/span\u003e) \u003c/span\u003e{\n\u003cspan class=\"lineNumber\"\u003e19\u003c/span\u003e  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(err) \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e err;\n\u003cspan class=\"lineNumber\"\u003e20\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e21\u003c/span\u003e}\u003c/code\u003e\u003c/pre\u003e \n\n\u003cp\u003eè¿™äº›ç‹¬ç«‹å‡½æ•°çš„å‘½åä¹Ÿè®¸ä¼šè®©å¼€å‘è€…è§‰å¾—éå¸¸ä¸é€‚ï¼Œä¸ºäº†å±•å¼€å±‚å±‚åµŒå¥—ï¼Œæˆ‘ä»¬ç¼–å†™äº†è®¸å¤šå‡ ä¹ä¸ä¼šè¢«\u003ccode\u003eé‡ç”¨\u003c/code\u003eçš„å‡½æ•°ï¼Œå³ä½¿ç°ä»£ç¼–è¾‘å™¨åœ¨ä»£ç è·³è½¬çš„åŠŸèƒ½ä¸Šéå¸¸æ–¹ä¾¿ï¼Œé˜…è¯»æ­¤ç±»ä»£ç çš„æ—¶å€™ä¾ç„¶ä¼šè®©æˆ‘ä»¬ä¸æ–­çš„è½¬ç§»è§†çº¿ã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eâ€œæ‡’æƒ°â€ä½¿äººè¿›æ­¥ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eä½¿ç”¨\u003ccode\u003ePromise\u003c/code\u003e,å¯ä»¥é¿å…æ­¤ç±»é—®é¢˜ï¼Œæ˜¾è‘—å‡å°‘ç¼–ç é‡ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§ã€‚\u003c/p\u003e\n\u003ch1\u003e2. Promise\u003c/h1\u003e\n\u003cblockquote\u003e\n\u003cp\u003eIE æµè§ˆå™¨ä¸æ”¯æŒ\u003ccode\u003ePromise\u003c/code\u003e,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨\u003ccode\u003ebluebird\u003c/code\u003eæˆ–\u003ccode\u003ees6-promise\u003c/code\u003eç­‰ç¬¬ä¸‰æ–¹åº“.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2\u003e2.1 promise æµ…æ\u003c/h2\u003e\n\u003cp\u003eä½¿ç”¨\u003ccode\u003enew\u003c/code\u003eå®ä¾‹åŒ–çš„\u003ccode\u003ePromise\u003c/code\u003eå¯¹è±¡å…·æœ‰ä¸‰ç§çŠ¶æ€:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eFulfilled\u003c/code\u003e - \u003ccode\u003ehas resolution\u003c/code\u003e: resolve æˆåŠŸ,è°ƒç”¨ \u003ccode\u003eonFulfilled\u003c/code\u003eå‡½æ•°\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eRejected\u003c/code\u003e - \u003ccode\u003ehas rejection\u003c/code\u003e: reject, è°ƒç”¨\u003ccode\u003eonRejected\u003c/code\u003eå‡½æ•°\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ePending\u003c/code\u003e - \u003ccode\u003eunresolved\u003c/code\u003e: åˆå§‹åŒ–çŠ¶æ€\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003eçŸ­æ¨ªçº¿å·¦è¾¹æ˜¯\u003ccode\u003ePromise/A+\u003c/code\u003eæœ¯è¯­,è€Œå³è¾¹åˆ™æ˜¯\u003ccode\u003eES6 Promise\u003c/code\u003eæœ¯è¯­.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003cimg src=\"https://raw.githubusercontent.com/youyiqin/markdown_imgs/master/image-1582215000590-ffa807c19d5f6959de485fc66664e123.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eåˆå§‹çŠ¶æ€ä¸º\u003ccode\u003epending\u003c/code\u003e,è½¬ä¸º\u003ccode\u003eFulfilled\u003c/code\u003eæˆ–è€…\u003ccode\u003eRejected\u003c/code\u003eä¹‹åä¸ä¼šå†æœ‰å˜åŒ–.\u003ccode\u003eFulfilled\u003c/code\u003eå’Œ\u003ccode\u003eRejected\u003c/code\u003eçŠ¶æ€ä¹Ÿè¢«ç§°ä¸º\u003ccode\u003eSettled\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ePromise\u003c/code\u003eçš„çŠ¶æ€æµè½¬å¹¶ä¸å¤æ‚ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦æ³¨æ„å…¶ä¸­ä¸€äº›ç»†èŠ‚ã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eæœ¬æ–‡ä¸ä¼šå¯¹\u003ccode\u003epromise\u003c/code\u003eåšé¢é¢ä¿±åˆ°çš„ä»‹ç»,æ¨èé˜…è¯»å®˜æ–¹æ–‡æ¡£.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eé¦–å…ˆ,æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ª\u003ccode\u003epromise\u003c/code\u003eå®ä¾‹:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"lineNumber\"\u003e1\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e// å®ä¾‹åŒ–\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e2\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e promise = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresolve, reject\u003c/span\u003e) =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e3\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e// balabala\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e4\u003c/span\u003e  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eif\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e...\u003c/span\u003e)\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e5\u003c/span\u003e    \u003cspan class=\"hljs-comment\"\u003e// å®ä¾‹çŠ¶æ€å˜æ›´ï¼Œè®¾ç½®å€¼\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e6\u003c/span\u003e    resolve(value) \u003cspan class=\"hljs-comment\"\u003e// success\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e7\u003c/span\u003e    resolve(...) \u003cspan class=\"hljs-comment\"\u003e// å¿½ç•¥\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e8\u003c/span\u003e  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e9\u003c/span\u003e  \treject(reason) \u003cspan class=\"hljs-comment\"\u003e// failure\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e10\u003c/span\u003e  }\n\u003cspan class=\"lineNumber\"\u003e11\u003c/span\u003e})\n\u003cspan class=\"lineNumber\"\u003e12\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e// é“¾å¼è°ƒç”¨ï¼Œå®ä¾‹æ–¹æ³• then è¿”å›ä¸€ä¸ªæ–°çš„å®ä¾‹\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e13\u003c/span\u003epromise\n\u003cspan class=\"lineNumber\"\u003e14\u003c/span\u003e  .then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003evalue\u003c/span\u003e) \u003c/span\u003e{\n\u003cspan class=\"lineNumber\"\u003e15\u003c/span\u003e\t\t\u003cspan class=\"hljs-comment\"\u003e// balabala\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e16\u003c/span\u003e  })\n\u003cspan class=\"lineNumber\"\u003e17\u003c/span\u003e\t.then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003evalue\u003c/span\u003e) \u003c/span\u003e{\n\u003cspan class=\"lineNumber\"\u003e18\u003c/span\u003e\t\t\u003cspan class=\"hljs-comment\"\u003e// balabala\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e19\u003c/span\u003e  })\n\u003cspan class=\"lineNumber\"\u003e20\u003c/span\u003e\t.catch(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003ereason\u003c/span\u003e =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e21\u003c/span\u003e  \t\u003cspan class=\"hljs-comment\"\u003e// balabala\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e22\u003c/span\u003e  })\n\u003cspan class=\"lineNumber\"\u003e23\u003c/span\u003e\t.finally(\u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e {})\u003c/code\u003e\u003c/pre\u003e \n\n\u003cp\u003eä¸Šè¿°ç¤ºä¾‹å±•ç¤ºäº†\u003ccode\u003epromise\u003c/code\u003eçš„ä¸€äº›ç‰¹æ€§ï¼Œå¦‚å®ä¾‹åŒ–ã€çŠ¶æ€è½¬æ¢èµ‹å€¼ã€é“¾å¼è°ƒç”¨å’Œå¼‚å¸¸å¤„ç†ï¼Œä¸‹é¢æˆ‘ä»¬ä¼šè®²åˆ°é™æ€æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•ã€‚\u003c/p\u003e\n\u003ch2\u003e2.1 Promise æ„é€ å™¨\u003c/h2\u003e\n\u003cp\u003eæˆ‘ä»¬é€šè¿‡\u003ccode\u003enew Promise(executor)\u003c/code\u003eå®ä¾‹åŒ–ä¸€ä¸ª\u003ccode\u003epromise\u003c/code\u003eçš„æ—¶å€™,å…¶çŠ¶æ€ä¸º\u003ccode\u003epending\u003c/code\u003e.åœ¨å®ä¾‹åŒ–çš„æ—¶å€™ä¼ å…¥ä¸€ä¸ªå‡½æ•°\u003ccode\u003eexecutorï¼ˆæ‰§è¡Œå™¨ï¼‰\u003c/code\u003eï¼Œæ­¤å‡½æ•°å°†ä¼šè·å–ä¸¤ä¸ªå®å‚\u003ccode\u003eresolve\u003c/code\u003eå’Œ\u003ccode\u003ereject\u003c/code\u003eå‡½æ•°ï¼ŒäºŒè€…éƒ½å¯ä»¥æ”¹å˜å®ä¾‹çš„çŠ¶æ€å’Œå€¼ã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eä¸æä¾› \u003ccode\u003eexecutor\u003c/code\u003e å°†æŠ›å‡º \u003ccode\u003etypeError\u003c/code\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eä¸Šè¿°ä»£ç çš„ç‰‡æ®µï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"lineNumber\"\u003e1\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e// å®ä¾‹åŒ–\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e2\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e promise = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresolve, reject\u003c/span\u003e) =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e3\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e// balabala\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e4\u003c/span\u003e  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eif\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e...\u003c/span\u003e)\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e5\u003c/span\u003e    \u003cspan class=\"hljs-comment\"\u003e// å®ä¾‹çŠ¶æ€å˜æ›´ï¼Œè®¾ç½®å€¼\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e6\u003c/span\u003e    resolve(value) \u003cspan class=\"hljs-comment\"\u003e// success\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e7\u003c/span\u003e    resolve(...) \u003cspan class=\"hljs-comment\"\u003e// å¿½ç•¥\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e8\u003c/span\u003e  } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e9\u003c/span\u003e  \treject(reason) \u003cspan class=\"hljs-comment\"\u003e// failure\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e10\u003c/span\u003e  }\n\u003cspan class=\"lineNumber\"\u003e11\u003c/span\u003e})\u003c/code\u003e\u003c/pre\u003e \n\n\u003cp\u003eéœ€è¦å…³æ³¨ä»¥ä¸‹å‡ ç‚¹ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eExecutor\u003c/code\u003eå‡½æ•°çš„å‚æ•°æ²¡æœ‰é™åˆ¶ï¼Œä½†é€šå¸¸æˆ‘ä»¬ä¼šå£°æ˜ä¸¤ä¸ªå½¢å‚å‡½æ•°ï¼š\u003ccode\u003eresolve\u003c/code\u003eå’Œ\u003ccode\u003ereject\u003c/code\u003eï¼Œ\u003ccode\u003eexecutor\u003c/code\u003eå†…éƒ¨ä½¿ç”¨æ­¤äºŒè€…å¯ä»¥æ˜¾å¼åœ°è½¬æ¢\u003ccode\u003ePromise\u003c/code\u003eå®ä¾‹çš„çŠ¶æ€ï¼Œè®¾ç½®å…¶å€¼ã€‚ï¼ˆä¸ä½¿ç”¨è¿™ä¸¤ä¸ªå‡½æ•°æ¥è½¬æ¢å®ä¾‹çŠ¶æ€æ„å‘³ç€æ­¤å®ä¾‹çš„çŠ¶æ€ä¸ä¼šæ”¹å˜ï¼Œè¿™ä¹Ÿå†™å¹¶æ²¡æœ‰å¤šå¤§æ„ä¹‰ï¼‰ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eresolve\u003c/code\u003eå’Œ\u003ccode\u003ereject\u003c/code\u003eå‡½æ•°çš„å®å‚å¯ä»¥æ˜¯ä¸åŒç±»å‹çš„å€¼ï¼Œä½†æ˜¯ä¼šè¢«è¿›ä¸€æ­¥å¤„ç†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ˜¾ç¤ºè½¬æ¢çŠ¶æ€è®¾ç½®å€¼çš„æ—¶å€™ï¼Œä¼ å…¥çš„å‚æ•°ä¸ä¸€å®šä¼šç›´æ¥ä½œä¸º\u003ccode\u003esettled\u003c/code\u003eçŠ¶æ€çš„å€¼ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003epending\u003c/code\u003eçŠ¶æ€åˆ°\u003ccode\u003esettled\u003c/code\u003eçŠ¶æ€æ˜¯ä¸å¯é€†çš„ï¼Œå¹¶ä¸”åœ¨\u003ccode\u003eexecutor\u003c/code\u003eä¸­çš„\u003ccode\u003eresolve\u003c/code\u003eå’Œ\u003ccode\u003ereject\u003c/code\u003eå‡½æ•°åªèƒ½æ‰§è¡Œä¸€æ¬¡ï¼Œåç»­å†æ‰§è¡Œå°†ä¼šè¢«å¿½ç•¥ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003eexecutor\u003c/code\u003eå‡½æ•°æ˜¯åŒæ­¥æ‰§è¡Œçš„ã€‚\u003ccode\u003eresolve\u003c/code\u003eå’Œ\u003ccode\u003ereject\u003c/code\u003eå‡½æ•°æ¥æ”¶ä»»æ„ç±»å‹çš„å€¼ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eæˆ‘ä»¬æ¥çœ‹çœ‹ç»™\u003ccode\u003eresolve\u003c/code\u003eå‡½æ•°ä¼ å…¥ä»¥ä¸‹ä¸‰ç§ä¸åŒçš„å€¼ä¼šæœ‰æ€æ ·çš„ç»“æœã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eåŸå§‹ç±»å‹å€¼\u003c/li\u003e\n\u003cli\u003ePromise å®ä¾‹\u003c/li\u003e\n\u003cli\u003ethenable å¯¹è±¡\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eé¦–å…ˆæ˜¯\u003ccode\u003eåŸå§‹ç±»å‹å€¼\u003c/code\u003eï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"lineNumber\"\u003e1\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e p = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresolve, reject\u003c/span\u003e) =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e2\u003c/span\u003e  resolve(\u003cspan class=\"hljs-built_in\"\u003eSymbol\u003c/span\u003e())\n\u003cspan class=\"lineNumber\"\u003e3\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e// resolve(1)\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e4\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e// resolve('1')\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e5\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e// resolve(null)\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e6\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e// resolve(undefined)\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e7\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e// resolve(1n)\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e8\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e// resolve(true)\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e9\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e// reject ä¹Ÿæ˜¯å¦‚æ­¤\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e10\u003c/span\u003e})\n\u003cspan class=\"lineNumber\"\u003e11\u003c/span\u003e \n\u003cspan class=\"lineNumber\"\u003e12\u003c/span\u003ep.then(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ev\u003c/span\u003e) =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e13\u003c/span\u003e  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'resolve'\u003c/span\u003eï¼Œ v);\n\u003cspan class=\"lineNumber\"\u003e14\u003c/span\u003e}).catch(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ei\u003c/span\u003e) =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e15\u003c/span\u003e  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'reject'\u003c/span\u003e, i);\n\u003cspan class=\"lineNumber\"\u003e16\u003c/span\u003e})\u003c/code\u003e\u003c/pre\u003e \n\n\u003cp\u003eåŸå§‹ç±»å‹æ•°æ®ä¼ å…¥\u003ccode\u003eresolve\u003c/code\u003eå‡½æ•°ï¼Œéƒ½èƒ½é¡ºåˆ©å°†çŠ¶æ€è½¬ä¸º\u003ccode\u003efulfilled\u003c/code\u003eå¹¶ä¸”è®¾ç½®ä¸ºå½“å‰çŠ¶æ€ä¸‹çš„å€¼ã€‚ä½¿ç”¨\u003ccode\u003ereject\u003c/code\u003eå‡½æ•°åˆ™å°†çŠ¶æ€è½¬ä¸º\u003ccode\u003erejected\u003c/code\u003e,å€¼åˆ™æ˜¯åŸå§‹ç±»å‹çš„å€¼ã€‚\u003c/p\u003e\n\u003cp\u003eå…¶æ¬¡ï¼Œæ¥çœ‹çœ‹ä¼ å…¥\u003ccode\u003ePromise\u003c/code\u003eå¯¹è±¡ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"lineNumber\"\u003e1\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e p = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresolve, reject\u003c/span\u003e) =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e2\u003c/span\u003e  resolve(\u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e.resolve(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e))\n\u003cspan class=\"lineNumber\"\u003e3\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e// or\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e4\u003c/span\u003e  reject(\u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e.resolve(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e))\n\u003cspan class=\"lineNumber\"\u003e5\u003c/span\u003e})\n\u003cspan class=\"lineNumber\"\u003e6\u003c/span\u003ep.then(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ev\u003c/span\u003e) =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e7\u003c/span\u003e  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'resolve'\u003c/span\u003e, v);\n\u003cspan class=\"lineNumber\"\u003e8\u003c/span\u003e}).catch(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ei\u003c/span\u003e) =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e9\u003c/span\u003e  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'reject'\u003c/span\u003e, i)\n\u003cspan class=\"lineNumber\"\u003e10\u003c/span\u003e})\n\u003cspan class=\"lineNumber\"\u003e11\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e// output\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e12\u003c/span\u003eresolve \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e \n\n\u003cp\u003eå¦‚æœä¼ å…¥ç»™\u003ccode\u003epromise\u003c/code\u003eçš„å‚æ•°ä¹Ÿæ˜¯ä¸€ä¸ª\u003ccode\u003ePromise\u003c/code\u003eå®ä¾‹ï¼Œåˆ™ç›¸å½“äºä¸€ä¸ªç©ºåŒ…è£…ï¼Œæœ€ç»ˆå°†å¾—åˆ°ä¸€ä¸ªç›¸åŒçŠ¶æ€å’Œå€¼çš„\u003ccode\u003ePromise\u003c/code\u003eå®ä¾‹ã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003ereject(Promise.resolve(1))\u003c/code\u003e ä¸ä¼šç…§æ¬\u003ccode\u003eresolve\u003c/code\u003eçš„ç‰¹æ€§ï¼Œå¯¹äºä¼ å…¥ä¸€ä¸ª\u003ccode\u003ePromise\u003c/code\u003eå®ä¾‹çš„æƒ…å½¢ï¼Œä¼šå°†ä¹‹ä½œä¸º\u003ccode\u003eRejected\u003c/code\u003eçŠ¶æ€ä¸‹çš„\u003ccode\u003ereason\u003c/code\u003eã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"lineNumber\"\u003e1\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e p = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresolve, reject\u003c/span\u003e) =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e2\u003c/span\u003e  resolve(\u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e.reject(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e))\n\u003cspan class=\"lineNumber\"\u003e3\u003c/span\u003e})\n\u003cspan class=\"lineNumber\"\u003e4\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e// output\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e5\u003c/span\u003ereject \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e \n\n\u003cp\u003eæ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹ä¼ å…¥ä¸€ä¸ªæ™®é€šçš„ \u003ccode\u003ethenable\u003c/code\u003e å¯¹è±¡ã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eå…·æœ‰\u003ccode\u003ethen\u003c/code\u003eæ–¹æ³•çš„å¯¹è±¡ç§°ä¸º\u003ccode\u003ethenable\u003c/code\u003eå¯¹è±¡ï¼Œ\u003ccode\u003ePromise\u003c/code\u003eå®ä¾‹å¯¹è±¡ä¹Ÿæ˜¯ä¸€ç§\u003ccode\u003ethenable\u003c/code\u003eå¯¹è±¡ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"lineNumber\"\u003e1\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e obj = {\n\u003cspan class=\"lineNumber\"\u003e2\u003c/span\u003e  \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'Miao'\u003c/span\u003e,\n\u003cspan class=\"lineNumber\"\u003e3\u003c/span\u003e  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e4\u003c/span\u003e    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'this is then'\u003c/span\u003e, \u003cspan class=\"hljs-built_in\"\u003earguments\u003c/span\u003e);\n\u003cspan class=\"lineNumber\"\u003e5\u003c/span\u003e    \u003cspan class=\"hljs-built_in\"\u003earguments\u003c/span\u003e[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e](\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n\u003cspan class=\"lineNumber\"\u003e6\u003c/span\u003e  }\n\u003cspan class=\"lineNumber\"\u003e7\u003c/span\u003e}\n\u003cspan class=\"lineNumber\"\u003e8\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e p = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresolve, reject\u003c/span\u003e) =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e9\u003c/span\u003e  resolve(obj)\n\u003cspan class=\"lineNumber\"\u003e10\u003c/span\u003e})\n\u003cspan class=\"lineNumber\"\u003e11\u003c/span\u003e \n\u003cspan class=\"lineNumber\"\u003e12\u003c/span\u003ep.then(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ev\u003c/span\u003e) =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e13\u003c/span\u003e  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'resolve'\u003c/span\u003e, v);\n\u003cspan class=\"lineNumber\"\u003e14\u003c/span\u003e}).catch(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ei\u003c/span\u003e) =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e15\u003c/span\u003e  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'reject'\u003c/span\u003e, i)\n\u003cspan class=\"lineNumber\"\u003e16\u003c/span\u003e})\n\u003cspan class=\"lineNumber\"\u003e17\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e// output\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e18\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e is then [Arguments] {\n\u003cspan class=\"lineNumber\"\u003e19\u003c/span\u003e  \u003cspan class=\"hljs-string\"\u003e'0'\u003c/span\u003e: [\u003cspan class=\"hljs-built_in\"\u003eFunction\u003c/span\u003e (anonymous)],\n\u003cspan class=\"lineNumber\"\u003e20\u003c/span\u003e  \u003cspan class=\"hljs-string\"\u003e'1'\u003c/span\u003e: [\u003cspan class=\"hljs-built_in\"\u003eFunction\u003c/span\u003e (anonymous)]\n\u003cspan class=\"lineNumber\"\u003e21\u003c/span\u003e}\n\u003cspan class=\"lineNumber\"\u003e22\u003c/span\u003eresolve \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e \n\n\u003cp\u003e\u003ccode\u003eexecutor\u003c/code\u003eå†…\u003ccode\u003eresolve\u003c/code\u003eä¸€ä¸ª\u003ccode\u003ethenable\u003c/code\u003eå¯¹è±¡ï¼Œåˆ™ä¼šå°†\u003ccode\u003ethen\u003c/code\u003eæ–¹æ³•è§†ä½œä¸€ä¸ª\u003ccode\u003eexecutor\u003c/code\u003eï¼Œåœ¨å…¶å†…éƒ¨å¯ä»¥æ˜¾ç¤ºç¼–å†™\u003ccode\u003eresolve\u003c/code\u003eå’Œ\u003ccode\u003ereject\u003c/code\u003eçš„é€»è¾‘æ¥æ”¹å˜æ•´ä¸ª\u003ccode\u003ePromise\u003c/code\u003eå®ä¾‹çš„çŠ¶æ€å’Œå€¼ã€‚\u003c/p\u003e\n\u003ch2\u003e2.2 Promise å®ä¾‹æ–¹æ³•\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003ePromise\u003c/code\u003eå®ä¾‹æœ‰ä¸‰ä¸ªå®ä¾‹æ–¹æ³•ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ethen\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecatch\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003efinally\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003eé‡ç”³ï¼š\u003ccode\u003epromise\u003c/code\u003eå®ä¾‹çš„çŠ¶æ€è½¬æ¢æ˜¯å•å‘çš„,ä¸€æ—¦\u003ccode\u003esettled\u003c/code\u003eåˆ™ä¸å¯é€†è½¬,åŒæ—¶æˆ‘ä»¬å¯ä»¥å¤šæ¬¡åˆ©ç”¨æ­¤\u003ccode\u003esettled\u003c/code\u003eçŠ¶æ€çš„å®ä¾‹ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eé¦–å…ˆæ˜¯\u003ccode\u003ethen(onFulfilled, onRejected)\u003c/code\u003eæ–¹æ³•ï¼Œæ­¤æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œåœ¨\u003ccode\u003ePromise\u003c/code\u003eçŠ¶æ€ä¸º\u003ccode\u003epending\u003c/code\u003eçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ­¤æ–¹æ³•ç†è§£ä¸ºæ³¨å†ŒçŠ¶æ€è½¬å˜ä¸º\u003ccode\u003eFulfilled\u003c/code\u003eå’Œ\u003ccode\u003eRejected\u003c/code\u003eåæ‰§è¡Œçš„å›è°ƒå‡½æ•°ï¼Œå¹¶ä¸”è¿™äº›å›è°ƒå‡½æ•°çš„æ‰§è¡Œæ˜¯å¼‚æ­¥çš„ã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003ePromise\u003c/code\u003eåªèƒ½è½¬æ¢ä¸€æ¬¡ï¼Œå› æ­¤ä¸Šè¿°ä¸¤ä¸ªå‚æ•°çš„æ“ä½œæ˜¯äº’æ–¥çš„ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eåœ¨å®ç°ä¸Š\u003ccode\u003eNode\u003c/code\u003eå¯ä»¥é€šè¿‡\u003ccode\u003eprocess.nextTick\u003c/code\u003eæ¥åˆ›å»ºæ–°çš„å¾®ä»»åŠ¡ï¼Œåœ¨æµè§ˆå™¨ç«¯åˆ™å¯ä»¥é€šè¿‡\u003ccode\u003eMutationObserver\u003c/code\u003eåŠŸèƒ½åˆ›å»ºå¾®ä»»åŠ¡ã€‚\u003c/p\u003e\n\u003cp\u003eä»¥ä¸‹ä¸¤ç§\u003ccode\u003ethen\u003c/code\u003eå‡½æ•°çš„ä¼ å‚éƒ½ä¼šè¢«å¿½ç•¥, å¹¶ä¸”å¼‚æ­¥è¿”å›ä¸€ä¸ªç›¸åŒå€¼çš„\u003ccode\u003ePromise\u003c/code\u003eæ–°å®ä¾‹ï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"lineNumber\"\u003e1\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e// ä¼ éå‡½æ•°å¤„ç†å¯¹è±¡\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e2\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e.resolve(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e).then(\u003cspan class=\"hljs-string\"\u003e'sss'\u003c/span\u003e)\n\u003cspan class=\"lineNumber\"\u003e3\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e// ä¸ä¼ å€¼\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e4\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e.resolve(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e).then()\n\u003cspan class=\"lineNumber\"\u003e5\u003c/span\u003e \n\u003cspan class=\"lineNumber\"\u003e6\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e p = \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e.resolve(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n\u003cspan class=\"lineNumber\"\u003e7\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e c = p.then()\n\u003cspan class=\"lineNumber\"\u003e8\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(p);\n\u003cspan class=\"lineNumber\"\u003e9\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003esetTimeout\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e10\u003c/span\u003e  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(c);\n\u003cspan class=\"lineNumber\"\u003e11\u003c/span\u003e}, \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e);\n\u003cspan class=\"lineNumber\"\u003e12\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e// output\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e13\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e { \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e }\n\u003cspan class=\"lineNumber\"\u003e14\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e { \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e }\u003c/code\u003e\u003c/pre\u003e \n\n\u003cp\u003eä¸æ¨èç¼–å†™ä¸Šè¿°\u003ccode\u003ethen\u003c/code\u003eæ–¹æ³•ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“æ­¤ç§æƒ…å½¢\u003ccode\u003ePromise\u003c/code\u003eä¼šå¦‚ä½•å¤„ç†æ•´ä½“çš„é€»è¾‘æµç¨‹ã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eæ— è®º\u003ccode\u003ePromise\u003c/code\u003eå®ä¾‹å¤„äºä½•ç§çŠ¶æ€ï¼Œæˆ‘ä»¬æ³¨å†Œå›è°ƒå‡½æ•°éƒ½å°†å¼‚æ­¥æ‰§è¡Œã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eå…¶æ¬¡ï¼Œ\u003ccode\u003ecatch\u003c/code\u003eæ–¹æ³•å¯ä»¥ç†è§£ä¸º\u003ccode\u003ethen\u003c/code\u003eæ–¹æ³•çš„è¯­æ³•ç³–å½¢å¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†\u003ccode\u003ethen(undefiled, onRejected)\u003c/code\u003eè§†ä¸º\u003ccode\u003ecatch(onRejected)\u003c/code\u003eä¸€ç§å½¢å¼ï¼Œå¼€å‘è€…å¯ä»¥è‡ªç”±é€‰æ‹©å¦‚ä½•ç¼–å†™\u003ccode\u003ePromise\u003c/code\u003eå®ä¾‹ä»\u003ccode\u003epending\u003c/code\u003eè½¬ä¸º\u003ccode\u003esettled\u003c/code\u003eçŠ¶æ€åçš„å¼‚æ­¥å›è°ƒå‡½æ•°ã€‚\u003c/p\u003e\n\u003cp\u003eæœ€åï¼Œ\u003ccode\u003efinally\u003c/code\u003eæ–¹æ³•åˆ™ç›¸å½“äºæ³¨å†Œä¸€ä¸ª\u003ccode\u003ePromise\u003c/code\u003eå®ä¾‹\u003ccode\u003esettled\u003c/code\u003eä¹‹åçš„æ¸…ç†æ–¹æ³•ï¼Œé€šå¸¸æˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¸€ä¸ªå…·æœ‰æ¸…ç†åŠŸèƒ½çš„å‡½æ•°ä½œä¸ºå‚æ•°ã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003efinally\u003c/code\u003eè¿”å›ä¸€ä¸ªæ–°çš„\u003ccode\u003ePromise\u003c/code\u003eå®ä¾‹ï¼Œ\u003ccode\u003efinally\u003c/code\u003eè®¾è®¡ä¸ºä¸€ä¸ªä¸çŠ¶æ€æ— å…³çš„æ–¹æ³•ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹åªæ˜¯ä¼ é€’ä¸Šå±‚çš„\u003ccode\u003ePromise\u003c/code\u003eï¼Œé™¤éæ˜¾å¼åœ°è¿”å›ä¸€ä¸ªæ–°çš„\u003ccode\u003ePromise\u003c/code\u003eå®ä¾‹ï¼Œæˆ–è€…æŠ›å‡ºå¼‚å¸¸è¿”å›\u003ccode\u003eRejected\u003c/code\u003eçŠ¶æ€çš„å®ä¾‹ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eè®©æˆ‘ä»¬æ¥å†™ä¸€ä¸ªç¤ºä¾‹ï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"lineNumber\"\u003e1\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresolve ,reject\u003c/span\u003e) =\u003e\u003c/span\u003e resolve(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e))\n\u003cspan class=\"lineNumber\"\u003e2\u003c/span\u003e  .then(\u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e3\u003c/span\u003e    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'1'\u003c/span\u003e);\n\u003cspan class=\"lineNumber\"\u003e4\u003c/span\u003e  })\n\u003cspan class=\"lineNumber\"\u003e5\u003c/span\u003e  .then(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ev\u003c/span\u003e) =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e6\u003c/span\u003e    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'2'\u003c/span\u003e, v);\n\u003cspan class=\"lineNumber\"\u003e7\u003c/span\u003e    \u003cspan class=\"hljs-keyword\"\u003ethrow\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003eError\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'my error'\u003c/span\u003e)\n\u003cspan class=\"lineNumber\"\u003e8\u003c/span\u003e  })\n\u003cspan class=\"lineNumber\"\u003e9\u003c/span\u003e  .then(\u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e10\u003c/span\u003e    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'3'\u003c/span\u003e);\n\u003cspan class=\"lineNumber\"\u003e11\u003c/span\u003e  })\n\u003cspan class=\"lineNumber\"\u003e12\u003c/span\u003e  .catch(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eerr\u003c/span\u003e =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e13\u003c/span\u003e    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'catch any error'\u003c/span\u003e);\n\u003cspan class=\"lineNumber\"\u003e14\u003c/span\u003e    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e \u003cspan class=\"hljs-comment\"\u003e// æˆ–è€… return Promise.resolve(4)\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e15\u003c/span\u003e  })\n\u003cspan class=\"lineNumber\"\u003e16\u003c/span\u003e  .then(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ev\u003c/span\u003e) =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e17\u003c/span\u003e    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'4'\u003c/span\u003e, v);\n\u003cspan class=\"lineNumber\"\u003e18\u003c/span\u003e    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e19\u003c/span\u003e  })\n\u003cspan class=\"lineNumber\"\u003e20\u003c/span\u003e  .finally(\u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e21\u003c/span\u003e    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'finally'\u003c/span\u003e);\n\u003cspan class=\"lineNumber\"\u003e22\u003c/span\u003e  })\n\u003cspan class=\"lineNumber\"\u003e23\u003c/span\u003e  .then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003ev\u003c/span\u003e =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e24\u003c/span\u003e    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e, v);\n\u003cspan class=\"lineNumber\"\u003e25\u003c/span\u003e  })\n\u003cspan class=\"lineNumber\"\u003e26\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e// output\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e27\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e28\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003eundefined\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e29\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e any error\n\u003cspan class=\"lineNumber\"\u003e30\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e4\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e31\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003efinally\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e32\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e \n\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003ePromise\u003c/code\u003eå®ä¾‹æ”¯æŒé“¾å¼è°ƒç”¨,æ¯ä¸ª\u003ccode\u003ethen\u003c/code\u003eå‡½æ•°å†…éƒ¨æœ€åå°†è¿”å›ä¸€ä¸ªå…¨æ–°çš„\u003ccode\u003epromise\u003c/code\u003eå®ä¾‹ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003ccode\u003ethen\u003c/code\u003eæ–¹æ³•é»˜è®¤è¿”å›ä¸€ä¸ªå€¼ä¸º\u003ccode\u003eundefined\u003c/code\u003e,çŠ¶æ€ä¸º\u003ccode\u003efulfilled\u003c/code\u003eçš„\u003ccode\u003ePromise\u003c/code\u003eå®ä¾‹.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003eå›è°ƒå‡½æ•°\u003c/code\u003eçš„å†™æ³•ç¼–å†™å¯ä»¥ä¸€æ¬¡æ€§ç›‘å¬æ‰€æœ‰å›è°ƒå‡½æ•°çš„é”™è¯¯å¤„ç†é€»è¾‘æ˜¯å¾ˆå›°éš¾çš„,\u003ccode\u003ePromiseå®ä¾‹\u003c/code\u003eçš„å®ä¾‹æ–¹æ³•\u003ccode\u003ecatch\u003c/code\u003eèƒ½å¤„ç†é“¾å¼è°ƒç”¨ä¹‹å‰æ‰€æœ‰çš„\u003ccode\u003ethen\u003c/code\u003eå‡½æ•°é”™è¯¯å’Œæ˜¾å¼çš„\u003ccode\u003ereject\u003c/code\u003eè¡Œä¸º.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003ccode\u003ecatch\u003c/code\u003eæ–¹æ³•èƒ½å¤„ç†é“¾å¼è°ƒç”¨ä¹‹å‰æ‰€æœ‰çš„å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å‰é¢çš„\u003ccode\u003ePromise\u003c/code\u003eçŠ¶æ€è½¬ä¸º\u003ccode\u003erejected\u003c/code\u003eçš„æ—¶å€™ï¼Œä¼š\"è·³è¿‡\"\u003ccode\u003ethen\u003c/code\u003eæ–¹æ³•ï¼Œä»è€Œæ‰§è¡Œ\u003ccode\u003ecatch\u003c/code\u003eæ–¹æ³•æ³¨å†Œçš„å¼‚æ­¥å›è°ƒã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003ePromise\u003c/code\u003eçš„å¼‚æ­¥æ³¨å†Œç›‘å¬å‡½æ•°çš„æ‰§è¡Œé¡ºåºå–å†³äºä½¿ç”¨å®ä¾‹æ–¹æ³•æ·»åŠ çš„é¡ºåºã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2\u003e2.3 Promise é™æ€æ–¹æ³•\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003ePromise\u003c/code\u003eç±»å…·æœ‰ä¸¤ä¸ªèƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹çš„é™æ€æ–¹æ³•:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003ePromise.resolve(value)\u003c/li\u003e\n\u003cli\u003ePromise.reject(reason)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eäºŒè€…åŒºåˆ«åœ¨äºè¿”å›çš„\u003ccode\u003epromise\u003c/code\u003eå®ä¾‹çš„çŠ¶æ€,å‰è€…ä¸º\u003ccode\u003efulfilled\u003c/code\u003e,åè€…ä¸º\u003ccode\u003erejected\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ePromise.resolve(value)\u003c/code\u003eå¯ä»¥è§†ä¸ºä»¥ä¸‹ä»£ç çš„ç®€å†™:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"lineNumber\"\u003e1\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eresolve\u003c/span\u003e =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e2\u003c/span\u003e  resolve(value)\n\u003cspan class=\"lineNumber\"\u003e3\u003c/span\u003e})\u003c/code\u003e\u003c/pre\u003e \n\n\u003cp\u003e\u003ccode\u003ePromise.reject(reason)\u003c/code\u003eäº¦ç±»ä¼¼ã€‚\u003c/p\u003e\n\u003cp\u003eå†æ¬¡é‡ç”³ï¼Œä¼ å…¥çš„å®å‚\u003ccode\u003eï¼ˆvalue/reasonï¼‰\u003c/code\u003eå¯ä»¥æœ‰å‡ ç§æƒ…å½¢ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå¦‚æœ\u003ccode\u003evalue\u003c/code\u003eæ˜¯ä¸€ä¸ªåŸå§‹æ•°æ®ç±»å‹çš„å€¼ï¼Œåˆ™è®¾ç½®\u003ccode\u003ePromise\u003c/code\u003eå®ä¾‹å€¼ä¸ºæ­¤å€¼ï¼ŒçŠ¶æ€è®¾ç½®ä¸º\u003ccode\u003efulfilled\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eå¦‚æœ\u003ccode\u003evalue\u003c/code\u003eæ˜¯ä¸€ä¸ª\u003ccode\u003ePromise\u003c/code\u003eå®ä¾‹ï¼Œåˆ™æ²¿ç”¨æ­¤å®ä¾‹çš„çŠ¶æ€å’Œå€¼ã€‚\u003c/li\u003e\n\u003cli\u003eå¦‚æœä¼ å…¥çš„å®å‚æ˜¯ä¸€ä¸ªé\u003ccode\u003ePromise\u003c/code\u003eçš„\u003ccode\u003ethenable\u003c/code\u003eå¯¹è±¡ï¼Œåˆ™è°ƒç”¨æ­¤å¯¹è±¡çš„\u003ccode\u003ethen\u003c/code\u003eæ–¹æ³•ï¼Œå¹¶ä¸”ä¼ å…¥\u003ccode\u003eresolve\u003c/code\u003eå’Œ\u003ccode\u003ereject\u003c/code\u003eä½œä¸ºå®å‚,å°†\u003ccode\u003ethen\u003c/code\u003eæ–¹æ³•ä½œä¸º\u003ccode\u003eexecutor\u003c/code\u003eï¼Œåœ¨å†…éƒ¨å¯ä»¥è®¾ç½®å½“å‰å®ä¾‹çš„çŠ¶æ€å’Œå€¼, å¿…é¡»æ˜¾ç¤ºè°ƒç”¨\u003ccode\u003eresolve\u003c/code\u003eæˆ–è€…\u003ccode\u003ereject\u003c/code\u003eæ–¹æ³•ï¼Œä½¿ç”¨\u003ccode\u003ereturn\u003c/code\u003eå…¶ä»–å€¼åˆ™æ— æ•ˆã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"lineNumber\"\u003e1\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e obj = {\n\u003cspan class=\"lineNumber\"\u003e2\u003c/span\u003e  \u003cspan class=\"hljs-attr\"\u003ename\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e'o'\u003c/span\u003e,\n\u003cspan class=\"lineNumber\"\u003e3\u003c/span\u003e  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e4\u003c/span\u003e    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'this is then'\u003c/span\u003e, \u003cspan class=\"hljs-built_in\"\u003earguments\u003c/span\u003e);\n\u003cspan class=\"lineNumber\"\u003e5\u003c/span\u003e    \u003cspan class=\"hljs-built_in\"\u003earguments\u003c/span\u003e[\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e](\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n\u003cspan class=\"lineNumber\"\u003e6\u003c/span\u003e  }\n\u003cspan class=\"lineNumber\"\u003e7\u003c/span\u003e}\n\u003cspan class=\"lineNumber\"\u003e8\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e p = \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e.resolve(obj)\n\u003cspan class=\"lineNumber\"\u003e9\u003c/span\u003ep\n\u003cspan class=\"lineNumber\"\u003e10\u003c/span\u003e\t.then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003er\u003c/span\u003e =\u003e\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'resolve'\u003c/span\u003e, r))\n\u003cspan class=\"lineNumber\"\u003e11\u003c/span\u003e  .catch(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003er\u003c/span\u003e =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e12\u003c/span\u003e\t\t\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'reject'\u003c/span\u003e, r);\n\u003cspan class=\"lineNumber\"\u003e13\u003c/span\u003e\t})\n\u003cspan class=\"lineNumber\"\u003e14\u003c/span\u003e \n\u003cspan class=\"lineNumber\"\u003e15\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e// output\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e16\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e is then [Arguments] {\n\u003cspan class=\"lineNumber\"\u003e17\u003c/span\u003e  \u003cspan class=\"hljs-string\"\u003e'0'\u003c/span\u003e: [\u003cspan class=\"hljs-built_in\"\u003eFunction\u003c/span\u003e (anonymous)],\n\u003cspan class=\"lineNumber\"\u003e18\u003c/span\u003e  \u003cspan class=\"hljs-string\"\u003e'1'\u003c/span\u003e: [\u003cspan class=\"hljs-built_in\"\u003eFunction\u003c/span\u003e (anonymous)]\n\u003cspan class=\"lineNumber\"\u003e19\u003c/span\u003e}\n\u003cspan class=\"lineNumber\"\u003e20\u003c/span\u003ereject \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e \n\n\u003cp\u003eæ­¤å¤–,\u003ccode\u003ePromise\u003c/code\u003eç±»è¿˜æœ‰å¦‚ä¸‹å‡ ä¸ªé™æ€æ–¹æ³•:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ePromise.all(iterable)\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ePromise.race(iterable)\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ePromise.any(iterable)\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ePromise.allSettled(iterable)\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eè¿™å‡ ä¸ªé™æ€æ–¹æ³•å„æœ‰å…¶åº”ç”¨åœºæ™¯.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eæ˜¯å¦æ”¯æŒè¿™äº›é™æ€æ–¹æ³•å–å†³äºå½“å‰ç¯å¢ƒ,ä¾‹å¦‚åœ¨\u003ccode\u003eIE\u003c/code\u003eæµè§ˆå™¨ä¸‹æ— æ³•ä½¿ç”¨\u003ccode\u003ePromise\u003c/code\u003eï¼Œåœ¨\u003ccode\u003eNode14\u003c/code\u003eä¸‹æ— æ³•ä½¿ç”¨\u003ccode\u003ePromise.allSettled\u003c/code\u003eï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“æ¥è¿›è¡Œæ›¿æ¢ï¼Œä¾‹å¦‚\u003ccode\u003ebluebird\u003c/code\u003eã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch3\u003e2.2.1 all\u003c/h3\u003e\n\u003cp\u003eé¦–å…ˆ,\u003ccode\u003ePromise.all(iterable)\u003c/code\u003eæ–¹æ³•æ¥æ”¶ä¸€ä¸ª\u003ccode\u003eiterable\u003c/code\u003eå¯¹è±¡ï¼ˆé€šå¸¸æ˜¯æ•°ç»„ï¼‰ä½œä¸ºå‚æ•°,æœ€ç»ˆè¿”å›ä¸€ä¸ªæ–°çš„\u003ccode\u003epromise å®ä¾‹\u003c/code\u003e.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eå¦‚æœ\u003ccode\u003eiterable\u003c/code\u003eå¯¹è±¡æ˜¯ç©ºçš„,åˆ™è¿”å›çš„ç»“æœæ˜¯ç©ºæ•°ç»„(å°½ç®¡æˆ‘ä»¬ä¸å¤ªä¼šè¿™ä¹ˆåš).\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eæˆ‘ä»¬é€šè¿‡ç¤ºä¾‹ä»£ç æ¥ç†è§£è§„èŒƒ:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"lineNumber\"\u003e1\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e p1 = \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e.all([\n\u003cspan class=\"lineNumber\"\u003e2\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e,\n\u003cspan class=\"lineNumber\"\u003e3\u003c/span\u003e  \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e.resolve(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e)\n\u003cspan class=\"lineNumber\"\u003e4\u003c/span\u003e])\u003c/code\u003e\u003c/pre\u003e \n\n\u003cp\u003eåˆæˆçš„\u003ccode\u003ePromise\u003c/code\u003eå°†åœ¨æ‰€æœ‰å†…éƒ¨\u003ccode\u003ePromise\u003c/code\u003eå®ä¾‹è½¬åŒ–ä¸º\u003ccode\u003eFulfilled\u003c/code\u003eçŠ¶æ€åè½¬æ¢ä¸º\u003ccode\u003eFulfilled\u003c/code\u003eçŠ¶æ€ï¼Œå…¶å€¼æ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡è½¬åŒ–ä¸º\u003ccode\u003ePromise\u003c/code\u003eè§£å†³ä¹‹åçš„å€¼çš„æ•°ç»„ã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eå¯è¿­ä»£å¯¹è±¡å°†ä¼šé€šè¿‡\u003ccode\u003ePromise.resolve\u003c/code\u003eæ–¹æ³•è½¬æ¢ä¸º\u003ccode\u003ePromise\u003c/code\u003eå®ä¾‹ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eå¦‚æœä¸€æ—¦å…¶ä¸­ä¹‹ä¸€å‡ºç°\u003ccode\u003erejected\u003c/code\u003eçŠ¶æ€çš„\u003ccode\u003epromise å®ä¾‹\u003c/code\u003e,åˆ™åˆæˆçš„\u003ccode\u003ePromise\u003c/code\u003eå®ä¾‹çš„çŠ¶æ€è½¬åŒ–ä¸º\u003ccode\u003erejected\u003c/code\u003e,ä¸”å€¼ä¸ºæœ€å…ˆå‡ºç°çš„\u003ccode\u003erejected\u003c/code\u003eçŠ¶æ€å®ä¾‹çš„å€¼.\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬å¯ä»¥ä½¿ç”¨\u003ccode\u003ePromise.all\u003c/code\u003eæ¥æ‰§è¡Œä¸€ç»„å¼‚æ­¥æ“ä½œ,è¿™äº›æ“ä½œçš„æ—¶é—´èŠ±è´¹å–å†³äºæœ€é•¿çš„é‚£ä¸ªå…ƒç´ ,å¹¶ä¸”æœ€ç»ˆå¦‚æœä¸€åˆ‡é¡ºåˆ©,åˆ™ç»“æœçš„é¡ºåºæ˜¯ä¸å˜çš„.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ePromise.all()\u003c/code\u003eæ–¹æ³•é€‚ç”¨äº\u003ccode\u003eåˆå¹¶è¯·æ±‚\u003c/code\u003eçš„åœºæ™¯,ä¾‹å¦‚æŸäº›é¡¹ç›®ä¸­,æäº¤çš„å¤šä¸ªæ•°æ®éœ€è¦è°ƒç”¨äº‘ç«¯æ¥å£è¿›è¡Œæ•°æ®æ ¡éªŒ,å½“æ‰€æœ‰æ•°æ®éƒ½é€šè¿‡æ ¡éªŒçš„æ—¶å€™æ‰èƒ½æ‰§è¡Œä¸‹ä¸€æ­¥æ“ä½œ,æ¥çœ‹çœ‹ä»£ç :\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"lineNumber\"\u003e1\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e// æœ‰ä¸€ä¸ªè¿”å› promise å¯¹è±¡çš„ asyncApi å‡½æ•°\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e2\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e// æ¯ä¸€ä¸ª test å‡½æ•°éƒ½æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„æµ‹è¯•\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e3\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e test = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003evalue\u003c/span\u003e) =\u003e\u003c/span\u003e asyncApi(value)\n\u003cspan class=\"lineNumber\"\u003e4\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e.all([\n\u003cspan class=\"lineNumber\"\u003e5\u003c/span\u003e  test(\u003cspan class=\"hljs-string\"\u003e'xxx'\u003c/span\u003e),\n\u003cspan class=\"lineNumber\"\u003e6\u003c/span\u003e  test(\u003cspan class=\"hljs-string\"\u003e'xx'\u003c/span\u003e),\n\u003cspan class=\"lineNumber\"\u003e7\u003c/span\u003e  test(\u003cspan class=\"hljs-string\"\u003e'x'\u003c/span\u003e)\n\u003cspan class=\"lineNumber\"\u003e8\u003c/span\u003e]).then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eresults\u003c/span\u003e =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e9\u003c/span\u003e  results.forEach(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eresult\u003c/span\u003e =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e10\u003c/span\u003e    \u003cspan class=\"hljs-comment\"\u003e// balabala ä½ çš„ä»£ç é€»è¾‘\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e11\u003c/span\u003e    \u003cspan class=\"hljs-comment\"\u003e// éƒ½é€šè¿‡äº†\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e12\u003c/span\u003e  })\n\u003cspan class=\"lineNumber\"\u003e13\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e// do more...\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e14\u003c/span\u003e}).catch(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eerror\u003c/span\u003e =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e15\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e// å¤±è´¥çš„å€¼, balabala\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e16\u003c/span\u003e  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(error)\n\u003cspan class=\"lineNumber\"\u003e17\u003c/span\u003e})\u003c/code\u003e\u003c/pre\u003e \n\n\u003ch3\u003e2.2.2 race\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003ePromise.race(iterable)\u003c/code\u003eå¦‚å…¶å,ç±»ä¼¼äº\u003ccode\u003ePromise.all()\u003c/code\u003e,æ¥æ”¶åŒç±»å‹å‚æ•°,ä¸€æ—¦è¿­ä»£å™¨ä¸­æŸä¸ª\u003ccode\u003epromise\u003c/code\u003eçŠ¶æ€è½¬åŒ–ä¸º\u003ccode\u003esettled\u003c/code\u003e,ç«‹å³è¿”å›æ­¤\u003ccode\u003ePromise\u003c/code\u003eå®ä¾‹.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eä¼ å…¥çš„è¿­ä»£ä¸ºç©ºçš„è¯,è¿”å›çš„\u003ccode\u003epromise\u003c/code\u003eå§‹ç»ˆ\u003ccode\u003epending\u003c/code\u003e.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003ccode\u003ePromise.race()\u003c/code\u003eéå¸¸é€‚åˆåšå¼‚æ­¥è¯·æ±‚çš„\u003ccode\u003eè¶…æ—¶\u003c/code\u003eå¤„ç†.æ¥çœ‹ä¸€ä¸ªä¾‹å­:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"lineNumber\"\u003e1\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e// asyncApi() è¿”å› promise\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e2\u003c/span\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003etimeout\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ems\u003c/span\u003e) \u003c/span\u003e{\n\u003cspan class=\"lineNumber\"\u003e3\u003c/span\u003e  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresolve, reject\u003c/span\u003e) =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e4\u003c/span\u003e    \u003cspan class=\"hljs-built_in\"\u003esetTimeout\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e5\u003c/span\u003e      reject(\u003cspan class=\"hljs-string\"\u003e`timeout: \u003cspan class=\"hljs-subst\"\u003e${ms}\u003c/span\u003e ms`\u003c/span\u003e)\n\u003cspan class=\"lineNumber\"\u003e6\u003c/span\u003e    }, ms)\n\u003cspan class=\"lineNumber\"\u003e7\u003c/span\u003e  })\n\u003cspan class=\"lineNumber\"\u003e8\u003c/span\u003e}\n\u003cspan class=\"lineNumber\"\u003e9\u003c/span\u003e \n\u003cspan class=\"lineNumber\"\u003e10\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e.race([\n\u003cspan class=\"lineNumber\"\u003e11\u003c/span\u003e  asyncApi(\u003cspan class=\"hljs-string\"\u003e'xx'\u003c/span\u003e),\n\u003cspan class=\"lineNumber\"\u003e12\u003c/span\u003e  timeout(\u003cspan class=\"hljs-number\"\u003e5000\u003c/span\u003e)\n\u003cspan class=\"lineNumber\"\u003e13\u003c/span\u003e]).then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eres\u003c/span\u003e =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e14\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e// success\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e15\u003c/span\u003e}).catch(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eerror\u003c/span\u003e =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e16\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e// timeout or error\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e17\u003c/span\u003e})\u003c/code\u003e\u003c/pre\u003e \n\n\u003ch3\u003e2.2.3 any\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003ePromise.any(iterable)\u003c/code\u003eæ˜¯\u003ccode\u003ePromise.all()\u003c/code\u003eçš„åé¢,å…¶è¯­æ³•æ— å¼‚.\u003c/p\u003e\n\u003cp\u003eéœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœä¼ å…¥çš„è¿­ä»£å™¨æ˜¯ç©ºçš„,åˆ™è¿”å›\u003ccode\u003erejected\u003c/code\u003eçš„\u003ccode\u003epromise \u003c/code\u003eå®ä¾‹.åªè¦æœ‰ä¸€ä¸ªæˆåŠŸ,åˆ™è¿”å›æ­¤ç»“æœ.å¦‚æœè¿­ä»£å™¨å†…çš„\u003ccode\u003epromise\u003c/code\u003eå…¨éƒ¨è¿”å›\u003ccode\u003erejected\u003c/code\u003eçŠ¶æ€,åˆ™æœ€ç»ˆè¿”å›\u003ccode\u003erejected\u003c/code\u003eçš„\u003ccode\u003epromise\u003c/code\u003eå®ä¾‹.\u003c/p\u003e\n\u003cp\u003eå› æ­¤,æ­¤æ–¹æ³•é€‚ç”¨äºéªŒè¯å¤šä¸ªå¼‚æ­¥ç»“æœä¸­æ˜¯å¦æœ‰\u003ccode\u003efulfilled\u003c/code\u003eçš„\u003ccode\u003epromise\u003c/code\u003eå®ä¾‹.\u003c/p\u003e\n\u003cp\u003eå¦‚æœæˆ‘ä»¬éœ€è¦å‘å¤šä¸ªæ•°æ®æºè·å–æŸä¸€ä¸ªæ•°æ®,åˆ™å¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•æœ€å¿«é€Ÿçš„è·å–åˆ°æ•°æ®,äº¦æˆ–è€…æ‰€æœ‰å¼‚æ­¥è¯·æ±‚éƒ½å¤±è´¥.\u003c/p\u003e\n\u003ch3\u003e2.2.4 allSettled\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003ePromise.allSettled(iterable)\u003c/code\u003eæ–¹æ³•è¿”å›ä¸€ä¸ªåœ¨æ‰€æœ‰ç»™å®šçš„\u003ccode\u003epromise\u003c/code\u003eè½¬ä¸º\u003ccode\u003esettled\u003c/code\u003eçŠ¶æ€åçš„æ•°ç»„,æ•°ç»„å…ƒç´ æ˜¯æ¯ä¸€ä¸ª\u003ccode\u003epromise\u003c/code\u003eç»“æœ.\u003c/p\u003e\n\u003cp\u003eå¦‚æœæˆ‘ä»¬æœ‰å¤šä¸ªäº’ä¸ä¾èµ–çš„\u003ccode\u003eå¼‚æ­¥ä»»åŠ¡\u003c/code\u003e,æˆ–è€…æˆ‘ä»¬æ€»æƒ³çŸ¥é“æ¯ä¸ª\u003ccode\u003epromise\u003c/code\u003eçš„ç»“æœ,è€Œä¸éœ€è¦å…¶ä¸­çš„\u003ccode\u003erejected\u003c/code\u003eçŠ¶æ€\u003ccode\u003epromise\u003c/code\u003eå»å¼•å‘\u003ccode\u003ecatch\u003c/code\u003e,æ¥çœ‹çœ‹\u003ccode\u003eMDN\u003c/code\u003eçš„ä¾‹å­:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"lineNumber\"\u003e1\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e promise1 = \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e.resolve(\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e);\n\u003cspan class=\"lineNumber\"\u003e2\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e promise2 = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresolve, reject\u003c/span\u003e) =\u003e\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003esetTimeout\u003c/span\u003e(reject, \u003cspan class=\"hljs-number\"\u003e100\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'foo'\u003c/span\u003e));\n\u003cspan class=\"lineNumber\"\u003e3\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e promises = [promise1, promise2];\n\u003cspan class=\"lineNumber\"\u003e4\u003c/span\u003e \n\u003cspan class=\"lineNumber\"\u003e5\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e.allSettled(promises).\n\u003cspan class=\"lineNumber\"\u003e6\u003c/span\u003e  then(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresults\u003c/span\u003e) =\u003e\u003c/span\u003e results.forEach(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresult\u003c/span\u003e) =\u003e\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(result)));\u003c/code\u003e\u003c/pre\u003e \n\n\u003cp\u003eè¾“å‡ºæ˜¯:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-shell\"\u003e\u003cspan class=\"lineNumber\"\u003e1\u003c/span\u003e\u003cspan class=\"hljs-meta\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"bash\"\u003e Object { status: \u003cspan class=\"hljs-string\"\u003e\"fulfilled\"\u003c/span\u003e, value: 3 }\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e2\u003c/span\u003e\u003cspan class=\"hljs-meta\"\u003e\u003e\u003c/span\u003e\u003cspan class=\"bash\"\u003e Object { status: \u003cspan class=\"hljs-string\"\u003e\"rejected\"\u003c/span\u003e, reason: \u003cspan class=\"hljs-string\"\u003e\"foo\"\u003c/span\u003e }\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e \n\n\u003cp\u003eå¦‚ä¸Šæ‰€ç¤º,çŠ¶æ€ä¸º\u003ccode\u003efulfilled\u003c/code\u003eæ—¶,å…·æœ‰\u003ccode\u003evalue\u003c/code\u003e,çŠ¶æ€ä¸º\u003ccode\u003erejected\u003c/code\u003eæ—¶,å…·æœ‰\u003ccode\u003ereason\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eè¿˜è®°å¾—æˆ‘ä»¬åœ¨\u003ccode\u003ePromise.all()\u003c/code\u003eä¸­çš„è¿­ä»£å™¨è¿”å›çš„æ˜¯\u003ccode\u003epromise.catch(err =\u003e err)\u003c/code\u003eå—?å…¶å®,ä½¿ç”¨\u003ccode\u003ePromise.allSettled()\u003c/code\u003eç›¸å¯¹æ›´å¥½.\u003c/p\u003e\n\u003ch2\u003e2.3 Promise çš„ä¼˜åŠ£\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003ePromise\u003c/code\u003eçš„å‡ºç°ä¿ƒè¿›äº†\u003ccode\u003eå¼‚æ­¥\u003c/code\u003eç¼–ç¨‹çš„å‘å±•,æˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨ç«¯å’Œ\u003ccode\u003enode\u003c/code\u003eç«¯çœ‹åˆ°ç»Ÿä¸€çš„\u003ccode\u003ePromise\u003c/code\u003eä»£ç .è¿˜è®°å¾—\u003ccode\u003ecallback\u003c/code\u003eå›è°ƒå‡½æ•°çš„å‚æ•°çº¦å®šå—?\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"lineNumber\"\u003e1\u003c/span\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003efoo\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eparam, (err, data) =\u003e {\n\u003cspan class=\"lineNumber\"\u003e2\u003c/span\u003e  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(err) {\n\u003cspan class=\"lineNumber\"\u003e3\u003c/span\u003e    \u003cspan class=\"hljs-regexp\"\u003e//\u003c/span\u003e balabala\n\u003cspan class=\"lineNumber\"\u003e4\u003c/span\u003e  }\n\u003cspan class=\"lineNumber\"\u003e5\u003c/span\u003e  \u003cspan class=\"hljs-regexp\"\u003e//\u003c/span\u003e balabala\n\u003cspan class=\"lineNumber\"\u003e6\u003c/span\u003e}\u003c/span\u003e)\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e \n\n\u003cp\u003eè¿™ç§å‚æ•°çº¦å®šæ˜¯è„†å¼±çš„,å¼€å‘è€…å¯ä»¥ä¸æŒ‰æ­¤çº¦å®šç¼–å†™å›è°ƒå‡½æ•°,è¿™ç±»éšè—\u003ccode\u003ebug\u003c/code\u003eå¯èƒ½å°±æ­¤è€Œç”Ÿ.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ePromise\u003c/code\u003eçš„å‡ºç°,æˆ‘ä»¬å¿…é¡»ä½¿ç”¨å…¶å®ä¾‹æ–¹æ³•\u003ccode\u003ethen\u003c/code\u003eå’Œ\u003ccode\u003ecatch\u003c/code\u003eå»æŒ‰è§„èŒƒç¼–ç ,å¦åˆ™å°†ä¼šå‡ºé”™,å¼€å‘è€…ä¹Ÿå¯ä»¥çœ‹åˆ°æ˜æ˜¾çš„é”™è¯¯æç¤ºä¿¡æ¯.\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬å†æ¥çœ‹çœ‹å¦‚ä¸‹ä¸¤ä¸ªä¾‹å­:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"lineNumber\"\u003e1\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e// callback\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e2\u003c/span\u003efs.readFile(name, opts?, \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eerr, string|Buffer\u003c/span\u003e) =\u003e\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003evoid\u003c/span\u003e)\n\u003cspan class=\"lineNumber\"\u003e3\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e// Promise\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e4\u003c/span\u003ereadFilePromisified(name, opts?): \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e\u0026#x3C;string | Buffer\u003e\u003c/code\u003e\u003c/pre\u003e \n\n\u003cp\u003e\u003ccode\u003ePromise\u003c/code\u003eæ–¹æ¡ˆè®©å‡½æ•°å‚æ•°å’Œå›è°ƒè§£è€¦å¼€æ¥,æ‰€æœ‰çš„å‚æ•°éƒ½ç”¨äºæ­¤å‡½æ•°çš„è¾“å…¥.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ePromise\u003c/code\u003eåœ¨å¤„ç†å•æ¬¡å¼‚æ­¥ä»»åŠ¡çš„æ—¶å€™è¡¨ç°è‰¯å¥½,ä½†æ˜¯å¯¹äºå¤šæ¬¡è§¦å‘çš„ä»»åŠ¡ä¾¿æ˜¾å¾—ä¹åŠ›,ä¹Ÿè®¸æˆ‘ä»¬éœ€è¦å­¦ä¹ ä¸€äº›\u003ccode\u003eå“åº”å¼ç¼–ç¨‹\u003c/code\u003eæŠ€æœ¯,ä»¥è§£å†³æ­¤ç±»é—®é¢˜.\u003c/p\u003e\n\u003cp\u003eå¯¹äº\u003ccode\u003eES6 Promise\u003c/code\u003eæ¥è¯´,ç¼ºä¹ä¸¤é¡¹å¾ˆå®ç”¨çš„åŠŸèƒ½:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå–æ¶ˆä»»åŠ¡(åœ¨ç»„ä»¶è¢«åˆ é™¤åå–æ¶ˆå¼‚æ­¥ä»»åŠ¡ç­‰)ï¼ŒTC39 å§”å‘˜ä¼šå®é™…ä¸Šå‡†å¤‡å¢åŠ æ­¤ç‰¹æ€§ï¼Œä½†æœ€ç»ˆææ¡ˆè¢«æ’¤å›äº†ï¼Œä½†æ˜¯æ²¡å…³ç³»ï¼Œ\u003ccode\u003eBluebird\u003c/code\u003eå®ç°äº†æ­¤åŠŸèƒ½ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹æ­¤ç‰¹æ€§è¿›è¡Œè¡¥å……ï¼Œä¾‹å¦‚åˆ©ç”¨\u003ccode\u003esetTimeout\u003c/code\u003eå®šæ—¶å™¨å‡½æ•°å¯ä»¥è¢«å–æ¶ˆçš„ç‰¹æ€§ï¼Œç¼–å†™ä¸€äº›é€»è¾‘ä»£ç å’Œ\u003ccode\u003ePromise\u003c/code\u003eå–æ¶ˆçŠ¶æ€è½¬æ¢çš„åŠŸèƒ½å‡½æ•°ã€‚\u003c/li\u003e\n\u003cli\u003eè¿›åº¦è¿½è¸ª(æ˜¾ç¤ºè¿›åº¦æ¡ç­‰)ï¼ŒåŸç”Ÿä¸æ”¯æŒæ­¤ç‰¹æ€§çš„åŸå› æ˜¯æ‹…å¿ƒæ­¤ç‰¹æ€§ä¼šå¯¼è‡´\u003ccode\u003ePromise\u003c/code\u003eçš„é“¾å¼è°ƒç”¨å’Œç±»ä¼¼\u003ccode\u003eall\u003c/code\u003eé™æ€æ–¹æ³•çš„å¤æ‚åº¦å¢åŠ ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eåŸç”Ÿ\u003ccode\u003ePromise\u003c/code\u003eæš‚æœªæ”¯æŒä¸Šè¿°ä¸¤é¡¹ç‰¹æ€§,ä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥çœ‹çœ‹ç±»ä¼¼\u003ccode\u003eBluebird\u003c/code\u003eè¿™æ ·çš„ç¬¬ä¸‰æ–¹åº“ï¼Œå®ƒä»¬åŠŸèƒ½å¼ºå¤§å¹¶ä¸”è¢«å¹¿æ³›ä½¿ç”¨ï¼Œå€¼å¾—ä¿¡èµ–ã€‚\u003c/p\u003e\n\u003ch1\u003e3. async / await\u003c/h1\u003e\n\u003cp\u003eæåŠå¼‚æ­¥å‡½æ•°ï¼Œ\u003ccode\u003easync/await\u003c/code\u003eè¯­æ³•å…³é”®å­—ä¸€å®šæ˜¯ç»•ä¸å¼€çš„çŸ¥è¯†ç‚¹ï¼Œè¿™æ˜¯ä¸€ç§ä½¿ç”¨ \u003ccode\u003ePromise\u003c/code\u003eçš„ç‰¹æ®Šè¯­æ³•ï¼Œå¹¶ä¸”éå¸¸å®¹æ˜“ç†è§£å’Œä½¿ç”¨ã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬ç›´æ¥çœ‹ç¤ºä¾‹ï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"lineNumber\"\u003e1\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003efoo\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u003cspan class=\"lineNumber\"\u003e2\u003c/span\u003e  \u003cspan class=\"hljs-comment\"\u003e// balabala\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e3\u003c/span\u003e  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n\u003cspan class=\"lineNumber\"\u003e4\u003c/span\u003e}\u003c/code\u003e\u003c/pre\u003e \n\n\u003cblockquote\u003e\n\u003cp\u003eå¯ä»¥ç†è§£ä¸º async å‡½æ•°æœ€åæ˜¾å¼è¿”å›çš„å€¼ç»è¿‡ Promise.resolve å‡½æ•°çš„è½¬åŒ–ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ Promise å®ä¾‹\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eåœ¨å‡½æ•°å‰æ·»åŠ \u003ccode\u003easync\u003c/code\u003eæ ‡è¯†æ­¤å‡½æ•°æ€»æ˜¯è¿”å›ä¸€ä¸ª\u003ccode\u003ePromise\u003c/code\u003eå®ä¾‹,å³ä½¿æˆ‘ä»¬æ˜¾ç¤ºæŒ‡å®šå…¶ä»–çš„ç±»å‹å€¼çš„è¿”å›å€¼ï¼Œä¹Ÿä¼šè¢«åŒ…è£…æˆä¸€ä¸ª\u003ccode\u003ePromise\u003c/code\u003eå¹¶è¿”å›ï¼Œå½“ç„¶ï¼Œä¾ç„¶æ¨èæ˜¾ç¤ºåœ°æŒ‡å®šè¿”å›\u003ccode\u003ePromise\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cp\u003eä½¿ç”¨\u003ccode\u003easync\u003c/code\u003eå…³é”®å­—å¯ä»¥è®©å‡½æ•°å…·æœ‰\u003ccode\u003eå¼‚æ­¥\u003c/code\u003eç‰¹å¾ï¼Œä½†æ€»ä½“ä¸Šä»£ç ä¾ç„¶æ˜¯\u003ccode\u003eåŒæ­¥\u003c/code\u003eæ±‚å€¼çš„ã€‚\u003c/p\u003e\n\u003cp\u003eä¸¾ä¸ªä¾‹å­ï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"lineNumber\"\u003e1\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003efoo\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u003cspan class=\"lineNumber\"\u003e2\u003c/span\u003e  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n\u003cspan class=\"lineNumber\"\u003e3\u003c/span\u003e}\n\u003cspan class=\"lineNumber\"\u003e4\u003c/span\u003efoo()\n\u003cspan class=\"lineNumber\"\u003e5\u003c/span\u003e\u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e)\n\u003cspan class=\"lineNumber\"\u003e6\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e// output\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e7\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e8\u003c/span\u003e\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e \n\n\u003cblockquote\u003e\n\u003cp\u003eå¼‚æ­¥å‡½æ•°å…·æœ‰æš‚åœå’Œæ¢å¤æ‰§è¡Œçš„åŠŸèƒ½æ˜¯ååˆ†å¿…è¦çš„ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eä½¿ç”¨\u003ccode\u003eawait\u003c/code\u003eå…³é”®å­—å¯ä»¥æš‚åœå¼‚æ­¥å‡½æ•°çš„æ‰§è¡Œå¹¶ä¸”ç­‰å¾…è¿”å›çš„\u003ccode\u003ePromise\u003c/code\u003eå®ä¾‹è¿›å…¥\u003ccode\u003esettled\u003c/code\u003eçŠ¶æ€ã€‚\u003c/p\u003e\n\u003cp\u003eå…³é”®è¯\u003ccode\u003eawait\u003c/code\u003eåªåœ¨\u003ccode\u003easync\u003c/code\u003eå‡½æ•°å†…æœ‰æ•ˆï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"lineNumber\"\u003e1\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003efoo\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u003cspan class=\"lineNumber\"\u003e2\u003c/span\u003e  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e res = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e axios.get(\u003cspan class=\"hljs-string\"\u003e'your url'\u003c/span\u003e)\n\u003cspan class=\"lineNumber\"\u003e3\u003c/span\u003e}\u003c/code\u003e\u003c/pre\u003e \n\n\u003cp\u003eåœ¨æ—¥å¸¸å·¥ä½œä¸­æ— è®ºæ˜¯æµè§ˆå™¨è¿˜æ˜¯\u003ccode\u003eNodejs\u003c/code\u003eï¼Œéƒ½å¯ä»¥çœ‹åˆ°\u003ccode\u003eawait\u003c/code\u003eçš„èº«å½±ã€‚\u003c/p\u003e\n\u003cp\u003eé‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬æ›´æ¨èä½¿ç”¨\u003ccode\u003easync/await\u003c/code\u003eè¯­æ³•ï¼Œå®ƒåˆæœ‰æ€æ ·çš„ç»†èŠ‚éœ€è¦æˆ‘ä»¬å…³æ³¨çš„å‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eæ¥çœ‹ä»¥ä¸‹å‡ ç‚¹ç‰¹æ€§ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eé¡¶å±‚\u003ccode\u003eawait\u003c/code\u003eï¼šæ­¤ææ¡ˆå½“å‰ä¾ç„¶æ˜¯ \u003ccode\u003estage 3\u003c/code\u003eï¼Œåœ¨æ­£å¼è¿›å…¥ç¨³å®šç‰ˆä¹‹å‰ï¼Œé¡¶å±‚å¯¹äº\u003ccode\u003eawait\u003c/code\u003eçš„ä½¿ç”¨ä¾ç„¶éœ€è¦ç«‹å³æ‰§è¡Œè¡¨è¾¾å¼ï¼ˆIIFEï¼‰ï¼Œä¸å¹¸çš„æ˜¯ï¼Œè¿™ç§æ¨¡å¼å¯¼è‡´å›¾å½¢æ‰§è¡Œå’Œåº”ç”¨ç¨‹åºçš„é™æ€å¯åˆ†ææ€§çš„ç¡®å®šæ€§é™ä½ã€‚ç”±äºè¿™äº›åŸå› ï¼Œç¼ºå°‘é¡¶å±‚ \u003ccode\u003eawait\u003c/code\u003e è¢«è®¤ä¸ºæ¯”è¯¥åŠŸèƒ½å¸¦æ¥çš„å±å®³æœ‰æ›´é«˜çš„é£é™©ã€‚\u003c/li\u003e\n\u003cli\u003eé¡¶å±‚ \u003ccode\u003eawait\u003c/code\u003e ä»…é™äº ES æ¨¡å—ã€‚æ˜ç¡®ä¸æ”¯æŒ\u003ccode\u003eCommonJS\u003c/code\u003eæ¨¡å—ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eawait\u003c/code\u003eæ”¯æŒ\u003ccode\u003ethenable\u003c/code\u003eå¯¹è±¡,å¦‚æœå…¶åæ˜¯ä¸€ä¸ª\u003ccode\u003ethenable\u003c/code\u003eå¯¹è±¡ï¼Œåˆ™ä¼šæ‰§è¡Œæ­¤å¯¹è±¡çš„\u003ccode\u003ethen\u003c/code\u003eæ–¹æ³•ï¼Œå¹¶ä¸”ä¼ å…¥\u003ccode\u003eresolve\u003c/code\u003eå’Œ\u003ccode\u003ereject\u003c/code\u003eå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ª\u003ccode\u003esettled\u003c/code\u003eçš„\u003ccode\u003ePromise\u003c/code\u003eå®ä¾‹ã€‚\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eawait\u003c/code\u003eå’Œ\u003ccode\u003ePromise.all\u003c/code\u003eç­‰é™æ€æ–¹æ³•é…åˆè‰¯å¥½ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"lineNumber\"\u003e1\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e res = \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e.all([\n\u003cspan class=\"lineNumber\"\u003e2\u003c/span\u003e  promise1,\n\u003cspan class=\"lineNumber\"\u003e3\u003c/span\u003e  promise2,\n\u003cspan class=\"lineNumber\"\u003e4\u003c/span\u003e  ...\n\u003cspan class=\"lineNumber\"\u003e5\u003c/span\u003e])\u003c/code\u003e\u003c/pre\u003e \n\n\u003cul\u003e\n\u003cli\u003eError å¤„ç†\u003c/li\u003e\n\u003c/ul\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003easync/await\u003c/code\u003eé…åˆ\u003ccode\u003etry...catch..\u003c/code\u003eå¯ä»¥æ›´æ¸…æ™°åœ°åŒæ—¶å¤„ç†åŒæ­¥å’Œå¼‚æ­¥çš„å¼‚å¸¸\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"lineNumber\"\u003e1\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e makeRequest = \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e () =\u003e {\n\u003cspan class=\"lineNumber\"\u003e2\u003c/span\u003e  \u003cspan class=\"hljs-keyword\"\u003etry\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e3\u003c/span\u003e    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e data = \u003cspan class=\"hljs-built_in\"\u003eJSON\u003c/span\u003e.parse(\u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e getJSON())\n\u003cspan class=\"lineNumber\"\u003e4\u003c/span\u003e    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(data)\n\u003cspan class=\"lineNumber\"\u003e5\u003c/span\u003e  } \u003cspan class=\"hljs-keyword\"\u003ecatch\u003c/span\u003e (e) {\n\u003cspan class=\"lineNumber\"\u003e6\u003c/span\u003e    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(e)\n\u003cspan class=\"lineNumber\"\u003e7\u003c/span\u003e  }\n\u003cspan class=\"lineNumber\"\u003e8\u003c/span\u003e}\u003c/code\u003e\u003c/pre\u003e \n\n\u003cp\u003eæ— è®ºæ˜¯å¼‚æ­¥å‡½æ•°\u003ccode\u003egetJSON()\u003c/code\u003eè¿˜æ˜¯åŒæ­¥å‡½æ•°\u003ccode\u003eJSON.parse()\u003c/code\u003eéƒ½èƒ½è¢«åŒä¸€ä¸ª\u003ccode\u003etry...catch...\u003c/code\u003eç»“æ„å¯¹å¼‚å¸¸è¿›è¡Œå¤„ç†ï¼Œä»£ç é€»è¾‘ç›¸å¯¹ä½¿ç”¨\u003ccode\u003ePromise.then / catch\u003c/code\u003eçš„æ–¹å¼æ¥è¯´ä¼šæ›´æ¸…æ™°ï¼Œå¯è¯»æ€§æ›´å¼ºã€‚\u003c/p\u003e\n\u003cp\u003eä¹Ÿè®¸å¯è¯»æ€§çš„è¯„åˆ¤æ›´å®¹æ˜“æºæ‚ä¸»è§‚æ„è¯†ï¼Œä½†æ˜¯å¯¹äºå¼‚æ­¥\u003ccode\u003eDebug\u003c/code\u003eä»£ç æ¥è¯´ï¼Œ\u003ccode\u003easync/await\u003c/code\u003eæ˜¾ç„¶æ›´è½»æ¾ã€‚\u003c/p\u003e\n\u003cp\u003eä¸ºä»€ä¹ˆï¼Ÿæˆ‘æƒ³æœ‰ä»¥ä¸‹ä¸¤ç‚¹ç†ç”±ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eåœ¨\u003ccode\u003ethen\u003c/code\u003eä¸­éš¾ä»¥å¯¹ç®­å¤´å‡½æ•°ä¸‹æ–­ç‚¹\u003c/li\u003e\n\u003cli\u003eå³ä½¿æ˜¯åœ¨ \u003ccode\u003ethen\u003c/code\u003eä¸­ä¸‹äº†æ–­ç‚¹ï¼Œç±»ä¼¼å•æ­¥æ­¥å…¥çš„æ“ä½œä¹Ÿä¸ä¼šå¾—åˆ°é¢„æœŸçš„ç»“æœï¼ŒåŸå› åœ¨äºè¿™ç§è°ƒè¯•æ–¹å¼åªèƒ½åœ¨åŒæ­¥ä»£ç ä¸­ä½¿ç”¨ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eæˆ‘ä»¬æ¥çœ‹ä¸¤ä¸ªç¤ºä¾‹ï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"lineNumber\"\u003e1\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e makeRequest = \u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e2\u003c/span\u003e   \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e callAPromise()\n\u003cspan class=\"lineNumber\"\u003e3\u003c/span\u003e     .then(\u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e callAPromise())\n\u003cspan class=\"lineNumber\"\u003e4\u003c/span\u003e     .then(\u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e callAPromise())\n\u003cspan class=\"lineNumber\"\u003e5\u003c/span\u003e}\n\u003cspan class=\"lineNumber\"\u003e6\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e// async / await\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e7\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e makeRequest = \u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e() =\u003e {\n\u003cspan class=\"lineNumber\"\u003e8\u003c/span\u003e   \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e callAPromise()\n\u003cspan class=\"lineNumber\"\u003e9\u003c/span\u003e   \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e callAPromise()\n\u003cspan class=\"lineNumber\"\u003e10\u003c/span\u003e}\u003c/code\u003e\u003c/pre\u003e \n\n\u003cp\u003eåœ¨è°ƒè¯•è¿‡ç¨‹ä¸­ç”±äº\u003ccode\u003eawait\u003c/code\u003eçš„ç‰¹æ®Šæ€§ï¼Œæˆ‘ä»¬å¯ä»¥åƒè°ƒè¯•åŒæ­¥ä»£ç è¿™ä¹ˆæ–¹ä¾¿è‡ªç„¶ã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eå¦å¤–ï¼Œä½¿ç”¨\u003ccode\u003easync / await\u003c/code\u003eè¯­æ³•ï¼Œæˆ‘ä»¬åº”è¯¥ç•™å¿ƒå¼‚æ­¥ä»£ç çš„å¹³è¡ŒåŠ é€Ÿé—®é¢˜ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eæ¥çœ‹ç¤ºä¾‹ï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"lineNumber\"\u003e1\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edelay\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eid\u003c/span\u003e) \u003c/span\u003e{\n\u003cspan class=\"lineNumber\"\u003e2\u003c/span\u003e  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eres\u003c/span\u003e) =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e3\u003c/span\u003e    \u003cspan class=\"hljs-built_in\"\u003esetTimeout\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e() =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e4\u003c/span\u003e      \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e`task \u003cspan class=\"hljs-subst\"\u003e${id}\u003c/span\u003e finished.`\u003c/span\u003e)\n\u003cspan class=\"lineNumber\"\u003e5\u003c/span\u003e    }, \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e)\n\u003cspan class=\"lineNumber\"\u003e6\u003c/span\u003e  })\n\u003cspan class=\"lineNumber\"\u003e7\u003c/span\u003e}\n\u003cspan class=\"lineNumber\"\u003e8\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edemo1\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u003cspan class=\"lineNumber\"\u003e9\u003c/span\u003e  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e delay(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n\u003cspan class=\"lineNumber\"\u003e10\u003c/span\u003e  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e delay(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e)\n\u003cspan class=\"lineNumber\"\u003e11\u003c/span\u003e  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e delay(\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e)\n\u003cspan class=\"lineNumber\"\u003e12\u003c/span\u003e}\n\u003cspan class=\"lineNumber\"\u003e13\u003c/span\u003edemo1()\n\u003cspan class=\"lineNumber\"\u003e14\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e// å¦ä¸€ä¸ª demo\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e15\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edemo2\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u003cspan class=\"lineNumber\"\u003e16\u003c/span\u003e  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e p1 = delay(\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e)\n\u003cspan class=\"lineNumber\"\u003e17\u003c/span\u003e  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e p2 = delay(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e)\n\u003cspan class=\"lineNumber\"\u003e18\u003c/span\u003e  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e p3 = delay(\u003cspan class=\"hljs-number\"\u003e3\u003c/span\u003e)\n\u003cspan class=\"lineNumber\"\u003e19\u003c/span\u003e  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e p1\n\u003cspan class=\"lineNumber\"\u003e20\u003c/span\u003e  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e p2\n\u003cspan class=\"lineNumber\"\u003e21\u003c/span\u003e  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e p3\n\u003cspan class=\"lineNumber\"\u003e22\u003c/span\u003e}\u003c/code\u003e\u003c/pre\u003e \n\n\u003cp\u003eå¯¹äºæ²¡æœ‰å¼‚æ­¥æ‰§è¡Œé¡ºåºéœ€æ±‚çš„\u003ccode\u003easync/await\u003c/code\u003eè¯­æ³•æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€æ¬¡æ€§åˆå§‹åŒ–å…¶å¼‚æ­¥ä»»åŠ¡ï¼Œç„¶åå†åˆ†åˆ«ç­‰å¾…å…¶ç»“æœå³å¯ã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eåœ¨é‡è§†\u003ccode\u003eæ€§èƒ½\u003c/code\u003eçš„åº”ç”¨ä¸­ï¼Œä½¿ç”¨\u003ccode\u003easync/await\u003c/code\u003eè¯­æ³•å¯ä»¥å‡å°‘å†…å­˜çš„å ç”¨ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eåœ¨ä½¿ç”¨\u003ccode\u003enew Promise\u003c/code\u003eåˆå§‹åŒ–æ—¶ï¼Œæˆ‘ä»¬åˆ›å»º\u003ccode\u003ePromise\u003c/code\u003eå®ä¾‹çš„å‡½æ•°å³ä½¿æ˜¯åœ¨å¤„ç†ç¨‹åºè½¬æ¢\u003ccode\u003ePromise\u003c/code\u003eå®ä¾‹çš„çŠ¶æ€æ—¶ä¾ç„¶è¢«ä¿å­˜åœ¨æ ˆè¿½è¸ªä¿¡æ¯å†…ï¼Œç„¶è€Œæˆ‘ä»¬çŸ¥é“è¿™äº›ä¿¡æ¯éšç€åˆå§‹åŒ–å‡½æ•°çš„è¿”å›å…¶å®å·²ç»æ²¡æœ‰å¿…è¦å­˜åœ¨äº†ï¼Œä½†æ˜¯\u003ccode\u003eJavascript\u003c/code\u003eå¼•æ“ä¼šåœ¨åˆ›å»º\u003ccode\u003ePromise\u003c/code\u003eæ—¶å°½å¯èƒ½ä¿å­˜å®Œæ•´çš„è°ƒç”¨æ ˆï¼Œåœ¨æŠ›å‡ºé”™è¯¯æ—¶è°ƒç”¨æ ˆå¯ä»¥ç”±è¿è¡Œæ—¶çš„é”™è¯¯å¤„ç†é€»è¾‘è·å–ï¼Œæ•…æˆ‘ä»¬èƒ½åœ¨æ ˆè¿½è¸ªä¿¡æ¯ä¸­çœ‹åˆ°å®ƒä»¬ï¼Œæœ€ç»ˆå ç”¨ä¸€äº›å†…å­˜ï¼Œå¢åŠ äº†è®¡ç®—å’Œå­˜å‚¨æˆæœ¬ã€‚\u003c/p\u003e\n\u003cp\u003eå¦‚æœæˆ‘ä»¬ä½¿ç”¨\u003ccode\u003easync/await\u003c/code\u003eè¯­æ³•ï¼š\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"lineNumber\"\u003e1\u003c/span\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003efooPromiseExecutor\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eresolve, reject\u003c/span\u003e) \u003c/span\u003e{\n\u003cspan class=\"lineNumber\"\u003e2\u003c/span\u003e  \u003cspan class=\"hljs-built_in\"\u003esetTimeout\u003c/span\u003e(reject, \u003cspan class=\"hljs-number\"\u003e1000\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e'bar'\u003c/span\u003e)\n\u003cspan class=\"lineNumber\"\u003e3\u003c/span\u003e}\n\u003cspan class=\"lineNumber\"\u003e4\u003c/span\u003e \n\u003cspan class=\"lineNumber\"\u003e5\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003efoo\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\u003cspan class=\"lineNumber\"\u003e6\u003c/span\u003e  \u003cspan class=\"hljs-keyword\"\u003eawait\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(fooPromiseExecutor)\n\u003cspan class=\"lineNumber\"\u003e7\u003c/span\u003e}\n\u003cspan class=\"lineNumber\"\u003e8\u003c/span\u003efoo()\n\u003cspan class=\"lineNumber\"\u003e9\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e/// Uncaught (in promise) bar\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e10\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e// foo\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e11\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e// async function (async)\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e12\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e// foo\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e \n\n\u003cp\u003eç”±äº\u003ccode\u003efooPromiseExecutor\u003c/code\u003eå·²ç»è¿”å›ï¼Œæ•…ä¸åœ¨é”™è¯¯ä¿¡æ¯ä¸­äº†ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eJavascript\u003c/code\u003eè¿è¡Œæ—¶å¯ä»¥ç®€å•åœ°åœ¨åµŒå¥—å‡½æ•°ä¸­å­˜å‚¨æŒ‡å‘åŒ…å«å‡½æ•°çš„æŒ‡é’ˆï¼Œå°±å¦‚åŒå¯¹å¾…åŒæ­¥å‡½æ•°ä¸€æ ·ï¼ŒæŒ‡é’ˆæ—¶æœºå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œç”¨äºåœ¨å‡ºé”™çš„æ—¶å€™ç”Ÿæˆé”™è¯¯ä¿¡æ¯ï¼Œå¦‚æ­¤ä¸€æ¥ä¾¿çœå»äº†è¿™â€œå¾®å°â€çš„æ¶ˆè€—ã€‚\u003c/p\u003e\n\u003cp\u003eæœ€åæˆ‘æƒ³è¯´ï¼Œç›¸å¯¹äºä½¿ç”¨\u003ccode\u003ePromise\u003c/code\u003eçš„å®ä¾‹æ–¹æ³•æ¥ç¼–å†™å¼‚æ­¥ä»£ç ï¼Œä½¿ç”¨\u003ccode\u003easync/await\u003c/code\u003eçš„è¯­æ³•ï¼Œæ˜¾ç„¶ä»£ç é‡å°†ä¼šå‡å°‘ğŸ¶ï¼Œä½•ä¹è€Œä¸ä¸ºï¼Ÿ\u003c/p\u003e\n\u003ch1\u003e4. Promisify\u003c/h1\u003e\n\u003cp\u003e\u003ccode\u003ePromise\u003c/code\u003eå¾ˆæ£’ï¼Œä½†æ˜¯éµå¾ªå¸¸è§çš„é”™è¯¯ä¼˜å…ˆçš„å›è°ƒé£æ ¼çš„å‡½æ•°ä¾ç„¶å¯ä»¥åœ¨è®¸å¤šåœºæ™¯ä¸‹æ´»è·ƒç€ï¼Œæ— è®ºæ˜¯å…¶å¼€å‘è€…åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™è¿˜æœªå‡ºç°\u003ccode\u003ePromise\u003c/code\u003eï¼Œäº¦æˆ–æ˜¯å¼€å‘è€…æ›´å–œæ¬¢å›è°ƒé£æ ¼çš„èŒƒå¼ï¼Œè·Ÿè¿™äº›å›è°ƒé£æ ¼çš„å‡½æ•°æ‰“äº¤é“ä¼¼ä¹æ— å¯é¿å…ã€‚\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eNodejs å®˜æ–¹æä¾›äº† util.promisify å·¥å…·å‡½æ•°ç”¨äºå°†ä¼ ç»Ÿå›è°ƒé£æ ¼çš„å‡½æ•°è½¬æ¢ä¸ºè¿”å›\u003ccode\u003ePromise\u003c/code\u003eçš„å‡½æ•°ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eæˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ªå°†\u003ccode\u003ecallback\u003c/code\u003eé£æ ¼çš„å‡½æ•°è½¬æ¢ä¸º\u003ccode\u003ePromise\u003c/code\u003eé£æ ¼çš„å‡½æ•°çš„å·¥å…·å‡½æ•°ã€‚\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-js\"\u003e\u003cspan class=\"lineNumber\"\u003e1\u003c/span\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003epromisify\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ef, multiArgs = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e\u003c/span\u003e)\u003c/span\u003e{\n\u003cspan class=\"lineNumber\"\u003e2\u003c/span\u003e  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e...args\u003c/span\u003e) \u003c/span\u003e{\n\u003cspan class=\"lineNumber\"\u003e3\u003c/span\u003e    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003ePromise\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003eresolve, reject\u003c/span\u003e) =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e4\u003c/span\u003e      \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ecallback\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eerr, ...results\u003c/span\u003e) \u003c/span\u003e{\n\u003cspan class=\"lineNumber\"\u003e5\u003c/span\u003e        err ? reject(err) : resolve(multiArgs ? results : results[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e])\n\u003cspan class=\"lineNumber\"\u003e6\u003c/span\u003e      }\n\u003cspan class=\"lineNumber\"\u003e7\u003c/span\u003e      args.push(callback)\n\u003cspan class=\"lineNumber\"\u003e8\u003c/span\u003e      f.call(\u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e, ...args)\n\u003cspan class=\"lineNumber\"\u003e9\u003c/span\u003e    })\n\u003cspan class=\"lineNumber\"\u003e10\u003c/span\u003e  }\n\u003cspan class=\"lineNumber\"\u003e11\u003c/span\u003e}\n\u003cspan class=\"lineNumber\"\u003e12\u003c/span\u003e \n\u003cspan class=\"lineNumber\"\u003e13\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e fs = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e'fs'\u003c/span\u003e)\n\u003cspan class=\"lineNumber\"\u003e14\u003c/span\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e fsPromise = promisify(fs.readdir)\n\u003cspan class=\"lineNumber\"\u003e15\u003c/span\u003efsPromise(\u003cspan class=\"hljs-string\"\u003e'.'\u003c/span\u003e).then(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003er\u003c/span\u003e =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e16\u003c/span\u003e  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'resolve'\u003c/span\u003e, r);\n\u003cspan class=\"lineNumber\"\u003e17\u003c/span\u003e}).catch(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003er\u003c/span\u003e =\u003e\u003c/span\u003e {\n\u003cspan class=\"lineNumber\"\u003e18\u003c/span\u003e  \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e'reject'\u003c/span\u003e, r);\n\u003cspan class=\"lineNumber\"\u003e19\u003c/span\u003e})\n\u003cspan class=\"lineNumber\"\u003e20\u003c/span\u003e\u003cspan class=\"hljs-comment\"\u003e// output\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e21\u003c/span\u003eresolve [\n\u003cspan class=\"lineNumber\"\u003e22\u003c/span\u003e  \u003cspan class=\"hljs-string\"\u003e'index.js'\u003c/span\u003e\n\u003cspan class=\"lineNumber\"\u003e23\u003c/span\u003e]\u003c/code\u003e\u003c/pre\u003e \n\n\u003cp\u003eåœ¨è¿™ä¸ªè½¬æ¢è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†åŸæ¥çš„å‡½æ•°åŒ…è£¹è¿›å»ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªå¯æ‰§è¡Œçš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¥æ”¶çš„å‚æ•°è·ŸåŸæ¥çš„\u003ccode\u003eå›è°ƒé£æ ¼\u003c/code\u003eå‡½æ•°ä¸€è‡´ï¼Œåªæ˜¯å°†ä¹‹è½¬æ¢ä¸º\u003ccode\u003ePromise\u003c/code\u003eé£æ ¼çš„å‡½æ•°åï¼Œä¼ å‚å¯ä»¥çœç•¥\u003ccode\u003eå›è°ƒå‡½æ•°\u003c/code\u003eï¼Œæˆ‘ä»¬åœ¨å†…éƒ¨æ„å»ºäº†ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå¹¶ä¸”å°†ä¹‹ä½œä¸ºåŸå‡½æ•°çš„å›è°ƒéƒ¨åˆ†ä½œä¸ºå‚æ•°ä¼ ç»™äº†è¿”å›å‡½æ•°ã€‚\u003c/p\u003e\n\u003cp\u003eç°åœ¨ï¼Œæˆ‘ä»¬å°†ä¼ ç»Ÿå›è°ƒé£æ ¼çš„å‡½æ•°è½¬åŒ–ä¸ºè¿”å›\u003ccode\u003ePromise\u003c/code\u003eçš„å‡½æ•°äº†ï¼Œæˆ‘ä»¬å¯ä»¥æ”¾å¿ƒä½¿ç”¨\u003ccode\u003ePromise\u003c/code\u003eçš„æ–°ç‰¹æ€§äº†ã€‚\u003c/p\u003e\n\u003ch1\u003eå‚è€ƒ\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"chrome-extension://bocbaocobfecmglnmeaeppambideimao/pdf/viewer.html?file=file%3A%2F%2F%2FUsers%2Fyi%2FDesktop%2Fexploring-es6.pdf\"\u003eExploring ES6 - exploring-es6.pdf\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://stackoverflow.com/questions/2069763/difference-between-event-handlers-and-callbacks\"\u003earchitecture - Difference between event handlers and callbacks - Stack Overflow\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://stackoverflow.com/questions/6348494/addeventlistener-vs-onclick\"\u003ejavascript - addEventListener vs onclick - Stack Overflow\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://bluebirdjs.com/docs/getting-started.html\"\u003eGetting Started | bluebird\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eJavaScript é«˜çº§ç¨‹åºè®¾è®¡\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://zh.javascript.info/\"\u003eç°ä»£ JavaScript æ•™ç¨‹\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.geeksforgeeks.org/javascript-promise-resolve-method/\"\u003eJavaScript | promise resolve() Method - GeeksforGeeks\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://itnext.io/error-handling-with-async-await-in-js-26c3f20bc06a\"\u003eError handling with Async/Await in JS | by Ian Segers | ITNEXT\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://nodejs.dev/learn/understanding-javascript-promises\"\u003eUnderstanding JavaScript Promises\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://nodejs.cn/api/util/util_promisify_original.html\"\u003eutil.promisify(original) | Node.js API æ–‡æ¡£\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","title":"Javascript,I promise - å¼‚æ­¥ç¼–ç¨‹","date":"2021/4/9","tags":["JavaScript"],"mainImg":"https://images.unsplash.com/photo-1611923973164-e0e5f7f69872?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwxNjUyNjZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2MTc5NzU1MTI\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=1080","coverImg":"https://images.unsplash.com/photo-1611923973164-e0e5f7f69872?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwxNjUyNjZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2MTc5NzU1MTI\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=400","intro":"Promise, JavaScript ä¸–ç•Œä¸­çš„å¼‚æ­¥å¤„ç†å¯¹è±¡.æˆ‘é˜…è¯»äº† Dr.Axel å‰è¾ˆçš„ç”µå­ä¹¦,å……æ»¡æ„Ÿæ¿€."}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"Javascript,I-promise"},"buildId":"4zVTu01G9zNJYsDPnATZL","assetPrefix":"/blog","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/blog/_next/static/chunks/polyfills-86dac49abe0e0232b575.js"></script><script src="/blog/_next/static/chunks/main-bc20978b5b49cb620506.js" async=""></script><script src="/blog/_next/static/chunks/webpack-eb080e3f091731f228fb.js" async=""></script><script src="/blog/_next/static/chunks/framework.9ec1f7868b3e9d138cdd.js" async=""></script><script src="/blog/_next/static/chunks/commons.d877dcdd17afd7219ae3.js" async=""></script><script src="/blog/_next/static/chunks/6335da8543c52d3af527c387f688061357787349.7e9e1b66dd81783d6900.js" async=""></script><script src="/blog/_next/static/chunks/pages/_app-4e649ed46ef47e92b24e.js" async=""></script><script src="/blog/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.c2ce14a235a03ef7811d.js" async=""></script><script src="/blog/_next/static/chunks/pages/posts/%5Bslug%5D-ece295f9976e557edb76.js" async=""></script><script src="/blog/_next/static/4zVTu01G9zNJYsDPnATZL/_buildManifest.js" async=""></script><script src="/blog/_next/static/4zVTu01G9zNJYsDPnATZL/_ssgManifest.js" async=""></script></body></html>