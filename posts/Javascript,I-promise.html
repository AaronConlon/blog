<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta name="description" content="javascript node deno linux web developer"/><meta charSet="utf-8"/><link rel="icon" href="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text y=%22.9em%22 font-size=%2290%22&gt;ğŸ¯&lt;/text&gt;&lt;/svg&gt;"/><title>Javascript,I promise - å¼‚æ­¥ç¼–ç¨‹</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reset-css@5.0.1/reset.min.css"/><link rel="stylesheet" href="/blog/post.css"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-J0BNBT8YXG"></script><script><!-- Global site tag (gtag.js) - Google Analytics -->
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'G-J0BNBT8YXG');</script><link rel="preload" href="/blog/_next/static/css/15b7ac151cc27d0bf446.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/15b7ac151cc27d0bf446.css" data-n-g=""/><link rel="preload" href="/blog/_next/static/css/59a87fe619da797e3375.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/59a87fe619da797e3375.css" data-n-p=""/><noscript data-n-css="true"></noscript><link rel="preload" href="/blog/_next/static/chunks/main-c37f7d67026ad75148c3.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/webpack-eb080e3f091731f228fb.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/framework.1daf1ec1ecf144ee9147.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/commons.cb58dfc173e18379cc5b.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/6335da8543c52d3af527c387f688061357787349.aa32db8a194765817dea.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/pages/_app-ebdd114948c696bf4519.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.7a872eda8469b3325c5d.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/pages/posts/%5Bslug%5D-5d143f0d2b02a907308e.js" as="script"/></head><body><div id="__next"><style data-emotion-css="d6jcgn">html{line-height:1.15;-webkit-text-size-adjust:100%;}body{margin:0;}main{display:block;}h1{font-size:2em;margin:0.67em 0;}hr{box-sizing:content-box;height:0;overflow:visible;}pre{font-family:monospace,monospace;font-size:1em;}a{background-color:transparent;}abbr[title]{border-bottom:none;-webkit-text-decoration:underline;text-decoration:underline;-webkit-text-decoration:underline dotted;-webkit-text-decoration:underline dotted;text-decoration:underline dotted;}b,strong{font-weight:bolder;}code,kbd,samp{font-family:monospace,monospace;font-size:1em;}small{font-size:80%;}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline;}sub{bottom:-0.25em;}sup{top:-0.5em;}img{border-style:none;}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0;}button,input{overflow:visible;}button,select{text-transform:none;}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0;}fieldset{padding:0.35em 0.75em 0.625em;}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal;}progress{vertical-align:baseline;}textarea{overflow:auto;}[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0;}[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{-webkit-appearance:none !important;}input[type="number"]{-moz-appearance:textfield;}[type="search"]{-webkit-appearance:textfield;outline-offset:-2px;}[type="search"]::-webkit-search-decoration{-webkit-appearance:none !important;}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit;}details{display:block;}summary{display:list-item;}template{display:none;}[hidden]{display:none !important;}html{box-sizing:border-box;font-family:sans-serif;}*,*::before,*::after{box-sizing:border-box;}blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0;}button{background:transparent;padding:0;}fieldset{margin:0;padding:0;}ol,ul{margin:0;padding:0;}html{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";line-height:1.5;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%;text-rendering:optimizelegibility;}hr{border-top-width:1px;}img{border-style:solid;}textarea{resize:vertical;}button,[role="button"]{cursor:pointer;}button::-moz-focus-inner{border:0 !important;}table{border-collapse:collapse;}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit;}a{color:inherit;-webkit-text-decoration:inherit;text-decoration:inherit;}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit;}pre,code,kbd,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle;}img,video{max-width:100%;height:auto;}html{line-height:1.5;color:#1A202C;}*,*::before,*::after{border-width:0;border-style:solid;border-color:#E2E8F0;}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#A0AEC0;}input::-ms-input-placeholder,textarea::-ms-input-placeholder{color:#A0AEC0;}input::-webkit-input-placeholder,textarea::-webkit-input-placeholder{color:#A0AEC0;}input::-moz-placeholder,textarea::-moz-placeholder{color:#A0AEC0;}input:-ms-input-placeholder,textarea:-ms-input-placeholder{color:#A0AEC0;}input::placeholder,textarea::placeholder{color:#A0AEC0;}</style><div><div class="layout_container__1BBI- css-0"><header><div class="css-0"><style data-emotion-css="em7ozm">.css-em7ozm{font-size:2.25rem;line-height:1.25;font-weight:700;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";text-align:center;margin:0 auto;padding:1.4rem 1rem;color:#0069d6;}@media screen and (min-width:48em){.css-em7ozm{font-size:3rem;}}</style><h1 class="css-em7ozm"><a href="/blog">å¦™æ‰<style data-emotion-css="1i1myri">.css-1i1myri{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";font-size:30%;}</style><sub class="css-1i1myri">blog</sub></a></h1></div></header><main><div class="css-0"><style data-emotion-css="t9c2rr">.css-t9c2rr{width:100%;margin:0 auto;padding-bottom:2rem;max-width:960px;}</style><div class="css-t9c2rr"><style data-emotion-css="8atqhb">.css-8atqhb{width:100%;}</style><img alt="" class="css-8atqhb"/></div><style data-emotion-css="1td051d">.css-1td051d{width:100%;margin:0 auto;max-width:960px;}</style><div class="css-1td051d"><style data-emotion-css="1299f13">.css-1299f13{font-size:1.875rem;line-height:2.5rem!important;font-weight:700;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";text-align:center;overflow:hidden;}@media screen and (min-width:30em){.css-1299f13{line-height:3rem!important;}}@media screen and (min-width:48em){.css-1299f13{font-size:2.25rem;}}</style><h1 class="css-1299f13">Javascript,I promise - å¼‚æ­¥ç¼–ç¨‹</h1><style data-emotion-css="7e9jz6">.css-7e9jz6{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:2rem;margin:0 auto;margin-right:0.4rem;float:right;}</style><div id="tags" class="css-7e9jz6"><style data-emotion-css="qgikqf">.css-qgikqf{display:inline-block;padding-left:8px;padding-right:0.25rem;text-transform:uppercase;font-size:0.6rem;border-radius:5px;font-weight:700;white-space:nowrap;vertical-align:middle;background-color:#c6f6d5;color:#22543d;height:2rem;line-height:2rem;min-width:4rem;}</style><div class="css-qgikqf">JavaScript</div></div><style data-emotion-css="8ddayy">.css-8ddayy{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;min-height:2rem;max-width:100%;border-radius:0.25rem;font-weight:500;min-width:2rem;padding-left:0.75rem;padding-right:0.75rem;background-color:#c6f6d5;color:#22543d;margin-bottom:2rem;font-size:0.6rem;margin-left:0.4rem;}</style><div class="css-8ddayy">æœ€åæ›´æ–°: <!-- -->2021/4/9</div><div><p>å¤§å®¶å¥½ï¼Œä»Šå¤©æˆ‘ä»¬è¦åˆ†äº«çš„çŸ¥è¯†ç‚¹æ˜¯<code>Promise</code>ä¸å¼‚æ­¥ç¼–ç¨‹ã€‚</p><p><code>Promise</code>æ˜¯å¯¹å°šä¸å­˜åœ¨ç»“æœçš„å¯¹è±¡çš„ä¸€ä¸ªæ›¿èº«ï¼Œä¹Ÿè®¸ä½ æ›¾çœ‹åˆ°ç±»ä¼¼çš„æœ¯è¯­ï¼Œä¾‹å¦‚<code>future</code>/<code>delay</code>/<code>deferred</code>ç­‰ï¼Œå®é™…ä¸Šè¿™äº›æœ¯è¯­æè¿°çš„æ˜¯ä¸€ä¸ªç›¸åŒçš„æ¦‚å¿µï¼Œéƒ½æ˜¯ä¸€ç§å¼‚æ­¥ç¨‹åºæ‰§è¡Œçš„æœºåˆ¶ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬åˆ†äº«çš„çŸ¥è¯†å°†æ¶‰åŠä»¥ä¸‹å†…å®¹ï¼š</p><ul><li>å‡½æ•°å›è°ƒ</li><li>Promise æµ…æ</li><li>Async / await</li><li>Promisify</li></ul><h1 id="1-">1. å›è°ƒ</h1><p>JavaScript è¯­è¨€ä¸ºäº†è®©éƒ¨åˆ†ä»»åŠ¡æŒ‰å¼‚æ­¥çš„æ–¹å¼è¿›è¡Œï¼Œæä¾›äº†ç¼–å†™<code>å›è°ƒå‡½æ•°</code>çš„æ–¹æ³•ï¼Œè®©æŸäº›ä»»åŠ¡åœ¨è¾¾æˆä¸€äº›æ¡ä»¶ä¹‹åå†æ‰§è¡Œå¼€å‘è€…æŒ‡å®šçš„<code>å›è°ƒå‡½æ•°</code>ã€‚</p><p>ä¸¾ä¸¤ä¸ªä¾‹å­:</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">const callbackFn = () =&gt; {
  // balabala
};
// browser
setTimeout(callbackFn, 1000);

// nodejs
const fs = require(&quot;fs&quot;);
fs.readFile(&quot;filename&quot;, (err, data) =&gt; {
  if (err) throw err;
  // balabala
});
// more
console.log(1);</code></pre></div></div></details><p>å¦‚ä¸Šæ‰€ç¤ºï¼Œè¦ä¹ˆå»¶è¿Ÿæ‰§è¡Œå›è°ƒï¼Œè¦ä¹ˆè¯»å–æ–‡ä»¶åæ‰§è¡Œå›è°ƒï¼ŒäºŒè€…éƒ½ä¸ä¼šç«‹å³æ‰§è¡Œä»è€Œé˜»å¡ä¸»çº¿ç¨‹ï¼Œè€Œæ˜¯å„è‡ªå…·æœ‰è‡ªå·±çš„æ‰§è¡Œæ¡ä»¶ï¼Œæ»¡è¶³æ¡ä»¶åæ”¾å…¥ä»»åŠ¡å¾ªç¯é˜Ÿåˆ—ä¸­ç­‰å¾…ä¸»çº¿ç¨‹ç©ºé—²æ‰å¾—ä»¥å–å‡ºå¹¶æ‰§è¡Œã€‚</p><p>ä¸Šè¿°å›è°ƒå‡½æ•°åœ¨æŸäº›åœºæ™¯ä¸‹æ›¾è®©å¼€å‘è€…å†™å‡ºå¦‚ä¸‹ç±»å‹çš„ä»£ç ï¼š</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">fs.readFile(&quot;file1.txt&quot;, function (err, data) {
  if (err) throw err;
  // ...ä¸€äº›æ“ä½œ
  fs.readFile(&quot;file2.txt&quot;, function (err, data) {
    if (err) throw err;
    // ...ä¸€äº›æ“ä½œ
    fs.readFile(&quot;file3.txt&quot;, function (err, data) {
      if (err) throw err;
      // ...ä¸€äº›æ“ä½œ
      fs.readFile(&quot;file4.txt&quot;, function (err, data) {
        if (err) throw err;
        // ...ä¸€äº›æ“ä½œ
      });
    });
  });
});</code></pre></div></div></details><p>ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿå› ä¸ºæŸäº›åœºæ™¯ä¸‹éœ€è¦å¯¹å¼‚æ­¥æ“ä½œè¿›è¡Œæ’åºï¼Œéœ€è¦ä¿è¯è¿è¡Œé€»è¾‘å…·æœ‰ä¸€å®šçš„é¡ºåºï¼Œå¹¶ä¸”è¿˜éœ€è¦å¯¹æ¯ä¸€ä¸ªå›è°ƒè¿›è¡Œé”™è¯¯å¤„ç†ã€‚</p><p>ä¸Šè¿°æ¡ˆä¾‹çœç•¥äº†çœŸå®çš„é€»è¾‘ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºè¿™ç§å›è°ƒçš„åµŒå¥—è®©ä»£ç å¾ˆå®¹æ˜“å¤±æ§ï¼Œå¹¶ä¸”éš¾ä»¥é˜…è¯»å’Œç»´æŠ¤ã€‚</p><p>æ— è®ºæ˜¯å†™ä¸‹è¿™æ®µä»£ç çš„äººè¿˜æ˜¯é˜…è¯»è¿™æ®µä»£ç çš„äººéƒ½è¢«å…¶æ‰€&quot;æŠ˜ç£¨&quot;ï¼Œæˆ‘ä»¬å°†æ­¤ç±»ä»£ç ç»“æ„ç§°ä¸º<code>â€œå›è°ƒåœ°ç‹±â€</code>ã€‚</p><p>å³ä½¿æˆ‘ä»¬å°†ä¹‹æ‘Šå¼€ï¼Œä¸ºæ¯ä¸€ä¸ªå›è°ƒå‡½æ•°éƒ½ç¼–å†™ä¸€ä¸ªå…·åçš„ç‹¬ç«‹å‡½æ•°æ¥è°ƒç”¨ï¼Œä¾ç„¶å¯è¯»æ€§ä¸ä½³ï¼š</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">fs.readFile(&quot;file1.txt&quot;, step1);

function step1(err, data) {
  if (err) throw err;
  // ...
  fs.readFile(&quot;file2.txt&quot;, step2);
}
function step2(err, data) {
  if (err) throw err;
  // ...
  fs.readFile(&quot;file3.txt&quot;, step3);
}
function step3(err, data) {
  if (err) throw err;
  // ...
  fs.readFile(&quot;file4.txt&quot;, step4);
}
function step4(err, data) {
  if (err) throw err;
  // ...
}</code></pre></div></div></details><p>è¿™äº›ç‹¬ç«‹å‡½æ•°çš„å‘½åä¹Ÿè®¸ä¼šè®©å¼€å‘è€…è§‰å¾—éå¸¸ä¸é€‚ï¼Œä¸ºäº†å±•å¼€å±‚å±‚åµŒå¥—ï¼Œæˆ‘ä»¬ç¼–å†™äº†è®¸å¤šå‡ ä¹ä¸ä¼šè¢«<code>é‡ç”¨</code>çš„å‡½æ•°ï¼Œå³ä½¿ç°ä»£ç¼–è¾‘å™¨åœ¨ä»£ç è·³è½¬çš„åŠŸèƒ½ä¸Šéå¸¸æ–¹ä¾¿ï¼Œé˜…è¯»æ­¤ç±»ä»£ç çš„æ—¶å€™ä¾ç„¶ä¼šè®©æˆ‘ä»¬ä¸æ–­çš„è½¬ç§»è§†çº¿ã€‚</p><blockquote><p>â€œæ‡’æƒ°â€ä½¿äººè¿›æ­¥ã€‚</p></blockquote><p>ä½¿ç”¨<code>Promise</code>,å¯ä»¥é¿å…æ­¤ç±»é—®é¢˜ï¼Œæ˜¾è‘—å‡å°‘ç¼–ç é‡ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§ã€‚</p><h1 id="2-promise">2. Promise</h1><blockquote><p>IE æµè§ˆå™¨ä¸æ”¯æŒ<code>Promise</code>,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>bluebird</code>æˆ–<code>es6-promise</code>ç­‰ç¬¬ä¸‰æ–¹åº“.</p></blockquote><h2 id="21-promise-">2.1 promise æµ…æ</h2><p>ä½¿ç”¨<code>new</code>å®ä¾‹åŒ–çš„<code>Promise</code>å¯¹è±¡å…·æœ‰ä¸‰ç§çŠ¶æ€:</p><ul><li><code>Fulfilled</code> <ul><li><code>has resolution</code>: resolve æˆåŠŸ,è°ƒç”¨ <code>onFulfilled</code>å‡½æ•°</li></ul></li><li><code>Rejected</code> <ul><li><code>has rejection</code>: reject, è°ƒç”¨<code>onRejected</code>å‡½æ•°</li></ul></li><li><code>Pending</code> <ul><li><code>unresolved</code>: åˆå§‹åŒ–çŠ¶æ€</li></ul></li></ul><blockquote><p>çŸ­æ¨ªçº¿å·¦è¾¹æ˜¯<code>Promise/A+</code>æœ¯è¯­,è€Œå³è¾¹åˆ™æ˜¯<code>ES6 Promise</code>æœ¯è¯­.</p></blockquote><p><img src="https://raw.githubusercontent.com/youyiqin/markdown_imgs/master/image-1582215000590-ffa807c19d5f6959de485fc66664e123.png"/></p><p>åˆå§‹çŠ¶æ€ä¸º<code>pending</code>,è½¬ä¸º<code>Fulfilled</code>æˆ–è€…<code>Rejected</code>ä¹‹åä¸ä¼šå†æœ‰å˜åŒ–.<code>Fulfilled</code>å’Œ<code>Rejected</code>çŠ¶æ€ä¹Ÿè¢«ç§°ä¸º<code>Settled</code>ã€‚</p><p><code>Promise</code>çš„çŠ¶æ€æµè½¬å¹¶ä¸å¤æ‚ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦æ³¨æ„å…¶ä¸­ä¸€äº›ç»†èŠ‚ã€‚</p><blockquote><p>æœ¬æ–‡ä¸ä¼šå¯¹<code>promise</code>åšé¢é¢ä¿±åˆ°çš„ä»‹ç»,æ¨èé˜…è¯»å®˜æ–¹æ–‡æ¡£.</p></blockquote><p>é¦–å…ˆ,æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ª<code>promise</code>å®ä¾‹:</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">// å®ä¾‹åŒ–
const promise = new Promise((resolve, reject) =&gt; {
  // balabala
  if(...) {
    // å®ä¾‹çŠ¶æ€å˜æ›´ï¼Œè®¾ç½®å€¼
    resolve(value) // success
    resolve(...) // å¿½ç•¥
  } else {
      reject(reason) // failure
  }
})
// é“¾å¼è°ƒç”¨ï¼Œå®ä¾‹æ–¹æ³• then è¿”å›ä¸€ä¸ªæ–°çš„å®ä¾‹
promise
  .then(function(value) {
        // balabala
  })
    .then(function(value) {
        // balabala
  })
    .catch(reason =&gt; {
      // balabala
  })
    .finally(() =&gt; {})</code></pre></div></div></details><p>ä¸Šè¿°ç¤ºä¾‹å±•ç¤ºäº†<code>promise</code>çš„ä¸€äº›ç‰¹æ€§ï¼Œå¦‚å®ä¾‹åŒ–ã€çŠ¶æ€è½¬æ¢èµ‹å€¼ã€é“¾å¼è°ƒç”¨å’Œå¼‚å¸¸å¤„ç†ï¼Œä¸‹é¢æˆ‘ä»¬ä¼šè®²åˆ°é™æ€æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•ã€‚</p><h2 id="21-promise-">2.1 Promise æ„é€ å™¨</h2><p>æˆ‘ä»¬é€šè¿‡<code>new Promise(executor)</code>å®ä¾‹åŒ–ä¸€ä¸ª<code>promise</code>çš„æ—¶å€™,å…¶çŠ¶æ€ä¸º<code>pending</code>.åœ¨å®ä¾‹åŒ–çš„æ—¶å€™ä¼ å…¥ä¸€ä¸ªå‡½æ•°<code>executorï¼ˆæ‰§è¡Œå™¨ï¼‰</code>ï¼Œæ­¤å‡½æ•°å°†ä¼šè·å–ä¸¤ä¸ªå®å‚<code>resolve</code>å’Œ<code>reject</code>å‡½æ•°ï¼ŒäºŒè€…éƒ½å¯ä»¥æ”¹å˜å®ä¾‹çš„çŠ¶æ€å’Œå€¼ã€‚</p><blockquote><p>ä¸æä¾› <code>executor</code> å°†æŠ›å‡º <code>typeError</code></p></blockquote><p>ä¸Šè¿°ä»£ç çš„ç‰‡æ®µï¼š</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">// å®ä¾‹åŒ–
const promise = new Promise((resolve, reject) =&gt; {
  // balabala
  if(...) {
    // å®ä¾‹çŠ¶æ€å˜æ›´ï¼Œè®¾ç½®å€¼
    resolve(value) // success
    resolve(...) // å¿½ç•¥
  } else {
      reject(reason) // failure
  }
})</code></pre></div></div></details><p>éœ€è¦å…³æ³¨ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li><code>Executor</code>å‡½æ•°çš„å‚æ•°æ²¡æœ‰é™åˆ¶ï¼Œä½†é€šå¸¸æˆ‘ä»¬ä¼šå£°æ˜ä¸¤ä¸ªå½¢å‚å‡½æ•°ï¼š<code>resolve</code>å’Œ<code>reject</code>ï¼Œ<code>executor</code>å†…éƒ¨ä½¿ç”¨æ­¤äºŒè€…å¯ä»¥æ˜¾å¼åœ°è½¬æ¢<code>Promise</code>å®ä¾‹çš„çŠ¶æ€ï¼Œè®¾ç½®å…¶å€¼ã€‚ï¼ˆä¸ä½¿ç”¨è¿™ä¸¤ä¸ªå‡½æ•°æ¥è½¬æ¢å®ä¾‹çŠ¶æ€æ„å‘³ç€æ­¤å®ä¾‹çš„çŠ¶æ€ä¸ä¼šæ”¹å˜ï¼Œè¿™ä¹Ÿå†™å¹¶æ²¡æœ‰å¤šå¤§æ„ä¹‰ï¼‰ã€‚</li><li><code>resolve</code>å’Œ<code>reject</code>å‡½æ•°çš„å®å‚å¯ä»¥æ˜¯ä¸åŒç±»å‹çš„å€¼ï¼Œä½†æ˜¯ä¼šè¢«è¿›ä¸€æ­¥å¤„ç†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ˜¾ç¤ºè½¬æ¢çŠ¶æ€è®¾ç½®å€¼çš„æ—¶å€™ï¼Œä¼ å…¥çš„å‚æ•°ä¸ä¸€å®šä¼šç›´æ¥ä½œä¸º<code>settled</code>çŠ¶æ€çš„å€¼ã€‚</li><li><code>pending</code>çŠ¶æ€åˆ°<code>settled</code>çŠ¶æ€æ˜¯ä¸å¯é€†çš„ï¼Œå¹¶ä¸”åœ¨<code>executor</code>ä¸­çš„<code>resolve</code>å’Œ<code>reject</code>å‡½æ•°åªèƒ½æ‰§è¡Œä¸€æ¬¡ï¼Œåç»­å†æ‰§è¡Œå°†ä¼šè¢«å¿½ç•¥ã€‚</li></ul><blockquote><p><code>executor</code>å‡½æ•°æ˜¯åŒæ­¥æ‰§è¡Œçš„ã€‚<code>resolve</code>å’Œ<code>reject</code>å‡½æ•°æ¥æ”¶ä»»æ„ç±»å‹çš„å€¼ã€‚</p></blockquote><p>æˆ‘ä»¬æ¥çœ‹çœ‹ç»™<code>resolve</code>å‡½æ•°ä¼ å…¥ä»¥ä¸‹ä¸‰ç§ä¸åŒçš„å€¼ä¼šæœ‰æ€æ ·çš„ç»“æœã€‚</p><ul><li>åŸå§‹ç±»å‹å€¼</li><li>Promise å®ä¾‹</li><li>thenable å¯¹è±¡</li></ul><p>é¦–å…ˆæ˜¯<code>åŸå§‹ç±»å‹å€¼</code>ï¼š</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">const p = new Promise((resolve, reject) =&gt; {
  resolve(Symbol())
  // resolve(1)
  // resolve(&#x27;1&#x27;)
  // resolve(null)
  // resolve(undefined)
  // resolve(1n)
  // resolve(true)
  // reject ä¹Ÿæ˜¯å¦‚æ­¤
})

p.then((v) =&gt; {
  console.log(&#x27;resolve&#x27;ï¼Œ v);
}).catch((i) =&gt; {
  console.log(&#x27;reject&#x27;, i);
})</code></pre></div></div></details><p>åŸå§‹ç±»å‹æ•°æ®ä¼ å…¥<code>resolve</code>å‡½æ•°ï¼Œéƒ½èƒ½é¡ºåˆ©å°†çŠ¶æ€è½¬ä¸º<code>fulfilled</code>å¹¶ä¸”è®¾ç½®ä¸ºå½“å‰çŠ¶æ€ä¸‹çš„å€¼ã€‚ä½¿ç”¨<code>reject</code>å‡½æ•°åˆ™å°†çŠ¶æ€è½¬ä¸º<code>rejected</code>,å€¼åˆ™æ˜¯åŸå§‹ç±»å‹çš„å€¼ã€‚</p><p>å…¶æ¬¡ï¼Œæ¥çœ‹çœ‹ä¼ å…¥<code>Promise</code>å¯¹è±¡ã€‚</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">const p = new Promise((resolve, reject) =&gt; {
  resolve(Promise.resolve(1))
  // or
  reject(Promise.resolve(1))
})
p.then((v) =&gt; {
  console.log(&#x27;resolve&#x27;, v);
}).catch((i) =&gt; {
  console.log(&#x27;reject&#x27;, i)
})
// output
resolve 1</code></pre></div></div></details><p>å¦‚æœä¼ å…¥ç»™<code>promise</code>çš„å‚æ•°ä¹Ÿæ˜¯ä¸€ä¸ª<code>Promise</code>å®ä¾‹ï¼Œåˆ™ç›¸å½“äºä¸€ä¸ªç©ºåŒ…è£…ï¼Œæœ€ç»ˆå°†å¾—åˆ°ä¸€ä¸ªç›¸åŒçŠ¶æ€å’Œå€¼çš„<code>Promise</code>å®ä¾‹ã€‚</p><blockquote><p><code>reject(Promise.resolve(1))</code> ä¸ä¼šç…§æ¬<code>resolve</code>çš„ç‰¹æ€§ï¼Œå¯¹äºä¼ å…¥ä¸€ä¸ª<code>Promise</code>å®ä¾‹çš„æƒ…å½¢ï¼Œä¼šå°†ä¹‹ä½œä¸º<code>Rejected</code>çŠ¶æ€ä¸‹çš„<code>reason</code>ã€‚</p></blockquote><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">const p = new Promise((resolve, reject) =&gt; {
  resolve(Promise.reject(1))
})
// output
reject 1</code></pre></div></div></details><p>æ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹ä¼ å…¥ä¸€ä¸ªæ™®é€šçš„ <code>thenable</code> å¯¹è±¡ã€‚</p><blockquote><p>å…·æœ‰<code>then</code>æ–¹æ³•çš„å¯¹è±¡ç§°ä¸º<code>thenable</code>å¯¹è±¡ï¼Œ<code>Promise</code>å®ä¾‹å¯¹è±¡ä¹Ÿæ˜¯ä¸€ç§<code>thenable</code>å¯¹è±¡ã€‚</p></blockquote><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">const obj = {
  name: &#x27;Miao&#x27;,
  then() {
    console.log(&#x27;this is then&#x27;, arguments);
    arguments[0](1)
  }
}
const p = new Promise((resolve, reject) =&gt; {
  resolve(obj)
})

p.then((v) =&gt; {
  console.log(&#x27;resolve&#x27;, v);
}).catch((i) =&gt; {
  console.log(&#x27;reject&#x27;, i)
})
// output
this is then [Arguments] {
  &#x27;0&#x27;: [Function (anonymous)],
  &#x27;1&#x27;: [Function (anonymous)]
}
resolve 1</code></pre></div></div></details><p><code>executor</code>å†…<code>resolve</code>ä¸€ä¸ª<code>thenable</code>å¯¹è±¡ï¼Œåˆ™ä¼šå°†<code>then</code>æ–¹æ³•è§†ä½œä¸€ä¸ª<code>executor</code>ï¼Œåœ¨å…¶å†…éƒ¨å¯ä»¥æ˜¾ç¤ºç¼–å†™<code>resolve</code>å’Œ<code>reject</code>çš„é€»è¾‘æ¥æ”¹å˜æ•´ä¸ª<code>Promise</code>å®ä¾‹çš„çŠ¶æ€å’Œå€¼ã€‚</p><h2 id="22-promise-">2.2 Promise å®ä¾‹æ–¹æ³•</h2><p><code>Promise</code>å®ä¾‹æœ‰ä¸‰ä¸ªå®ä¾‹æ–¹æ³•ï¼š</p><ul><li><code>then</code></li><li><code>catch</code></li><li><code>finally</code></li></ul><blockquote><p>é‡ç”³ï¼š<code>promise</code>å®ä¾‹çš„çŠ¶æ€è½¬æ¢æ˜¯å•å‘çš„,ä¸€æ—¦<code>settled</code>åˆ™ä¸å¯é€†è½¬,åŒæ—¶æˆ‘ä»¬å¯ä»¥å¤šæ¬¡åˆ©ç”¨æ­¤<code>settled</code>çŠ¶æ€çš„å®ä¾‹ã€‚</p></blockquote><p>é¦–å…ˆæ˜¯<code>then(onFulfilled, onRejected)</code>æ–¹æ³•ï¼Œæ­¤æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œåœ¨<code>Promise</code>çŠ¶æ€ä¸º<code>pending</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ­¤æ–¹æ³•ç†è§£ä¸ºæ³¨å†ŒçŠ¶æ€è½¬å˜ä¸º<code>Fulfilled</code>å’Œ<code>Rejected</code>åæ‰§è¡Œçš„å›è°ƒå‡½æ•°ï¼Œå¹¶ä¸”è¿™äº›å›è°ƒå‡½æ•°çš„æ‰§è¡Œæ˜¯å¼‚æ­¥çš„ã€‚</p><blockquote><p><code>Promise</code>åªèƒ½è½¬æ¢ä¸€æ¬¡ï¼Œå› æ­¤ä¸Šè¿°ä¸¤ä¸ªå‚æ•°çš„æ“ä½œæ˜¯äº’æ–¥çš„ã€‚</p></blockquote><p>åœ¨å®ç°ä¸Š<code>Node</code>å¯ä»¥é€šè¿‡<code>process.nextTick</code>æ¥åˆ›å»ºæ–°çš„å¾®ä»»åŠ¡ï¼Œåœ¨æµè§ˆå™¨ç«¯åˆ™å¯ä»¥é€šè¿‡<code>MutationObserver</code>åŠŸèƒ½åˆ›å»ºå¾®ä»»åŠ¡ã€‚</p><p>ä»¥ä¸‹ä¸¤ç§<code>then</code>å‡½æ•°çš„ä¼ å‚éƒ½ä¼šè¢«å¿½ç•¥, å¹¶ä¸”å¼‚æ­¥è¿”å›ä¸€ä¸ªç›¸åŒå€¼çš„<code>Promise</code>æ–°å®ä¾‹ï¼š</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">// ä¼ éå‡½æ•°å¤„ç†å¯¹è±¡
Promise.resolve(1).then(&#x27;sss&#x27;)
// ä¸ä¼ å€¼
Promise.resolve(1).then()

const p = Promise.resolve(1)
let c = p.then()
console.log(p);
setTimeout(() =&gt; {
  console.log(c);
}, 200);
// output
Promise { 1 }
Promise { 1 }</code></pre></div></div></details><p>ä¸æ¨èç¼–å†™ä¸Šè¿°<code>then</code>æ–¹æ³•ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“æ­¤ç§æƒ…å½¢<code>Promise</code>ä¼šå¦‚ä½•å¤„ç†æ•´ä½“çš„é€»è¾‘æµç¨‹ã€‚</p><blockquote><p>æ— è®º<code>Promise</code>å®ä¾‹å¤„äºä½•ç§çŠ¶æ€ï¼Œæˆ‘ä»¬æ³¨å†Œå›è°ƒå‡½æ•°éƒ½å°†å¼‚æ­¥æ‰§è¡Œã€‚</p></blockquote><p>å…¶æ¬¡ï¼Œ<code>catch</code>æ–¹æ³•å¯ä»¥ç†è§£ä¸º<code>then</code>æ–¹æ³•çš„è¯­æ³•ç³–å½¢å¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†<code>then(undefiled, onRejected)</code>è§†ä¸º<code>catch(onRejected)</code>ä¸€ç§å½¢å¼ï¼Œå¼€å‘è€…å¯ä»¥è‡ªç”±é€‰æ‹©å¦‚ä½•ç¼–å†™<code>Promise</code>å®ä¾‹ä»<code>pending</code>è½¬ä¸º<code>settled</code>çŠ¶æ€åçš„å¼‚æ­¥å›è°ƒå‡½æ•°ã€‚</p><p>æœ€åï¼Œ<code>finally</code>æ–¹æ³•åˆ™ç›¸å½“äºæ³¨å†Œä¸€ä¸ª<code>Promise</code>å®ä¾‹<code>settled</code>ä¹‹åçš„æ¸…ç†æ–¹æ³•ï¼Œé€šå¸¸æˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¸€ä¸ªå…·æœ‰æ¸…ç†åŠŸèƒ½çš„å‡½æ•°ä½œä¸ºå‚æ•°ã€‚</p><blockquote><p><code>finally</code>è¿”å›ä¸€ä¸ªæ–°çš„<code>Promise</code>å®ä¾‹ï¼Œ<code>finally</code>è®¾è®¡ä¸ºä¸€ä¸ªä¸çŠ¶æ€æ— å…³çš„æ–¹æ³•ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹åªæ˜¯ä¼ é€’ä¸Šå±‚çš„<code>Promise</code>ï¼Œé™¤éæ˜¾å¼åœ°è¿”å›ä¸€ä¸ªæ–°çš„<code>Promise</code>å®ä¾‹ï¼Œæˆ–è€…æŠ›å‡ºå¼‚å¸¸è¿”å›<code>Rejected</code>çŠ¶æ€çš„å®ä¾‹ã€‚</p></blockquote><p>è®©æˆ‘ä»¬æ¥å†™ä¸€ä¸ªç¤ºä¾‹ï¼š</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">new Promise((resolve ,reject) =&gt; resolve(1))
  .then(() =&gt; {
    console.log(&#x27;1&#x27;);
  })
  .then((v) =&gt; {
    console.log(&#x27;2&#x27;, v);
    throw new Error(&#x27;my error&#x27;)
  })
  .then(() =&gt; {
    console.log(&#x27;3&#x27;);
  })
  .catch(err =&gt; {
    console.log(&#x27;catch any error&#x27;);
    return 4 // æˆ–è€… return Promise.resolve(4)
  })
  .then((v) =&gt; {
    console.log(&#x27;4&#x27;, v);
    return 5
  })
  .finally(() =&gt; {
    console.log(&#x27;finally&#x27;);
  })
  .then(v =&gt; {
    console.log(5, v);
  })
// output
1
2 undefined
catch any error
4 4
finally
5 5</code></pre></div></div></details><blockquote><p><code>Promise</code>å®ä¾‹æ”¯æŒé“¾å¼è°ƒç”¨,æ¯ä¸ª<code>then</code>å‡½æ•°å†…éƒ¨æœ€åå°†è¿”å›ä¸€ä¸ªå…¨æ–°çš„<code>promise</code>å®ä¾‹ã€‚</p></blockquote><p><code>then</code>æ–¹æ³•é»˜è®¤è¿”å›ä¸€ä¸ªå€¼ä¸º<code>undefined</code>,çŠ¶æ€ä¸º<code>fulfilled</code>çš„<code>Promise</code>å®ä¾‹.</p><blockquote><p><code>å›è°ƒå‡½æ•°</code>çš„å†™æ³•ç¼–å†™å¯ä»¥ä¸€æ¬¡æ€§ç›‘å¬æ‰€æœ‰å›è°ƒå‡½æ•°çš„é”™è¯¯å¤„ç†é€»è¾‘æ˜¯å¾ˆå›°éš¾çš„,<code>Promiseå®ä¾‹</code>çš„å®ä¾‹æ–¹æ³•<code>catch</code>èƒ½å¤„ç†é“¾å¼è°ƒç”¨ä¹‹å‰æ‰€æœ‰çš„<code>then</code>å‡½æ•°é”™è¯¯å’Œæ˜¾å¼çš„<code>reject</code>è¡Œä¸º.</p></blockquote><p><code>catch</code>æ–¹æ³•èƒ½å¤„ç†é“¾å¼è°ƒç”¨ä¹‹å‰æ‰€æœ‰çš„å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å‰é¢çš„<code>Promise</code>çŠ¶æ€è½¬ä¸º<code>rejected</code>çš„æ—¶å€™ï¼Œä¼š&quot;è·³è¿‡&quot;<code>then</code>æ–¹æ³•ï¼Œä»è€Œæ‰§è¡Œ<code>catch</code>æ–¹æ³•æ³¨å†Œçš„å¼‚æ­¥å›è°ƒã€‚</p><blockquote><p><code>Promise</code>çš„å¼‚æ­¥æ³¨å†Œç›‘å¬å‡½æ•°çš„æ‰§è¡Œé¡ºåºå–å†³äºä½¿ç”¨å®ä¾‹æ–¹æ³•æ·»åŠ çš„é¡ºåºã€‚</p></blockquote><h2 id="23-promise-">2.3 Promise é™æ€æ–¹æ³•</h2><p><code>Promise</code>ç±»å…·æœ‰ä¸¤ä¸ªèƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹çš„é™æ€æ–¹æ³•:</p><ul><li>Promise.resolve(value)</li><li>Promise.reject(reason)</li></ul><p>äºŒè€…åŒºåˆ«åœ¨äºè¿”å›çš„<code>promise</code>å®ä¾‹çš„çŠ¶æ€,å‰è€…ä¸º<code>fulfilled</code>,åè€…ä¸º<code>rejected</code>.</p><p><code>Promise.resolve(value)</code>å¯ä»¥è§†ä¸ºä»¥ä¸‹ä»£ç çš„ç®€å†™:</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">new Promise((resolve) =&gt; {
  resolve(value);
});</code></pre></div></div></details><p><code>Promise.reject(reason)</code>äº¦ç±»ä¼¼ã€‚</p><p>å†æ¬¡é‡ç”³ï¼Œä¼ å…¥çš„å®å‚<code>ï¼ˆvalue/reasonï¼‰</code>å¯ä»¥æœ‰å‡ ç§æƒ…å½¢ï¼š</p><ul><li>å¦‚æœ<code>value</code>æ˜¯ä¸€ä¸ªåŸå§‹æ•°æ®ç±»å‹çš„å€¼ï¼Œåˆ™è®¾ç½®<code>Promise</code>å®ä¾‹å€¼ä¸ºæ­¤å€¼ï¼ŒçŠ¶æ€è®¾ç½®ä¸º<code>fulfilled</code></li><li>å¦‚æœ<code>value</code>æ˜¯ä¸€ä¸ª<code>Promise</code>å®ä¾‹ï¼Œåˆ™æ²¿ç”¨æ­¤å®ä¾‹çš„çŠ¶æ€å’Œå€¼ã€‚</li><li>å¦‚æœä¼ å…¥çš„å®å‚æ˜¯ä¸€ä¸ªé<code>Promise</code>çš„<code>thenable</code>å¯¹è±¡ï¼Œåˆ™è°ƒç”¨æ­¤å¯¹è±¡çš„<code>then</code>æ–¹æ³•ï¼Œå¹¶ä¸”ä¼ å…¥<code>resolve</code>å’Œ<code>reject</code>ä½œä¸ºå®å‚,å°†<code>then</code>æ–¹æ³•ä½œä¸º<code>executor</code>ï¼Œåœ¨å†…éƒ¨å¯ä»¥è®¾ç½®å½“å‰å®ä¾‹çš„çŠ¶æ€å’Œå€¼, å¿…é¡»æ˜¾ç¤ºè°ƒç”¨<code>resolve</code>æˆ–è€…<code>reject</code>æ–¹æ³•ï¼Œä½¿ç”¨<code>return</code>å…¶ä»–å€¼åˆ™æ— æ•ˆã€‚</li></ul><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">const obj = {
  name: &#x27;o&#x27;,
  then() {
    console.log(&#x27;this is then&#x27;, arguments);
    arguments[1](1)
  }
}
const p = Promise.resolve(obj)
p
    .then(r =&gt; console.log(&#x27;resolve&#x27;, r))
  .catch(r =&gt; {
        console.log(&#x27;reject&#x27;, r);
    })

// output
this is then [Arguments] {
  &#x27;0&#x27;: [Function (anonymous)],
  &#x27;1&#x27;: [Function (anonymous)]
}
reject 1</code></pre></div></div></details><p>æ­¤å¤–,<code>Promise</code>ç±»è¿˜æœ‰å¦‚ä¸‹å‡ ä¸ªé™æ€æ–¹æ³•:</p><ul><li><code>Promise.all(iterable)</code></li><li><code>Promise.race(iterable)</code></li><li><code>Promise.any(iterable)</code></li><li><code>Promise.allSettled(iterable)</code></li></ul><p>è¿™å‡ ä¸ªé™æ€æ–¹æ³•å„æœ‰å…¶åº”ç”¨åœºæ™¯.</p><blockquote><p>æ˜¯å¦æ”¯æŒè¿™äº›é™æ€æ–¹æ³•å–å†³äºå½“å‰ç¯å¢ƒ,ä¾‹å¦‚åœ¨<code>IE</code>æµè§ˆå™¨ä¸‹æ— æ³•ä½¿ç”¨<code>Promise</code>ï¼Œåœ¨<code>Node14</code>ä¸‹æ— æ³•ä½¿ç”¨<code>Promise.allSettled</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“æ¥è¿›è¡Œæ›¿æ¢ï¼Œä¾‹å¦‚<code>bluebird</code>ã€‚</p></blockquote><h3 id="221-all">2.2.1 all</h3><p>é¦–å…ˆ,<code>Promise.all(iterable)</code>æ–¹æ³•æ¥æ”¶ä¸€ä¸ª<code>iterable</code>å¯¹è±¡ï¼ˆé€šå¸¸æ˜¯æ•°ç»„ï¼‰ä½œä¸ºå‚æ•°,æœ€ç»ˆè¿”å›ä¸€ä¸ªæ–°çš„<code>promise å®ä¾‹</code>.</p><blockquote><p>å¦‚æœ<code>iterable</code>å¯¹è±¡æ˜¯ç©ºçš„,åˆ™è¿”å›çš„ç»“æœæ˜¯ç©ºæ•°ç»„(å°½ç®¡æˆ‘ä»¬ä¸å¤ªä¼šè¿™ä¹ˆåš).</p></blockquote><p>æˆ‘ä»¬é€šè¿‡ç¤ºä¾‹ä»£ç æ¥ç†è§£è§„èŒƒ:</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">let p1 = Promise.all([1, Promise.resolve(2)]);</code></pre></div></div></details><p>åˆæˆçš„<code>Promise</code>å°†åœ¨æ‰€æœ‰å†…éƒ¨<code>Promise</code>å®ä¾‹è½¬åŒ–ä¸º<code>Fulfilled</code>çŠ¶æ€åè½¬æ¢ä¸º<code>Fulfilled</code>çŠ¶æ€ï¼Œå…¶å€¼æ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡è½¬åŒ–ä¸º<code>Promise</code>è§£å†³ä¹‹åçš„å€¼çš„æ•°ç»„ã€‚</p><blockquote><p>å¯è¿­ä»£å¯¹è±¡å°†ä¼šé€šè¿‡<code>Promise.resolve</code>æ–¹æ³•è½¬æ¢ä¸º<code>Promise</code>å®ä¾‹ã€‚</p></blockquote><p>å¦‚æœä¸€æ—¦å…¶ä¸­ä¹‹ä¸€å‡ºç°<code>rejected</code>çŠ¶æ€çš„<code>promise å®ä¾‹</code>,åˆ™åˆæˆçš„<code>Promise</code>å®ä¾‹çš„çŠ¶æ€è½¬åŒ–ä¸º<code>rejected</code>,ä¸”å€¼ä¸ºæœ€å…ˆå‡ºç°çš„<code>rejected</code>çŠ¶æ€å®ä¾‹çš„å€¼.</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>Promise.all</code>æ¥æ‰§è¡Œä¸€ç»„å¼‚æ­¥æ“ä½œ,è¿™äº›æ“ä½œçš„æ—¶é—´èŠ±è´¹å–å†³äºæœ€é•¿çš„é‚£ä¸ªå…ƒç´ ,å¹¶ä¸”æœ€ç»ˆå¦‚æœä¸€åˆ‡é¡ºåˆ©,åˆ™ç»“æœçš„é¡ºåºæ˜¯ä¸å˜çš„.</p><p><code>Promise.all()</code>æ–¹æ³•é€‚ç”¨äº<code>åˆå¹¶è¯·æ±‚</code>çš„åœºæ™¯,ä¾‹å¦‚æŸäº›é¡¹ç›®ä¸­,æäº¤çš„å¤šä¸ªæ•°æ®éœ€è¦è°ƒç”¨äº‘ç«¯æ¥å£è¿›è¡Œæ•°æ®æ ¡éªŒ,å½“æ‰€æœ‰æ•°æ®éƒ½é€šè¿‡æ ¡éªŒçš„æ—¶å€™æ‰èƒ½æ‰§è¡Œä¸‹ä¸€æ­¥æ“ä½œ,æ¥çœ‹çœ‹ä»£ç :</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">// æœ‰ä¸€ä¸ªè¿”å› promise å¯¹è±¡çš„ asyncApi å‡½æ•°
// æ¯ä¸€ä¸ª test å‡½æ•°éƒ½æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„æµ‹è¯•
const test = (value) =&gt; asyncApi(value);
Promise.all([test(&quot;xxx&quot;), test(&quot;xx&quot;), test(&quot;x&quot;)])
  .then((results) =&gt; {
    results.forEach((result) =&gt; {
      // balabala ä½ çš„ä»£ç é€»è¾‘
      // éƒ½é€šè¿‡äº†
    });
    // do more...
  })
  .catch((error) =&gt; {
    // å¤±è´¥çš„å€¼, balabala
    console.log(error);
  });</code></pre></div></div></details><h3 id="222-race">2.2.2 race</h3><p><code>Promise.race(iterable)</code>å¦‚å…¶å,ç±»ä¼¼äº<code>Promise.all()</code>,æ¥æ”¶åŒç±»å‹å‚æ•°,ä¸€æ—¦è¿­ä»£å™¨ä¸­æŸä¸ª<code>promise</code>çŠ¶æ€è½¬åŒ–ä¸º<code>settled</code>,ç«‹å³è¿”å›æ­¤<code>Promise</code>å®ä¾‹.</p><blockquote><p>ä¼ å…¥çš„è¿­ä»£ä¸ºç©ºçš„è¯,è¿”å›çš„<code>promise</code>å§‹ç»ˆ<code>pending</code>.</p></blockquote><p><code>Promise.race()</code>éå¸¸é€‚åˆåšå¼‚æ­¥è¯·æ±‚çš„<code>è¶…æ—¶</code>å¤„ç†.æ¥çœ‹ä¸€ä¸ªä¾‹å­:</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">// asyncApi() è¿”å› promise
function timeout(ms) {
  return new Promise((resolve, reject) =&gt; {
    setTimeout(() =&gt; {
      reject(`timeout: ${ms} ms`);
    }, ms);
  });
}

Promise.race([asyncApi(&quot;xx&quot;), timeout(5000)])
  .then((res) =&gt; {
    // success
  })
  .catch((error) =&gt; {
    // timeout or error
  });</code></pre></div></div></details><h3 id="223-any">2.2.3 any</h3><p><code>Promise.any(iterable)</code>æ˜¯<code>Promise.all()</code>çš„åé¢,å…¶è¯­æ³•æ— å¼‚.</p><p>éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœä¼ å…¥çš„è¿­ä»£å™¨æ˜¯ç©ºçš„,åˆ™è¿”å›<code>rejected</code>çš„<code>promise</code>å®ä¾‹.åªè¦æœ‰ä¸€ä¸ªæˆåŠŸ,åˆ™è¿”å›æ­¤ç»“æœ.å¦‚æœè¿­ä»£å™¨å†…çš„<code>promise</code>å…¨éƒ¨è¿”å›<code>rejected</code>çŠ¶æ€,åˆ™æœ€ç»ˆè¿”å›<code>rejected</code>çš„<code>promise</code>å®ä¾‹.</p><p>å› æ­¤,æ­¤æ–¹æ³•é€‚ç”¨äºéªŒè¯å¤šä¸ªå¼‚æ­¥ç»“æœä¸­æ˜¯å¦æœ‰<code>fulfilled</code>çš„<code>promise</code>å®ä¾‹.</p><p>å¦‚æœæˆ‘ä»¬éœ€è¦å‘å¤šä¸ªæ•°æ®æºè·å–æŸä¸€ä¸ªæ•°æ®,åˆ™å¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•æœ€å¿«é€Ÿçš„è·å–åˆ°æ•°æ®,äº¦æˆ–è€…æ‰€æœ‰å¼‚æ­¥è¯·æ±‚éƒ½å¤±è´¥.</p><h3 id="224-allsettled">2.2.4 allSettled</h3><p><code>Promise.allSettled(iterable)</code>æ–¹æ³•è¿”å›ä¸€ä¸ªåœ¨æ‰€æœ‰ç»™å®šçš„<code>promise</code>è½¬ä¸º<code>settled</code>çŠ¶æ€åçš„æ•°ç»„,æ•°ç»„å…ƒç´ æ˜¯æ¯ä¸€ä¸ª<code>promise</code>ç»“æœ.</p><p>å¦‚æœæˆ‘ä»¬æœ‰å¤šä¸ªäº’ä¸ä¾èµ–çš„<code>å¼‚æ­¥ä»»åŠ¡</code>,æˆ–è€…æˆ‘ä»¬æ€»æƒ³çŸ¥é“æ¯ä¸ª<code>promise</code>çš„ç»“æœ,è€Œä¸éœ€è¦å…¶ä¸­çš„<code>rejected</code>çŠ¶æ€<code>promise</code>å»å¼•å‘<code>catch</code>,æ¥çœ‹çœ‹<code>MDN</code>çš„ä¾‹å­:</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">const promise1 = Promise.resolve(3);
const promise2 = new Promise((resolve, reject) =&gt;
  setTimeout(reject, 100, &quot;foo&quot;)
);
const promises = [promise1, promise2];

Promise.allSettled(promises).then((results) =&gt;
  results.forEach((result) =&gt; console.log(result))
);</code></pre></div></div></details><p>è¾“å‡ºæ˜¯:</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-shell">&gt; Object { status: &quot;fulfilled&quot;, value: 3 }
&gt; Object { status: &quot;rejected&quot;, reason: &quot;foo&quot; }</code></pre></div></div></details><p>å¦‚ä¸Šæ‰€ç¤º,çŠ¶æ€ä¸º<code>fulfilled</code>æ—¶,å…·æœ‰<code>value</code>,çŠ¶æ€ä¸º<code>rejected</code>æ—¶,å…·æœ‰<code>reason</code>.</p><p>è¿˜è®°å¾—æˆ‘ä»¬åœ¨<code>Promise.all()</code>ä¸­çš„è¿­ä»£å™¨è¿”å›çš„æ˜¯<code>promise.catch(err =&gt; err)</code>å—?å…¶å®,ä½¿ç”¨<code>Promise.allSettled()</code>ç›¸å¯¹æ›´å¥½.</p><h2 id="23-promise-">2.3 Promise çš„ä¼˜åŠ£</h2><p><code>Promise</code>çš„å‡ºç°ä¿ƒè¿›äº†<code>å¼‚æ­¥</code>ç¼–ç¨‹çš„å‘å±•,æˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨ç«¯å’Œ<code>node</code>ç«¯çœ‹åˆ°ç»Ÿä¸€çš„<code>Promise</code>ä»£ç .è¿˜è®°å¾—<code>callback</code>å›è°ƒå‡½æ•°çš„å‚æ•°çº¦å®šå—?</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">function foo(param, (err, data) =&gt; {
  if(err) {
    // balabala
  }
  // balabala
})</code></pre></div></div></details><p>è¿™ç§å‚æ•°çº¦å®šæ˜¯è„†å¼±çš„,å¼€å‘è€…å¯ä»¥ä¸æŒ‰æ­¤çº¦å®šç¼–å†™å›è°ƒå‡½æ•°,è¿™ç±»éšè—<code>bug</code>å¯èƒ½å°±æ­¤è€Œç”Ÿ.</p><p><code>Promise</code>çš„å‡ºç°,æˆ‘ä»¬å¿…é¡»ä½¿ç”¨å…¶å®ä¾‹æ–¹æ³•<code>then</code>å’Œ<code>catch</code>å»æŒ‰è§„èŒƒç¼–ç ,å¦åˆ™å°†ä¼šå‡ºé”™,å¼€å‘è€…ä¹Ÿå¯ä»¥çœ‹åˆ°æ˜æ˜¾çš„é”™è¯¯æç¤ºä¿¡æ¯.</p><p>æˆ‘ä»¬å†æ¥çœ‹çœ‹å¦‚ä¸‹ä¸¤ä¸ªä¾‹å­:</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">// callback
fs.readFile(name, opts?, (err, string|Buffer) =&gt; void)
// Promise
readFilePromisified(name, opts?): Promise&lt;string | Buffer&gt;</code></pre></div></div></details><p><code>Promise</code>æ–¹æ¡ˆè®©å‡½æ•°å‚æ•°å’Œå›è°ƒè§£è€¦å¼€æ¥,æ‰€æœ‰çš„å‚æ•°éƒ½ç”¨äºæ­¤å‡½æ•°çš„è¾“å…¥.</p><p><code>Promise</code>åœ¨å¤„ç†å•æ¬¡å¼‚æ­¥ä»»åŠ¡çš„æ—¶å€™è¡¨ç°è‰¯å¥½,ä½†æ˜¯å¯¹äºå¤šæ¬¡è§¦å‘çš„ä»»åŠ¡ä¾¿æ˜¾å¾—ä¹åŠ›,ä¹Ÿè®¸æˆ‘ä»¬éœ€è¦å­¦ä¹ ä¸€äº›<code>å“åº”å¼ç¼–ç¨‹</code>æŠ€æœ¯,ä»¥è§£å†³æ­¤ç±»é—®é¢˜.</p><p>å¯¹äº<code>ES6 Promise</code>æ¥è¯´,ç¼ºä¹ä¸¤é¡¹å¾ˆå®ç”¨çš„åŠŸèƒ½:</p><ul><li>å–æ¶ˆä»»åŠ¡(åœ¨ç»„ä»¶è¢«åˆ é™¤åå–æ¶ˆå¼‚æ­¥ä»»åŠ¡ç­‰)ï¼ŒTC39 å§”å‘˜ä¼šå®é™…ä¸Šå‡†å¤‡å¢åŠ æ­¤ç‰¹æ€§ï¼Œä½†æœ€ç»ˆææ¡ˆè¢«æ’¤å›äº†ï¼Œä½†æ˜¯æ²¡å…³ç³»ï¼Œ<code>Bluebird</code>å®ç°äº†æ­¤åŠŸèƒ½ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹æ­¤ç‰¹æ€§è¿›è¡Œè¡¥å……ï¼Œä¾‹å¦‚åˆ©ç”¨<code>setTimeout</code>å®šæ—¶å™¨å‡½æ•°å¯ä»¥è¢«å–æ¶ˆçš„ç‰¹æ€§ï¼Œç¼–å†™ä¸€äº›é€»è¾‘ä»£ç å’Œ<code>Promise</code>å–æ¶ˆçŠ¶æ€è½¬æ¢çš„åŠŸèƒ½å‡½æ•°ã€‚</li><li>è¿›åº¦è¿½è¸ª(æ˜¾ç¤ºè¿›åº¦æ¡ç­‰)ï¼ŒåŸç”Ÿä¸æ”¯æŒæ­¤ç‰¹æ€§çš„åŸå› æ˜¯æ‹…å¿ƒæ­¤ç‰¹æ€§ä¼šå¯¼è‡´<code>Promise</code>çš„é“¾å¼è°ƒç”¨å’Œç±»ä¼¼<code>all</code>é™æ€æ–¹æ³•çš„å¤æ‚åº¦å¢åŠ ã€‚</li></ul><p>åŸç”Ÿ<code>Promise</code>æš‚æœªæ”¯æŒä¸Šè¿°ä¸¤é¡¹ç‰¹æ€§,ä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥çœ‹çœ‹ç±»ä¼¼<code>Bluebird</code>è¿™æ ·çš„ç¬¬ä¸‰æ–¹åº“ï¼Œå®ƒä»¬åŠŸèƒ½å¼ºå¤§å¹¶ä¸”è¢«å¹¿æ³›ä½¿ç”¨ï¼Œå€¼å¾—ä¿¡èµ–ã€‚</p><h1 id="3-async--await">3. async / await</h1><p>æåŠå¼‚æ­¥å‡½æ•°ï¼Œ<code>async/await</code>è¯­æ³•å…³é”®å­—ä¸€å®šæ˜¯ç»•ä¸å¼€çš„çŸ¥è¯†ç‚¹ï¼Œè¿™æ˜¯ä¸€ç§ä½¿ç”¨ <code>Promise</code>çš„ç‰¹æ®Šè¯­æ³•ï¼Œå¹¶ä¸”éå¸¸å®¹æ˜“ç†è§£å’Œä½¿ç”¨ã€‚</p><p>æˆ‘ä»¬ç›´æ¥çœ‹ç¤ºä¾‹ï¼š</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">async function foo() {
  // balabala
  return 1;
}</code></pre></div></div></details><blockquote><p>å¯ä»¥ç†è§£ä¸º async å‡½æ•°æœ€åæ˜¾å¼è¿”å›çš„å€¼ç»è¿‡ Promise.resolve å‡½æ•°çš„è½¬åŒ–ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ Promise å®ä¾‹</p></blockquote><p>åœ¨å‡½æ•°å‰æ·»åŠ <code>async</code>æ ‡è¯†æ­¤å‡½æ•°æ€»æ˜¯è¿”å›ä¸€ä¸ª<code>Promise</code>å®ä¾‹,å³ä½¿æˆ‘ä»¬æ˜¾ç¤ºæŒ‡å®šå…¶ä»–çš„ç±»å‹å€¼çš„è¿”å›å€¼ï¼Œä¹Ÿä¼šè¢«åŒ…è£…æˆä¸€ä¸ª<code>Promise</code>å¹¶è¿”å›ï¼Œå½“ç„¶ï¼Œä¾ç„¶æ¨èæ˜¾ç¤ºåœ°æŒ‡å®šè¿”å›<code>Promise</code>ã€‚</p><p>ä½¿ç”¨<code>async</code>å…³é”®å­—å¯ä»¥è®©å‡½æ•°å…·æœ‰<code>å¼‚æ­¥</code>ç‰¹å¾ï¼Œä½†æ€»ä½“ä¸Šä»£ç ä¾ç„¶æ˜¯<code>åŒæ­¥</code>æ±‚å€¼çš„ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">async function foo() {
  console.log(1);
}
foo();
console.log(2);
// output
1;
2;</code></pre></div></div></details><blockquote><p>å¼‚æ­¥å‡½æ•°å…·æœ‰æš‚åœå’Œæ¢å¤æ‰§è¡Œçš„åŠŸèƒ½æ˜¯ååˆ†å¿…è¦çš„ã€‚</p></blockquote><p>ä½¿ç”¨<code>await</code>å…³é”®å­—å¯ä»¥æš‚åœå¼‚æ­¥å‡½æ•°çš„æ‰§è¡Œå¹¶ä¸”ç­‰å¾…è¿”å›çš„<code>Promise</code>å®ä¾‹è¿›å…¥<code>settled</code>çŠ¶æ€ã€‚</p><p>å…³é”®è¯<code>await</code>åªåœ¨<code>async</code>å‡½æ•°å†…æœ‰æ•ˆï¼š</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">async function foo() {
  const res = await axios.get(&quot;your url&quot;);
}</code></pre></div></div></details><p>åœ¨æ—¥å¸¸å·¥ä½œä¸­æ— è®ºæ˜¯æµè§ˆå™¨è¿˜æ˜¯<code>Nodejs</code>ï¼Œéƒ½å¯ä»¥çœ‹åˆ°<code>await</code>çš„èº«å½±ã€‚</p><p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬æ›´æ¨èä½¿ç”¨<code>async/await</code>è¯­æ³•ï¼Œå®ƒåˆæœ‰æ€æ ·çš„ç»†èŠ‚éœ€è¦æˆ‘ä»¬å…³æ³¨çš„å‘¢ï¼Ÿ</p><p>æ¥çœ‹ä»¥ä¸‹å‡ ç‚¹ç‰¹æ€§ï¼š</p><ul><li>é¡¶å±‚<code>await</code>ï¼šæ­¤ææ¡ˆå½“å‰ä¾ç„¶æ˜¯ <code>stage 3</code>ï¼Œåœ¨æ­£å¼è¿›å…¥ç¨³å®šç‰ˆä¹‹å‰ï¼Œé¡¶å±‚å¯¹äº<code>await</code>çš„ä½¿ç”¨ä¾ç„¶éœ€è¦ç«‹å³æ‰§è¡Œè¡¨è¾¾å¼ï¼ˆIIFEï¼‰ï¼Œä¸å¹¸çš„æ˜¯ï¼Œè¿™ç§æ¨¡å¼å¯¼è‡´å›¾å½¢æ‰§è¡Œå’Œåº”ç”¨ç¨‹åºçš„é™æ€å¯åˆ†ææ€§çš„ç¡®å®šæ€§é™ä½ã€‚ç”±äºè¿™äº›åŸå› ï¼Œç¼ºå°‘é¡¶å±‚ <code>await</code> è¢«è®¤ä¸ºæ¯”è¯¥åŠŸèƒ½å¸¦æ¥çš„å±å®³æœ‰æ›´é«˜çš„é£é™©ã€‚</li><li>é¡¶å±‚ <code>await</code> ä»…é™äº ES æ¨¡å—ã€‚æ˜ç¡®ä¸æ”¯æŒ<code>CommonJS</code>æ¨¡å—ã€‚</li><li><code>await</code>æ”¯æŒ<code>thenable</code>å¯¹è±¡,å¦‚æœå…¶åæ˜¯ä¸€ä¸ª<code>thenable</code>å¯¹è±¡ï¼Œåˆ™ä¼šæ‰§è¡Œæ­¤å¯¹è±¡çš„<code>then</code>æ–¹æ³•ï¼Œå¹¶ä¸”ä¼ å…¥<code>resolve</code>å’Œ<code>reject</code>å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ª<code>settled</code>çš„<code>Promise</code>å®ä¾‹ã€‚</li><li><code>await</code>å’Œ<code>Promise.all</code>ç­‰é™æ€æ–¹æ³•é…åˆè‰¯å¥½ã€‚</li></ul><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">const res = await Promise.all([
  promise1,
  promise2,
  ...
])</code></pre></div></div></details><ul><li>Error å¤„ç†</li></ul><blockquote><p><code>async/await</code>é…åˆ<code>try...catch..</code>å¯ä»¥æ›´æ¸…æ™°åœ°åŒæ—¶å¤„ç†åŒæ­¥å’Œå¼‚æ­¥çš„å¼‚å¸¸</p></blockquote><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">const makeRequest = async () =&gt; {
  try {
    const data = JSON.parse(await getJSON());
    console.log(data);
  } catch (e) {
    console.log(e);
  }
};</code></pre></div></div></details><p>æ— è®ºæ˜¯å¼‚æ­¥å‡½æ•°<code>getJSON()</code>è¿˜æ˜¯åŒæ­¥å‡½æ•°<code>JSON.parse()</code>éƒ½èƒ½è¢«åŒä¸€ä¸ª<code>try...catch...</code>ç»“æ„å¯¹å¼‚å¸¸è¿›è¡Œå¤„ç†ï¼Œä»£ç é€»è¾‘ç›¸å¯¹ä½¿ç”¨<code>Promise.then / catch</code>çš„æ–¹å¼æ¥è¯´ä¼šæ›´æ¸…æ™°ï¼Œå¯è¯»æ€§æ›´å¼ºã€‚</p><p>ä¹Ÿè®¸å¯è¯»æ€§çš„è¯„åˆ¤æ›´å®¹æ˜“æºæ‚ä¸»è§‚æ„è¯†ï¼Œä½†æ˜¯å¯¹äºå¼‚æ­¥<code>Debug</code>ä»£ç æ¥è¯´ï¼Œ<code>async/await</code>æ˜¾ç„¶æ›´è½»æ¾ã€‚</p><p>ä¸ºä»€ä¹ˆï¼Ÿæˆ‘æƒ³æœ‰ä»¥ä¸‹ä¸¤ç‚¹ç†ç”±ï¼š</p><ul><li>åœ¨<code>then</code>ä¸­éš¾ä»¥å¯¹ç®­å¤´å‡½æ•°ä¸‹æ–­ç‚¹</li><li>å³ä½¿æ˜¯åœ¨ <code>then</code>ä¸­ä¸‹äº†æ–­ç‚¹ï¼Œç±»ä¼¼å•æ­¥æ­¥å…¥çš„æ“ä½œä¹Ÿä¸ä¼šå¾—åˆ°é¢„æœŸçš„ç»“æœï¼ŒåŸå› åœ¨äºè¿™ç§è°ƒè¯•æ–¹å¼åªèƒ½åœ¨åŒæ­¥ä»£ç ä¸­ä½¿ç”¨ã€‚</li></ul><p>æˆ‘ä»¬æ¥çœ‹ä¸¤ä¸ªç¤ºä¾‹ï¼š</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">const makeRequest = () =&gt; {
  return callAPromise()
    .then(() =&gt; callAPromise())
    .then(() =&gt; callAPromise());
};
// async / await
const makeRequest = async () =&gt; {
  await callAPromise();
  await callAPromise();
};</code></pre></div></div></details><p>åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­ç”±äº<code>await</code>çš„ç‰¹æ®Šæ€§ï¼Œæˆ‘ä»¬å¯ä»¥åƒè°ƒè¯•åŒæ­¥ä»£ç è¿™ä¹ˆæ–¹ä¾¿è‡ªç„¶ã€‚</p><blockquote><p>å¦å¤–ï¼Œä½¿ç”¨<code>async / await</code>è¯­æ³•ï¼Œæˆ‘ä»¬åº”è¯¥ç•™å¿ƒå¼‚æ­¥ä»£ç çš„å¹³è¡ŒåŠ é€Ÿé—®é¢˜ã€‚</p></blockquote><p>æ¥çœ‹ç¤ºä¾‹ï¼š</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">async function delay(id) {
  return new Promise((res) =&gt; {
    setTimeout(() =&gt; {
      console.log(`task ${id} finished.`);
    }, 1000);
  });
}
async function demo1() {
  await delay(1);
  await delay(2);
  await delay(3);
}
demo1();
// å¦ä¸€ä¸ª demo
async function demo2() {
  const p1 = delay(1);
  const p2 = delay(2);
  const p3 = delay(3);
  await p1;
  await p2;
  await p3;
}</code></pre></div></div></details><p>å¯¹äºæ²¡æœ‰å¼‚æ­¥æ‰§è¡Œé¡ºåºéœ€æ±‚çš„<code>async/await</code>è¯­æ³•æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€æ¬¡æ€§åˆå§‹åŒ–å…¶å¼‚æ­¥ä»»åŠ¡ï¼Œç„¶åå†åˆ†åˆ«ç­‰å¾…å…¶ç»“æœå³å¯ã€‚</p><blockquote><p>åœ¨é‡è§†<code>æ€§èƒ½</code>çš„åº”ç”¨ä¸­ï¼Œä½¿ç”¨<code>async/await</code>è¯­æ³•å¯ä»¥å‡å°‘å†…å­˜çš„å ç”¨ã€‚</p></blockquote><p>åœ¨ä½¿ç”¨<code>new Promise</code>åˆå§‹åŒ–æ—¶ï¼Œæˆ‘ä»¬åˆ›å»º<code>Promise</code>å®ä¾‹çš„å‡½æ•°å³ä½¿æ˜¯åœ¨å¤„ç†ç¨‹åºè½¬æ¢<code>Promise</code>å®ä¾‹çš„çŠ¶æ€æ—¶ä¾ç„¶è¢«ä¿å­˜åœ¨æ ˆè¿½è¸ªä¿¡æ¯å†…ï¼Œç„¶è€Œæˆ‘ä»¬çŸ¥é“è¿™äº›ä¿¡æ¯éšç€åˆå§‹åŒ–å‡½æ•°çš„è¿”å›å…¶å®å·²ç»æ²¡æœ‰å¿…è¦å­˜åœ¨äº†ï¼Œä½†æ˜¯<code>Javascript</code>å¼•æ“ä¼šåœ¨åˆ›å»º<code>Promise</code>æ—¶å°½å¯èƒ½ä¿å­˜å®Œæ•´çš„è°ƒç”¨æ ˆï¼Œåœ¨æŠ›å‡ºé”™è¯¯æ—¶è°ƒç”¨æ ˆå¯ä»¥ç”±è¿è¡Œæ—¶çš„é”™è¯¯å¤„ç†é€»è¾‘è·å–ï¼Œæ•…æˆ‘ä»¬èƒ½åœ¨æ ˆè¿½è¸ªä¿¡æ¯ä¸­çœ‹åˆ°å®ƒä»¬ï¼Œæœ€ç»ˆå ç”¨ä¸€äº›å†…å­˜ï¼Œå¢åŠ äº†è®¡ç®—å’Œå­˜å‚¨æˆæœ¬ã€‚</p><p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨<code>async/await</code>è¯­æ³•ï¼š</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">function fooPromiseExecutor(resolve, reject) {
  setTimeout(reject, 1000, &quot;bar&quot;);
}

async function foo() {
  await new Promise(fooPromiseExecutor);
}
foo();
/// Uncaught (in promise) bar
// foo
// async function (async)
// foo</code></pre></div></div></details><p>ç”±äº<code>fooPromiseExecutor</code>å·²ç»è¿”å›ï¼Œæ•…ä¸åœ¨é”™è¯¯ä¿¡æ¯ä¸­äº†ã€‚</p><p><code>Javascript</code>è¿è¡Œæ—¶å¯ä»¥ç®€å•åœ°åœ¨åµŒå¥—å‡½æ•°ä¸­å­˜å‚¨æŒ‡å‘åŒ…å«å‡½æ•°çš„æŒ‡é’ˆï¼Œå°±å¦‚åŒå¯¹å¾…åŒæ­¥å‡½æ•°ä¸€æ ·ï¼ŒæŒ‡é’ˆæ—¶æœºå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œç”¨äºåœ¨å‡ºé”™çš„æ—¶å€™ç”Ÿæˆé”™è¯¯ä¿¡æ¯ï¼Œå¦‚æ­¤ä¸€æ¥ä¾¿çœå»äº†è¿™â€œå¾®å°â€çš„æ¶ˆè€—ã€‚</p><p>æœ€åæˆ‘æƒ³è¯´ï¼Œç›¸å¯¹äºä½¿ç”¨<code>Promise</code>çš„å®ä¾‹æ–¹æ³•æ¥ç¼–å†™å¼‚æ­¥ä»£ç ï¼Œä½¿ç”¨<code>async/await</code>çš„è¯­æ³•ï¼Œæ˜¾ç„¶ä»£ç é‡å°†ä¼šå‡å°‘ ğŸ¶ï¼Œä½•ä¹è€Œä¸ä¸ºï¼Ÿ</p><h1 id="4-promisify">4. Promisify</h1><p><code>Promise</code>å¾ˆæ£’ï¼Œä½†æ˜¯éµå¾ªå¸¸è§çš„é”™è¯¯ä¼˜å…ˆçš„å›è°ƒé£æ ¼çš„å‡½æ•°ä¾ç„¶å¯ä»¥åœ¨è®¸å¤šåœºæ™¯ä¸‹æ´»è·ƒç€ï¼Œæ— è®ºæ˜¯å…¶å¼€å‘è€…åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™è¿˜æœªå‡ºç°<code>Promise</code>ï¼Œäº¦æˆ–æ˜¯å¼€å‘è€…æ›´å–œæ¬¢å›è°ƒé£æ ¼çš„èŒƒå¼ï¼Œè·Ÿè¿™äº›å›è°ƒé£æ ¼çš„å‡½æ•°æ‰“äº¤é“ä¼¼ä¹æ— å¯é¿å…ã€‚</p><blockquote><p>Nodejs å®˜æ–¹æä¾›äº† util.promisify å·¥å…·å‡½æ•°ç”¨äºå°†ä¼ ç»Ÿå›è°ƒé£æ ¼çš„å‡½æ•°è½¬æ¢ä¸ºè¿”å›<code>Promise</code>çš„å‡½æ•°ã€‚</p></blockquote><p>æˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ªå°†<code>callback</code>é£æ ¼çš„å‡½æ•°è½¬æ¢ä¸º<code>Promise</code>é£æ ¼çš„å‡½æ•°çš„å·¥å…·å‡½æ•°ã€‚</p><details open=""><summary class="Code_summary__2YXsZ">Details</summary><div class="Code_container__2ip2n"><div class="Code_header__6pHWW"><div class="CopyCode_normal__JylQA"><div style="cursor:pointer"><svg viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" width="15" height="15"><path d="M11 1.5h2.5v12a1 1 0 01-1 1h-10a1 1 0 01-1-1v-12H4m.5-1h6v2a1 1 0 01-1 1h-4a1 1 0 01-1-1v-2z" stroke="currentColor"></path></svg></div></div></div><div class="Code_code_area__GjtJr"><div class="Code_line_num__3uYIf"><ul></ul></div><pre class="Code_code__1ValO"><code class="lang-js">function promisify(f, multiArgs = false) {
  return function (...args) {
    return new Promise((resolve, reject) =&gt; {
      function callback(err, ...results) {
        err ? reject(err) : resolve(multiArgs ? results : results[0]);
      }
      args.push(callback);
      f.call(this, ...args);
    });
  };
}

const fs = require(&quot;fs&quot;);
const fsPromise = promisify(fs.readdir);
fsPromise(&quot;.&quot;)
  .then((r) =&gt; {
    console.log(&quot;resolve&quot;, r);
  })
  .catch((r) =&gt; {
    console.log(&quot;reject&quot;, r);
  });
// output
resolve[&quot;index.js&quot;];</code></pre></div></div></details><p>åœ¨è¿™ä¸ªè½¬æ¢è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†åŸæ¥çš„å‡½æ•°åŒ…è£¹è¿›å»ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªå¯æ‰§è¡Œçš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¥æ”¶çš„å‚æ•°è·ŸåŸæ¥çš„<code>å›è°ƒé£æ ¼</code>å‡½æ•°ä¸€è‡´ï¼Œåªæ˜¯å°†ä¹‹è½¬æ¢ä¸º<code>Promise</code>é£æ ¼çš„å‡½æ•°åï¼Œä¼ å‚å¯ä»¥çœç•¥<code>å›è°ƒå‡½æ•°</code>ï¼Œæˆ‘ä»¬åœ¨å†…éƒ¨æ„å»ºäº†ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå¹¶ä¸”å°†ä¹‹ä½œä¸ºåŸå‡½æ•°çš„å›è°ƒéƒ¨åˆ†ä½œä¸ºå‚æ•°ä¼ ç»™äº†è¿”å›å‡½æ•°ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä¼ ç»Ÿå›è°ƒé£æ ¼çš„å‡½æ•°è½¬åŒ–ä¸ºè¿”å›<code>Promise</code>çš„å‡½æ•°äº†ï¼Œæˆ‘ä»¬å¯ä»¥æ”¾å¿ƒä½¿ç”¨<code>Promise</code>çš„æ–°ç‰¹æ€§äº†ã€‚</p><h1 id="">å‚è€ƒ</h1><ul><li><a href="chrome-extension://bocbaocobfecmglnmeaeppambideimao/pdf/viewer.html?file=file%3A%2F%2F%2FUsers%2Fyi%2FDesktop%2Fexploring-es6.pdf">Exploring ES6 - exploring-es6.pdf</a></li><li><a href="https://stackoverflow.com/questions/2069763/difference-between-event-handlers-and-callbacks">architecture - Difference between event handlers and callbacks - Stack Overflow</a></li><li><a href="https://stackoverflow.com/questions/6348494/addeventlistener-vs-onclick">javascript - addEventListener vs onclick - Stack Overflow</a></li><li><a href="http://bluebirdjs.com/docs/getting-started.html">Getting Started | bluebird</a></li><li>JavaScript é«˜çº§ç¨‹åºè®¾è®¡</li><li><a href="https://zh.javascript.info/">ç°ä»£ JavaScript æ•™ç¨‹</a></li><li><a href="https://www.geeksforgeeks.org/javascript-promise-resolve-method/">JavaScript | promise resolve() Method - GeeksforGeeks</a></li><li><a href="https://itnext.io/error-handling-with-async-await-in-js-26c3f20bc06a">Error handling with Async/Await in JS | by Ian Segers | ITNEXT</a></li><li><a href="https://nodejs.dev/learn/understanding-javascript-promises">Understanding JavaScript Promises</a></li><li><a href="http://nodejs.cn/api/util/util_promisify_original.html">util.promisify(original) | Node.js API æ–‡æ¡£</a></li></ul></div></div></div></main><style data-emotion-css="1fic0ux">.css-1fic0ux{border:0;opacity:0.6;border-bottom:0.0625rem solid;width:auto;margin-top:0.5rem;margin-bottom:0.5rem;border-color:inherit;}</style><hr class="css-1fic0ux"/><style data-emotion-css="11i96b0">.css-11i96b0{margin:2rem;text-align:center;}</style><div class="css-11i96b0"><p id="msg">è°¢è°¢ä½ èƒ½çœ‹åˆ°è¿™é‡Œ!<span role="img" aria-label="emoji">ğŸ¤—</span>Â å¦‚æœä½ æœ‰ä»»ä½•æƒ³ä¸æˆ‘è®¨è®ºçš„å†…å®¹,è¯·ç»™æˆ‘å‘é‚®ä»¶.<span role="img" aria-label="emoji">ğŸ•Š</span></p><br/><a style="text-decoration:none" href="mailto:rivenqinyy@gmail.com"><style data-emotion-css="meafa5">.css-meafa5{display:inline-block;padding-left:0.25rem;padding-right:0.25rem;text-transform:uppercase;font-size:0.75rem;border-radius:0.125rem;font-weight:700;white-space:nowrap;vertical-align:middle;background-color:#c6f6d5;color:#22543d;}</style><div class="css-meafa5">æˆ‘çš„é‚®ä»¶</div><span role="img" aria-label="my email">ğŸ“®</span></a><br/><br/><style data-emotion-css="1fb5c92">.css-1fb5c92{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";color:#4A5568;font-size:.7rem;}</style><p class="css-1fb5c92">å¦™æ‰ Â© 2020. All rights reserved.</p></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"slug":"Javascript,I-promise","content":"\nå¤§å®¶å¥½ï¼Œä»Šå¤©æˆ‘ä»¬è¦åˆ†äº«çš„çŸ¥è¯†ç‚¹æ˜¯`Promise`ä¸å¼‚æ­¥ç¼–ç¨‹ã€‚\n\n`Promise`æ˜¯å¯¹å°šä¸å­˜åœ¨ç»“æœçš„å¯¹è±¡çš„ä¸€ä¸ªæ›¿èº«ï¼Œä¹Ÿè®¸ä½ æ›¾çœ‹åˆ°ç±»ä¼¼çš„æœ¯è¯­ï¼Œä¾‹å¦‚`future`/`delay`/`deferred`ç­‰ï¼Œå®é™…ä¸Šè¿™äº›æœ¯è¯­æè¿°çš„æ˜¯ä¸€ä¸ªç›¸åŒçš„æ¦‚å¿µï¼Œéƒ½æ˜¯ä¸€ç§å¼‚æ­¥ç¨‹åºæ‰§è¡Œçš„æœºåˆ¶ã€‚\n\næ¥ä¸‹æ¥æˆ‘ä»¬åˆ†äº«çš„çŸ¥è¯†å°†æ¶‰åŠä»¥ä¸‹å†…å®¹ï¼š\n\n- å‡½æ•°å›è°ƒ\n- Promise æµ…æ\n- Async / await\n- Promisify\n\n# 1. å›è°ƒ\n\nJavaScript è¯­è¨€ä¸ºäº†è®©éƒ¨åˆ†ä»»åŠ¡æŒ‰å¼‚æ­¥çš„æ–¹å¼è¿›è¡Œï¼Œæä¾›äº†ç¼–å†™`å›è°ƒå‡½æ•°`çš„æ–¹æ³•ï¼Œè®©æŸäº›ä»»åŠ¡åœ¨è¾¾æˆä¸€äº›æ¡ä»¶ä¹‹åå†æ‰§è¡Œå¼€å‘è€…æŒ‡å®šçš„`å›è°ƒå‡½æ•°`ã€‚\n\nä¸¾ä¸¤ä¸ªä¾‹å­:\n\n```js\nconst callbackFn = () =\u003e {\n  // balabala\n};\n// browser\nsetTimeout(callbackFn, 1000);\n\n// nodejs\nconst fs = require(\"fs\");\nfs.readFile(\"filename\", (err, data) =\u003e {\n  if (err) throw err;\n  // balabala\n});\n// more\nconsole.log(1);\n```\n\nå¦‚ä¸Šæ‰€ç¤ºï¼Œè¦ä¹ˆå»¶è¿Ÿæ‰§è¡Œå›è°ƒï¼Œè¦ä¹ˆè¯»å–æ–‡ä»¶åæ‰§è¡Œå›è°ƒï¼ŒäºŒè€…éƒ½ä¸ä¼šç«‹å³æ‰§è¡Œä»è€Œé˜»å¡ä¸»çº¿ç¨‹ï¼Œè€Œæ˜¯å„è‡ªå…·æœ‰è‡ªå·±çš„æ‰§è¡Œæ¡ä»¶ï¼Œæ»¡è¶³æ¡ä»¶åæ”¾å…¥ä»»åŠ¡å¾ªç¯é˜Ÿåˆ—ä¸­ç­‰å¾…ä¸»çº¿ç¨‹ç©ºé—²æ‰å¾—ä»¥å–å‡ºå¹¶æ‰§è¡Œã€‚\n\nä¸Šè¿°å›è°ƒå‡½æ•°åœ¨æŸäº›åœºæ™¯ä¸‹æ›¾è®©å¼€å‘è€…å†™å‡ºå¦‚ä¸‹ç±»å‹çš„ä»£ç ï¼š\n\n```js\nfs.readFile(\"file1.txt\", function (err, data) {\n  if (err) throw err;\n  // ...ä¸€äº›æ“ä½œ\n  fs.readFile(\"file2.txt\", function (err, data) {\n    if (err) throw err;\n    // ...ä¸€äº›æ“ä½œ\n    fs.readFile(\"file3.txt\", function (err, data) {\n      if (err) throw err;\n      // ...ä¸€äº›æ“ä½œ\n      fs.readFile(\"file4.txt\", function (err, data) {\n        if (err) throw err;\n        // ...ä¸€äº›æ“ä½œ\n      });\n    });\n  });\n});\n```\n\nä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿå› ä¸ºæŸäº›åœºæ™¯ä¸‹éœ€è¦å¯¹å¼‚æ­¥æ“ä½œè¿›è¡Œæ’åºï¼Œéœ€è¦ä¿è¯è¿è¡Œé€»è¾‘å…·æœ‰ä¸€å®šçš„é¡ºåºï¼Œå¹¶ä¸”è¿˜éœ€è¦å¯¹æ¯ä¸€ä¸ªå›è°ƒè¿›è¡Œé”™è¯¯å¤„ç†ã€‚\n\nä¸Šè¿°æ¡ˆä¾‹çœç•¥äº†çœŸå®çš„é€»è¾‘ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºè¿™ç§å›è°ƒçš„åµŒå¥—è®©ä»£ç å¾ˆå®¹æ˜“å¤±æ§ï¼Œå¹¶ä¸”éš¾ä»¥é˜…è¯»å’Œç»´æŠ¤ã€‚\n\næ— è®ºæ˜¯å†™ä¸‹è¿™æ®µä»£ç çš„äººè¿˜æ˜¯é˜…è¯»è¿™æ®µä»£ç çš„äººéƒ½è¢«å…¶æ‰€\"æŠ˜ç£¨\"ï¼Œæˆ‘ä»¬å°†æ­¤ç±»ä»£ç ç»“æ„ç§°ä¸º`â€œå›è°ƒåœ°ç‹±â€`ã€‚\n\nå³ä½¿æˆ‘ä»¬å°†ä¹‹æ‘Šå¼€ï¼Œä¸ºæ¯ä¸€ä¸ªå›è°ƒå‡½æ•°éƒ½ç¼–å†™ä¸€ä¸ªå…·åçš„ç‹¬ç«‹å‡½æ•°æ¥è°ƒç”¨ï¼Œä¾ç„¶å¯è¯»æ€§ä¸ä½³ï¼š\n\n```js\nfs.readFile(\"file1.txt\", step1);\n\nfunction step1(err, data) {\n  if (err) throw err;\n  // ...\n  fs.readFile(\"file2.txt\", step2);\n}\nfunction step2(err, data) {\n  if (err) throw err;\n  // ...\n  fs.readFile(\"file3.txt\", step3);\n}\nfunction step3(err, data) {\n  if (err) throw err;\n  // ...\n  fs.readFile(\"file4.txt\", step4);\n}\nfunction step4(err, data) {\n  if (err) throw err;\n  // ...\n}\n```\n\nè¿™äº›ç‹¬ç«‹å‡½æ•°çš„å‘½åä¹Ÿè®¸ä¼šè®©å¼€å‘è€…è§‰å¾—éå¸¸ä¸é€‚ï¼Œä¸ºäº†å±•å¼€å±‚å±‚åµŒå¥—ï¼Œæˆ‘ä»¬ç¼–å†™äº†è®¸å¤šå‡ ä¹ä¸ä¼šè¢«`é‡ç”¨`çš„å‡½æ•°ï¼Œå³ä½¿ç°ä»£ç¼–è¾‘å™¨åœ¨ä»£ç è·³è½¬çš„åŠŸèƒ½ä¸Šéå¸¸æ–¹ä¾¿ï¼Œé˜…è¯»æ­¤ç±»ä»£ç çš„æ—¶å€™ä¾ç„¶ä¼šè®©æˆ‘ä»¬ä¸æ–­çš„è½¬ç§»è§†çº¿ã€‚\n\n\u003e â€œæ‡’æƒ°â€ä½¿äººè¿›æ­¥ã€‚\n\nä½¿ç”¨`Promise`,å¯ä»¥é¿å…æ­¤ç±»é—®é¢˜ï¼Œæ˜¾è‘—å‡å°‘ç¼–ç é‡ï¼Œæé«˜ä»£ç çš„å¯è¯»æ€§ã€‚\n\n# 2. Promise\n\n\u003e IE æµè§ˆå™¨ä¸æ”¯æŒ`Promise`,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`bluebird`æˆ–`es6-promise`ç­‰ç¬¬ä¸‰æ–¹åº“.\n\n## 2.1 promise æµ…æ\n\nä½¿ç”¨`new`å®ä¾‹åŒ–çš„`Promise`å¯¹è±¡å…·æœ‰ä¸‰ç§çŠ¶æ€:\n\n- `Fulfilled` - `has resolution`: resolve æˆåŠŸ,è°ƒç”¨ `onFulfilled`å‡½æ•°\n- `Rejected` - `has rejection`: reject, è°ƒç”¨`onRejected`å‡½æ•°\n- `Pending` - `unresolved`: åˆå§‹åŒ–çŠ¶æ€\n\n\u003e çŸ­æ¨ªçº¿å·¦è¾¹æ˜¯`Promise/A+`æœ¯è¯­,è€Œå³è¾¹åˆ™æ˜¯`ES6 Promise`æœ¯è¯­.\n\n![](https://raw.githubusercontent.com/youyiqin/markdown_imgs/master/image-1582215000590-ffa807c19d5f6959de485fc66664e123.png)\n\nåˆå§‹çŠ¶æ€ä¸º`pending`,è½¬ä¸º`Fulfilled`æˆ–è€…`Rejected`ä¹‹åä¸ä¼šå†æœ‰å˜åŒ–.`Fulfilled`å’Œ`Rejected`çŠ¶æ€ä¹Ÿè¢«ç§°ä¸º`Settled`ã€‚\n\n`Promise`çš„çŠ¶æ€æµè½¬å¹¶ä¸å¤æ‚ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦æ³¨æ„å…¶ä¸­ä¸€äº›ç»†èŠ‚ã€‚\n\n\u003e æœ¬æ–‡ä¸ä¼šå¯¹`promise`åšé¢é¢ä¿±åˆ°çš„ä»‹ç»,æ¨èé˜…è¯»å®˜æ–¹æ–‡æ¡£.\n\né¦–å…ˆ,æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ª`promise`å®ä¾‹:\n\n```js\n// å®ä¾‹åŒ–\nconst promise = new Promise((resolve, reject) =\u003e {\n  // balabala\n  if(...) {\n    // å®ä¾‹çŠ¶æ€å˜æ›´ï¼Œè®¾ç½®å€¼\n    resolve(value) // success\n    resolve(...) // å¿½ç•¥\n  } else {\n  \treject(reason) // failure\n  }\n})\n// é“¾å¼è°ƒç”¨ï¼Œå®ä¾‹æ–¹æ³• then è¿”å›ä¸€ä¸ªæ–°çš„å®ä¾‹\npromise\n  .then(function(value) {\n\t\t// balabala\n  })\n\t.then(function(value) {\n\t\t// balabala\n  })\n\t.catch(reason =\u003e {\n  \t// balabala\n  })\n\t.finally(() =\u003e {})\n```\n\nä¸Šè¿°ç¤ºä¾‹å±•ç¤ºäº†`promise`çš„ä¸€äº›ç‰¹æ€§ï¼Œå¦‚å®ä¾‹åŒ–ã€çŠ¶æ€è½¬æ¢èµ‹å€¼ã€é“¾å¼è°ƒç”¨å’Œå¼‚å¸¸å¤„ç†ï¼Œä¸‹é¢æˆ‘ä»¬ä¼šè®²åˆ°é™æ€æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•ã€‚\n\n## 2.1 Promise æ„é€ å™¨\n\næˆ‘ä»¬é€šè¿‡`new Promise(executor)`å®ä¾‹åŒ–ä¸€ä¸ª`promise`çš„æ—¶å€™,å…¶çŠ¶æ€ä¸º`pending`.åœ¨å®ä¾‹åŒ–çš„æ—¶å€™ä¼ å…¥ä¸€ä¸ªå‡½æ•°`executorï¼ˆæ‰§è¡Œå™¨ï¼‰`ï¼Œæ­¤å‡½æ•°å°†ä¼šè·å–ä¸¤ä¸ªå®å‚`resolve`å’Œ`reject`å‡½æ•°ï¼ŒäºŒè€…éƒ½å¯ä»¥æ”¹å˜å®ä¾‹çš„çŠ¶æ€å’Œå€¼ã€‚\n\n\u003e ä¸æä¾› `executor` å°†æŠ›å‡º `typeError`\n\nä¸Šè¿°ä»£ç çš„ç‰‡æ®µï¼š\n\n```js\n// å®ä¾‹åŒ–\nconst promise = new Promise((resolve, reject) =\u003e {\n  // balabala\n  if(...) {\n    // å®ä¾‹çŠ¶æ€å˜æ›´ï¼Œè®¾ç½®å€¼\n    resolve(value) // success\n    resolve(...) // å¿½ç•¥\n  } else {\n  \treject(reason) // failure\n  }\n})\n```\n\néœ€è¦å…³æ³¨ä»¥ä¸‹å‡ ç‚¹ï¼š\n\n- `Executor`å‡½æ•°çš„å‚æ•°æ²¡æœ‰é™åˆ¶ï¼Œä½†é€šå¸¸æˆ‘ä»¬ä¼šå£°æ˜ä¸¤ä¸ªå½¢å‚å‡½æ•°ï¼š`resolve`å’Œ`reject`ï¼Œ`executor`å†…éƒ¨ä½¿ç”¨æ­¤äºŒè€…å¯ä»¥æ˜¾å¼åœ°è½¬æ¢`Promise`å®ä¾‹çš„çŠ¶æ€ï¼Œè®¾ç½®å…¶å€¼ã€‚ï¼ˆä¸ä½¿ç”¨è¿™ä¸¤ä¸ªå‡½æ•°æ¥è½¬æ¢å®ä¾‹çŠ¶æ€æ„å‘³ç€æ­¤å®ä¾‹çš„çŠ¶æ€ä¸ä¼šæ”¹å˜ï¼Œè¿™ä¹Ÿå†™å¹¶æ²¡æœ‰å¤šå¤§æ„ä¹‰ï¼‰ã€‚\n- `resolve`å’Œ`reject`å‡½æ•°çš„å®å‚å¯ä»¥æ˜¯ä¸åŒç±»å‹çš„å€¼ï¼Œä½†æ˜¯ä¼šè¢«è¿›ä¸€æ­¥å¤„ç†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ˜¾ç¤ºè½¬æ¢çŠ¶æ€è®¾ç½®å€¼çš„æ—¶å€™ï¼Œä¼ å…¥çš„å‚æ•°ä¸ä¸€å®šä¼šç›´æ¥ä½œä¸º`settled`çŠ¶æ€çš„å€¼ã€‚\n- `pending`çŠ¶æ€åˆ°`settled`çŠ¶æ€æ˜¯ä¸å¯é€†çš„ï¼Œå¹¶ä¸”åœ¨`executor`ä¸­çš„`resolve`å’Œ`reject`å‡½æ•°åªèƒ½æ‰§è¡Œä¸€æ¬¡ï¼Œåç»­å†æ‰§è¡Œå°†ä¼šè¢«å¿½ç•¥ã€‚\n\n\u003e `executor`å‡½æ•°æ˜¯åŒæ­¥æ‰§è¡Œçš„ã€‚`resolve`å’Œ`reject`å‡½æ•°æ¥æ”¶ä»»æ„ç±»å‹çš„å€¼ã€‚\n\næˆ‘ä»¬æ¥çœ‹çœ‹ç»™`resolve`å‡½æ•°ä¼ å…¥ä»¥ä¸‹ä¸‰ç§ä¸åŒçš„å€¼ä¼šæœ‰æ€æ ·çš„ç»“æœã€‚\n\n- åŸå§‹ç±»å‹å€¼\n- Promise å®ä¾‹\n- thenable å¯¹è±¡\n\né¦–å…ˆæ˜¯`åŸå§‹ç±»å‹å€¼`ï¼š\n\n```js\nconst p = new Promise((resolve, reject) =\u003e {\n  resolve(Symbol())\n  // resolve(1)\n  // resolve('1')\n  // resolve(null)\n  // resolve(undefined)\n  // resolve(1n)\n  // resolve(true)\n  // reject ä¹Ÿæ˜¯å¦‚æ­¤\n})\n\np.then((v) =\u003e {\n  console.log('resolve'ï¼Œ v);\n}).catch((i) =\u003e {\n  console.log('reject', i);\n})\n```\n\nåŸå§‹ç±»å‹æ•°æ®ä¼ å…¥`resolve`å‡½æ•°ï¼Œéƒ½èƒ½é¡ºåˆ©å°†çŠ¶æ€è½¬ä¸º`fulfilled`å¹¶ä¸”è®¾ç½®ä¸ºå½“å‰çŠ¶æ€ä¸‹çš„å€¼ã€‚ä½¿ç”¨`reject`å‡½æ•°åˆ™å°†çŠ¶æ€è½¬ä¸º`rejected`,å€¼åˆ™æ˜¯åŸå§‹ç±»å‹çš„å€¼ã€‚\n\nå…¶æ¬¡ï¼Œæ¥çœ‹çœ‹ä¼ å…¥`Promise`å¯¹è±¡ã€‚\n\n```js\nconst p = new Promise((resolve, reject) =\u003e {\n  resolve(Promise.resolve(1))\n  // or\n  reject(Promise.resolve(1))\n})\np.then((v) =\u003e {\n  console.log('resolve', v);\n}).catch((i) =\u003e {\n  console.log('reject', i)\n})\n// output\nresolve 1\n```\n\nå¦‚æœä¼ å…¥ç»™`promise`çš„å‚æ•°ä¹Ÿæ˜¯ä¸€ä¸ª`Promise`å®ä¾‹ï¼Œåˆ™ç›¸å½“äºä¸€ä¸ªç©ºåŒ…è£…ï¼Œæœ€ç»ˆå°†å¾—åˆ°ä¸€ä¸ªç›¸åŒçŠ¶æ€å’Œå€¼çš„`Promise`å®ä¾‹ã€‚\n\n\u003e `reject(Promise.resolve(1))` ä¸ä¼šç…§æ¬`resolve`çš„ç‰¹æ€§ï¼Œå¯¹äºä¼ å…¥ä¸€ä¸ª`Promise`å®ä¾‹çš„æƒ…å½¢ï¼Œä¼šå°†ä¹‹ä½œä¸º`Rejected`çŠ¶æ€ä¸‹çš„`reason`ã€‚\n\n```js\nconst p = new Promise((resolve, reject) =\u003e {\n  resolve(Promise.reject(1))\n})\n// output\nreject 1\n```\n\næ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹ä¼ å…¥ä¸€ä¸ªæ™®é€šçš„ `thenable` å¯¹è±¡ã€‚\n\n\u003e å…·æœ‰`then`æ–¹æ³•çš„å¯¹è±¡ç§°ä¸º`thenable`å¯¹è±¡ï¼Œ`Promise`å®ä¾‹å¯¹è±¡ä¹Ÿæ˜¯ä¸€ç§`thenable`å¯¹è±¡ã€‚\n\n```js\nconst obj = {\n  name: 'Miao',\n  then() {\n    console.log('this is then', arguments);\n    arguments[0](1)\n  }\n}\nconst p = new Promise((resolve, reject) =\u003e {\n  resolve(obj)\n})\n\np.then((v) =\u003e {\n  console.log('resolve', v);\n}).catch((i) =\u003e {\n  console.log('reject', i)\n})\n// output\nthis is then [Arguments] {\n  '0': [Function (anonymous)],\n  '1': [Function (anonymous)]\n}\nresolve 1\n```\n\n`executor`å†…`resolve`ä¸€ä¸ª`thenable`å¯¹è±¡ï¼Œåˆ™ä¼šå°†`then`æ–¹æ³•è§†ä½œä¸€ä¸ª`executor`ï¼Œåœ¨å…¶å†…éƒ¨å¯ä»¥æ˜¾ç¤ºç¼–å†™`resolve`å’Œ`reject`çš„é€»è¾‘æ¥æ”¹å˜æ•´ä¸ª`Promise`å®ä¾‹çš„çŠ¶æ€å’Œå€¼ã€‚\n\n## 2.2 Promise å®ä¾‹æ–¹æ³•\n\n`Promise`å®ä¾‹æœ‰ä¸‰ä¸ªå®ä¾‹æ–¹æ³•ï¼š\n\n- `then`\n- `catch`\n- `finally`\n\n\u003e é‡ç”³ï¼š`promise`å®ä¾‹çš„çŠ¶æ€è½¬æ¢æ˜¯å•å‘çš„,ä¸€æ—¦`settled`åˆ™ä¸å¯é€†è½¬,åŒæ—¶æˆ‘ä»¬å¯ä»¥å¤šæ¬¡åˆ©ç”¨æ­¤`settled`çŠ¶æ€çš„å®ä¾‹ã€‚\n\né¦–å…ˆæ˜¯`then(onFulfilled, onRejected)`æ–¹æ³•ï¼Œæ­¤æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œåœ¨`Promise`çŠ¶æ€ä¸º`pending`çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ­¤æ–¹æ³•ç†è§£ä¸ºæ³¨å†ŒçŠ¶æ€è½¬å˜ä¸º`Fulfilled`å’Œ`Rejected`åæ‰§è¡Œçš„å›è°ƒå‡½æ•°ï¼Œå¹¶ä¸”è¿™äº›å›è°ƒå‡½æ•°çš„æ‰§è¡Œæ˜¯å¼‚æ­¥çš„ã€‚\n\n\u003e `Promise`åªèƒ½è½¬æ¢ä¸€æ¬¡ï¼Œå› æ­¤ä¸Šè¿°ä¸¤ä¸ªå‚æ•°çš„æ“ä½œæ˜¯äº’æ–¥çš„ã€‚\n\nåœ¨å®ç°ä¸Š`Node`å¯ä»¥é€šè¿‡`process.nextTick`æ¥åˆ›å»ºæ–°çš„å¾®ä»»åŠ¡ï¼Œåœ¨æµè§ˆå™¨ç«¯åˆ™å¯ä»¥é€šè¿‡`MutationObserver`åŠŸèƒ½åˆ›å»ºå¾®ä»»åŠ¡ã€‚\n\nä»¥ä¸‹ä¸¤ç§`then`å‡½æ•°çš„ä¼ å‚éƒ½ä¼šè¢«å¿½ç•¥, å¹¶ä¸”å¼‚æ­¥è¿”å›ä¸€ä¸ªç›¸åŒå€¼çš„`Promise`æ–°å®ä¾‹ï¼š\n\n```js\n// ä¼ éå‡½æ•°å¤„ç†å¯¹è±¡\nPromise.resolve(1).then('sss')\n// ä¸ä¼ å€¼\nPromise.resolve(1).then()\n\nconst p = Promise.resolve(1)\nlet c = p.then()\nconsole.log(p);\nsetTimeout(() =\u003e {\n  console.log(c);\n}, 200);\n// output\nPromise { 1 }\nPromise { 1 }\n```\n\nä¸æ¨èç¼–å†™ä¸Šè¿°`then`æ–¹æ³•ï¼Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“æ­¤ç§æƒ…å½¢`Promise`ä¼šå¦‚ä½•å¤„ç†æ•´ä½“çš„é€»è¾‘æµç¨‹ã€‚\n\n\u003e æ— è®º`Promise`å®ä¾‹å¤„äºä½•ç§çŠ¶æ€ï¼Œæˆ‘ä»¬æ³¨å†Œå›è°ƒå‡½æ•°éƒ½å°†å¼‚æ­¥æ‰§è¡Œã€‚\n\nå…¶æ¬¡ï¼Œ`catch`æ–¹æ³•å¯ä»¥ç†è§£ä¸º`then`æ–¹æ³•çš„è¯­æ³•ç³–å½¢å¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†`then(undefiled, onRejected)`è§†ä¸º`catch(onRejected)`ä¸€ç§å½¢å¼ï¼Œå¼€å‘è€…å¯ä»¥è‡ªç”±é€‰æ‹©å¦‚ä½•ç¼–å†™`Promise`å®ä¾‹ä»`pending`è½¬ä¸º`settled`çŠ¶æ€åçš„å¼‚æ­¥å›è°ƒå‡½æ•°ã€‚\n\næœ€åï¼Œ`finally`æ–¹æ³•åˆ™ç›¸å½“äºæ³¨å†Œä¸€ä¸ª`Promise`å®ä¾‹`settled`ä¹‹åçš„æ¸…ç†æ–¹æ³•ï¼Œé€šå¸¸æˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¸€ä¸ªå…·æœ‰æ¸…ç†åŠŸèƒ½çš„å‡½æ•°ä½œä¸ºå‚æ•°ã€‚\n\n\u003e `finally`è¿”å›ä¸€ä¸ªæ–°çš„`Promise`å®ä¾‹ï¼Œ`finally`è®¾è®¡ä¸ºä¸€ä¸ªä¸çŠ¶æ€æ— å…³çš„æ–¹æ³•ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹åªæ˜¯ä¼ é€’ä¸Šå±‚çš„`Promise`ï¼Œé™¤éæ˜¾å¼åœ°è¿”å›ä¸€ä¸ªæ–°çš„`Promise`å®ä¾‹ï¼Œæˆ–è€…æŠ›å‡ºå¼‚å¸¸è¿”å›`Rejected`çŠ¶æ€çš„å®ä¾‹ã€‚\n\nè®©æˆ‘ä»¬æ¥å†™ä¸€ä¸ªç¤ºä¾‹ï¼š\n\n```js\nnew Promise((resolve ,reject) =\u003e resolve(1))\n  .then(() =\u003e {\n    console.log('1');\n  })\n  .then((v) =\u003e {\n    console.log('2', v);\n    throw new Error('my error')\n  })\n  .then(() =\u003e {\n    console.log('3');\n  })\n  .catch(err =\u003e {\n    console.log('catch any error');\n    return 4 // æˆ–è€… return Promise.resolve(4)\n  })\n  .then((v) =\u003e {\n    console.log('4', v);\n    return 5\n  })\n  .finally(() =\u003e {\n    console.log('finally');\n  })\n  .then(v =\u003e {\n    console.log(5, v);\n  })\n// output\n1\n2 undefined\ncatch any error\n4 4\nfinally\n5 5\n```\n\n\u003e `Promise`å®ä¾‹æ”¯æŒé“¾å¼è°ƒç”¨,æ¯ä¸ª`then`å‡½æ•°å†…éƒ¨æœ€åå°†è¿”å›ä¸€ä¸ªå…¨æ–°çš„`promise`å®ä¾‹ã€‚\n\n`then`æ–¹æ³•é»˜è®¤è¿”å›ä¸€ä¸ªå€¼ä¸º`undefined`,çŠ¶æ€ä¸º`fulfilled`çš„`Promise`å®ä¾‹.\n\n\u003e `å›è°ƒå‡½æ•°`çš„å†™æ³•ç¼–å†™å¯ä»¥ä¸€æ¬¡æ€§ç›‘å¬æ‰€æœ‰å›è°ƒå‡½æ•°çš„é”™è¯¯å¤„ç†é€»è¾‘æ˜¯å¾ˆå›°éš¾çš„,`Promiseå®ä¾‹`çš„å®ä¾‹æ–¹æ³•`catch`èƒ½å¤„ç†é“¾å¼è°ƒç”¨ä¹‹å‰æ‰€æœ‰çš„`then`å‡½æ•°é”™è¯¯å’Œæ˜¾å¼çš„`reject`è¡Œä¸º.\n\n`catch`æ–¹æ³•èƒ½å¤„ç†é“¾å¼è°ƒç”¨ä¹‹å‰æ‰€æœ‰çš„å¼‚å¸¸ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å‰é¢çš„`Promise`çŠ¶æ€è½¬ä¸º`rejected`çš„æ—¶å€™ï¼Œä¼š\"è·³è¿‡\"`then`æ–¹æ³•ï¼Œä»è€Œæ‰§è¡Œ`catch`æ–¹æ³•æ³¨å†Œçš„å¼‚æ­¥å›è°ƒã€‚\n\n\u003e `Promise`çš„å¼‚æ­¥æ³¨å†Œç›‘å¬å‡½æ•°çš„æ‰§è¡Œé¡ºåºå–å†³äºä½¿ç”¨å®ä¾‹æ–¹æ³•æ·»åŠ çš„é¡ºåºã€‚\n\n## 2.3 Promise é™æ€æ–¹æ³•\n\n`Promise`ç±»å…·æœ‰ä¸¤ä¸ªèƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹çš„é™æ€æ–¹æ³•:\n\n- Promise.resolve(value)\n- Promise.reject(reason)\n\näºŒè€…åŒºåˆ«åœ¨äºè¿”å›çš„`promise`å®ä¾‹çš„çŠ¶æ€,å‰è€…ä¸º`fulfilled`,åè€…ä¸º`rejected`.\n\n`Promise.resolve(value)`å¯ä»¥è§†ä¸ºä»¥ä¸‹ä»£ç çš„ç®€å†™:\n\n```js\nnew Promise((resolve) =\u003e {\n  resolve(value);\n});\n```\n\n`Promise.reject(reason)`äº¦ç±»ä¼¼ã€‚\n\nå†æ¬¡é‡ç”³ï¼Œä¼ å…¥çš„å®å‚`ï¼ˆvalue/reasonï¼‰`å¯ä»¥æœ‰å‡ ç§æƒ…å½¢ï¼š\n\n- å¦‚æœ`value`æ˜¯ä¸€ä¸ªåŸå§‹æ•°æ®ç±»å‹çš„å€¼ï¼Œåˆ™è®¾ç½®`Promise`å®ä¾‹å€¼ä¸ºæ­¤å€¼ï¼ŒçŠ¶æ€è®¾ç½®ä¸º`fulfilled`\n- å¦‚æœ`value`æ˜¯ä¸€ä¸ª`Promise`å®ä¾‹ï¼Œåˆ™æ²¿ç”¨æ­¤å®ä¾‹çš„çŠ¶æ€å’Œå€¼ã€‚\n- å¦‚æœä¼ å…¥çš„å®å‚æ˜¯ä¸€ä¸ªé`Promise`çš„`thenable`å¯¹è±¡ï¼Œåˆ™è°ƒç”¨æ­¤å¯¹è±¡çš„`then`æ–¹æ³•ï¼Œå¹¶ä¸”ä¼ å…¥`resolve`å’Œ`reject`ä½œä¸ºå®å‚,å°†`then`æ–¹æ³•ä½œä¸º`executor`ï¼Œåœ¨å†…éƒ¨å¯ä»¥è®¾ç½®å½“å‰å®ä¾‹çš„çŠ¶æ€å’Œå€¼, å¿…é¡»æ˜¾ç¤ºè°ƒç”¨`resolve`æˆ–è€…`reject`æ–¹æ³•ï¼Œä½¿ç”¨`return`å…¶ä»–å€¼åˆ™æ— æ•ˆã€‚\n\n```js\nconst obj = {\n  name: 'o',\n  then() {\n    console.log('this is then', arguments);\n    arguments[1](1)\n  }\n}\nconst p = Promise.resolve(obj)\np\n\t.then(r =\u003e console.log('resolve', r))\n  .catch(r =\u003e {\n\t\tconsole.log('reject', r);\n\t})\n\n// output\nthis is then [Arguments] {\n  '0': [Function (anonymous)],\n  '1': [Function (anonymous)]\n}\nreject 1\n```\n\næ­¤å¤–,`Promise`ç±»è¿˜æœ‰å¦‚ä¸‹å‡ ä¸ªé™æ€æ–¹æ³•:\n\n- `Promise.all(iterable)`\n- `Promise.race(iterable)`\n- `Promise.any(iterable)`\n- `Promise.allSettled(iterable)`\n\nè¿™å‡ ä¸ªé™æ€æ–¹æ³•å„æœ‰å…¶åº”ç”¨åœºæ™¯.\n\n\u003e æ˜¯å¦æ”¯æŒè¿™äº›é™æ€æ–¹æ³•å–å†³äºå½“å‰ç¯å¢ƒ,ä¾‹å¦‚åœ¨`IE`æµè§ˆå™¨ä¸‹æ— æ³•ä½¿ç”¨`Promise`ï¼Œåœ¨`Node14`ä¸‹æ— æ³•ä½¿ç”¨`Promise.allSettled`ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“æ¥è¿›è¡Œæ›¿æ¢ï¼Œä¾‹å¦‚`bluebird`ã€‚\n\n### 2.2.1 all\n\né¦–å…ˆ,`Promise.all(iterable)`æ–¹æ³•æ¥æ”¶ä¸€ä¸ª`iterable`å¯¹è±¡ï¼ˆé€šå¸¸æ˜¯æ•°ç»„ï¼‰ä½œä¸ºå‚æ•°,æœ€ç»ˆè¿”å›ä¸€ä¸ªæ–°çš„`promise å®ä¾‹`.\n\n\u003e å¦‚æœ`iterable`å¯¹è±¡æ˜¯ç©ºçš„,åˆ™è¿”å›çš„ç»“æœæ˜¯ç©ºæ•°ç»„(å°½ç®¡æˆ‘ä»¬ä¸å¤ªä¼šè¿™ä¹ˆåš).\n\næˆ‘ä»¬é€šè¿‡ç¤ºä¾‹ä»£ç æ¥ç†è§£è§„èŒƒ:\n\n```js\nlet p1 = Promise.all([1, Promise.resolve(2)]);\n```\n\nåˆæˆçš„`Promise`å°†åœ¨æ‰€æœ‰å†…éƒ¨`Promise`å®ä¾‹è½¬åŒ–ä¸º`Fulfilled`çŠ¶æ€åè½¬æ¢ä¸º`Fulfilled`çŠ¶æ€ï¼Œå…¶å€¼æ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡è½¬åŒ–ä¸º`Promise`è§£å†³ä¹‹åçš„å€¼çš„æ•°ç»„ã€‚\n\n\u003e å¯è¿­ä»£å¯¹è±¡å°†ä¼šé€šè¿‡`Promise.resolve`æ–¹æ³•è½¬æ¢ä¸º`Promise`å®ä¾‹ã€‚\n\nå¦‚æœä¸€æ—¦å…¶ä¸­ä¹‹ä¸€å‡ºç°`rejected`çŠ¶æ€çš„`promise å®ä¾‹`,åˆ™åˆæˆçš„`Promise`å®ä¾‹çš„çŠ¶æ€è½¬åŒ–ä¸º`rejected`,ä¸”å€¼ä¸ºæœ€å…ˆå‡ºç°çš„`rejected`çŠ¶æ€å®ä¾‹çš„å€¼.\n\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨`Promise.all`æ¥æ‰§è¡Œä¸€ç»„å¼‚æ­¥æ“ä½œ,è¿™äº›æ“ä½œçš„æ—¶é—´èŠ±è´¹å–å†³äºæœ€é•¿çš„é‚£ä¸ªå…ƒç´ ,å¹¶ä¸”æœ€ç»ˆå¦‚æœä¸€åˆ‡é¡ºåˆ©,åˆ™ç»“æœçš„é¡ºåºæ˜¯ä¸å˜çš„.\n\n`Promise.all()`æ–¹æ³•é€‚ç”¨äº`åˆå¹¶è¯·æ±‚`çš„åœºæ™¯,ä¾‹å¦‚æŸäº›é¡¹ç›®ä¸­,æäº¤çš„å¤šä¸ªæ•°æ®éœ€è¦è°ƒç”¨äº‘ç«¯æ¥å£è¿›è¡Œæ•°æ®æ ¡éªŒ,å½“æ‰€æœ‰æ•°æ®éƒ½é€šè¿‡æ ¡éªŒçš„æ—¶å€™æ‰èƒ½æ‰§è¡Œä¸‹ä¸€æ­¥æ“ä½œ,æ¥çœ‹çœ‹ä»£ç :\n\n```js\n// æœ‰ä¸€ä¸ªè¿”å› promise å¯¹è±¡çš„ asyncApi å‡½æ•°\n// æ¯ä¸€ä¸ª test å‡½æ•°éƒ½æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„æµ‹è¯•\nconst test = (value) =\u003e asyncApi(value);\nPromise.all([test(\"xxx\"), test(\"xx\"), test(\"x\")])\n  .then((results) =\u003e {\n    results.forEach((result) =\u003e {\n      // balabala ä½ çš„ä»£ç é€»è¾‘\n      // éƒ½é€šè¿‡äº†\n    });\n    // do more...\n  })\n  .catch((error) =\u003e {\n    // å¤±è´¥çš„å€¼, balabala\n    console.log(error);\n  });\n```\n\n### 2.2.2 race\n\n`Promise.race(iterable)`å¦‚å…¶å,ç±»ä¼¼äº`Promise.all()`,æ¥æ”¶åŒç±»å‹å‚æ•°,ä¸€æ—¦è¿­ä»£å™¨ä¸­æŸä¸ª`promise`çŠ¶æ€è½¬åŒ–ä¸º`settled`,ç«‹å³è¿”å›æ­¤`Promise`å®ä¾‹.\n\n\u003e ä¼ å…¥çš„è¿­ä»£ä¸ºç©ºçš„è¯,è¿”å›çš„`promise`å§‹ç»ˆ`pending`.\n\n`Promise.race()`éå¸¸é€‚åˆåšå¼‚æ­¥è¯·æ±‚çš„`è¶…æ—¶`å¤„ç†.æ¥çœ‹ä¸€ä¸ªä¾‹å­:\n\n```js\n// asyncApi() è¿”å› promise\nfunction timeout(ms) {\n  return new Promise((resolve, reject) =\u003e {\n    setTimeout(() =\u003e {\n      reject(`timeout: ${ms} ms`);\n    }, ms);\n  });\n}\n\nPromise.race([asyncApi(\"xx\"), timeout(5000)])\n  .then((res) =\u003e {\n    // success\n  })\n  .catch((error) =\u003e {\n    // timeout or error\n  });\n```\n\n### 2.2.3 any\n\n`Promise.any(iterable)`æ˜¯`Promise.all()`çš„åé¢,å…¶è¯­æ³•æ— å¼‚.\n\néœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœä¼ å…¥çš„è¿­ä»£å™¨æ˜¯ç©ºçš„,åˆ™è¿”å›`rejected`çš„`promise `å®ä¾‹.åªè¦æœ‰ä¸€ä¸ªæˆåŠŸ,åˆ™è¿”å›æ­¤ç»“æœ.å¦‚æœè¿­ä»£å™¨å†…çš„`promise`å…¨éƒ¨è¿”å›`rejected`çŠ¶æ€,åˆ™æœ€ç»ˆè¿”å›`rejected`çš„`promise`å®ä¾‹.\n\nå› æ­¤,æ­¤æ–¹æ³•é€‚ç”¨äºéªŒè¯å¤šä¸ªå¼‚æ­¥ç»“æœä¸­æ˜¯å¦æœ‰`fulfilled`çš„`promise`å®ä¾‹.\n\nå¦‚æœæˆ‘ä»¬éœ€è¦å‘å¤šä¸ªæ•°æ®æºè·å–æŸä¸€ä¸ªæ•°æ®,åˆ™å¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•æœ€å¿«é€Ÿçš„è·å–åˆ°æ•°æ®,äº¦æˆ–è€…æ‰€æœ‰å¼‚æ­¥è¯·æ±‚éƒ½å¤±è´¥.\n\n### 2.2.4 allSettled\n\n`Promise.allSettled(iterable)`æ–¹æ³•è¿”å›ä¸€ä¸ªåœ¨æ‰€æœ‰ç»™å®šçš„`promise`è½¬ä¸º`settled`çŠ¶æ€åçš„æ•°ç»„,æ•°ç»„å…ƒç´ æ˜¯æ¯ä¸€ä¸ª`promise`ç»“æœ.\n\nå¦‚æœæˆ‘ä»¬æœ‰å¤šä¸ªäº’ä¸ä¾èµ–çš„`å¼‚æ­¥ä»»åŠ¡`,æˆ–è€…æˆ‘ä»¬æ€»æƒ³çŸ¥é“æ¯ä¸ª`promise`çš„ç»“æœ,è€Œä¸éœ€è¦å…¶ä¸­çš„`rejected`çŠ¶æ€`promise`å»å¼•å‘`catch`,æ¥çœ‹çœ‹`MDN`çš„ä¾‹å­:\n\n```js\nconst promise1 = Promise.resolve(3);\nconst promise2 = new Promise((resolve, reject) =\u003e\n  setTimeout(reject, 100, \"foo\")\n);\nconst promises = [promise1, promise2];\n\nPromise.allSettled(promises).then((results) =\u003e\n  results.forEach((result) =\u003e console.log(result))\n);\n```\n\nè¾“å‡ºæ˜¯:\n\n```shell\n\u003e Object { status: \"fulfilled\", value: 3 }\n\u003e Object { status: \"rejected\", reason: \"foo\" }\n```\n\nå¦‚ä¸Šæ‰€ç¤º,çŠ¶æ€ä¸º`fulfilled`æ—¶,å…·æœ‰`value`,çŠ¶æ€ä¸º`rejected`æ—¶,å…·æœ‰`reason`.\n\nè¿˜è®°å¾—æˆ‘ä»¬åœ¨`Promise.all()`ä¸­çš„è¿­ä»£å™¨è¿”å›çš„æ˜¯`promise.catch(err =\u003e err)`å—?å…¶å®,ä½¿ç”¨`Promise.allSettled()`ç›¸å¯¹æ›´å¥½.\n\n## 2.3 Promise çš„ä¼˜åŠ£\n\n`Promise`çš„å‡ºç°ä¿ƒè¿›äº†`å¼‚æ­¥`ç¼–ç¨‹çš„å‘å±•,æˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨ç«¯å’Œ`node`ç«¯çœ‹åˆ°ç»Ÿä¸€çš„`Promise`ä»£ç .è¿˜è®°å¾—`callback`å›è°ƒå‡½æ•°çš„å‚æ•°çº¦å®šå—?\n\n```js\nfunction foo(param, (err, data) =\u003e {\n  if(err) {\n    // balabala\n  }\n  // balabala\n})\n```\n\nè¿™ç§å‚æ•°çº¦å®šæ˜¯è„†å¼±çš„,å¼€å‘è€…å¯ä»¥ä¸æŒ‰æ­¤çº¦å®šç¼–å†™å›è°ƒå‡½æ•°,è¿™ç±»éšè—`bug`å¯èƒ½å°±æ­¤è€Œç”Ÿ.\n\n`Promise`çš„å‡ºç°,æˆ‘ä»¬å¿…é¡»ä½¿ç”¨å…¶å®ä¾‹æ–¹æ³•`then`å’Œ`catch`å»æŒ‰è§„èŒƒç¼–ç ,å¦åˆ™å°†ä¼šå‡ºé”™,å¼€å‘è€…ä¹Ÿå¯ä»¥çœ‹åˆ°æ˜æ˜¾çš„é”™è¯¯æç¤ºä¿¡æ¯.\n\næˆ‘ä»¬å†æ¥çœ‹çœ‹å¦‚ä¸‹ä¸¤ä¸ªä¾‹å­:\n\n```js\n// callback\nfs.readFile(name, opts?, (err, string|Buffer) =\u003e void)\n// Promise\nreadFilePromisified(name, opts?): Promise\u003cstring | Buffer\u003e\n```\n\n`Promise`æ–¹æ¡ˆè®©å‡½æ•°å‚æ•°å’Œå›è°ƒè§£è€¦å¼€æ¥,æ‰€æœ‰çš„å‚æ•°éƒ½ç”¨äºæ­¤å‡½æ•°çš„è¾“å…¥.\n\n`Promise`åœ¨å¤„ç†å•æ¬¡å¼‚æ­¥ä»»åŠ¡çš„æ—¶å€™è¡¨ç°è‰¯å¥½,ä½†æ˜¯å¯¹äºå¤šæ¬¡è§¦å‘çš„ä»»åŠ¡ä¾¿æ˜¾å¾—ä¹åŠ›,ä¹Ÿè®¸æˆ‘ä»¬éœ€è¦å­¦ä¹ ä¸€äº›`å“åº”å¼ç¼–ç¨‹`æŠ€æœ¯,ä»¥è§£å†³æ­¤ç±»é—®é¢˜.\n\nå¯¹äº`ES6 Promise`æ¥è¯´,ç¼ºä¹ä¸¤é¡¹å¾ˆå®ç”¨çš„åŠŸèƒ½:\n\n- å–æ¶ˆä»»åŠ¡(åœ¨ç»„ä»¶è¢«åˆ é™¤åå–æ¶ˆå¼‚æ­¥ä»»åŠ¡ç­‰)ï¼ŒTC39 å§”å‘˜ä¼šå®é™…ä¸Šå‡†å¤‡å¢åŠ æ­¤ç‰¹æ€§ï¼Œä½†æœ€ç»ˆææ¡ˆè¢«æ’¤å›äº†ï¼Œä½†æ˜¯æ²¡å…³ç³»ï¼Œ`Bluebird`å®ç°äº†æ­¤åŠŸèƒ½ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹æ­¤ç‰¹æ€§è¿›è¡Œè¡¥å……ï¼Œä¾‹å¦‚åˆ©ç”¨`setTimeout`å®šæ—¶å™¨å‡½æ•°å¯ä»¥è¢«å–æ¶ˆçš„ç‰¹æ€§ï¼Œç¼–å†™ä¸€äº›é€»è¾‘ä»£ç å’Œ`Promise`å–æ¶ˆçŠ¶æ€è½¬æ¢çš„åŠŸèƒ½å‡½æ•°ã€‚\n- è¿›åº¦è¿½è¸ª(æ˜¾ç¤ºè¿›åº¦æ¡ç­‰)ï¼ŒåŸç”Ÿä¸æ”¯æŒæ­¤ç‰¹æ€§çš„åŸå› æ˜¯æ‹…å¿ƒæ­¤ç‰¹æ€§ä¼šå¯¼è‡´`Promise`çš„é“¾å¼è°ƒç”¨å’Œç±»ä¼¼`all`é™æ€æ–¹æ³•çš„å¤æ‚åº¦å¢åŠ ã€‚\n\nåŸç”Ÿ`Promise`æš‚æœªæ”¯æŒä¸Šè¿°ä¸¤é¡¹ç‰¹æ€§,ä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥çœ‹çœ‹ç±»ä¼¼`Bluebird`è¿™æ ·çš„ç¬¬ä¸‰æ–¹åº“ï¼Œå®ƒä»¬åŠŸèƒ½å¼ºå¤§å¹¶ä¸”è¢«å¹¿æ³›ä½¿ç”¨ï¼Œå€¼å¾—ä¿¡èµ–ã€‚\n\n# 3. async / await\n\næåŠå¼‚æ­¥å‡½æ•°ï¼Œ`async/await`è¯­æ³•å…³é”®å­—ä¸€å®šæ˜¯ç»•ä¸å¼€çš„çŸ¥è¯†ç‚¹ï¼Œè¿™æ˜¯ä¸€ç§ä½¿ç”¨ `Promise`çš„ç‰¹æ®Šè¯­æ³•ï¼Œå¹¶ä¸”éå¸¸å®¹æ˜“ç†è§£å’Œä½¿ç”¨ã€‚\n\næˆ‘ä»¬ç›´æ¥çœ‹ç¤ºä¾‹ï¼š\n\n```js\nasync function foo() {\n  // balabala\n  return 1;\n}\n```\n\n\u003e å¯ä»¥ç†è§£ä¸º async å‡½æ•°æœ€åæ˜¾å¼è¿”å›çš„å€¼ç»è¿‡ Promise.resolve å‡½æ•°çš„è½¬åŒ–ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ Promise å®ä¾‹\n\nåœ¨å‡½æ•°å‰æ·»åŠ `async`æ ‡è¯†æ­¤å‡½æ•°æ€»æ˜¯è¿”å›ä¸€ä¸ª`Promise`å®ä¾‹,å³ä½¿æˆ‘ä»¬æ˜¾ç¤ºæŒ‡å®šå…¶ä»–çš„ç±»å‹å€¼çš„è¿”å›å€¼ï¼Œä¹Ÿä¼šè¢«åŒ…è£…æˆä¸€ä¸ª`Promise`å¹¶è¿”å›ï¼Œå½“ç„¶ï¼Œä¾ç„¶æ¨èæ˜¾ç¤ºåœ°æŒ‡å®šè¿”å›`Promise`ã€‚\n\nä½¿ç”¨`async`å…³é”®å­—å¯ä»¥è®©å‡½æ•°å…·æœ‰`å¼‚æ­¥`ç‰¹å¾ï¼Œä½†æ€»ä½“ä¸Šä»£ç ä¾ç„¶æ˜¯`åŒæ­¥`æ±‚å€¼çš„ã€‚\n\nä¸¾ä¸ªä¾‹å­ï¼š\n\n```js\nasync function foo() {\n  console.log(1);\n}\nfoo();\nconsole.log(2);\n// output\n1;\n2;\n```\n\n\u003e å¼‚æ­¥å‡½æ•°å…·æœ‰æš‚åœå’Œæ¢å¤æ‰§è¡Œçš„åŠŸèƒ½æ˜¯ååˆ†å¿…è¦çš„ã€‚\n\nä½¿ç”¨`await`å…³é”®å­—å¯ä»¥æš‚åœå¼‚æ­¥å‡½æ•°çš„æ‰§è¡Œå¹¶ä¸”ç­‰å¾…è¿”å›çš„`Promise`å®ä¾‹è¿›å…¥`settled`çŠ¶æ€ã€‚\n\nå…³é”®è¯`await`åªåœ¨`async`å‡½æ•°å†…æœ‰æ•ˆï¼š\n\n```js\nasync function foo() {\n  const res = await axios.get(\"your url\");\n}\n```\n\nåœ¨æ—¥å¸¸å·¥ä½œä¸­æ— è®ºæ˜¯æµè§ˆå™¨è¿˜æ˜¯`Nodejs`ï¼Œéƒ½å¯ä»¥çœ‹åˆ°`await`çš„èº«å½±ã€‚\n\né‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬æ›´æ¨èä½¿ç”¨`async/await`è¯­æ³•ï¼Œå®ƒåˆæœ‰æ€æ ·çš„ç»†èŠ‚éœ€è¦æˆ‘ä»¬å…³æ³¨çš„å‘¢ï¼Ÿ\n\næ¥çœ‹ä»¥ä¸‹å‡ ç‚¹ç‰¹æ€§ï¼š\n\n- é¡¶å±‚`await`ï¼šæ­¤ææ¡ˆå½“å‰ä¾ç„¶æ˜¯ `stage 3`ï¼Œåœ¨æ­£å¼è¿›å…¥ç¨³å®šç‰ˆä¹‹å‰ï¼Œé¡¶å±‚å¯¹äº`await`çš„ä½¿ç”¨ä¾ç„¶éœ€è¦ç«‹å³æ‰§è¡Œè¡¨è¾¾å¼ï¼ˆIIFEï¼‰ï¼Œä¸å¹¸çš„æ˜¯ï¼Œè¿™ç§æ¨¡å¼å¯¼è‡´å›¾å½¢æ‰§è¡Œå’Œåº”ç”¨ç¨‹åºçš„é™æ€å¯åˆ†ææ€§çš„ç¡®å®šæ€§é™ä½ã€‚ç”±äºè¿™äº›åŸå› ï¼Œç¼ºå°‘é¡¶å±‚ `await` è¢«è®¤ä¸ºæ¯”è¯¥åŠŸèƒ½å¸¦æ¥çš„å±å®³æœ‰æ›´é«˜çš„é£é™©ã€‚\n- é¡¶å±‚ `await` ä»…é™äº ES æ¨¡å—ã€‚æ˜ç¡®ä¸æ”¯æŒ`CommonJS`æ¨¡å—ã€‚\n- `await`æ”¯æŒ`thenable`å¯¹è±¡,å¦‚æœå…¶åæ˜¯ä¸€ä¸ª`thenable`å¯¹è±¡ï¼Œåˆ™ä¼šæ‰§è¡Œæ­¤å¯¹è±¡çš„`then`æ–¹æ³•ï¼Œå¹¶ä¸”ä¼ å…¥`resolve`å’Œ`reject`å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ª`settled`çš„`Promise`å®ä¾‹ã€‚\n- `await`å’Œ`Promise.all`ç­‰é™æ€æ–¹æ³•é…åˆè‰¯å¥½ã€‚\n\n```js\nconst res = await Promise.all([\n  promise1,\n  promise2,\n  ...\n])\n```\n\n- Error å¤„ç†\n\n\u003e `async/await`é…åˆ`try...catch..`å¯ä»¥æ›´æ¸…æ™°åœ°åŒæ—¶å¤„ç†åŒæ­¥å’Œå¼‚æ­¥çš„å¼‚å¸¸\n\nè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š\n\n```js\nconst makeRequest = async () =\u003e {\n  try {\n    const data = JSON.parse(await getJSON());\n    console.log(data);\n  } catch (e) {\n    console.log(e);\n  }\n};\n```\n\næ— è®ºæ˜¯å¼‚æ­¥å‡½æ•°`getJSON()`è¿˜æ˜¯åŒæ­¥å‡½æ•°`JSON.parse()`éƒ½èƒ½è¢«åŒä¸€ä¸ª`try...catch...`ç»“æ„å¯¹å¼‚å¸¸è¿›è¡Œå¤„ç†ï¼Œä»£ç é€»è¾‘ç›¸å¯¹ä½¿ç”¨`Promise.then / catch`çš„æ–¹å¼æ¥è¯´ä¼šæ›´æ¸…æ™°ï¼Œå¯è¯»æ€§æ›´å¼ºã€‚\n\nä¹Ÿè®¸å¯è¯»æ€§çš„è¯„åˆ¤æ›´å®¹æ˜“æºæ‚ä¸»è§‚æ„è¯†ï¼Œä½†æ˜¯å¯¹äºå¼‚æ­¥`Debug`ä»£ç æ¥è¯´ï¼Œ`async/await`æ˜¾ç„¶æ›´è½»æ¾ã€‚\n\nä¸ºä»€ä¹ˆï¼Ÿæˆ‘æƒ³æœ‰ä»¥ä¸‹ä¸¤ç‚¹ç†ç”±ï¼š\n\n- åœ¨`then`ä¸­éš¾ä»¥å¯¹ç®­å¤´å‡½æ•°ä¸‹æ–­ç‚¹\n- å³ä½¿æ˜¯åœ¨ `then`ä¸­ä¸‹äº†æ–­ç‚¹ï¼Œç±»ä¼¼å•æ­¥æ­¥å…¥çš„æ“ä½œä¹Ÿä¸ä¼šå¾—åˆ°é¢„æœŸçš„ç»“æœï¼ŒåŸå› åœ¨äºè¿™ç§è°ƒè¯•æ–¹å¼åªèƒ½åœ¨åŒæ­¥ä»£ç ä¸­ä½¿ç”¨ã€‚\n\næˆ‘ä»¬æ¥çœ‹ä¸¤ä¸ªç¤ºä¾‹ï¼š\n\n```js\nconst makeRequest = () =\u003e {\n  return callAPromise()\n    .then(() =\u003e callAPromise())\n    .then(() =\u003e callAPromise());\n};\n// async / await\nconst makeRequest = async () =\u003e {\n  await callAPromise();\n  await callAPromise();\n};\n```\n\nåœ¨è°ƒè¯•è¿‡ç¨‹ä¸­ç”±äº`await`çš„ç‰¹æ®Šæ€§ï¼Œæˆ‘ä»¬å¯ä»¥åƒè°ƒè¯•åŒæ­¥ä»£ç è¿™ä¹ˆæ–¹ä¾¿è‡ªç„¶ã€‚\n\n\u003e å¦å¤–ï¼Œä½¿ç”¨`async / await`è¯­æ³•ï¼Œæˆ‘ä»¬åº”è¯¥ç•™å¿ƒå¼‚æ­¥ä»£ç çš„å¹³è¡ŒåŠ é€Ÿé—®é¢˜ã€‚\n\næ¥çœ‹ç¤ºä¾‹ï¼š\n\n```js\nasync function delay(id) {\n  return new Promise((res) =\u003e {\n    setTimeout(() =\u003e {\n      console.log(`task ${id} finished.`);\n    }, 1000);\n  });\n}\nasync function demo1() {\n  await delay(1);\n  await delay(2);\n  await delay(3);\n}\ndemo1();\n// å¦ä¸€ä¸ª demo\nasync function demo2() {\n  const p1 = delay(1);\n  const p2 = delay(2);\n  const p3 = delay(3);\n  await p1;\n  await p2;\n  await p3;\n}\n```\n\nå¯¹äºæ²¡æœ‰å¼‚æ­¥æ‰§è¡Œé¡ºåºéœ€æ±‚çš„`async/await`è¯­æ³•æ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€æ¬¡æ€§åˆå§‹åŒ–å…¶å¼‚æ­¥ä»»åŠ¡ï¼Œç„¶åå†åˆ†åˆ«ç­‰å¾…å…¶ç»“æœå³å¯ã€‚\n\n\u003e åœ¨é‡è§†`æ€§èƒ½`çš„åº”ç”¨ä¸­ï¼Œä½¿ç”¨`async/await`è¯­æ³•å¯ä»¥å‡å°‘å†…å­˜çš„å ç”¨ã€‚\n\nåœ¨ä½¿ç”¨`new Promise`åˆå§‹åŒ–æ—¶ï¼Œæˆ‘ä»¬åˆ›å»º`Promise`å®ä¾‹çš„å‡½æ•°å³ä½¿æ˜¯åœ¨å¤„ç†ç¨‹åºè½¬æ¢`Promise`å®ä¾‹çš„çŠ¶æ€æ—¶ä¾ç„¶è¢«ä¿å­˜åœ¨æ ˆè¿½è¸ªä¿¡æ¯å†…ï¼Œç„¶è€Œæˆ‘ä»¬çŸ¥é“è¿™äº›ä¿¡æ¯éšç€åˆå§‹åŒ–å‡½æ•°çš„è¿”å›å…¶å®å·²ç»æ²¡æœ‰å¿…è¦å­˜åœ¨äº†ï¼Œä½†æ˜¯`Javascript`å¼•æ“ä¼šåœ¨åˆ›å»º`Promise`æ—¶å°½å¯èƒ½ä¿å­˜å®Œæ•´çš„è°ƒç”¨æ ˆï¼Œåœ¨æŠ›å‡ºé”™è¯¯æ—¶è°ƒç”¨æ ˆå¯ä»¥ç”±è¿è¡Œæ—¶çš„é”™è¯¯å¤„ç†é€»è¾‘è·å–ï¼Œæ•…æˆ‘ä»¬èƒ½åœ¨æ ˆè¿½è¸ªä¿¡æ¯ä¸­çœ‹åˆ°å®ƒä»¬ï¼Œæœ€ç»ˆå ç”¨ä¸€äº›å†…å­˜ï¼Œå¢åŠ äº†è®¡ç®—å’Œå­˜å‚¨æˆæœ¬ã€‚\n\nå¦‚æœæˆ‘ä»¬ä½¿ç”¨`async/await`è¯­æ³•ï¼š\n\n```js\nfunction fooPromiseExecutor(resolve, reject) {\n  setTimeout(reject, 1000, \"bar\");\n}\n\nasync function foo() {\n  await new Promise(fooPromiseExecutor);\n}\nfoo();\n/// Uncaught (in promise) bar\n// foo\n// async function (async)\n// foo\n```\n\nç”±äº`fooPromiseExecutor`å·²ç»è¿”å›ï¼Œæ•…ä¸åœ¨é”™è¯¯ä¿¡æ¯ä¸­äº†ã€‚\n\n`Javascript`è¿è¡Œæ—¶å¯ä»¥ç®€å•åœ°åœ¨åµŒå¥—å‡½æ•°ä¸­å­˜å‚¨æŒ‡å‘åŒ…å«å‡½æ•°çš„æŒ‡é’ˆï¼Œå°±å¦‚åŒå¯¹å¾…åŒæ­¥å‡½æ•°ä¸€æ ·ï¼ŒæŒ‡é’ˆæ—¶æœºå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œç”¨äºåœ¨å‡ºé”™çš„æ—¶å€™ç”Ÿæˆé”™è¯¯ä¿¡æ¯ï¼Œå¦‚æ­¤ä¸€æ¥ä¾¿çœå»äº†è¿™â€œå¾®å°â€çš„æ¶ˆè€—ã€‚\n\næœ€åæˆ‘æƒ³è¯´ï¼Œç›¸å¯¹äºä½¿ç”¨`Promise`çš„å®ä¾‹æ–¹æ³•æ¥ç¼–å†™å¼‚æ­¥ä»£ç ï¼Œä½¿ç”¨`async/await`çš„è¯­æ³•ï¼Œæ˜¾ç„¶ä»£ç é‡å°†ä¼šå‡å°‘ ğŸ¶ï¼Œä½•ä¹è€Œä¸ä¸ºï¼Ÿ\n\n# 4. Promisify\n\n`Promise`å¾ˆæ£’ï¼Œä½†æ˜¯éµå¾ªå¸¸è§çš„é”™è¯¯ä¼˜å…ˆçš„å›è°ƒé£æ ¼çš„å‡½æ•°ä¾ç„¶å¯ä»¥åœ¨è®¸å¤šåœºæ™¯ä¸‹æ´»è·ƒç€ï¼Œæ— è®ºæ˜¯å…¶å¼€å‘è€…åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™è¿˜æœªå‡ºç°`Promise`ï¼Œäº¦æˆ–æ˜¯å¼€å‘è€…æ›´å–œæ¬¢å›è°ƒé£æ ¼çš„èŒƒå¼ï¼Œè·Ÿè¿™äº›å›è°ƒé£æ ¼çš„å‡½æ•°æ‰“äº¤é“ä¼¼ä¹æ— å¯é¿å…ã€‚\n\n\u003e Nodejs å®˜æ–¹æä¾›äº† util.promisify å·¥å…·å‡½æ•°ç”¨äºå°†ä¼ ç»Ÿå›è°ƒé£æ ¼çš„å‡½æ•°è½¬æ¢ä¸ºè¿”å›`Promise`çš„å‡½æ•°ã€‚\n\næˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ªå°†`callback`é£æ ¼çš„å‡½æ•°è½¬æ¢ä¸º`Promise`é£æ ¼çš„å‡½æ•°çš„å·¥å…·å‡½æ•°ã€‚\n\n```js\nfunction promisify(f, multiArgs = false) {\n  return function (...args) {\n    return new Promise((resolve, reject) =\u003e {\n      function callback(err, ...results) {\n        err ? reject(err) : resolve(multiArgs ? results : results[0]);\n      }\n      args.push(callback);\n      f.call(this, ...args);\n    });\n  };\n}\n\nconst fs = require(\"fs\");\nconst fsPromise = promisify(fs.readdir);\nfsPromise(\".\")\n  .then((r) =\u003e {\n    console.log(\"resolve\", r);\n  })\n  .catch((r) =\u003e {\n    console.log(\"reject\", r);\n  });\n// output\nresolve[\"index.js\"];\n```\n\nåœ¨è¿™ä¸ªè½¬æ¢è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†åŸæ¥çš„å‡½æ•°åŒ…è£¹è¿›å»ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªå¯æ‰§è¡Œçš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¥æ”¶çš„å‚æ•°è·ŸåŸæ¥çš„`å›è°ƒé£æ ¼`å‡½æ•°ä¸€è‡´ï¼Œåªæ˜¯å°†ä¹‹è½¬æ¢ä¸º`Promise`é£æ ¼çš„å‡½æ•°åï¼Œä¼ å‚å¯ä»¥çœç•¥`å›è°ƒå‡½æ•°`ï¼Œæˆ‘ä»¬åœ¨å†…éƒ¨æ„å»ºäº†ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå¹¶ä¸”å°†ä¹‹ä½œä¸ºåŸå‡½æ•°çš„å›è°ƒéƒ¨åˆ†ä½œä¸ºå‚æ•°ä¼ ç»™äº†è¿”å›å‡½æ•°ã€‚\n\nç°åœ¨ï¼Œæˆ‘ä»¬å°†ä¼ ç»Ÿå›è°ƒé£æ ¼çš„å‡½æ•°è½¬åŒ–ä¸ºè¿”å›`Promise`çš„å‡½æ•°äº†ï¼Œæˆ‘ä»¬å¯ä»¥æ”¾å¿ƒä½¿ç”¨`Promise`çš„æ–°ç‰¹æ€§äº†ã€‚\n\n# å‚è€ƒ\n\n- [Exploring ES6 - exploring-es6.pdf](chrome-extension://bocbaocobfecmglnmeaeppambideimao/pdf/viewer.html?file=file%3A%2F%2F%2FUsers%2Fyi%2FDesktop%2Fexploring-es6.pdf)\n- [architecture - Difference between event handlers and callbacks - Stack Overflow](https://stackoverflow.com/questions/2069763/difference-between-event-handlers-and-callbacks)\n- [javascript - addEventListener vs onclick - Stack Overflow](https://stackoverflow.com/questions/6348494/addeventlistener-vs-onclick)\n- [Getting Started | bluebird](http://bluebirdjs.com/docs/getting-started.html)\n- JavaScript é«˜çº§ç¨‹åºè®¾è®¡\n- [ç°ä»£ JavaScript æ•™ç¨‹](https://zh.javascript.info/)\n- [JavaScript | promise resolve() Method - GeeksforGeeks](https://www.geeksforgeeks.org/javascript-promise-resolve-method/)\n- [Error handling with Async/Await in JS | by Ian Segers | ITNEXT](https://itnext.io/error-handling-with-async-await-in-js-26c3f20bc06a)\n- [Understanding JavaScript Promises](https://nodejs.dev/learn/understanding-javascript-promises)\n- [util.promisify(original) | Node.js API æ–‡æ¡£](http://nodejs.cn/api/util/util_promisify_original.html)\n","title":"Javascript,I promise - å¼‚æ­¥ç¼–ç¨‹","date":"2021/4/9","tags":["JavaScript"],"mainImg":"https://images.unsplash.com/photo-1611923973164-e0e5f7f69872?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwxNjUyNjZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2MTc5NzU1MTI\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=1080","coverImg":"https://images.unsplash.com/photo-1611923973164-e0e5f7f69872?crop=entropy\u0026cs=tinysrgb\u0026fit=max\u0026fm=jpg\u0026ixid=MnwxNjUyNjZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2MTc5NzU1MTI\u0026ixlib=rb-1.2.1\u0026q=80\u0026w=400","intro":"Promise, JavaScript ä¸–ç•Œä¸­çš„å¼‚æ­¥å¤„ç†å¯¹è±¡.æˆ‘é˜…è¯»äº† Dr.Axel å‰è¾ˆçš„ç”µå­ä¹¦,å……æ»¡æ„Ÿæ¿€."}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"Javascript,I-promise"},"buildId":"lP6wRmPC69lUiAWvAOKO6","assetPrefix":"/blog","nextExport":false,"isFallback":false,"gsp":true,"head":[["meta",{"name":"viewport","content":"width=device-width"}],["meta",{"name":"description","content":"javascript node deno linux web developer"}],["meta",{"charSet":"utf-8"}],["link",{"rel":"icon","href":"data:image/svg+xml,\u003csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22\u003e\u003ctext y=%22.9em%22 font-size=%2290%22\u003eğŸ¯\u003c/text\u003e\u003c/svg\u003e"}],["title",{"children":"Javascript,I promise - å¼‚æ­¥ç¼–ç¨‹"}],["link",{"rel":"stylesheet","href":"https://cdn.jsdelivr.net/npm/reset-css@5.0.1/reset.min.css"}],["link",{"rel":"stylesheet","href":"/blog/post.css"}],["script",{"async":true,"src":"https://www.googletagmanager.com/gtag/js?id=G-J0BNBT8YXG"}],["script",{"dangerouslySetInnerHTML":{"__html":"\u003c!-- Global site tag (gtag.js) - Google Analytics --\u003e\n            window.dataLayer = window.dataLayer || [];\n            function gtag(){dataLayer.push(arguments);}\n            gtag('js', new Date());\n            gtag('config', 'G-J0BNBT8YXG');"}}]]}</script><script nomodule="" src="/blog/_next/static/chunks/polyfills-86dac49abe0e0232b575.js"></script><script src="/blog/_next/static/chunks/main-c37f7d67026ad75148c3.js" async=""></script><script src="/blog/_next/static/chunks/webpack-eb080e3f091731f228fb.js" async=""></script><script src="/blog/_next/static/chunks/framework.1daf1ec1ecf144ee9147.js" async=""></script><script src="/blog/_next/static/chunks/commons.cb58dfc173e18379cc5b.js" async=""></script><script src="/blog/_next/static/chunks/6335da8543c52d3af527c387f688061357787349.aa32db8a194765817dea.js" async=""></script><script src="/blog/_next/static/chunks/pages/_app-ebdd114948c696bf4519.js" async=""></script><script src="/blog/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.7a872eda8469b3325c5d.js" async=""></script><script src="/blog/_next/static/chunks/pages/posts/%5Bslug%5D-5d143f0d2b02a907308e.js" async=""></script><script src="/blog/_next/static/lP6wRmPC69lUiAWvAOKO6/_buildManifest.js" async=""></script><script src="/blog/_next/static/lP6wRmPC69lUiAWvAOKO6/_ssgManifest.js" async=""></script></body></html>