{"pageProps":{"post":{"slug":"javascriptä¹‹å¯¹è±¡è½¬æ¢","contentHtml":"<p>åœ¨æœºç¼˜å·§åˆä¹‹ä¸‹,æˆ‘çœ‹åˆ°äº†å›½å¤–å¤§ç¥<code>Dr.Axel Rauschmayer</code>çš„åšå®¢:<a href=\"https://2ality.com/index.html\">2ality â€“ JavaScript and more</a>,å…¶ä¸­ä¸€ç¯‡æ–‡ç« é’ˆå¯¹<code>ç±»å‹è½¬æ¢</code>è¿™ä¸ªé—®é¢˜ä½œäº†åˆ†äº«,æœ¬ç€æ±‚çŸ¥çš„æƒ³æ³•æˆ‘é™ä¸‹å¿ƒé˜…è¯»äº†æ­¤æ–‡,æ‰€å¾—æ‰€æƒ³è®°å½•äºæ­¤.</p>\n<p><strong>2021å¹´03æœˆ22æ—¥18:52:54</strong></p>\n<h2>1. èµ·å§‹</h2>\n<p><code>JavaScript</code> æ˜¯ä¼˜ç§€çš„åŠ¨æ€è¯­è¨€,æ•°æ®ç±»å‹çš„è½¬æ¢åœ¨æ—¥å¸¸ç¼–ç¨‹å¼€å‘ä¸­ååˆ†å¸¸è§.æœ¬æ–‡å°†ç»“åˆä¸€äº›å®é™…é—®é¢˜å’Œä¸ªäººç–‘æƒ‘å¯¹<code>ç±»å‹è½¬æ¢</code>è¿›è¡Œå­¦ä¹ å’Œè§£æ,å°½é‡ä»<code>ECMAScriptè§„èŒƒ</code>å‡ºå‘,å­¦ä¹ ç±»å‹è½¬æ¢çš„è®¾è®¡ç†å¿µå’Œå®ç°é€»è¾‘.</p>\n<blockquote>\n<p>å¦‚æœå–œæ¬¢,ä¸å¦¨äº²è‡ªé˜…è¯» <a href=\"https://tc39.es/ecma262/multipage/\">ECMAScriptÂ® 2022 Language Specification</a></p>\n</blockquote>\n<h2>2. ä½•ä¸ºç±»å‹è½¬æ¢?</h2>\n<p>é¦–å…ˆæˆ‘ä»¬è¦æ˜ç¡®<code>JavaScript</code>æ•°æ®åˆ†ä¸º:</p>\n<ul>\n<li>åŸå§‹æ•°æ®ç±»å‹(primitive)\n<ul>\n<li>undefined</li>\n<li>null</li>\n<li>string</li>\n<li>number</li>\n<li>biginit</li>\n<li>boolean</li>\n<li>symbol</li>\n</ul>\n</li>\n<li>å¯¹è±¡</li>\n</ul>\n<p>çœ‹çœ‹è¿™ä¸€è¡Œä»£ç :</p>\n<pre><code class=\"hljs language-js\"><span class=\"lineNumber\">1</span><span class=\"hljs-built_in\">Number</span>(<span class=\"hljs-string\">'3'</span>) * <span class=\"hljs-built_in\">Number</span>(<span class=\"hljs-string\">'2'</span>)</code></pre> \n\n<p>ä¸¤ä¸ªæ•°å­—ä¹‹é—´ä½¿ç”¨ä¹˜æ³•æ“ä½œç¬¦ç›¸ä¹˜,æ•°å­—ç±»å‹æ˜¯æ˜ç¡®çš„ä»å­—ç¬¦ä¸²é€šè¿‡<code>Number()</code>å‡½æ•°<code>æ˜¾å¼</code>è½¬è¿‡æ¥çš„.</p>\n<p>å­—ç¬¦ä¸²ä¹‹é—´<code>\"ä¸èƒ½\"</code>ç›´æ¥æ‰§è¡Œä¹˜æ³•.</p>\n<pre><code class=\"hljs language-js\"><span class=\"lineNumber\">1</span><span class=\"hljs-string\">'a'</span> * <span class=\"hljs-string\">'b'</span> <span class=\"hljs-comment\">// NaN</span></code></pre> \n\n<p>ä¹Ÿè®¸ä½ ä¼šä¸¾å‡ºå¦‚ä¸‹å¯è¡Œçš„ä¾‹å­:</p>\n<pre><code class=\"hljs language-js\"><span class=\"lineNumber\">1</span><span class=\"hljs-string\">'1'</span> * <span class=\"hljs-string\">'2'</span> <span class=\"hljs-comment\">// 2</span></code></pre> \n\n<p>æ­¤æ—¶,å­—ç¬¦ä¸²ä¹‹é—´çš„ä¹˜æ³•å¾—å‡ºäº†æˆ‘ä»¬æƒ³è¦çš„ç»“æœ.ç©¶å…¶å®è´¨æ˜¯å› ä¸ºè§£é‡Šå™¨å¯¹å­—ç¬¦ä¸²è¿›è¡Œäº†<code>éšå¼ç±»å‹è½¬æ¢(coercion)</code>.</p>\n<p>JavaScript è¯­è¨€åˆæœŸå¹¶æ²¡æœ‰è®¾è®¡å¼‚å¸¸æ•è·(<code>exceptions</code>),è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä½ ä¼šçœ‹åˆ°ç°ä»Šè§£é‡Šå™¨å¯¹å¦‚ä¸‹ä»£ç çš„è§£é‡Š.</p>\n<pre><code class=\"hljs language-js\"><span class=\"lineNumber\">1</span><span class=\"hljs-number\">1</span> / <span class=\"hljs-literal\">true</span> <span class=\"hljs-comment\">// 1</span>\n<span class=\"lineNumber\">2</span><span class=\"hljs-number\">1</span> / <span class=\"hljs-literal\">false</span> <span class=\"hljs-comment\">// Infinity , å¾ˆæ˜æ˜¾, 0 ä½œä¸ºåˆ†æ¯æ˜¯é”™è¯¯çš„,ä½†æ˜¯è§£é‡Šå™¨æœ€åçš„å€¼æ˜¯ Infinity</span>\n<span class=\"lineNumber\">3</span><span class=\"hljs-built_in\">Number</span>(<span class=\"hljs-string\">'a'</span>) <span class=\"hljs-comment\">// NaN </span></code></pre> \n\n<p>ä¸ºäº†å®ç°å…¼å®¹,<code>ECMAScript</code>ä¸å¾—ä¸\"å…è®¸\"è¿™éƒ¨åˆ†é”™è¯¯çš„è®¾è®¡ç»§ç»­å­˜åœ¨.ä½†æ˜¯,å¯¹äºä¸€äº›ç›¸å¯¹è¾ƒæ–°çš„ç‰¹æ€§æ¥è¯´,ä¿®å¤äº†è¿™ä¸ªé”™è¯¯çš„è®¾è®¡.</p>\n<p>ä¾‹å¦‚:</p>\n<pre><code class=\"hljs language-JavaScript\"><span class=\"lineNumber\">1</span><span class=\"hljs-number\">1</span> / <span class=\"hljs-built_in\">Symbol</span>() <span class=\"hljs-comment\">// except error: can not cover a symbol value to a number</span>\n<span class=\"lineNumber\">2</span> \n<span class=\"lineNumber\">3</span><span class=\"hljs-number\">1</span> / <span class=\"hljs-number\">2n</span> <span class=\"hljs-comment\">// except error: can not mix BigInt and other types,use explicit conversions</span>\n<span class=\"lineNumber\">4</span> \n<span class=\"lineNumber\">5</span><span class=\"hljs-number\">1</span>() <span class=\"hljs-comment\">// except error: 1 is not a function</span>\n<span class=\"lineNumber\">6</span> \n<span class=\"lineNumber\">7</span><span class=\"hljs-keyword\">new</span> <span class=\"hljs-number\">1</span> <span class=\"hljs-comment\">// except error: 1 is not a constructor</span>\n<span class=\"lineNumber\">8</span> \n<span class=\"lineNumber\">9</span><span class=\"hljs-string\">'ab'</span>.length = <span class=\"hljs-number\">1</span> <span class=\"hljs-comment\">// åªè¯»å±æ€§ä¸å¯æ”¹</span></code></pre> \n\n<h2>3. ECMAScript è§„èŒƒæ˜¯å¦‚ä½•å®šä¹‰ç±»å‹è½¬æ¢çš„?</h2>\n<p>å…ˆæ¥çœ‹çœ‹å¦‚ä¸‹ä¸€ä¸ªä½¿ç”¨<code>Typescript</code>ç¼–å†™çš„å‡½æ•°:</p>\n<pre><code class=\"hljs language-typescript\"><span class=\"lineNumber\">1</span><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">multiply</span>(<span class=\"hljs-params\">a: <span class=\"hljs-built_in\">number</span>, b: <span class=\"hljs-built_in\">number</span></span>) </span>{\n<span class=\"lineNumber\">2</span>  <span class=\"hljs-comment\">// ...</span>\n<span class=\"lineNumber\">3</span>}</code></pre> \n\n<p>å¦‚ä¸Šæ‰€ç¤º,æ­¤å‡½æ•°çš„ä¸¤ä¸ªå‚æ•°çš„ç±»å‹éƒ½æ˜¯<code>number</code>,åœ¨è½¬è¯‘ä¸º<code>JavaScript</code>çš„è¿‡ç¨‹ä¸­,è½¬è¯‘å™¨åšäº†ä»€ä¹ˆ?</p>\n<p>ä¸ºäº†åœ¨è½¬è¯‘åä¿è¯å‚æ•°ç±»å‹æ­£ç¡®,å…¶è¿‡ç¨‹ç®€è¿°ä¸ºå¦‚ä¸‹ä»£ç :</p>\n<pre><code class=\"hljs language-JavaScript\"><span class=\"lineNumber\">1</span><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">multiply</span>(<span class=\"hljs-params\">a, b</span>) </span>{\n<span class=\"lineNumber\">2</span>  <span class=\"hljs-keyword\">let</span> _a = ToNumberic(a);\n<span class=\"lineNumber\">3</span>  <span class=\"hljs-keyword\">let</span> _b = ToNumberic(b);\n<span class=\"lineNumber\">4</span>  <span class=\"hljs-comment\">/// ...</span>\n<span class=\"lineNumber\">5</span>}</code></pre> \n\n<h3>3.1 è½¬æ¢ä¸ºåŸå§‹æ•°æ®ç±»å‹æˆ–å¯¹è±¡</h3>\n<p>å½“è¯­å¥éœ€è¦æ‰§è¡Œéšå¼è½¬æ¢çš„æ—¶å€™,å¦‚ä¸‹<code>æŠ½è±¡æ“ä½œ</code>å‡½æ•°å°†ç›®æ ‡æ•°æ®è½¬æ¢ä¸ºé¢„æœŸçš„åŸå§‹æ•°æ®ç±»å‹æˆ–è€…<code>Object</code>:</p>\n<ul>\n<li>ToBoolean()</li>\n<li>ToNumber()</li>\n<li>ToBumeric(), å…¼é¡¾ number å’Œ BigInt</li>\n<li>ToBigInt()</li>\n<li>ToString()</li>\n<li>ToObject()</li>\n</ul>\n<blockquote>\n<p><a href=\"https://tc39.es/ecma262/#sec-abstract-operations\">æŠ½è±¡æ“ä½œ</a>æ˜¯åœ¨ECMAScriptè§„èŒƒä¸­å®šä¹‰çš„å‡½æ•°,å®ƒä»¬çš„å®šä¹‰æ˜¯ä¸ºäº†ç®€æ´åœ°ç¼–å†™è§„èŒƒ.JavaScriptå¼•æ“ä¸å¿…å°†å®ƒä»¬ä½œä¸ºå•ç‹¬çš„å‡½æ•°åœ¨å¼•æ“ä¸­å®ç°.ä¸èƒ½ç›´æ¥ä»JavaScriptè°ƒç”¨å®ƒä»¬.ä½†æ˜¯å¼•æ“å®ç°äº†ç±»ä¼¼<code>Number()</code>è¿™æ ·çš„æ˜¾ç¤ºè½¬æ¢å‡½æ•°.</p>\n</blockquote>\n<h3>3.2 è½¬æ¢ä¸ºæ•°å­—ç±»å‹</h3>\n<p>å¯¹äºéœ€è¦è¢«éšå¼è½¬åŒ–ä¸º<code>numeric</code>ç±»å‹æ•°æ®çš„å€¼æ¥è¯´,å°†ä¼šç”¨åˆ°<code>ToNumeric</code>æŠ½è±¡æ“ä½œ.è½¬æ¢çš„ç»“æœå¯èƒ½æ˜¯<code>number</code>ç±»å‹æˆ–è€…<code>BigInt</code>ç±»å‹.</p>\n<p>å¦‚è‹¥éœ€è¦å°†<code>x</code>è½¬æ¢ä¸ºæ•´å½¢,åˆ™ä½¿ç”¨æŠ½è±¡æ“ä½œ<code>ToInteger</code>.åœ¨ä½¿ç”¨<code>ä½æ“ä½œ</code>çš„æ—¶å€™æ‰§è¡Œçš„éšå¼è½¬æ¢åˆ™è§†æƒ…å½¢ä½¿ç”¨æŠ½è±¡æ“ä½œ<code>ToInt32</code>æˆ–è€…<code>ToUint32</code>.</p>\n<p>ä¾‹å¦‚:</p>\n<pre><code class=\"hljs language-js\"><span class=\"lineNumber\">1</span><span class=\"hljs-string\">'1'</span> >> <span class=\"hljs-number\">1</span> <span class=\"hljs-comment\">// ä½¿ç”¨ ToInt32 æŠ½è±¡æ–¹æ³•è½¬ä¸º 32 ä½æ•´æ•°</span>\n<span class=\"lineNumber\">2</span><span class=\"hljs-number\">2</span> >> <span class=\"hljs-string\">'1'</span> <span class=\"hljs-comment\">// ä½¿ç”¨ ToUint32 æŠ½è±¡æ–¹æ³•è½¬ä¸ºæ— ç¬¦å· 32 ä½æ•´æ•°</span>\n<span class=\"lineNumber\">3</span>-<span class=\"hljs-number\">2</span> >>> <span class=\"hljs-number\">0</span> <span class=\"hljs-comment\">// -2 çš„äºŒè¿›åˆ¶è¡¨ç¤ºå±äºæœ‰ç¬¦å·æ•°,å› æ­¤éœ€è¦ ToUint32 è½¬æ¢,æœ€åç»“æœæ˜¯ 4294967294</span></code></pre> \n\n<p>æ›´å¤šç»†åˆ™å¦‚ä¸‹è¡¨æ‰€ç¤º:</p>\n<p>| operand        | left operand | right operand | result   |\n| :------------- | :----------- | :------------ | :------- |\n| <code>&#x3C;&#x3C;</code>           | <code>ToInt32()</code>  | <code>ToUint32()</code>  | <code>Int32</code>  |\n| signed <code>>></code>    | <code>ToInt32()</code>  | <code>ToUint32()</code>  | <code>Int32</code>  |\n| unsigned <code>>>></code> | <code>ToInt32()</code>  | <code>ToUint32()</code>  | <code>Uint32</code> |\n| <code>&#x26;</code>, <code>^</code>, <code>|</code>  | <code>ToInt32()</code>  | <code>ToUint32()</code>  | <code>Int32</code>  |\n| <code>~</code>            | â€”            | <code>ToInt32()</code>   | <code>Int32</code>  |</p>\n<h3>3.3 è½¬æ¢ä¸ºå±æ€§<code>keys</code>å±æ€§</h3>\n<p>æŠ½è±¡æ“ä½œ<code>ToPropertyKey</code>è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…<code>Symbol</code>,å¸¸ç”¨äº:</p>\n<ul>\n<li>æ‹¬å·æ“ä½œ</li>\n<li>å¯¹è±¡å­—é¢é‡çš„è®¡ç®—å±æ€§</li>\n<li>in æ“ä½œç¬¦çš„<code>left-hand side</code>,ç”¨äºåˆ¤å®š<code>in</code> çš„ç»“æœ</li>\n<li>Object çš„å‡ ä¸ªéœ€è¦è®¿é—®<code>value</code>å’Œéå†<code>key</code>ç›¸å…³çš„å‡½æ•°\n<ul>\n<li>Object.fromEntries</li>\n<li>Object.defineProperty</li>\n<li>Object.getOwnPropertyDescriptor</li>\n<li>Object.prototype.hasOwnProperty</li>\n<li>Object.prototype.propertyIsEnumerable</li>\n</ul>\n</li>\n<li>Reflect å¯¹è±¡çš„ç›¸å…³æ–¹æ³•</li>\n</ul>\n<h3>3.4 è½¬æ¢ä¸ºæ•°ç»„ç´¢å¼•(Array indices)</h3>\n<ul>\n<li><code>ToLength()</code> ä¸»è¦ç”¨äºå­—ç¬¦ä¸²ç´¢å¼•è®¡ç®—\n<ul>\n<li>æ­¤æŠ½è±¡æ–¹æ³•æ˜¯<code>ToIndex</code>æŠ½è±¡æ–¹æ³•çš„è¾…åŠ©æ–¹æ³•</li>\n<li>å…¶å€¼èŒƒå›´æ˜¯0 â‰¤ ? â‰¤ Math.MAX_SAVE_INTEGER</li>\n</ul>\n</li>\n<li><code>ToIndex()</code> ä¸»è¦ç”¨äºç±»æ•°ç»„ç´¢å¼•è®¡ç®—\n<ul>\n<li>ä¸ ToLength ä¸»è¦åŒºåˆ«åœ¨äº,æ­¤æŠ½è±¡æ–¹æ³•åœ¨ç´¢å¼•è¶Šç•Œçš„æ—¶å€™æŠ›å‡ºå¼‚å¸¸</li>\n<li>å…¶å€¼èŒƒå›´æ˜¯0 â‰¤ ? â‰¤ Math.MAX_SAVE_INTEGER</li>\n</ul>\n</li>\n<li><code>ToUint32()</code> ç”¨äºæ•°ç»„ç´¢å¼•è®¡ç®—\n<ul>\n<li>å…¶å€¼èŒƒå›´æ˜¯0 â‰¤ ? &#x3C; 2^32-1</li>\n</ul>\n</li>\n</ul>\n<h3>3.5 è½¬æ¢ä¸ºç±»æ•°ç»„å¯¹è±¡çš„å…ƒç´ </h3>\n<p>å¦‚æœä½ è¦ä¸º<code>ç±»æ•°ç»„</code>å¯¹è±¡çš„æŸä¸ªå…ƒç´ è®¾ç½®å€¼,å°†å¯èƒ½ä½¿ç”¨å¦‚ä¸‹çš„æŠ½è±¡æ–¹æ³•:</p>\n<ul>\n<li><code>ToInt8()</code></li>\n<li><code>ToUint8()</code></li>\n<li><code>ToUint8Clamp()</code></li>\n<li><code>ToInt16()</code></li>\n<li><code>ToUint16()</code></li>\n<li><code>ToInt32()</code></li>\n<li><code>ToUint32()</code></li>\n<li><code>ToBigInt64()</code></li>\n<li><code>ToBigUint64()</code></li>\n</ul>\n<p>ä¾‹å¦‚:</p>\n<pre><code class=\"hljs language-js\"><span class=\"lineNumber\">1</span><span class=\"hljs-keyword\">let</span> uint16 = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Int16Array</span>;\n<span class=\"lineNumber\">2</span>uint16 = <span class=\"hljs-built_in\">Int16Array</span>.from(<span class=\"hljs-string\">'12345'</span>);\n<span class=\"lineNumber\">3</span> \n<span class=\"lineNumber\">4</span><span class=\"hljs-built_in\">console</span>.log(uint16);\n<span class=\"lineNumber\">5</span><span class=\"hljs-comment\">// expected output: Int16Array [1, 2, 3, 4, 5]</span></code></pre> \n\n<p>æ­¤å¤„çš„å­—ç¬¦ä¸²<code>12345</code>åœ¨ <code>from</code>å‡½æ•°å†…éƒ¨è¿›è¡Œè¿­ä»£,å¹¶ä¸”è¿›è¡Œéšå¼çš„ç±»å‹è½¬æ¢,æœ€ç»ˆä¸º<code>Int16Array</code>å¯¹è±¡è®¾ç½®äº† 5 ä¸ªå…ƒç´ å€¼.</p>\n<h2>4. ECMAScript è§„èŒƒç¤ºä¾‹è§£è¯»</h2>\n<p><code>ECMAScript</code>è§„èŒƒæ˜ç¡®æä¾›äº†<code>JavaScript</code>çš„æ‰€æœ‰å®ç°ç®—æ³•è¯¦ç»†è®¾è®¡.å¤§å¤šæ•°çš„<code>æŠ½è±¡æ–¹æ³•</code>å¹¶æ²¡æœ‰åœ¨<code>JavaScript </code>å¼•æ“ä¸­å®ç°,ä½†æ˜¯ä¾ç„¶æœ‰å°‘æ•°æŠ½è±¡æ–¹æ³•å¯ä»¥è¿‘ä¹ç†è§£ä¸º<code>JavaScript</code>å¼•æ“ä¸­å¯¹åº”çš„éƒ¨åˆ†å‡½æ•°å®ç°.ä¸¾ä¸ªä¾‹å­,å¦‚ä¸‹å†…å®¹æ˜¯<code>ECMAScript</code>è§„èŒƒçš„ä¸€éƒ¨åˆ†:</p>\n<p><strong>The <code>typeof</code> Operator</strong></p>\n<ol>\n<li>\n<p>Let val be the result of evaluating <a href=\"https://tc39.es/ecma262/#prod-UnaryExpression\">UnaryExpression</a>. è®© val ä½œä¸ºè¯„ä¼°æ­¤ä¸€å…ƒè¡¨è¾¾å¼çš„ç»“æœ.</p>\n</li>\n<li>\n<p>If val is a <a href=\"https://tc39.es/ecma262/#sec-reference-record-specification-type\">Reference Record</a>, then</p>\n<p>a. If <a href=\"https://tc39.es/ecma262/#sec-isunresolvablereference\">IsUnresolvableReference</a>(val) is true, return \"undefined\". å¦‚æœè¿™ä¸ªå€¼æ˜¯ä¸€ä¸ªå¼•ç”¨è®°å½•(ä»…å­˜äºè§„èŒƒä¸­çš„ç±»å‹),å¹¶ä¸”æ˜¯ä¸€ä¸ªä¸å¯è§£æçš„å¼•ç”¨(æ¯”å¦‚å£°æ˜å´æœªåˆå§‹åŒ–çš„å˜é‡),åˆ™è¿”å› <code>undefined</code>.</p>\n</li>\n<li>\n<p>Set val to ? <a href=\"https://tc39.es/ecma262/#sec-getvalue\">GetValue</a>(val). ä»¤ val ç­‰äº GetValue(val) æŠ½è±¡æ“ä½œçš„ç»“æœ.å¦‚æœ‰å¼‚å¸¸åˆ™æŠ›å‡º.</p>\n</li>\n<li>\n<p>Return a String according to <a href=\"https://tc39.es/ecma262/#table-typeof-operator-results\">Table 38</a>. æŒ‰<code>val</code>çš„ç±»å‹é€‰æ‹©ä¸‹è¡¨ä¸­ä¸€ä¸ªå­—ç¬¦ä¸²ç»“æœ.</p>\n</li>\n</ol>\n<h5 style=\"text-align:center\">Table 38: typeof Operator Results</h5>\n<p>| Type of val                                                  | Result      |\n| ------------------------------------------------------------ | ----------- |\n| Undefined                                                    | \"undefined\" |\n| Null                                                         | \"object\"    |\n| Boolean                                                      | \"boolean\"   |\n| Number                                                       | \"number\"    |\n| String                                                       | \"string\"    |\n| Symbol                                                       | \"symbol\"    |\n| BigInt                                                       | \"bigint\"    |\n| Object (does not implement [[Call]]) <code>ä¸å¯è°ƒç”¨çš„å¯¹è±¡è¿”å› object</code> | \"object\"    |\n| Object (implements [[Call]])                                 | \"function\"  |</p>\n<blockquote>\n<p>ECMAScript è§„èŒƒä¸­ä¸ºäº†æ–¹ä¾¿æè¿°ç®—æ³•å’Œè®¾è®¡é€»è¾‘,è®¾å®šäº†å¾ˆå¤šæŠ½è±¡æ“ä½œå’Œè§„èŒƒä¸­çš„ç±»å‹,å®šä¹‰äº†è®¸å¤šç®€å†™æ–¹å¼,ç±»ä¼¼: ? å’Œ ! ç­‰.</p>\n</blockquote>\n<h2>5. éšå¼è½¬æ¢æŠ½è±¡æ–¹æ³•ç¤ºä¾‹</h2>\n<h3>5.1 ToPrimitive()</h3>\n<p>è¿™ä¸ªæŠ½è±¡æ–¹æ³•åœ¨è®¸å¤šéšå¼è½¬æ¢ç®—æ³•ä¸­è¢«ä½¿ç”¨åˆ°,å®ƒå¯ä»¥æŠŠä»»æ„å€¼è½¬æ¢ä¸ºåŸå§‹ç±»å‹å€¼.ç”±äºè®¸å¤šæ“ä½œåªæ¥å—åŸå§‹ç±»å‹æ•°æ®(æˆ–æœ€ç»ˆå°†ä½¿ç”¨åŸå§‹ç±»å‹æ•°æ®),æ­¤æŠ½è±¡æ–¹æ³•åœ¨<code>ECMAScript</code>è§„èŒƒä¸­è¢«å¹¿æ³›è°ƒç”¨.</p>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹ä¸€ä¸ª JavaScript ç‰ˆæœ¬çš„ <code>ToPrimitive</code>å‡½æ•°.</p>\n<pre><code class=\"hljs language-js\"><span class=\"lineNumber\">1</span><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">ToPrimitive</span>(<span class=\"hljs-params\">input: any, hint: <span class=\"hljs-string\">'default'</span> | <span class=\"hljs-string\">'string'</span> | <span class=\"hljs-string\">'number'</span> = <span class=\"hljs-string\">'default'</span></span>) </span>{\n<span class=\"lineNumber\">2</span>  <span class=\"hljs-keyword\">if</span> (Typeof(input) === <span class=\"hljs-string\">'object'</span>) {\n<span class=\"lineNumber\">3</span>    <span class=\"hljs-keyword\">let</span> exoticToPrim = input[<span class=\"hljs-built_in\">Symbol</span>.toPrimitive];\n<span class=\"lineNumber\">4</span>    <span class=\"hljs-keyword\">if</span> (exoticToPrim !== <span class=\"hljs-literal\">undefined</span>) {\n<span class=\"lineNumber\">5</span>      <span class=\"hljs-keyword\">let</span> result = exoticToPrim.call(input, hint);\n<span class=\"lineNumber\">6</span>      <span class=\"hljs-function\"><span class=\"hljs-title\">if</span>(<span class=\"hljs-params\">Typeof(result) !== <span class=\"hljs-string\">'object'</span></span>)</span> {\n<span class=\"lineNumber\">7</span>        <span class=\"hljs-keyword\">return</span> result;\n<span class=\"lineNumber\">8</span>      }\n<span class=\"lineNumber\">9</span>      <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">TypeError</span>();\n<span class=\"lineNumber\">10</span>    }\n<span class=\"lineNumber\">11</span>    <span class=\"hljs-keyword\">if</span> (hint === <span class=\"hljs-string\">'default'</span>) {\n<span class=\"lineNumber\">12</span>      hint = <span class=\"hljs-string\">'number'</span>\n<span class=\"lineNumber\">13</span>    }\n<span class=\"lineNumber\">14</span>    <span class=\"hljs-keyword\">return</span> OrdinaryToPrimitive(input, hint);\n<span class=\"lineNumber\">15</span>  } <span class=\"hljs-keyword\">else</span> {\n<span class=\"lineNumber\">16</span>    <span class=\"hljs-comment\">// input æ˜¯åŸå§‹æ•°æ®ç±»å‹</span>\n<span class=\"lineNumber\">17</span>    <span class=\"hljs-keyword\">return</span> input\n<span class=\"lineNumber\">18</span>  }\n<span class=\"lineNumber\">19</span>}</code></pre> \n\n<p>è¦ç†è§£è¿™ä¸ªå‡½æ•°,éœ€è¦äº†è§£ä¸€äº›å‰ç½®çŸ¥è¯†.</p>\n<p>é¦–å…ˆ, <code>hint</code>å‚æ•°è¡¨ç¤ºè¦è½¬æ¢åˆ°åŸå§‹å€¼çš„é¢„æœŸç±»å‹,é»˜è®¤æ˜¯<code>number</code>.</p>\n<p>.å…¶æ¬¡,æ­¤å‡½æ•°çš„ç›®çš„æ˜¯ä¸ºäº†å°†æŸä¸ªå€¼è½¬ä¸ºåŸå§‹ç±»å‹æ•°æ®,å¦‚æ­¤ä¸€æ¥å¯¹äºæœ¬èº«å°±æ˜¯åŸå§‹ç±»å‹çš„æ•°æ®æ¥è¯´ç›´æ¥è¿”å›å³å¯.</p>\n<p>å¯¹äºå¯¹è±¡æ¥è¯´,åˆ™éœ€è¦æ£€æŸ¥æ­¤å¯¹è±¡æ˜¯å¦é‡å†™äº†<code>Symbol.toPrimitive</code>æ–¹æ³•.</p>\n<blockquote>\n<p><code>Symbol.toPrimitive</code> æ˜¯ä¸€ä¸ªå†…ç½®çš„ Symbol å€¼ï¼Œå®ƒæ˜¯ä½œä¸ºå¯¹è±¡çš„å‡½æ•°å€¼å±æ€§å­˜åœ¨çš„ï¼Œå½“ä¸€ä¸ªå¯¹è±¡è½¬æ¢ä¸ºå¯¹åº”çš„åŸå§‹å€¼æ—¶ï¼Œä¼šè°ƒç”¨æ­¤å‡½æ•°ã€‚</p>\n</blockquote>\n<p>å¦‚æœç›®æ ‡å¯¹è±¡é‡å†™äº†æ–¹æ³•,åˆ™å°†<code>hint</code>å’Œ<code>input</code>ä½œä¸ºå‚æ•°æŒ‰é‡å†™çš„é€»è¾‘è¿›è¡Œè½¬æ¢,å‡ºç°å¼‚å¸¸åˆ™æŠ›å‡º.</p>\n<p>å¦‚æœæ­¤å¯¹è±¡æ²¡æœ‰<code>Symbol.toPrimitive</code>å‡½æ•°,åˆ™æŒ‰å¸¸è§„æŠ½è±¡æ–¹æ³•<a href=\"https://tc39.es/ecma262/#sec-ordinarytoprimitive\">OrdinaryToPrimitive</a>è¿›è¡Œè½¬æ¢.</p>\n<p>æ¥ä¸‹æ¥çœ‹çœ‹ <code>OrdinaryToPrimitive</code>çš„ JavaScript å‡½æ•°å¯ä»¥å¦‚ä½•å®ç°.</p>\n<pre><code class=\"hljs language-js\"><span class=\"lineNumber\">1</span><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">OrdinaryToPrimitive</span>(<span class=\"hljs-params\">O: object, hint: <span class=\"hljs-string\">'string'</span> | <span class=\"hljs-string\">'number'</span></span>) </span>{\n<span class=\"lineNumber\">2</span>  <span class=\"hljs-keyword\">let</span> methodNames;\n<span class=\"lineNumber\">3</span>  <span class=\"hljs-keyword\">if</span> (hint === <span class=\"hljs-string\">'string'</span>) {\n<span class=\"lineNumber\">4</span>    methodNames = [<span class=\"hljs-string\">'toString'</span>, <span class=\"hljs-string\">'valueOf'</span>];\n<span class=\"lineNumber\">5</span>  } <span class=\"hljs-keyword\">else</span> {\n<span class=\"lineNumber\">6</span>    methodNames = [<span class=\"hljs-string\">'valueOf'</span>, <span class=\"hljs-string\">'toString'</span>];\n<span class=\"lineNumber\">7</span>  }\n<span class=\"lineNumber\">8</span>  <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">let</span> name <span class=\"hljs-keyword\">of</span> methodNames) {\n<span class=\"lineNumber\">9</span>    <span class=\"hljs-keyword\">let</span> method = O[name];\n<span class=\"lineNumber\">10</span>    <span class=\"hljs-keyword\">if</span> (IsCallable(method)) {\n<span class=\"lineNumber\">11</span>      <span class=\"hljs-keyword\">let</span> result = method.call(O);\n<span class=\"lineNumber\">12</span>      <span class=\"hljs-keyword\">if</span> (TypeOf(result) !== <span class=\"hljs-string\">'object'</span>) {\n<span class=\"lineNumber\">13</span>        <span class=\"hljs-keyword\">return</span> result;\n<span class=\"lineNumber\">14</span>      }\n<span class=\"lineNumber\">15</span>    }\n<span class=\"lineNumber\">16</span>  }\n<span class=\"lineNumber\">17</span>  <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">TypeError</span>();\n<span class=\"lineNumber\">18</span>}</code></pre> \n\n<p>ğŸ‘†ä¸Šé¢çš„ä»£ç ç”¨åˆ°äº†å±æ€§ <code>key</code> å€¼,ä¸Šè¿°ä¸‰ä¸ªå…³é”®çš„å±æ€§ <code>key</code>åœ¨åŸå§‹ç±»å‹è½¬æ¢çš„æ—¶å€™ç”¨å¾—å¾ˆå¤š.åˆ†åˆ«æ˜¯:</p>\n<ul>\n<li>toString</li>\n<li>valueOf</li>\n<li>Symbol.toPrimitive(é»˜è®¤åªæœ‰ Symbol å’Œ Date å¯¹è±¡æœ‰æ­¤æ–¹æ³•)</li>\n</ul>\n<p>ä»<code>hint</code>å‚æ•°å¯çŸ¥, æœŸæœ›è½¬æ¢ç»“æœç±»å‹å’Œè°ƒç”¨çš„å¯¹è±¡æ–¹æ³•æœ‰ç›´æ¥å…³ç³».æ‰€ä»¥,æ ‡å‡†åº“ä¸­<code>Number()</code>å’Œ<code>String()</code>å‡½æ•°åœ¨å®ç°ä¸Šéƒ½æ˜¯æŒ‰æŠ½è±¡æ–¹æ³•<code>ToPrimitive</code>å»æ‰§è¡Œ,ä¸”è®¾ç½®<code>hint</code>ä¸º<code>number</code>æˆ–è€…<code>string</code>.</p>\n<p><strong>é‚£ä¹ˆ, ä½•ç§æƒ…å†µä¸‹ä½¿ç”¨å“ªä¸€ä¸ª<code>hint</code>å€¼å‘¢?</strong></p>\n<p>åœ¨éšå¼è½¬æ¢çš„æ—¶å€™,è®¾å®š<code>hint</code>ä¸º<code>number</code>çš„æƒ…å†µæœ‰ä»¥ä¸‹å‡ ä¸ªæŠ½è±¡æ–¹æ³•:</p>\n<ul>\n<li>toNumeric</li>\n<li>toNumber</li>\n<li>toBigInt / BigInt</li>\n<li>&#x3C; æˆ–è€… > æŠ½è±¡å…³ç³»æ¯”è¾ƒ</li>\n</ul>\n<p>è®¾å®š<code>hint</code>ä¸º<code>string</code>çš„åˆ™æ˜¯:</p>\n<ul>\n<li>toString</li>\n<li>toPropertyKey</li>\n</ul>\n<p>æœ€ååˆ™æ˜¯<code>hint</code>ä¸º<code>default</code>:</p>\n<ul>\n<li>æŠ½è±¡ç›¸ç­‰æ€§æ¯”è¾ƒ( == )</li>\n<li>åŠ æ“ä½œ(+)</li>\n<li>new Date(value), value å¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–è€… number</li>\n</ul>\n<p>ä½†æˆ‘ä»¬å¯ä»¥å‘ç°,<code>default</code>å’Œ<code>number</code>ä½œä¸º<code>hint</code>çš„å€¼æ—¶,å‡ ä¹æ²¡æœ‰å·®åˆ«,äºŒè€…å¯ä»¥è§†ä¸ºä¸€è‡´.</p>\n<p>åœ¨æ ‡å‡†åº“ä¸­,åªæœ‰<code>Date</code>å’Œ<code>Symbol</code>çš„å®ä¾‹é‡å†™äº†å®ƒä»¬çš„é»˜è®¤è¡Œä¸º.</p>\n<p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹<code>Date</code>æ˜¯å¦‚ä½•é‡å†™çš„:</p>\n<pre><code class=\"hljs language-js\"><span class=\"lineNumber\">1</span><span class=\"hljs-built_in\">Date</span>.prototype[<span class=\"hljs-built_in\">Symbol</span>.toPrimitive] = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">\n<span class=\"lineNumber\">2</span>  hint: <span class=\"hljs-string\">'default'</span> | <span class=\"hljs-string\">'string'</span> | <span class=\"hljs-string\">'number'</span></span>) </span>{\n<span class=\"lineNumber\">3</span>    <span class=\"hljs-keyword\">let</span> O = <span class=\"hljs-built_in\">this</span>;\n<span class=\"lineNumber\">4</span>    <span class=\"hljs-keyword\">if</span> (TypeOf(O) !== <span class=\"hljs-string\">'object'</span>) {\n<span class=\"lineNumber\">5</span>      <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">TypeError</span>();\n<span class=\"lineNumber\">6</span>    }\n<span class=\"lineNumber\">7</span>    <span class=\"hljs-keyword\">let</span> tryFirst;\n<span class=\"lineNumber\">8</span>    <span class=\"hljs-keyword\">if</span> (hint === <span class=\"hljs-string\">'string'</span> || hint === <span class=\"hljs-string\">'default'</span>) {\n<span class=\"lineNumber\">9</span>      tryFirst = <span class=\"hljs-string\">'string'</span>;\n<span class=\"lineNumber\">10</span>    } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (hint === <span class=\"hljs-string\">'number'</span>) {\n<span class=\"lineNumber\">11</span>      tryFirst = <span class=\"hljs-string\">'number'</span>;\n<span class=\"lineNumber\">12</span>    } <span class=\"hljs-keyword\">else</span> {\n<span class=\"lineNumber\">13</span>      <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">TypeError</span>();\n<span class=\"lineNumber\">14</span>    }\n<span class=\"lineNumber\">15</span>    <span class=\"hljs-keyword\">return</span> OrdinaryToPrimitive(O, tryFirst);\n<span class=\"lineNumber\">16</span>  };</code></pre> \n\n<p><code>tryFirst</code>é¦–é€‰é¡¹è®¾ç½®æˆäº†<code>string</code>,è€Œä¸æ˜¯é»˜è®¤çš„<code>default</code>ç­‰åŒäº<code>number</code>,åœ¨æ—¥å¸¸çš„å¼€å‘ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç¤ºä¾‹:</p>\n<pre><code class=\"hljs language-js\"><span class=\"lineNumber\">1</span><span class=\"hljs-keyword\">const</span> d = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Date</span>(<span class=\"hljs-string\">'2222-03-27'</span>)\n<span class=\"lineNumber\">2</span>d == <span class=\"hljs-string\">'Wed Mar 27 2222 08:00:00 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)'</span> <span class=\"hljs-comment\">// true</span>\n<span class=\"lineNumber\">3</span>> <span class=\"hljs-number\">1</span> + d <span class=\"hljs-comment\">// '1Wed Mar 27 2222 08:00:00 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´)'</span></code></pre> \n\n<p>æ—¥æœŸç¤ºä¾‹åŒæ—¶å…·æœ‰<code>toString()</code>å’Œ<code>valueOf()</code>æ–¹æ³•,äºæ­¤å¯ä»¥ç†è§£å…¶é‡å†™é€»è¾‘æ˜¯åå‘<code>string</code>çš„.</p>\n<h3>5.2 ToString()</h3>\n<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹<code>toString()</code>æ–¹æ³•çš„<code>JavaScript</code>ç‰ˆæœ¬å®ç°:</p>\n<pre><code class=\"hljs language-js\"><span class=\"lineNumber\">1</span><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">ToString</span>(<span class=\"hljs-params\">argument</span>) </span>{\n<span class=\"lineNumber\">2</span>  <span class=\"hljs-keyword\">if</span> (argument === <span class=\"hljs-literal\">undefined</span>) {\n<span class=\"lineNumber\">3</span>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">'undefined'</span>;\n<span class=\"lineNumber\">4</span>  } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (argument === <span class=\"hljs-literal\">null</span>) {\n<span class=\"lineNumber\">5</span>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">'null'</span>;\n<span class=\"lineNumber\">6</span>  } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (argument === <span class=\"hljs-literal\">true</span>) {\n<span class=\"lineNumber\">7</span>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">'true'</span>;\n<span class=\"lineNumber\">8</span>  } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (argument === <span class=\"hljs-literal\">false</span>) {\n<span class=\"lineNumber\">9</span>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">'false'</span>;\n<span class=\"lineNumber\">10</span>  } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (TypeOf(argument) === <span class=\"hljs-string\">'number'</span>) {\n<span class=\"lineNumber\">11</span>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">Number</span>.toString(argument);\n<span class=\"lineNumber\">12</span>  } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (TypeOf(argument) === <span class=\"hljs-string\">'string'</span>) {\n<span class=\"lineNumber\">13</span>    <span class=\"hljs-keyword\">return</span> argument;\n<span class=\"lineNumber\">14</span>  } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (TypeOf(argument) === <span class=\"hljs-string\">'symbol'</span>) {\n<span class=\"lineNumber\">15</span>    <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">TypeError</span>();\n<span class=\"lineNumber\">16</span>  } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (TypeOf(argument) === <span class=\"hljs-string\">'bigint'</span>) {\n<span class=\"lineNumber\">17</span>    <span class=\"hljs-keyword\">return</span> BigInt.toString(argument);\n<span class=\"lineNumber\">18</span>  } <span class=\"hljs-keyword\">else</span> {\n<span class=\"lineNumber\">19</span>    <span class=\"hljs-comment\">// argument is an object</span>\n<span class=\"lineNumber\">20</span>    <span class=\"hljs-keyword\">let</span> primValue = ToPrimitive(argument, <span class=\"hljs-string\">'string'</span>); <span class=\"hljs-comment\">// (A)</span>\n<span class=\"lineNumber\">21</span>    <span class=\"hljs-keyword\">return</span> ToString(primValue);\n<span class=\"lineNumber\">22</span>  }\n<span class=\"lineNumber\">23</span>}</code></pre> \n\n<p>ç®€æ´æ˜äº†, åœ¨å°†åŸå§‹å€¼è½¬æ¢ä¸º<code>string</code>çš„ä¸­é—´,ä½¿ç”¨äº†<code>ToPrimitive</code>å‡½æ•°ä½œä¸ºè¿‡æ¸¡.å¹¶ä¸”å¯¹äºå„ç§<code>type</code>çš„å€¼æœ‰ä¸åŒçš„å¤„ç†.éœ€è¦æ³¨æ„çš„æ˜¯,å¯¹äº<code>Symbol</code>æ˜¯æŠ›å‡ºå¼‚å¸¸.ä½†è¿™å¹¶ä¸æ„å‘³ç€<code>Symbol</code>å¯¹è±¡æ— æ³•è½¬æ¢ä¸º<code>string</code>.</p>\n<p><code>Symbol.prototype.toString()</code>å’Œ<code>String()</code>éƒ½è¢«é‡å†™äº†.æˆ‘ä»¬ä¸å¦¨çœ‹çœ‹å¦‚ä¸‹ç¤ºä¾‹:</p>\n<pre><code class=\"hljs language-js\"><span class=\"lineNumber\">1</span>> <span class=\"hljs-keyword\">const</span> sym = <span class=\"hljs-built_in\">Symbol</span>(<span class=\"hljs-string\">'sym'</span>)\n<span class=\"lineNumber\">2</span><span class=\"hljs-literal\">undefined</span>\n<span class=\"lineNumber\">3</span>> <span class=\"hljs-string\">''</span>+sym\n<span class=\"lineNumber\">4</span>Uncaught <span class=\"hljs-built_in\">TypeError</span>: Cannot convert a <span class=\"hljs-built_in\">Symbol</span> value to a string\n<span class=\"lineNumber\">5</span>> <span class=\"hljs-string\">`<span class=\"hljs-subst\">${sym}</span>`</span>\n<span class=\"lineNumber\">6</span>Uncaught <span class=\"hljs-built_in\">TypeError</span>: Cannot convert a <span class=\"hljs-built_in\">Symbol</span> value to a string</code></pre> \n\n<p>éšå¼è½¬æ¢å’Œæ¨¡æ¿å­—ç¬¦ä¸²éƒ½ä¼šæŠ›å‡ºå¼‚å¸¸.ä½†æ˜¯æ˜¾ç¤ºè½¬æ¢å’Œè°ƒç”¨<code>toString</code>æ–¹æ³•éƒ½å¯ä»¥æ‰§è¡Œ.</p>\n<pre><code class=\"hljs language-js\"><span class=\"lineNumber\">1</span>> <span class=\"hljs-built_in\">String</span>(sym)\n<span class=\"lineNumber\">2</span><span class=\"hljs-string\">'Symbol(sym)'</span>\n<span class=\"lineNumber\">3</span>> sym.toString()\n<span class=\"lineNumber\">4</span><span class=\"hljs-string\">'Symbol(sym)'</span></code></pre> \n\n<blockquote>\n<p>ç”±æ­¤çœ‹æ¥,<code>Symbol</code>å®ä¾‹çš„è¿™ä¸¤ä¸ªæ–¹æ³•ç¡®å®ä¸ä¼—ä¸åŒ.</p>\n</blockquote>\n<p><strong>è®©æˆ‘ä»¬å°†ç›®å…‰è½¬åˆ°<code>String()</code>å’Œ<code>Symbol.prototype.toString()</code>çš„å®ç°é€»è¾‘:</strong></p>\n<ul>\n<li><code>String()</code></li>\n</ul>\n<pre><code class=\"hljs language-js\"><span class=\"lineNumber\">1</span><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">String</span>(<span class=\"hljs-params\">value</span>) </span>{\n<span class=\"lineNumber\">2</span>  <span class=\"hljs-keyword\">let</span> s;\n<span class=\"lineNumber\">3</span>  <span class=\"hljs-keyword\">if</span> (value === <span class=\"hljs-literal\">undefined</span>) {\n<span class=\"lineNumber\">4</span>    s = <span class=\"hljs-string\">''</span>;\n<span class=\"lineNumber\">5</span>  } <span class=\"hljs-keyword\">else</span> {\n<span class=\"lineNumber\">6</span>    <span class=\"hljs-comment\">// new.target: æ£€æµ‹æ˜¯å¦é€šè¿‡ new å®ä¾‹åŒ–,å¦‚æœä¸æ˜¯åˆ™ä¸º undefined,æ˜¯åˆ™æŒ‡å‘æ„é€ æ–¹æ³•æˆ–å‡½æ•°</span>\n<span class=\"lineNumber\">7</span>    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">new</span>.target === <span class=\"hljs-literal\">undefined</span> &#x26;&#x26; TypeOf(value) === <span class=\"hljs-string\">'symbol'</span>) {\n<span class=\"lineNumber\">8</span>      <span class=\"hljs-comment\">// å¦‚æœ value æ˜¯ symbol,å¹¶ä¸”ä¸æ˜¯é€šè¿‡ new String è°ƒç”¨,åˆ™è¿”å› Symbol çš„æè¿°ç¬¦å‡½æ•°æ‰§è¡Œç»“æœ</span>\n<span class=\"lineNumber\">9</span>      <span class=\"hljs-keyword\">return</span> SymbolDescriptiveString(value);\n<span class=\"lineNumber\">10</span>    }\n<span class=\"lineNumber\">11</span>    s = ToString(value);\n<span class=\"lineNumber\">12</span>  }\n<span class=\"lineNumber\">13</span>  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">new</span>.target === <span class=\"hljs-literal\">undefined</span>) {\n<span class=\"lineNumber\">14</span>    <span class=\"hljs-comment\">// Function call</span>\n<span class=\"lineNumber\">15</span>    <span class=\"hljs-keyword\">return</span> s;\n<span class=\"lineNumber\">16</span>  }\n<span class=\"lineNumber\">17</span>  <span class=\"hljs-comment\">// New call</span>\n<span class=\"lineNumber\">18</span>  <span class=\"hljs-keyword\">return</span> StringCreate(s, <span class=\"hljs-keyword\">new</span>.target.prototype); <span class=\"hljs-comment\">// simplified!</span>\n<span class=\"lineNumber\">19</span>}\n<span class=\"lineNumber\">20</span> \n<span class=\"lineNumber\">21</span><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">StringCreate</span>(<span class=\"hljs-params\">value, prototype</span>) </span>{\n<span class=\"lineNumber\">22</span>  <span class=\"hljs-comment\">// Create a new String instance that has the given prototype</span>\n<span class=\"lineNumber\">23</span>}\n<span class=\"lineNumber\">24</span><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">SymbolDescriptiveString</span>(<span class=\"hljs-params\">sym</span>) </span>{\n<span class=\"lineNumber\">25</span>  assert.equal(TypeOf(sym), <span class=\"hljs-string\">'symbol'</span>);\n<span class=\"lineNumber\">26</span>  <span class=\"hljs-keyword\">let</span> desc = sym.description;\n<span class=\"lineNumber\">27</span>  <span class=\"hljs-keyword\">if</span> (desc === <span class=\"hljs-literal\">undefined</span>) {\n<span class=\"lineNumber\">28</span>    desc = <span class=\"hljs-string\">''</span>;\n<span class=\"lineNumber\">29</span>  }\n<span class=\"lineNumber\">30</span>  assert.equal(TypeOf(desc), <span class=\"hljs-string\">'string'</span>);\n<span class=\"lineNumber\">31</span>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">'Symbol('</span>+desc+<span class=\"hljs-string\">')'</span>;\n<span class=\"lineNumber\">32</span>}</code></pre> \n\n<p>æˆ‘ä»¬çŸ¥é“,<code>String</code>å¯ä»¥ç›´æ¥è°ƒç”¨,ä¹Ÿå¯ä»¥ä½¿ç”¨<code>new</code>å®ä¾‹åŒ–ä¸€ä¸ª<code>string object</code>.</p>\n<blockquote>\n<p>new String(1) // å®ä¾‹åŒ–ç»“æœæ˜¯ä¸€ä¸ªå¯¹è±¡,è€Œä¸æ˜¯ string ç±»å‹å€¼,å¯ä»¥ä½¿ç”¨ <code>valueOf</code>æ–¹æ³•è·å–å…¶ string ç±»å‹å€¼.å­—é¢é‡å®šä¹‰çš„å­—ç¬¦ä¸²åœ¨ä½¿ç”¨çš„æ—¶å€™çœ‹èµ·æ¥ä¼¼ä¹æ‹¥æœ‰<code>String</code>å®ä¾‹çš„æ–¹æ³•,å…¶å®è´¨æ˜¯å…ˆè½¬ä¸º<code>String</code>å®ä¾‹,å†è°ƒç”¨æ–¹æ³•.è¯¦æƒ…å¯è§:<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String#%E5%9F%BA%E6%9C%AC%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%92%8C%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%8C%BA%E5%88%AB\">åŸºæœ¬å­—ç¬¦ä¸²å’Œå­—ç¬¦ä¸²å¯¹è±¡çš„åŒºåˆ«.</a></p>\n</blockquote>\n<p>å¦‚ä¸Šæ‰€ç¤º,<code>String</code>æ„é€ å‡½æ•°å°†<code>Symbol</code>å•ç‹¬æ‹å‡ºæ¥å¤„ç†,é’ˆå¯¹<code>Symbol</code>è¿”å›å…¶æè¿°ç¬¦å­—ç¬¦ä¸².</p>\n<ul>\n<li><code>Symbol.prototype.toString()</code></li>\n</ul>\n<p><code>Symbol</code>ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨<code>ToString</code>æ–¹æ³•è½¬æ¢ä¸ºå­—ç¬¦ä¸²,å…¶å®ç°é€»è¾‘å¤§è‡´å¦‚ä¸‹:</p>\n<pre><code class=\"hljs language-js\"><span class=\"lineNumber\">1</span><span class=\"hljs-built_in\">Symbol</span>.prototype.toString = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) </span>{\n<span class=\"lineNumber\">2</span>  <span class=\"hljs-keyword\">let</span> sym = thisSymbolValue(<span class=\"hljs-built_in\">this</span>);\n<span class=\"lineNumber\">3</span>  <span class=\"hljs-keyword\">return</span> SymbolDescriptiveString(sym);\n<span class=\"lineNumber\">4</span>};\n<span class=\"lineNumber\">5</span><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">thisSymbolValue</span>(<span class=\"hljs-params\">value</span>) </span>{\n<span class=\"lineNumber\">6</span>  <span class=\"hljs-keyword\">if</span> (TypeOf(value) === <span class=\"hljs-string\">'symbol'</span>) {\n<span class=\"lineNumber\">7</span>    <span class=\"hljs-keyword\">return</span> value;\n<span class=\"lineNumber\">8</span>  }\n<span class=\"lineNumber\">9</span>  <span class=\"hljs-keyword\">if</span> (TypeOf(value) === <span class=\"hljs-string\">'object'</span> &#x26;&#x26; <span class=\"hljs-string\">'__SymbolData__'</span> <span class=\"hljs-keyword\">in</span> value) {\n<span class=\"lineNumber\">10</span>    <span class=\"hljs-keyword\">let</span> s = value.__SymbolData__;\n<span class=\"lineNumber\">11</span>    assert.equal(TypeOf(s), <span class=\"hljs-string\">'symbol'</span>);\n<span class=\"lineNumber\">12</span>    <span class=\"hljs-keyword\">return</span> s;\n<span class=\"lineNumber\">13</span>  }\n<span class=\"lineNumber\">14</span>}</code></pre> \n\n<blockquote>\n<p><a href=\"https://tc39.es/ecma262/#sec-object.prototype.tostring\">å®˜æ–¹æè¿°: ECMAScriptÂ® 2022 Language Specification - Object.prototype.toString</a></p>\n</blockquote>\n<p><code>Object.prototype.toString</code>çš„å®ç°è§„èŒƒç”¨ä»£ç æ¥æè¿°:</p>\n<pre><code class=\"hljs language-js\"><span class=\"lineNumber\">1</span><span class=\"hljs-built_in\">Object</span>.prototype.toString = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) </span>{\n<span class=\"lineNumber\">2</span>  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">this</span> === <span class=\"hljs-literal\">undefined</span>) {\n<span class=\"lineNumber\">3</span>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">'[object Undefined]'</span>;\n<span class=\"lineNumber\">4</span>  }\n<span class=\"lineNumber\">5</span>  <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">this</span> === <span class=\"hljs-literal\">null</span>) {\n<span class=\"lineNumber\">6</span>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">'[object Null]'</span>;\n<span class=\"lineNumber\">7</span>  }\n<span class=\"lineNumber\">8</span>  <span class=\"hljs-keyword\">let</span> O = ToObject(<span class=\"hljs-built_in\">this</span>);\n<span class=\"lineNumber\">9</span>  <span class=\"hljs-keyword\">let</span> isArray = <span class=\"hljs-built_in\">Array</span>.isArray(O);\n<span class=\"lineNumber\">10</span>  <span class=\"hljs-keyword\">let</span> builtinTag;\n<span class=\"lineNumber\">11</span>  <span class=\"hljs-keyword\">if</span> (isArray) {\n<span class=\"lineNumber\">12</span>    builtinTag = <span class=\"hljs-string\">'Array'</span>;\n<span class=\"lineNumber\">13</span>  } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-string\">'__ParameterMap__'</span> <span class=\"hljs-keyword\">in</span> O) {\n<span class=\"lineNumber\">14</span>    builtinTag = <span class=\"hljs-string\">'Arguments'</span>;\n<span class=\"lineNumber\">15</span>  } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-string\">'__Call__'</span> <span class=\"hljs-keyword\">in</span> O) {\n<span class=\"lineNumber\">16</span>    builtinTag = <span class=\"hljs-string\">'Function'</span>;\n<span class=\"lineNumber\">17</span>  } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-string\">'__ErrorData__'</span> <span class=\"hljs-keyword\">in</span> O) {\n<span class=\"lineNumber\">18</span>    builtinTag = <span class=\"hljs-string\">'Error'</span>;\n<span class=\"lineNumber\">19</span>  } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-string\">'__BooleanData__'</span> <span class=\"hljs-keyword\">in</span> O) {\n<span class=\"lineNumber\">20</span>    builtinTag = <span class=\"hljs-string\">'Boolean'</span>;\n<span class=\"lineNumber\">21</span>  } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-string\">'__NumberData__'</span> <span class=\"hljs-keyword\">in</span> O) {\n<span class=\"lineNumber\">22</span>    builtinTag = <span class=\"hljs-string\">'Number'</span>;\n<span class=\"lineNumber\">23</span>  } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-string\">'__StringData__'</span> <span class=\"hljs-keyword\">in</span> O) {\n<span class=\"lineNumber\">24</span>    builtinTag = <span class=\"hljs-string\">'String'</span>;\n<span class=\"lineNumber\">25</span>  } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-string\">'__DateValue__'</span> <span class=\"hljs-keyword\">in</span> O) {\n<span class=\"lineNumber\">26</span>    builtinTag = <span class=\"hljs-string\">'Date'</span>;\n<span class=\"lineNumber\">27</span>  } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-string\">'__RegExpMatcher__'</span> <span class=\"hljs-keyword\">in</span> O) {\n<span class=\"lineNumber\">28</span>    builtinTag = <span class=\"hljs-string\">'RegExp'</span>;\n<span class=\"lineNumber\">29</span>  } <span class=\"hljs-keyword\">else</span> {\n<span class=\"lineNumber\">30</span>    builtinTag = <span class=\"hljs-string\">'Object'</span>;\n<span class=\"lineNumber\">31</span>  }\n<span class=\"lineNumber\">32</span>  <span class=\"hljs-keyword\">let</span> tag = O[<span class=\"hljs-built_in\">Symbol</span>.toStringTag];\n<span class=\"lineNumber\">33</span>  <span class=\"hljs-keyword\">if</span> (TypeOf(tag) !== <span class=\"hljs-string\">'string'</span>) {\n<span class=\"lineNumber\">34</span>    tag = builtinTag;\n<span class=\"lineNumber\">35</span>  }\n<span class=\"lineNumber\">36</span>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">'[object '</span> + tag + <span class=\"hljs-string\">']'</span>;\n<span class=\"lineNumber\">37</span>};</code></pre> \n\n<p>é¦–å…ˆå°†<code>undefined</code>å’Œ<code>null</code>è¿›è¡Œä¸¥æ ¼æ¯”è¾ƒåˆ¤æ–­,ç„¶åå°†ä¹‹è½¬åŒ–ä¸ºä¸€ä¸ª<code>Object</code>,å†é’ˆå¯¹å…¶å†…éƒ¨<code>æ’æ§½å±æ€§</code>(å¦‚ä¸Šæ‰€ç¤º, if else çš„åŒä¸‹åˆ’çº¿å¼€å§‹å’Œç»“æŸçš„å­—ç¬¦ä¸²åˆ¤æ–­æ¡ä»¶,å°±æ˜¯æ£€æŸ¥å¯¹è±¡å†…éƒ¨çš„<code>æ’æ§½å±æ€§</code>)å®šä¹‰ä¸€ä¸ª<code>å†…å»ºæ ‡ç­¾</code>,æœ€åæ ¹æ®<code>JS å¼•æ“</code>æä¾›çš„<code>Symbol.toStringTag</code>å±æ€§å€¼æ¥è®¾å®šæœ€ç»ˆçš„è¿”å›å­—ç¬¦ä¸²å†…å®¹.</p>\n<p>å¦‚æœæ˜¯è‡ªå®šä¹‰çš„ç±»,å¯ä»¥æ ¹æ®<code>Symbol.toStringTag</code>è¿™ä¸ª API æ¥å®ç°ç±»å‹æ£€å‡º:</p>\n<pre><code class=\"hljs language-js\"><span class=\"lineNumber\">1</span><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Yo</span> </span>{}\n<span class=\"lineNumber\">2</span>Yo.prototype[<span class=\"hljs-built_in\">Symbol</span>.toStringTag] = <span class=\"hljs-string\">'Yo'</span>\n<span class=\"lineNumber\">3</span><span class=\"hljs-built_in\">String</span>(<span class=\"hljs-keyword\">new</span> Yo()) <span class=\"hljs-comment\">// '[object Yo]'</span></code></pre> \n\n<blockquote>\n<p>å¼€å‘è€…å¯ä»¥æ ¹æ®éœ€è¦é‡å†™å…¶å®ç°,ä½†ä¸é‡å†™ä¹Ÿä¾ç„¶æ— ç¢,æ¯•ç«Ÿæœ‰ Object å¯¹è±¡çš„åŸå‹å®ç°å…œåº•.</p>\n</blockquote>\n<h3>5.3 ToPropertyKey()</h3>\n<p><code>ToPropertyKey</code>åœ¨è§„èŒƒä¸­å¸¸ç”¨äºæ‹¬å·æ“ä½œç›¸å…³çš„é€»è¾‘æè¿°æ­¥éª¤,å…¶å·¥ä½œæ–¹å¼å¦‚ä¸‹:</p>\n<pre><code class=\"hljs language-js\"><span class=\"lineNumber\">1</span><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">ToPropertyKey</span> (<span class=\"hljs-params\">argument</span>) </span>{\n<span class=\"lineNumber\">2</span>  <span class=\"hljs-keyword\">let</span> key = ToPrimitive(argument, <span class=\"hljs-string\">'string'</span>); <span class=\"hljs-comment\">// é¢„æœŸå€¼ç±»å‹ä¸º string</span>\n<span class=\"lineNumber\">3</span>  <span class=\"hljs-comment\">// é’ˆå¯¹ symbol ä½œä¸º key ç±»å‹çš„ç‰¹æ®Šè®¾è®¡</span>\n<span class=\"lineNumber\">4</span>  <span class=\"hljs-function\"><span class=\"hljs-title\">if</span>(<span class=\"hljs-params\">TypeOf(key) === <span class=\"hljs-string\">'symbol'</span></span>)</span> {\n<span class=\"lineNumber\">5</span>    <span class=\"hljs-keyword\">return</span> key;\n<span class=\"lineNumber\">6</span>  }\n<span class=\"lineNumber\">7</span>  <span class=\"hljs-keyword\">return</span> ToString(key);\n<span class=\"lineNumber\">8</span>}</code></pre> \n\n<h3>5.4 ToNumeric()</h3>\n<p>å½“<code>number</code>ä½“ç³»ä¸­å¢åŠ äº†<code>BigInt</code>ä¹‹å,æ­¤æ–¹æ³•ä¹Ÿé’ˆå¯¹<code>BigInt</code>åšäº†è®¾è®¡:</p>\n<pre><code class=\"hljs language-js\"><span class=\"lineNumber\">1</span><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">ToNumeric</span>(<span class=\"hljs-params\">value</span>) </span>{\n<span class=\"lineNumber\">2</span>  <span class=\"hljs-keyword\">let</span> primValue = ToPrimitive(value, <span class=\"hljs-string\">'number'</span>);\n<span class=\"lineNumber\">3</span>  <span class=\"hljs-keyword\">if</span> (TypeOf(primValue) === <span class=\"hljs-string\">'bigint'</span>) {\n<span class=\"lineNumber\">4</span>    <span class=\"hljs-keyword\">return</span> primValue;\n<span class=\"lineNumber\">5</span>  }\n<span class=\"lineNumber\">6</span>  <span class=\"hljs-keyword\">return</span> ToNumber(primValue);\n<span class=\"lineNumber\">7</span>}</code></pre> \n\n<p>å¦‚æœå°†å…¶è½¬åŒ–ä¸ºåŸå§‹æ•°æ®ç±»å‹ä¹‹åæ˜¯<code>BigInt</code>,åˆ™ç›´æ¥è¿”å›,å¦åˆ™å°†ä½¿ç”¨<code>ToNumber</code>æŠ½è±¡æ“ä½œ:</p>\n<pre><code class=\"hljs language-js\"><span class=\"lineNumber\">1</span><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">ToNumber</span>(<span class=\"hljs-params\">argument</span>) </span>{\n<span class=\"lineNumber\">2</span>  <span class=\"hljs-keyword\">if</span> (argument === <span class=\"hljs-literal\">undefined</span>) {\n<span class=\"lineNumber\">3</span>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">NaN</span>;\n<span class=\"lineNumber\">4</span>  } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (argument === <span class=\"hljs-literal\">null</span>) {\n<span class=\"lineNumber\">5</span>    <span class=\"hljs-keyword\">return</span> +<span class=\"hljs-number\">0</span>;\n<span class=\"lineNumber\">6</span>  } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (argument === <span class=\"hljs-literal\">true</span>) {\n<span class=\"lineNumber\">7</span>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-number\">1</span>;\n<span class=\"lineNumber\">8</span>  } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (argument === <span class=\"hljs-literal\">false</span>) {\n<span class=\"lineNumber\">9</span>    <span class=\"hljs-keyword\">return</span> +<span class=\"hljs-number\">0</span>;\n<span class=\"lineNumber\">10</span>  } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (TypeOf(argument) === <span class=\"hljs-string\">'number'</span>) {\n<span class=\"lineNumber\">11</span>    <span class=\"hljs-keyword\">return</span> argument;\n<span class=\"lineNumber\">12</span>  } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (TypeOf(argument) === <span class=\"hljs-string\">'string'</span>) {\n<span class=\"lineNumber\">13</span>    <span class=\"hljs-keyword\">return</span> parseTheString(argument); <span class=\"hljs-comment\">// æ­¤å‡½æ•°ç•¥</span>\n<span class=\"lineNumber\">14</span>  } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (TypeOf(argument) === <span class=\"hljs-string\">'symbol'</span>) {\n<span class=\"lineNumber\">15</span>    <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">TypeError</span>(); <span class=\"hljs-comment\">// symbol å’Œ bigint å°†å¼•å‘ç±»å‹é”™è¯¯å¼‚å¸¸</span>\n<span class=\"lineNumber\">16</span>  } <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (TypeOf(argument) === <span class=\"hljs-string\">'bigint'</span>) {\n<span class=\"lineNumber\">17</span>    <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">TypeError</span>();\n<span class=\"lineNumber\">18</span>  } <span class=\"hljs-keyword\">else</span> {\n<span class=\"lineNumber\">19</span>    <span class=\"hljs-comment\">// argument is an object</span>\n<span class=\"lineNumber\">20</span>    <span class=\"hljs-keyword\">let</span> primValue = ToPrimitive(argument, <span class=\"hljs-string\">'number'</span>);\n<span class=\"lineNumber\">21</span>    <span class=\"hljs-keyword\">return</span> ToNumber(primValue);\n<span class=\"lineNumber\">22</span>  }\n<span class=\"lineNumber\">23</span>}</code></pre> \n\n<p>ä»ä¸Šè¿°å®ç°æˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ¥šç†è§£åˆ°æ—¥å¸¸å·¥ä½œä¸­å¯èƒ½ç”¨åˆ°çš„å˜é‡ç±»å‹éšå¼è½¬æ¢æ˜¯å¦‚ä½•å®ç°çš„,ä»¥åŠå‡ºç°<code>TypeError</code>çš„åŸå› .</p>\n<h2>6. éšå¼è½¬æ¢èŒƒä¾‹</h2>\n<h3>6.1 Addition operator(+)</h3>\n<blockquote>\n<p>æ­¤åŠ æ³•è¿ç®—éœ€è¦å’Œä¸€å…ƒè¿ç®—ç¬¦ <code>+</code>åŒºåˆ†å¼€æ¥.ä¸€å…ƒè¿ç®—ç¬¦ä½¿ç”¨çš„æ˜¯<code>ToNumber</code>æŠ½è±¡æ“ä½œ.</p>\n</blockquote>\n<p><code>JavaScript</code>ä¸­åŠ æ³•è¿ç®—ç¬¦çš„è§„å®šä»£ç å®ç°å¦‚ä¸‹:</p>\n<pre><code class=\"hljs language-js\"><span class=\"lineNumber\">1</span><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">Addition</span>(<span class=\"hljs-params\">leftHandSide, rightHandSide</span>) </span>{\n<span class=\"lineNumber\">2</span>  <span class=\"hljs-keyword\">let</span> lprim = ToPrimitive(leftHandSide);\n<span class=\"lineNumber\">3</span>  <span class=\"hljs-keyword\">let</span> rprim = ToPrimitive(rightHandSide);\n<span class=\"lineNumber\">4</span>  <span class=\"hljs-keyword\">if</span> (TypeOf(lprim) === <span class=\"hljs-string\">'string'</span> || TypeOf(rprim) === <span class=\"hljs-string\">'string'</span>) {\n<span class=\"lineNumber\">5</span>    <span class=\"hljs-keyword\">return</span> ToString(lprim) + ToString(rprim);\n<span class=\"lineNumber\">6</span>  }\n<span class=\"lineNumber\">7</span>  <span class=\"hljs-keyword\">let</span> lnum = ToNumeric(lprim);\n<span class=\"lineNumber\">8</span>  <span class=\"hljs-keyword\">let</span> rnum = ToNumeric(rprim);\n<span class=\"lineNumber\">9</span>  <span class=\"hljs-keyword\">if</span> (TypeOf(lnum) !== TypeOf(rnum)) {\n<span class=\"lineNumber\">10</span>    <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">TypeError</span>();\n<span class=\"lineNumber\">11</span>  }\n<span class=\"lineNumber\">12</span>  <span class=\"hljs-keyword\">let</span> T = Type(lnum);\n<span class=\"lineNumber\">13</span>  <span class=\"hljs-keyword\">return</span> T.add(lnum, rnum);\n<span class=\"lineNumber\">14</span>}</code></pre> \n\n<p>ç®—æ³•æ­¥éª¤:</p>\n<ul>\n<li>å°†å·¦å³æ“ä½œæ•°è½¬åŒ–ä¸ºåŸå§‹æ•°æ®ç±»å‹</li>\n<li>å¦‚æœå…¶ä¸­ä¸€ä¸ªæ˜¯å­—ç¬¦ä¸²,åˆ™éƒ½è½¬ä¸ºå­—ç¬¦ä¸²</li>\n<li>å¦‚æœäºŒè€…çš„åŸå§‹æ•°æ®ç±»å‹åˆ†åˆ«æ˜¯<code>BigInt</code>å’Œ<code>Number</code>,åˆ™æŠ¥ç±»å‹å¼‚å¸¸é”™è¯¯</li>\n<li>å¦åˆ™æ‰§è¡Œ<code>numeric</code>ç±»å‹çš„ç›¸åŠ æ“ä½œ.</li>\n</ul>\n<p>ç¤ºä¾‹:</p>\n<pre><code class=\"hljs language-js\"><span class=\"lineNumber\">1</span>> <span class=\"hljs-number\">1</span> + <span class=\"hljs-number\">2n</span>\n<span class=\"lineNumber\">2</span>Uncaught <span class=\"hljs-built_in\">TypeError</span>: Cannot mix BigInt and other types, use explicit conversions\n<span class=\"lineNumber\">3</span>> <span class=\"hljs-number\">1n</span> + <span class=\"hljs-number\">1n</span>\n<span class=\"lineNumber\">4</span><span class=\"hljs-number\">2n</span>\n<span class=\"lineNumber\">5</span>> [<span class=\"hljs-number\">1</span>] + <span class=\"hljs-number\">2</span>  <span class=\"hljs-comment\">// æ•°ç»„è½¬åŸå§‹æ•°æ®ç±»å‹,ä¼˜å…ˆè½¬ string</span>\n<span class=\"lineNumber\">6</span><span class=\"hljs-string\">'12'</span>\n<span class=\"lineNumber\">7</span>> <span class=\"hljs-number\">1</span> + <span class=\"hljs-literal\">true</span>\n<span class=\"lineNumber\">8</span><span class=\"hljs-number\">2</span>\n<span class=\"lineNumber\">9</span>> <span class=\"hljs-number\">1</span> + {}\n<span class=\"lineNumber\">10</span><span class=\"hljs-string\">'1[object Object]'</span></code></pre> \n\n<h3>6.2 Abstract Equality Comparison (==)</h3>\n<p>æŠ½è±¡ç›¸ç­‰æ€§æ¯”è¾ƒ,ä¸”å…è®¸æˆ‘å¦‚æ­¤ç¿»è¯‘,å…¶ä»£ç å®ç°å¦‚ä¸‹,ä¸€äº›å®ç°ç»†èŠ‚çš„ä½“ä¼šç›´æ¥å†™åœ¨æ³¨é‡Šä¸­.</p>\n<pre><code class=\"hljs language-js\"><span class=\"lineNumber\">1</span><span class=\"hljs-comment\">/** Loose equality (==) */</span>\n<span class=\"lineNumber\">2</span><span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">abstractEqualityComparison</span>(<span class=\"hljs-params\">x, y</span>) </span>{\n<span class=\"lineNumber\">3</span>  <span class=\"hljs-comment\">// å¯¹äºç±»å‹ä¸€è‡´çš„ä½¿ç”¨ä¸¥æ ¼ç›¸ç­‰æ€§æ¯”è¾ƒ</span>\n<span class=\"lineNumber\">4</span>  <span class=\"hljs-keyword\">if</span> (TypeOf(x) === TypeOf(y)) {\n<span class=\"lineNumber\">5</span>    <span class=\"hljs-comment\">// Use strict equality (===)</span>\n<span class=\"lineNumber\">6</span>    <span class=\"hljs-keyword\">return</span> strictEqualityComparison(x, y);\n<span class=\"lineNumber\">7</span>  }\n<span class=\"lineNumber\">8</span> \n<span class=\"lineNumber\">9</span>  <span class=\"hljs-comment\">// Comparing null with undefined</span>\n<span class=\"lineNumber\">10</span>  <span class=\"hljs-keyword\">if</span> (x === <span class=\"hljs-literal\">null</span> &#x26;&#x26; y === <span class=\"hljs-literal\">undefined</span>) {\n<span class=\"lineNumber\">11</span>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span>;\n<span class=\"lineNumber\">12</span>  }\n<span class=\"lineNumber\">13</span>  <span class=\"hljs-keyword\">if</span> (x === <span class=\"hljs-literal\">undefined</span> &#x26;&#x26; y === <span class=\"hljs-literal\">null</span>) {\n<span class=\"lineNumber\">14</span>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span>;\n<span class=\"lineNumber\">15</span>  }\n<span class=\"lineNumber\">16</span> \n<span class=\"lineNumber\">17</span>  <span class=\"hljs-comment\">// Comparing a number and a string</span>\n<span class=\"lineNumber\">18</span>  <span class=\"hljs-comment\">// æœ‰è¶£çš„æ•°å­—å’Œå­—ç¬¦ä¸²æ¯”è¾ƒ,éƒ½è½¬ä¸ºäº†æ•°å­—.</span>\n<span class=\"lineNumber\">19</span>  <span class=\"hljs-keyword\">if</span> (TypeOf(x) === <span class=\"hljs-string\">'number'</span> &#x26;&#x26; TypeOf(y) === <span class=\"hljs-string\">'string'</span>) {\n<span class=\"lineNumber\">20</span>    <span class=\"hljs-keyword\">return</span> abstractEqualityComparison(x, <span class=\"hljs-built_in\">Number</span>(y));\n<span class=\"lineNumber\">21</span>  }\n<span class=\"lineNumber\">22</span>  <span class=\"hljs-keyword\">if</span> (TypeOf(x) === <span class=\"hljs-string\">'string'</span> &#x26;&#x26; TypeOf(y) === <span class=\"hljs-string\">'number'</span>) {\n<span class=\"lineNumber\">23</span>    <span class=\"hljs-keyword\">return</span> abstractEqualityComparison(<span class=\"hljs-built_in\">Number</span>(x), y);\n<span class=\"lineNumber\">24</span>  }\n<span class=\"lineNumber\">25</span> \n<span class=\"lineNumber\">26</span>  <span class=\"hljs-comment\">// Comparing a bigint and a string</span>\n<span class=\"lineNumber\">27</span>  <span class=\"hljs-comment\">// å­—ç¬¦ä¸²å’Œ BigInt çš„æ¯”è¾ƒ,å°†å­—ç¬¦ä¸²è½¬ä¸º BigInt</span>\n<span class=\"lineNumber\">28</span>  <span class=\"hljs-keyword\">if</span> (TypeOf(x) === <span class=\"hljs-string\">'bigint'</span> &#x26;&#x26; TypeOf(y) === <span class=\"hljs-string\">'string'</span>) {\n<span class=\"lineNumber\">29</span>    <span class=\"hljs-keyword\">let</span> n = StringToBigInt(y);\n<span class=\"lineNumber\">30</span>    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-built_in\">Number</span>.isNaN(n)) {\n<span class=\"lineNumber\">31</span>      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">false</span>;\n<span class=\"lineNumber\">32</span>    }\n<span class=\"lineNumber\">33</span>    <span class=\"hljs-keyword\">return</span> abstractEqualityComparison(x, n);\n<span class=\"lineNumber\">34</span>  }\n<span class=\"lineNumber\">35</span>  <span class=\"hljs-keyword\">if</span> (TypeOf(x) === <span class=\"hljs-string\">'string'</span> &#x26;&#x26; TypeOf(y) === <span class=\"hljs-string\">'bigint'</span>) {\n<span class=\"lineNumber\">36</span>    <span class=\"hljs-keyword\">return</span> abstractEqualityComparison(y, x);\n<span class=\"lineNumber\">37</span>  }\n<span class=\"lineNumber\">38</span> \n<span class=\"lineNumber\">39</span>  <span class=\"hljs-comment\">// Comparing a boolean with a non-boolean</span>\n<span class=\"lineNumber\">40</span>  <span class=\"hljs-comment\">// è½¬ä¸ºæ•°å­—è¿›è¡Œæ¯”è¾ƒ</span>\n<span class=\"lineNumber\">41</span>  <span class=\"hljs-keyword\">if</span> (TypeOf(x) === <span class=\"hljs-string\">'boolean'</span>) {\n<span class=\"lineNumber\">42</span>    <span class=\"hljs-keyword\">return</span> abstractEqualityComparison(<span class=\"hljs-built_in\">Number</span>(x), y);\n<span class=\"lineNumber\">43</span>  }\n<span class=\"lineNumber\">44</span>  <span class=\"hljs-keyword\">if</span> (TypeOf(y) === <span class=\"hljs-string\">'boolean'</span>) {\n<span class=\"lineNumber\">45</span>    <span class=\"hljs-keyword\">return</span> abstractEqualityComparison(x, <span class=\"hljs-built_in\">Number</span>(y));\n<span class=\"lineNumber\">46</span>  }\n<span class=\"lineNumber\">47</span> \n<span class=\"lineNumber\">48</span>  <span class=\"hljs-comment\">// Comparing an object with a primitive</span>\n<span class=\"lineNumber\">49</span>  <span class=\"hljs-comment\">// (other than undefined, null, a boolean)</span>\n<span class=\"lineNumber\">50</span>  <span class=\"hljs-comment\">// å¯¹è±¡å’Œå››å¤§åŸå§‹æ•°æ®ç±»å‹çš„æ¯”è¾ƒ,å°†å¯¹è±¡è½¬ä¸ºåŸå§‹æ•°æ®ç±»å‹</span>\n<span class=\"lineNumber\">51</span>  <span class=\"hljs-keyword\">if</span> ([<span class=\"hljs-string\">'string'</span>, <span class=\"hljs-string\">'number'</span>, <span class=\"hljs-string\">'bigint'</span>, <span class=\"hljs-string\">'symbol'</span>].includes(TypeOf(x))\n<span class=\"lineNumber\">52</span>    &#x26;&#x26; TypeOf(y) === <span class=\"hljs-string\">'object'</span>) {\n<span class=\"lineNumber\">53</span>      <span class=\"hljs-keyword\">return</span> abstractEqualityComparison(x, ToPrimitive(y));\n<span class=\"lineNumber\">54</span>    }\n<span class=\"lineNumber\">55</span>  <span class=\"hljs-keyword\">if</span> (TypeOf(x) === <span class=\"hljs-string\">'object'</span>\n<span class=\"lineNumber\">56</span>    &#x26;&#x26; [<span class=\"hljs-string\">'string'</span>, <span class=\"hljs-string\">'number'</span>, <span class=\"hljs-string\">'bigint'</span>, <span class=\"hljs-string\">'symbol'</span>].includes(TypeOf(y)) {\n<span class=\"lineNumber\">57</span>      <span class=\"hljs-keyword\">return</span> abstractEqualityComparison(ToPrimitive(x), y);\n<span class=\"lineNumber\">58</span>    }\n<span class=\"lineNumber\">59</span>  \n<span class=\"lineNumber\">60</span>  <span class=\"hljs-comment\">// Comparing a bigint with a number</span>\n<span class=\"lineNumber\">61</span>\t<span class=\"hljs-comment\">// bigint å’Œæ•°å­—çš„æ¯”è¾ƒ,åˆ™åˆ¤å®šæ­£è´Ÿæ— ç©·æ€§å’Œ NaN,è¿™å‡ ä¸ªç±»å‹æ— æ³•æ¯”è¾ƒ,ä¸€å¾‹è¿”å› false</span>\n<span class=\"lineNumber\">62</span>  <span class=\"hljs-keyword\">if</span> ((TypeOf(x) === <span class=\"hljs-string\">'bigint'</span> &#x26;&#x26; TypeOf(y) === <span class=\"hljs-string\">'number'</span>)\n<span class=\"lineNumber\">63</span>    || (TypeOf(x) === <span class=\"hljs-string\">'number'</span> &#x26;&#x26; TypeOf(y) === <span class=\"hljs-string\">'bigint'</span>)) {\n<span class=\"lineNumber\">64</span>      <span class=\"hljs-keyword\">if</span> ([<span class=\"hljs-literal\">NaN</span>, +<span class=\"hljs-literal\">Infinity</span>, -<span class=\"hljs-literal\">Infinity</span>].includes(x)\n<span class=\"lineNumber\">65</span>        || [<span class=\"hljs-literal\">NaN</span>, +<span class=\"hljs-literal\">Infinity</span>, -<span class=\"hljs-literal\">Infinity</span>].includes(y)) {\n<span class=\"lineNumber\">66</span>          <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">false</span>;\n<span class=\"lineNumber\">67</span>        }\n<span class=\"lineNumber\">68</span>    \t<span class=\"hljs-comment\">// å¦åˆ™æŒ‰æ•°å­¦æ€§å€¼çš„ç›¸ç­‰æ¯”è¾ƒ, 1 == 1n ä¸º true</span>\n<span class=\"lineNumber\">69</span>      <span class=\"hljs-keyword\">if</span> (isSameMathematicalValue(x, y)) {\n<span class=\"lineNumber\">70</span>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span>;\n<span class=\"lineNumber\">71</span>      } <span class=\"hljs-keyword\">else</span> {\n<span class=\"lineNumber\">72</span>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">false</span>;\n<span class=\"lineNumber\">73</span>      }\n<span class=\"lineNumber\">74</span>    }  \n<span class=\"lineNumber\">75</span>  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">false</span>;\n<span class=\"lineNumber\">76</span>}</code></pre> \n\n<p>éƒ¨åˆ†æŠ½è±¡æ“ä½œå¯ä»¥æŸ¥çœ‹<code>ECMAScript æ–‡æ¡£</code>.</p>\n<h2>7. æœ¯è¯­è¡¥å……</h2>\n<p>æœ¬æ–‡åˆ°æ­¤å³å°†ç»“æŸ,æˆ‘ä»¬åœ¨ç±»å‹è½¬æ¢çš„è§„èŒƒæè¿°ä¸­ç»å¸¸çœ‹åˆ°å¦‚ä¸‹å‡ ä¸ªæœ¯è¯­,åŠ æ·±å…¶ç†è§£å¯¹äºæˆ‘ä»¬ç†è§£<code>ECMAScript è§„èŒƒ</code>æœ‰ä¸€å®šçš„å¸®åŠ©.</p>\n<ul>\n<li><em>type conversion</em>: æˆ‘ä»¬å¸Œæœ›è¾“å‡ºçš„å€¼å…·å¤‡æŒ‡å®šçš„ç±»å‹,å¦‚æœè¾“å…¥å·²ç»ç”±ç±»å‹,é€šå¸¸ç±»å‹è½¬æ¢åªæ˜¯ç®€å•çš„è¿”å›å…¶ç±»å‹,å¦åˆ™å°†å…¶å€¼è½¬æ¢ä¸º<code>hint</code>é¢„æœŸç±»å‹.</li>\n<li><em>Explicit type conversion</em>: æ˜¾ç¤ºç±»å‹è½¬æ¢æŒ‡çš„æ˜¯è¯­è¨€æ–¹é¢é€šè¿‡æ”¯æŒä¸€äº›æ“ä½œæˆ–è€…å‡½æ•°å‡ºå‘ç±»å‹è½¬æ¢,ç±»ä¼¼<code>JavaScript</code>ä¸­çš„<code>Number()/String()/Boolean()</code>ç­‰ç­‰,æ˜¾ç¤ºçš„ç±»å‹è½¬æ¢æ˜“äºé˜…è¯»å’Œç†è§£,æ•…ç¤¾åŒºä¸­å¸¸æœ‰<code>æ˜¾ç¤ºå¤§äºéšå¼</code>çš„è¯´æ³•,å…¶æ”¯æŒè€…ç”šå¤š.åœ¨<code>JavaScript</code>ä¸­æ˜¾ç¤ºè½¬æ¢ä¼šå¯¹å€¼åšä¸¤ç§ç±»å‹çš„æ“ä½œ:\n<ul>\n<li>Checked: æ£€æŸ¥æ˜¯å¦å¯ä»¥è½¬æ¢,å¦‚æœä¸è¡Œåˆ™æŠ›å‡ºå¼‚å¸¸</li>\n<li>Unchecked: è¿”å›ä¸€ä¸ªè®¾è®¡æ€§é”™è¯¯çš„å€¼,å¦‚æœ¬æ–‡å¼€å¤´æ‰€è¿°<code>1 / false</code> è¿”å› <code>Infinity</code>.</li>\n</ul>\n</li>\n<li><em>type casting</em>: ç±»å‹å®šä¹‰,ç±»ä¼¼äº<code>Java</code>ä¸­,åœ¨ä¸€ä¸ªèŒƒå›´å†…,ä¸å¯ä»¥å°†ä¸åŒç±»å‹çš„å€¼èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡.æŒ‰ç¼–ç¨‹è¯­è¨€çš„è®¾è®¡è€Œå®š, å…¶å®è´¨æ˜¯æ˜ç¡®çš„ç±»å‹æ£€æŸ¥.</li>\n<li><em>Type coercion</em>: éšå¼ç±»å‹è½¬æ¢, å¼±ç±»å‹è¯­è¨€çš„ç‰¹å¾ä¹‹ä¸€.</li>\n</ul>\n<h2>references</h2>\n<ul>\n<li><a href=\"https://2ality.com/2019/10/type-coercion.html\">Type coercion in JavaScript</a></li>\n<li><a href=\"https://timothygu.me/es-howto/\">How to Read the ECMAScript Specification</a></li>\n<li><a href=\"https://segmentfault.com/a/1190000019240609\">æ€æ ·é˜…è¯» ECMAScript è§„èŒƒï¼Ÿ - SegmentFault æ€å¦</a></li>\n<li><a href=\"http://www.ruanyifeng.com/blog/2015/11/ecmascript-specification.html\">è¯»æ‡‚ ECMAScript è§„æ ¼ - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—</a></li>\n<li><a href=\"https://sinaad.github.io/xfe/2016/04/15/ToPrimitive/\">jséšå¼è£…ç®±-ToPrimitive | {XFE}</a></li>\n<li><a href=\"http://ldllidonglin.github.io/blog/2020/03/10/2020-03-10-%E3%80%90%E8%AF%91%E3%80%91%E5%A6%82%E4%BD%95%E9%98%85%E8%AF%BBECMAScript%E8%A7%84%E8%8C%83(%E4%B8%80)/\">ã€è¯‘ã€‘å¦‚ä½•é˜…è¯»ECMAScriptè§„èŒƒ(ä¸€) | æå†¬ç³çš„åšå®¢</a></li>\n<li><a href=\"https://medium.com/@nikjohn/cast-to-number-in-javascript-using-the-unary-operator-f4ca67c792ce\">Cast to Number in Javascript using the Unary (+) Operator | by Nikhil John | Medium</a></li>\n</ul>\n","title":"javascriptè¯­è¨€ä¸­çš„ç±»å‹è½¬æ¢","date":"2021/3/22","tags":["javascript","tc39"],"mainImg":"https://images.unsplash.com/photo-1472437774355-71ab6752b434?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwxNjUyNjZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2MTY0MTAxMzQ&ixlib=rb-1.2.1&q=80&w=1080","coverImg":"https://images.unsplash.com/photo-1472437774355-71ab6752b434?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwxNjUyNjZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2MTY0MTAxMzQ&ixlib=rb-1.2.1&q=80&w=400","intro":"ä½ å¥½,TC39.è¯·é—® JavaScript ä¸–ç•Œä¸­çš„å¯¹è±¡è½¬æ¢æ˜¯å¦‚ä½•å®ç°çš„å‘¢?"}},"__N_SSG":true}