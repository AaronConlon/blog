{"pageProps":{"post":{"slug":"github-action-æµ…è§£","content":"\n### å‰è¨€\n\næˆ‘ç¡®å®éœ€è¦ä½¿ç”¨ GitHub action æ¥åšä¸€äº›äº‹æƒ…ã€‚æ­¤å‰æˆ‘ç…§æ¬ä»–äººçš„é…ç½®æ¥åˆ›å»ºäº†è‡ªå·±çš„åšå®¢æ„å»ºç³»ç»Ÿï¼Œä½†å½“æ—¶æ²¡æœ‰ä»”ç»†ğŸ¤”æ€è€ƒè¿™æ•´ä¸ªè¿‡ç¨‹ï¼Œä¹Ÿæ²¡æœ‰ç»§ç»­äº†è§£ GitHub action åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œæˆ‘æƒ³ä»Šå¤©æ˜¯æ—¶å€™äº†ï¼Œè®©æˆ‘ä»¬æ›´å¤šåœ°äº†è§£ GitHub actionï¼\n\n### What's Github action?\n\n2018 å¹´ 10 æœˆï¼ŒGitHub æ¨å‡ºäº†`Github Action`æŒç»­é›†æˆæœåŠ¡ï¼Œå…¶ä¸­åŒ…æ‹¬æŠ“å–ä»£ç ã€è¿è¡Œæµ‹è¯•ã€å‘å¸ƒåˆ°ç¬¬ä¸‰æ–¹æœåŠ¡ã€è¿œç¨‹ç™»å½•æœåŠ¡å™¨ç­‰ç­‰ã€‚ä¸ºäº†æ–¹ä¾¿å¼€å‘è€…æ‰§è¡Œä¸€äº›æ“ä½œï¼ŒGitHub å…è®¸å¼€å‘è€…ç¼–å†™ç‹¬ç«‹çš„å¯å…±äº«çš„è„šæœ¬æ–‡ä»¶æ¥è‡ªåŠ¨åŒ–åœ°æ‰§è¡Œç›¸å…³ä»»åŠ¡ã€‚\n\nä¾‹å¦‚ï¼Œåœ¨ push æ–°çš„å†…å®¹åˆ°ä»“åº“åè‡ªåŠ¨æ„å»ºä¸€ä¸ªé™æ€ç«™ç‚¹ï¼Œäº¦æˆ–æ˜¯é€šè¿‡è®¾ç½®å¥½çš„ shell è„šæœ¬ï¼Œå°†æ•°æ®åŒæ­¥åˆ° VPS ä¸Šï¼Œå†åœ¨ VPS ä¸Šæ‰§è¡Œä¸€äº›ä»»åŠ¡ï¼Œè¿™éƒ¨åˆ†å°±éå¸¸çµæ´»äº†ã€‚\n\næˆ‘ä»¬å¯ä»¥åœ¨[å®˜æ–¹å¸‚åœº](https://github.com/marketplace?type=actions)æˆ–è€…[awesome actions](https://github.com/sdras/awesome-actions)æ‰¾åˆ°å…·æœ‰ç‰¹å®šåŠŸèƒ½çš„å…±äº«`action`è„šæœ¬ã€‚\n\n### åŸºæœ¬æ¦‚å¿µ\n\nGitHub action å¸¸è§æœ¯è¯­å¦‚ä¸‹ï¼š\n\n- workflowï¼šå·¥ä½œæµç¨‹ï¼ŒåŒ…å«ä»¥ä¸‹å‡ ç‚¹\n  - Job: ä»»åŠ¡ï¼Œä¸€ä¸ªå·¥ä½œæµå¯ä»¥å…·æœ‰å¤šä¸ª job\n    - stepï¼šjob ç”± step ç»„æˆï¼Œè‹¥å¹²ä¸ªæ­¥éª¤æ‰§è¡Œç»“æŸå³è¡¨ç¤º job ç»“æŸ\n      - actionï¼šæ¯ä¸€ä¸ªæ­¥éª¤å¯ä»¥æ‰§è¡Œè‹¥å¹²ä¸ªå‘½ä»¤\n\n### å®è·µ\n\nåœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª`.github/workflows`ç›®å½•ï¼Œæ­¤ç›®å½•ä¸‹çš„æ‰€æœ‰`.yml`æ–‡ä»¶éƒ½åŒ…å«ç€å•ç‹¬çš„`workflow`ï¼Œè¿™äº›å·¥ä½œæµè„šæœ¬å°†è‡ªåŠ¨è¿è¡Œã€‚\n\n> è¯¦ç»†é…ç½®é“¾æ¥ [Workflow syntax for GitHub Actions - GitHub Docs](https://docs.github.com/en/actions/learn-github-actions/workflow-syntax-for-github-actions#on) \n\nè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå…¸å‹çš„ workflow æ–‡ä»¶ç¤ºä¾‹`demo.yml`ï¼š\n\n```yaml\nname: GitHub Actions Demo\non: [push]\njobs:\n  Explore-GitHub-Actions:\n    runs-on: ubuntu-latest\n    steps:\n      - run: echo \"ğŸ‰ The job was automatically triggered by a ${{ github.event_name }} event.\"\n      - run: echo \"ğŸ§ This job is now running on a ${{ runner.os }} server hosted by GitHub!\"\n      - run: echo \"ğŸ” The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}.\"\n      - name: Check out repository code\n        uses: actions/checkout@v2\n      - run: echo \"ğŸ’¡ The ${{ github.repository }} repository has been cloned to the runner.\"\n      - run: echo \"ğŸ–¥ï¸ The workflow is now ready to test your code on the runner.\"\n      - name: List files in the repository\n        run: |\n          ls ${{ github.workspace }}\n      - run: echo \"ğŸ This job's status is ${{ job.status }}.\"\n```\n\nè¿™ç§é…ç½®æ–‡ä»¶è¢«ç§°ä¸º`yaml`æ–‡ä»¶ï¼Œä¸Šè¿°å®˜æ–¹ç¤ºä¾‹ä¸­å¯ä»¥çœ‹åˆ°ä»¥ä¸‹å‡ ä¸ªå…¸å‹å­—æ®µï¼š\n\n- name: å·¥ä½œæµçš„åç§°ï¼Œé»˜è®¤ç­‰åŒäºæ–‡ä»¶å\n\n- on: è¿è¡Œæ¡ä»¶ï¼Œå¯ä»¥æ˜¯æ•°ç»„ï¼Œä¹Ÿå¯ä»¥æ˜¯å•ç‹¬çš„å­—ç¬¦ä¸²ï¼Œä¸Šè¿°è¡¨ç¤ºæ‰€æœ‰`push`è¡Œä¸ºéƒ½ä¼šæ‰§è¡Œåç»­ä»»åŠ¡ï¼Œç”šè‡³å¯ä»¥æ ¹æ®åˆ†æ”¯æ¥æŒ‡å®šæ‰§è¡Œæ—¶æœºã€‚\n\n- jobs: åˆ™è¡¨ç¤ºæ­¤å·¥ä½œæµä¸­çš„ä»»åŠ¡ï¼Œ`Explore-GitHub-Actions`å°±æ˜¯ä»»åŠ¡`id`ï¼Œç”¨äºåŒºåˆ†å¤šä¸ªä»»åŠ¡ï¼Œä¸åŒä»»åŠ¡ä¹‹é—´è¯·ä¿æŒè‰¯å¥½çš„ç¼©è¿›æ ¼å¼ã€‚æ¯ä¸ªä»»åŠ¡åŒ…æ‹¬ï¼š\n\n  - nameï¼ˆä»»åŠ¡åï¼‰\n  - needsï¼ˆä»»åŠ¡æ‰§è¡Œçš„ä¾èµ–é¡ºåºï¼Œå¯ä»¥æ˜¯å•ç‹¬çš„ä»»åŠ¡ idï¼Œæˆ–è€…æ˜¯åŒ…å«ä»»åŠ¡ id çš„æ•°ç»„ï¼Œå½“æŸä¸ªä»»åŠ¡éœ€è¦åœ¨æŒ‡å®šçš„ä»»åŠ¡ä¹‹åæ‰§è¡Œæ—¶ï¼Œéœ€è¦è®¾ç½® needsï¼‰\n  - runs-onï¼ˆè¿è¡Œç¯å¢ƒï¼Œæ”¯æŒå¸¸è§çš„æœåŠ¡å™¨å‘è¡Œç‰ˆï¼Œé€šå¸¸ä½¿ç”¨ ubuntu-latestï¼‰\n\n- steps: ä»»åŠ¡æ­¥éª¤ï¼ŒåŒ…å«ï¼š\n\n  - nameï¼šå•ä¸ªæ­¥éª¤å\n  - uses: ä½¿ç”¨ä»–äººçš„ action è„šæœ¬ä½œä¸ºå½“å‰æ­¥éª¤çš„ä¸€éƒ¨åˆ†ï¼Œå®˜æ–¹`å¼ºçƒˆå»ºè®®`æˆ‘ä»¬åœ¨ä½¿ç”¨ä»–äººçš„ action çš„æ—¶å€™æŒ‡å®š git é“¾æ¥ã€SHA æˆ– Docker tagï¼Œè¿™æ ·èƒ½é¿å…å½“ä»–äººçš„ action æ›´æ–°æ—¶äº§ç”ŸæœªçŸ¥çš„è¡Œä¸ºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n  ```yaml\n  steps:\n    # Reference a specific commit\n    - uses: actions/checkout@a81bbbf8298c0fa03ea29cdc473d45769f953675\n    # Reference the major version of a release\n    - uses: actions/checkout@v2\n    # Reference a specific version\n    - uses: actions/checkout@v2.2.0\n    # Reference a branch\n    - uses: actions/checkout@main\n  ```\n\n  ä½¿ç”¨ç¬¬ä¸‰æ–¹ action çš„æ—¶å€™ä¹Ÿè¦é˜…è¯»å…¶`README`æ–‡æ¡£ï¼Œä»¥é¿å…æŸäº›éœ€è¦é…ç½®çš„æ•°æ®ç¼ºå¤±ã€‚\n\n  - run: æ‰§è¡ŒæŸäº›æ“ä½œç³»ç»Ÿ shell å‘½ä»¤ï¼Œä¾‹å¦‚å¸¸è§çš„`npm install`ï¼Œå¦‚æœæœ‰å¤šä¸ªå‘½ä»¤ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š\n\n  ```yaml\n  - name: install dependencies\n  \trun: |\n  \t\tnpm ci\n  \t\tnpm run build\n  \tworking-directory: ./src\n  ```\n\n  `working-directory`æ˜¯å¯é€‰çš„ï¼Œç”¨äºæŒ‡å®šè¿è¡Œæ­¤å‘½ä»¤çš„ç›®å½•ï¼Œä¸æŒ‡å®šæ—¶å°†åœ¨æ ¹ç›®å½•ä¸‹è¿è¡Œã€‚\n\n  - shell: æŒ‡å®š shell ç±»å‹ï¼Œå¯ä»¥æ˜¯`bash`ã€`pwshï¼ˆpowershell ç”¨äº windows serverï¼‰`ï¼Œç”šè‡³æ˜¯ä½ å–œæ¬¢çš„`fish`æˆ–`zsh`ï¼Œç”šè‡³æ˜¯`python`ç¯å¢ƒï¼\n  - with: å®šä¹‰ä¸€ç³»åˆ—çš„é”®å€¼å¯¹æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨ï¼Œé»˜è®¤ä¼šæ·»åŠ å‰ç¼€`INPUT_`ï¼Œå¹¶ä¸”å…¨éƒ¨è½¬åŒ–ä¸ºå¤§å†™å­—æ¯ã€‚å½“ action ä½¿ç”¨åˆ° docker çš„æ—¶å€™ï¼Œå¯ä»¥è®¾ç½® args å’Œ entrypoint ä½œä¸ºå®¹å™¨çš„è¾“å…¥ï¼Œè¯¦æƒ…å¯æŸ¥é˜…æ–‡æ¡£ï¼Œæ­¤å¤„ä¸å»¶ä¼¸ã€‚\n  - envï¼šenv ä¹Ÿå¯ä»¥è®¾ç½®å•ç‹¬çš„ç¯å¢ƒå˜é‡ï¼Œå¹¶ä¸”è¿™äº›å˜é‡å¯ä»¥éå¸¸éšç§˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®ä»“åº“çš„`secret`é€‰é¡¹æ¥å¢åŠ å—ä¿æŠ¤çš„ç¯å¢ƒå˜é‡ï¼Œä¾‹å¦‚ï¼š`GITHUB_TOKEN: ${{ secrets.TOKEN }}`å¯ä»¥è¯»å–`secret`ä¸­çš„`TOKEN`å˜é‡æ·»åŠ åˆ°æ•´ä¸ªé¡¹ç›®ä¸­æ¥ ã€‚\n\n  - if : æ·»åŠ æ¡ä»¶ï¼Œé…åˆè¡¨è¾¾å¼å¯ä»¥å®ç°å¾ˆå¤šåŠŸèƒ½ï¼Œä¾‹å¦‚æ ¹æ®ä¸Šä¸€ä¸ªä»»åŠ¡æ˜¯å¦æˆåŠŸè€Œå†³å®šæ˜¯å¦æ‰§è¡Œé€‰å®šçš„æ­¥éª¤ï¼Œä¸¾ä¸ªä¾‹å­ï¼š\n\n  ```yaml\n  steps:\n    - name: My first step\n      uses: octo-org/action-name@main\n    - name: My backup step\n      if: ${{ failure() }}\n      uses: actions/heroku@1.0.0\n  ```\n\n  â€‹\tè¿™é‡Œå°±å¯ä»¥æ ¹æ®ç¬¬ä¸€ä¸ªæ­¥éª¤ä½¿ç”¨çš„ç»“æœæ¥å†³å®šæ˜¯å¦å†ä½¿ç”¨å¦ä¸€ä¸ªè„šæœ¬ã€‚\n\n\n### å‘å¸ƒä¸€ä¸ª React åº”ç”¨\n\nç°åœ¨ï¼Œæˆ‘çš„æ‰‹å¤´æœ‰ä¸€ä¸ªåä¸º`emoji_search_zh`çš„åº”ç”¨ï¼Œåœ¨è¿™ä¸ªåº”ç”¨é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æœç´¢ä¸­æ–‡å…³é”®å­—å»æ£€ç´¢`emoji`å­—ç¬¦ï¼Œå¹¶ä¸”å¯ä»¥å¾ˆæ–¹ä¾¿çš„å¤åˆ¶åˆ°å‰ªè´´æ¿ğŸ“‹ï¼ˆå¬èµ·æ¥ä¼¼ä¹æœ‰ç‚¹é¸¡è‚‹ğŸ‘¦ğŸ»ï¼‰ã€‚\n\nç°åœ¨ï¼Œä¸€æ­¥æ­¥æ¥éƒ¨ç½²ï¼š\n\n#### é…ç½® homepage\n\nå½“åº”ç”¨å‡†å¤‡å¥½éƒ¨ç½²æ—¶ï¼Œå°†`homepage`æ·»åŠ åˆ°`package.json`ä¸Šã€‚\n\n```json\n\"homepage\": \"https://<githubusername>.github.io/<app>\"\n```\n\n> æ³¨æ„æ›¿æ¢æ‰è´¦æˆ·åå’Œåº”ç”¨åç§°ï¼Œè¿™ä¸ªåç§°å¯ä»¥æ˜¯ä»“åº“å\n\n#### å¯ç”¨ GitHub Pages\n\nåˆ›å»ºä¸€ä¸ªåˆ†æ”¯ç”¨äºéƒ¨ç½²ï¼Œä¾‹å¦‚ï¼š`gh-pages`:\n\n`git checkout -b gh-pages`\n\n> åˆ›å»ºåˆ†æ”¯æœ‰åˆ©äºä¿æŒæˆ‘ä»¬æºä»£ç å’Œåº”ç”¨éƒ¨ç½²çš„ç‹¬ç«‹æ€§\n\n\n\n#### åˆ›å»ºå·¥ä½œæµ action\n\n\n\n\n\n### å‚è€ƒ\n\n- [GitHub Actions å¿«é€Ÿå…¥é—¨ - GitHub Docs](https://docs.github.com/cn/actions/quickstart)\n- [GitHub Actions å…¥é—¨æ•™ç¨‹ - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—](https://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html)\n- \n","title":"github action æµ…è§£","date":"2021/11/28","tags":["Git"],"mainImg":"https://images.unsplash.com/photo-1633791583517-c828e6f851a9?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwxNjUyNjZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2MzgwODk0OTQ&ixlib=rb-1.2.1&q=80&w=1080","coverImg":"https://images.unsplash.com/photo-1633791583517-c828e6f851a9?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwxNjUyNjZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2MzgwODk0OTQ&ixlib=rb-1.2.1&q=80&w=400","intro":"æˆ‘éœ€è¦ä½¿ç”¨ GitHub action æ¥è‡ªåŠ¨éƒ¨ç½²ä¸€äº›åº”ç”¨ã€‚"}},"__N_SSG":true}