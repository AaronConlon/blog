{"pageProps":{"post":{"slug":"ä»å®ç°Koaæ–‡ä»¶ä¸Šä¼ æ¥å£å­¦åˆ°çš„ä¸œè¥¿","contentHtml":"<h1>å‰è¨€</h1>\n<blockquote>\n<p>â€œæŒºæ°´çš„ã€‚â€</p>\n<p>â€œæ¯”æ²¡æœ‰å¥½ï¼â€</p>\n</blockquote>\n<p>æˆ‘åœ¨å†™åç«¯ç¨‹åºä¹‹å‰ï¼Œé˜…è¯»äº†<code>ã€Šç‹¼ä¹¦ï¼šNode.js Web åº”ç”¨å¼€å‘ã€‹</code>ï¼Œé€‰æ‹©äº†<code>koa-bodyparser</code>ä½œä¸ºæ•°æ®ç±»å‹è§£æä¸­é—´ä»¶ï¼Œä½†æ˜¯åœ¨éœ€è¦å®ç°æ–‡ä»¶ä¸Šä¼ çš„æ—¶å€™å‘ç°<code>koa-bodyparser</code>ä¸æ”¯æŒ<code>enctype=\"multipart/form-data\"</code>ã€‚</p>\n<p>åœ¨ GitHub çš„ issue æ¿å—ï¼Œå…¶æ ¸å¿ƒå¼€å‘è€…å›å¤ä½¿ç”¨<code>busboy</code>è¿™ä¸ªåº“ï¼Œä½†æ˜¯çœ‹èµ·æ¥å·²ç»å¾ˆå¤šå¹´æ²¡æœ‰æ›´æ–°æ–‡æ¡£äº†ï¼Œäºæ˜¯æˆ‘æŸ¥æ‰¾åˆ°äº†<code>koa-body</code>æ¥ä»£æ›¿<code>koa-bodyparser</code>ã€‚</p>\n<h1>ä½¿ç”¨è¿‡ç¨‹</h1>\n<p>åœ¨<code>koa-body</code>çš„ä»“åº“<code>README</code>ç•Œé¢ä¸Šå¯ä»¥çœ‹åˆ°å…¶åŠŸèƒ½ç‰¹æ€§ï¼š</p>\n<p><a href=\"https://github.com/koajs/koa-body\">koajs/koa-body: koa body parser middleware</a></p>\n<ul>\n<li>can handle requests such as:\n<ul>\n<li><strong>multipart/form-data</strong></li>\n<li><strong>application/x-www-urlencoded</strong></li>\n<li><strong>application/json</strong></li>\n<li><strong>application/json-patch+json</strong></li>\n<li><strong>application/vnd.api+json</strong></li>\n<li><strong>application/csp-report</strong></li>\n<li><strong>text/xml</strong></li>\n</ul>\n</li>\n<li>option for patch to Koa or Node, or either</li>\n<li>file uploads</li>\n<li>body, fields and files size limiting</li>\n</ul>\n<p>ğŸ‘ŒğŸ»ï¼Œæ”¯æŒ<code>multipart/form-data</code>å’Œæ–‡ä»¶ä¸Šä¼ ï¼Œå¯¹äºåç«¯æ¥å£ä¹Ÿæä¾›äº†è‰¯å¥½çš„<code>json</code>è§£ææ”¯æŒã€‚å®‰è£…å¥½äº†ä¹‹åï¼ŒæŒ‰éœ€è¦çš„åŠŸèƒ½è¿›è¡Œå®ä¾‹åŒ–ï¼Œç„¶åä½œä¸ºä¸€ä¸ªä¸­é—´ä»¶æ¥ä½¿ç”¨å³å¯ã€‚</p>\n<pre><code><span>const</span> koaBody = <span>require</span>(<span>\"koa-body\"</span>)\n<span class=\"lineNumber\">2</span>...\n<span class=\"lineNumber\">3</span>app.use(koaBody({\n<span class=\"lineNumber\">4</span>  <span>json</span>: <span>true</span>, <span>// å¼€å¯ json æ”¯æŒ</span>\n<span class=\"lineNumber\">5</span>  <span>multipart</span>: <span>true</span>, <span>// å¼€å¯ multipart/form-data æ”¯æŒ</span>\n<span class=\"lineNumber\">6</span>  <span>formlimit</span>: <span>2</span> * <span>1024</span> * <span>1024</span>, <span>// ä¼ è¾“å¤§å°é™åˆ¶ï¼Œé»˜è®¤ 56 kb</span>\n<span class=\"lineNumber\">7</span>  <span>formidable</span>: {\n<span class=\"lineNumber\">8</span>    <span>uploadDir</span>: process.env.UPLOAD_PATH, <span>// ä¸Šä¼ ä¿å­˜ç›®å½•</span>\n<span class=\"lineNumber\">9</span>    <span>hash</span>: â€˜md5â€™, <span>// è®¡ç®—å“ˆå¸Œå€¼ï¼Œæä¾›ç®—æ³• md1 or sha1</span>\n<span class=\"lineNumber\">10</span>    <span>keepExtensions</span>: <span>true</span>, <span>// ä¿ç•™æ‰©å±•å</span>\n<span class=\"lineNumber\">11</span>    <span>multiples</span>: <span>false</span>, <span>// ç¦æ­¢å¤šæ–‡ä»¶ä¸Šä¼ </span>\n<span class=\"lineNumber\">12</span>  }\n<span class=\"lineNumber\">13</span>}))</code></pre> \n\n<p>å¯ä»¥ä»ä»“åº“æ–‡æ¡£çœ‹åˆ°è¿˜å¯ä»¥åšå…¶ä»–æ“ä½œï¼Œä¾‹å¦‚ä¿å­˜å‰é‡å‘½åï¼Œè¿™ç±»æ“ä½œéƒ½é€šè¿‡é…ç½®å¯¹è±¡å®ä¾‹åŒ–çš„æ–¹å¼æ¥å®ç°ã€‚</p>\n<p>ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»è·¯ç”±å‡½æ•°é‡Œé€šè¿‡<code>ctx.request.files</code>è·å–åˆ°ä¸Šä¼ çš„æ–‡ä»¶ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¿å­˜ä½ç½®ã€æ‰©å±•åâ€˜æ–‡ä»¶åã€å“ˆå¸Œå€¼ã€å¤§å°ç­‰ç­‰ã€‚</p>\n<p>æˆ‘æƒ³è¿‡å¯¹äºé‡å¤ä¸Šä¼ ç›¸åŒå“ˆå¸Œå€¼çš„æ–‡ä»¶åšæ‹¦æˆªï¼Œåæ¥åœ¨å…¶<code>issue</code>æ¿å—å‘ç°æœ‰äººæè¿‡è¿™ä¸ªé—®é¢˜ï¼Œè¿™ä¸ª<code>issue</code>æ²¡æœ‰å…³é—­ï¼Œæœ‰äººæè®®ä½¿ç”¨<code>fs</code>æ¨¡å—åšå¤„ç†ï¼Œæš‚æ—¶å¥½åƒåªèƒ½è¿™æ ·ã€‚</p>\n<h1>å…¶ä»–</h1>\n<h2>curl</h2>\n<p>å†™å¥½äº†æ¥å£ï¼Œæˆ‘æ‰“ç®—ä½¿ç”¨<code>curl</code>æ¥æµ‹è¯•ï¼Œå…¶ä¸Šä¼ å‘½ä»¤å¦‚ä¸‹ï¼š</p>\n<pre><code>$ curl -F <span>'upload_filename=@demo.jpg'</span> http://localhost/upload</code></pre> \n\n<p>æä¾›<code>-F</code>å‚æ•°æŒ‡å®šè¯·æ±‚POSTç±»å‹å¹¶ä¸”æ·»åŠ <code>enctype=\"multipart/form-data</code>ï¼ŒæŒ‡å®šä¸Šä¼ æ–‡ä»¶åå’Œæ–‡ä»¶è·¯å¾„ã€‚</p>\n<blockquote>\n<p>å¦‚æœæƒ³ä¸Šä¼ å¤šä¸ªæ–‡ä»¶ï¼Œåˆ™ç»§ç»­æ·»åŠ  <code>-F xxx</code>å³å¯</p>\n</blockquote>\n<h2>Vim</h2>\n<p>æˆ‘æœ€è¿‘åœ¨åšæŒä½¿ç”¨<code>vim</code>è¿›è¡Œç¼–ç¨‹ï¼Œä»Šæ™šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘å¸Œæœ›æ˜¾ç¤ºç›¸å¯¹è¡Œæ•°ï¼Œå¹¶ä¸”å½“å‰è¡Œæ˜¾ç¤ºä¸ºæ‰€åœ¨è¡Œçš„è¡Œæ•°ã€‚</p>\n<p>å…¶é…ç½®ä¸ºï¼š</p>\n<pre><code><span>set</span> number relativenumber\n<span class=\"lineNumber\">2</span><span># or set nu rnu</span></code></pre> \n\n<p>å•çº¯ä½¿ç”¨<code>set rnu</code>ä¼šè®©æ‰€æœ‰è¡Œéƒ½ä¸ºç›¸å¯¹è¡Œæ•°ï¼Œå½“å‰è¡Œä¸º<code>0</code>ï¼Œ<code>vim7.4</code>ç‰ˆæœ¬åæä¾›äº†<code>Hybird</code>æ··åˆæ¨¡å¼ï¼Œå¯ä»¥å®ç°æˆ‘çš„éœ€æ±‚ã€‚</p>\n<h2>æ–‡ä»¶å‹ç¼©å’Œä¸‹è½½</h2>\n<p>æ­¤éœ€æ±‚åœ¨ç½‘ä¸Šçœ‹åˆ°äº†ä¸€ä¸ªå¾ˆå¥½çš„æ–¹æ¡ˆï¼Œå¯ä»¥ä»å‚è€ƒ 2 è®¿é—®åˆ°ï¼Œåœ¨è¿™å…ˆç•¥è¿‡ã€‚</p>\n<h1>å‚è€ƒ</h1>\n<ul>\n<li><a href=\"https://jeffkreeftmeijer.com/vim-number/\">Vimâ€™s absolute, relative and hybrid line numbers</a></li>\n<li><a href=\"https://cheatcode.co/tutorials/how-to-create-and-download-a-zip-file-with-node-js-and-javascript\">How to Create and Download a Zip File with Node.js and JavaScript | CheatCode</a></li>\n</ul>\n","title":"ä»å®ç°Koaæ–‡ä»¶ä¸Šä¼ æ¥å£å­¦åˆ°çš„ä¸œè¥¿","date":"2021/10/31","tags":["Node","Koa"],"mainImg":"https://images.unsplash.com/photo-1593720216276-0caa6452e004?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwxNjUyNjZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2MzU2MTQwODc&ixlib=rb-1.2.1&q=80&w=1080","coverImg":"https://images.unsplash.com/photo-1593720216276-0caa6452e004?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwxNjUyNjZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2MzU2MTQwODc&ixlib=rb-1.2.1&q=80&w=400","intro":"æœ€è¿‘åœ¨å†™æµè§ˆå™¨æ‰©å±•çš„åç«¯ç¨‹åºï¼Œæ¡†æ¶é€‰æ‹©äº† Koa ï¼Œæ–°å®ç°äº†æ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ï¼Œåœ¨è¿™é‡Œç®€å•è®°å½•ä¸€ä¸‹ã€‚"}},"__N_SSG":true}