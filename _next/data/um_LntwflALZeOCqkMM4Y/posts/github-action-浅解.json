{"pageProps":{"post":{"slug":"github-action-æµ…è§£","contentHtml":"<h3>å‰è¨€</h3>\n<p>æˆ‘ç¡®å®éœ€è¦ä½¿ç”¨ GitHub action æ¥åšä¸€äº›äº‹æƒ…ã€‚æ­¤å‰æˆ‘ç…§æ¬ä»–äººçš„é…ç½®æ¥åˆ›å»ºäº†è‡ªå·±çš„åšå®¢æ„å»ºç³»ç»Ÿï¼Œä½†å½“æ—¶æ²¡æœ‰ä»”ç»†ğŸ¤”æ€è€ƒè¿™æ•´ä¸ªè¿‡ç¨‹ï¼Œä¹Ÿæ²¡æœ‰ç»§ç»­äº†è§£ GitHub action åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œæˆ‘æƒ³ä»Šå¤©æ˜¯æ—¶å€™äº†ï¼Œè®©æˆ‘ä»¬æ›´å¤šåœ°äº†è§£ GitHub actionï¼</p>\n<h3>What's Github action?</h3>\n<p>2018 å¹´ 10 æœˆï¼ŒGitHub æ¨å‡ºäº†<code>Github Action</code>æŒç»­é›†æˆæœåŠ¡ï¼Œå…¶ä¸­åŒ…æ‹¬æŠ“å–ä»£ç ã€è¿è¡Œæµ‹è¯•ã€å‘å¸ƒåˆ°ç¬¬ä¸‰æ–¹æœåŠ¡ã€è¿œç¨‹ç™»å½•æœåŠ¡å™¨ç­‰ç­‰ã€‚ä¸ºäº†æ–¹ä¾¿å¼€å‘è€…æ‰§è¡Œä¸€äº›æ“ä½œï¼ŒGitHub å…è®¸å¼€å‘è€…ç¼–å†™ç‹¬ç«‹çš„å¯å…±äº«çš„è„šæœ¬æ–‡ä»¶æ¥è‡ªåŠ¨åŒ–åœ°æ‰§è¡Œç›¸å…³ä»»åŠ¡ã€‚</p>\n<p>ä¾‹å¦‚ï¼Œåœ¨ push æ–°çš„å†…å®¹åˆ°ä»“åº“åè‡ªåŠ¨æ„å»ºä¸€ä¸ªé™æ€ç«™ç‚¹ï¼Œäº¦æˆ–æ˜¯é€šè¿‡è®¾ç½®å¥½çš„ shell è„šæœ¬ï¼Œå°†æ•°æ®åŒæ­¥åˆ° VPS ä¸Šï¼Œå†åœ¨ VPS ä¸Šæ‰§è¡Œä¸€äº›ä»»åŠ¡ï¼Œè¿™éƒ¨åˆ†å°±éå¸¸çµæ´»äº†ã€‚</p>\n<p>æˆ‘ä»¬å¯ä»¥åœ¨<a href=\"https://github.com/marketplace?type=actions\">å®˜æ–¹å¸‚åœº</a>æˆ–è€…<a href=\"https://github.com/sdras/awesome-actions\">awesome actions</a>æ‰¾åˆ°å…·æœ‰ç‰¹å®šåŠŸèƒ½çš„å…±äº«<code>action</code>è„šæœ¬ã€‚</p>\n<h3>åŸºæœ¬æ¦‚å¿µ</h3>\n<p>GitHub action å¸¸è§æœ¯è¯­å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>workflowï¼šå·¥ä½œæµç¨‹ï¼ŒåŒ…å«ä»¥ä¸‹å‡ ç‚¹\n<ul>\n<li>Job: ä»»åŠ¡ï¼Œä¸€ä¸ªå·¥ä½œæµå¯ä»¥å…·æœ‰å¤šä¸ª job\n<ul>\n<li>stepï¼šjob ç”± step ç»„æˆï¼Œè‹¥å¹²ä¸ªæ­¥éª¤æ‰§è¡Œç»“æŸå³è¡¨ç¤º job ç»“æŸ\n<ul>\n<li>actionï¼šæ¯ä¸€ä¸ªæ­¥éª¤å¯ä»¥æ‰§è¡Œè‹¥å¹²ä¸ªå‘½ä»¤</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3>å®è·µ</h3>\n<p>åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª<code>.github/workflows</code>ç›®å½•ï¼Œæ­¤ç›®å½•ä¸‹çš„æ‰€æœ‰<code>.yml</code>æ–‡ä»¶éƒ½åŒ…å«ç€å•ç‹¬çš„<code>workflow</code>ï¼Œè¿™äº›å·¥ä½œæµè„šæœ¬å°†è‡ªåŠ¨è¿è¡Œã€‚</p>\n<blockquote>\n<p>è¯¦ç»†é…ç½®é“¾æ¥ <a href=\"https://docs.github.com/en/actions/learn-github-actions/workflow-syntax-for-github-actions#on\">Workflow syntax for GitHub Actions - GitHub Docs</a></p>\n</blockquote>\n<p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå…¸å‹çš„ workflow æ–‡ä»¶ç¤ºä¾‹<code>demo.yml</code>ï¼š</p>\n<pre><code><span>name:</span> <span>GitHub</span> <span>Actions</span> <span>Demo</span>\n<span class=\"lineNumber\">2</span><span>on:</span> [<span>push</span>]\n<span class=\"lineNumber\">3</span><span>jobs:</span>\n<span class=\"lineNumber\">4</span>  <span>Explore-GitHub-Actions:</span>\n<span class=\"lineNumber\">5</span>    <span>runs-on:</span> <span>ubuntu-latest</span>\n<span class=\"lineNumber\">6</span>    <span>steps:</span>\n<span class=\"lineNumber\">7</span>      <span>-</span> <span>run:</span> <span>echo</span> <span>\"ğŸ‰ The job was automatically triggered by a $<span>{{ github.event_name }}</span> event.\"</span>\n<span class=\"lineNumber\">8</span>      <span>-</span> <span>run:</span> <span>echo</span> <span>\"ğŸ§ This job is now running on a $<span>{{ runner.os }}</span> server hosted by GitHub!\"</span>\n<span class=\"lineNumber\">9</span>      <span>-</span> <span>run:</span> <span>echo</span> <span>\"ğŸ” The name of your branch is $<span>{{ github.ref }}</span> and your repository is $<span>{{ github.repository }}</span>.\"</span>\n<span class=\"lineNumber\">10</span>      <span>-</span> <span>name:</span> <span>Check</span> <span>out</span> <span>repository</span> <span>code</span>\n<span class=\"lineNumber\">11</span>        <span>uses:</span> <span>actions/checkout@v2</span>\n<span class=\"lineNumber\">12</span>      <span>-</span> <span>run:</span> <span>echo</span> <span>\"ğŸ’¡ The $<span>{{ github.repository }}</span> repository has been cloned to the runner.\"</span>\n<span class=\"lineNumber\">13</span>      <span>-</span> <span>run:</span> <span>echo</span> <span>\"ğŸ–¥ï¸ The workflow is now ready to test your code on the runner.\"</span>\n<span class=\"lineNumber\">14</span>      <span>-</span> <span>name:</span> <span>List</span> <span>files</span> <span>in</span> <span>the</span> <span>repository</span>\n<span class=\"lineNumber\">15</span>        <span>run:</span> <span>|\n<span class=\"lineNumber\">16</span>          ls ${{ github.workspace }}\n<span class=\"lineNumber\">17</span></span>      <span>-</span> <span>run:</span> <span>echo</span> <span>\"ğŸ This job's status is $<span>{{ job.status }}</span>.\"</span></code></pre> \n\n<p>è¿™ç§é…ç½®æ–‡ä»¶è¢«ç§°ä¸º<code>yaml</code>æ–‡ä»¶ï¼Œä¸Šè¿°å®˜æ–¹ç¤ºä¾‹ä¸­å¯ä»¥çœ‹åˆ°ä»¥ä¸‹å‡ ä¸ªå…¸å‹å­—æ®µï¼š</p>\n<ul>\n<li>\n<p>name: å·¥ä½œæµçš„åç§°ï¼Œé»˜è®¤ç­‰åŒäºæ–‡ä»¶å</p>\n</li>\n<li>\n<p>on: è¿è¡Œæ¡ä»¶ï¼Œå¯ä»¥æ˜¯æ•°ç»„ï¼Œä¹Ÿå¯ä»¥æ˜¯å•ç‹¬çš„å­—ç¬¦ä¸²ï¼Œä¸Šè¿°è¡¨ç¤ºæ‰€æœ‰<code>push</code>è¡Œä¸ºéƒ½ä¼šæ‰§è¡Œåç»­ä»»åŠ¡ï¼Œç”šè‡³å¯ä»¥æ ¹æ®åˆ†æ”¯æ¥æŒ‡å®šæ‰§è¡Œæ—¶æœºã€‚</p>\n</li>\n<li>\n<p>jobs: åˆ™è¡¨ç¤ºæ­¤å·¥ä½œæµä¸­çš„ä»»åŠ¡ï¼Œ<code>Explore-GitHub-Actions</code>å°±æ˜¯ä»»åŠ¡<code>id</code>ï¼Œç”¨äºåŒºåˆ†å¤šä¸ªä»»åŠ¡ï¼Œä¸åŒä»»åŠ¡ä¹‹é—´è¯·ä¿æŒè‰¯å¥½çš„ç¼©è¿›æ ¼å¼ã€‚æ¯ä¸ªä»»åŠ¡åŒ…æ‹¬ï¼š</p>\n<ul>\n<li>nameï¼ˆä»»åŠ¡åï¼‰</li>\n<li>needsï¼ˆä»»åŠ¡æ‰§è¡Œçš„ä¾èµ–é¡ºåºï¼Œå¯ä»¥æ˜¯å•ç‹¬çš„ä»»åŠ¡ idï¼Œæˆ–è€…æ˜¯åŒ…å«ä»»åŠ¡ id çš„æ•°ç»„ï¼Œå½“æŸä¸ªä»»åŠ¡éœ€è¦åœ¨æŒ‡å®šçš„ä»»åŠ¡ä¹‹åæ‰§è¡Œæ—¶ï¼Œéœ€è¦è®¾ç½® needsï¼‰</li>\n<li>runs-onï¼ˆè¿è¡Œç¯å¢ƒï¼Œæ”¯æŒå¸¸è§çš„æœåŠ¡å™¨å‘è¡Œç‰ˆï¼Œé€šå¸¸ä½¿ç”¨ ubuntu-latestï¼‰</li>\n</ul>\n</li>\n<li>\n<p>steps: ä»»åŠ¡æ­¥éª¤ï¼ŒåŒ…å«ï¼š</p>\n<ul>\n<li>nameï¼šå•ä¸ªæ­¥éª¤å</li>\n<li>uses: ä½¿ç”¨ä»–äººçš„ action è„šæœ¬ä½œä¸ºå½“å‰æ­¥éª¤çš„ä¸€éƒ¨åˆ†ï¼Œå®˜æ–¹<code>å¼ºçƒˆå»ºè®®</code>æˆ‘ä»¬åœ¨ä½¿ç”¨ä»–äººçš„ action çš„æ—¶å€™æŒ‡å®š git é“¾æ¥ã€SHA æˆ– Docker tagï¼Œè¿™æ ·èƒ½é¿å…å½“ä»–äººçš„ action æ›´æ–°æ—¶äº§ç”ŸæœªçŸ¥çš„è¡Œä¸ºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</li>\n</ul>\n<pre><code><span>steps:</span>\n<span class=\"lineNumber\">2</span>  <span># Reference a specific commit</span>\n<span class=\"lineNumber\">3</span>  <span>-</span> <span>uses:</span> <span>actions/checkout@a81bbbf8298c0fa03ea29cdc473d45769f953675</span>\n<span class=\"lineNumber\">4</span>  <span># Reference the major version of a release</span>\n<span class=\"lineNumber\">5</span>  <span>-</span> <span>uses:</span> <span>actions/checkout@v2</span>\n<span class=\"lineNumber\">6</span>  <span># Reference a specific version</span>\n<span class=\"lineNumber\">7</span>  <span>-</span> <span>uses:</span> <span>actions/checkout@v2.2.0</span>\n<span class=\"lineNumber\">8</span>  <span># Reference a branch</span>\n<span class=\"lineNumber\">9</span>  <span>-</span> <span>uses:</span> <span>actions/checkout@main</span></code></pre> \n\n<p>ä½¿ç”¨ç¬¬ä¸‰æ–¹ action çš„æ—¶å€™ä¹Ÿè¦é˜…è¯»å…¶<code>README</code>æ–‡æ¡£ï¼Œä»¥é¿å…æŸäº›éœ€è¦é…ç½®çš„æ•°æ®ç¼ºå¤±ã€‚</p>\n<ul>\n<li>run: æ‰§è¡ŒæŸäº›æ“ä½œç³»ç»Ÿ shell å‘½ä»¤ï¼Œä¾‹å¦‚å¸¸è§çš„<code>npm install</code>ï¼Œå¦‚æœæœ‰å¤šä¸ªå‘½ä»¤ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š</li>\n</ul>\n<pre><code><span>-</span> <span>name:</span> <span>install</span> <span>dependencies</span>\n<span class=\"lineNumber\">2</span>\t<span>run:</span> <span>|</span>\n<span class=\"lineNumber\">3</span>\t\t<span>npm</span> <span>ci</span>\n<span class=\"lineNumber\">4</span>\t\t<span>npm</span> <span>run</span> <span>build</span>\n<span class=\"lineNumber\">5</span>\t<span>working-directory:</span> <span>./src</span></code></pre> \n\n<p><code>working-directory</code>æ˜¯å¯é€‰çš„ï¼Œç”¨äºæŒ‡å®šè¿è¡Œæ­¤å‘½ä»¤çš„ç›®å½•ï¼Œä¸æŒ‡å®šæ—¶å°†åœ¨æ ¹ç›®å½•ä¸‹è¿è¡Œã€‚</p>\n<ul>\n<li>\n<p>shell: æŒ‡å®š shell ç±»å‹ï¼Œå¯ä»¥æ˜¯<code>bash</code>ã€<code>pwshï¼ˆpowershell ç”¨äº windows serverï¼‰</code>ï¼Œç”šè‡³æ˜¯ä½ å–œæ¬¢çš„<code>fish</code>æˆ–<code>zsh</code>ï¼Œç”šè‡³æ˜¯<code>python</code>ç¯å¢ƒï¼</p>\n</li>\n<li>\n<p>with: å®šä¹‰ä¸€ç³»åˆ—çš„é”®å€¼å¯¹æ•°æ®ä½œä¸ºç¯å¢ƒå˜é‡ä½¿ç”¨ï¼Œé»˜è®¤ä¼šæ·»åŠ å‰ç¼€<code>INPUT_</code>ï¼Œå¹¶ä¸”å…¨éƒ¨è½¬åŒ–ä¸ºå¤§å†™å­—æ¯ã€‚å½“ action ä½¿ç”¨åˆ° docker çš„æ—¶å€™ï¼Œå¯ä»¥è®¾ç½® args å’Œ entrypoint ä½œä¸ºå®¹å™¨çš„è¾“å…¥ï¼Œè¯¦æƒ…å¯æŸ¥é˜…æ–‡æ¡£ï¼Œæ­¤å¤„ä¸å»¶ä¼¸ã€‚</p>\n</li>\n<li>\n<p>envï¼šenv ä¹Ÿå¯ä»¥è®¾ç½®å•ç‹¬çš„ç¯å¢ƒå˜é‡ï¼Œå¹¶ä¸”è¿™äº›å˜é‡å¯ä»¥éå¸¸éšç§˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®ä»“åº“çš„<code>secret</code>é€‰é¡¹æ¥å¢åŠ å—ä¿æŠ¤çš„ç¯å¢ƒå˜é‡ï¼Œä¾‹å¦‚ï¼š<code>GITHUB_TOKEN: ${{ secrets.TOKEN }}</code>å¯ä»¥è¯»å–<code>secret</code>ä¸­çš„<code>TOKEN</code>å˜é‡æ·»åŠ åˆ°æ•´ä¸ªé¡¹ç›®ä¸­æ¥ ã€‚</p>\n</li>\n<li>\n<p>if : æ·»åŠ æ¡ä»¶ï¼Œé…åˆè¡¨è¾¾å¼å¯ä»¥å®ç°å¾ˆå¤šåŠŸèƒ½ï¼Œä¾‹å¦‚æ ¹æ®ä¸Šä¸€ä¸ªä»»åŠ¡æ˜¯å¦æˆåŠŸè€Œå†³å®šæ˜¯å¦æ‰§è¡Œé€‰å®šçš„æ­¥éª¤ï¼Œä¸¾ä¸ªä¾‹å­ï¼š</p>\n</li>\n</ul>\n<pre><code><span>steps:</span>\n<span class=\"lineNumber\">2</span>  <span>-</span> <span>name:</span> <span>My</span> <span>first</span> <span>step</span>\n<span class=\"lineNumber\">3</span>    <span>uses:</span> <span>octo-org/action-name@main</span>\n<span class=\"lineNumber\">4</span>  <span>-</span> <span>name:</span> <span>My</span> <span>backup</span> <span>step</span>\n<span class=\"lineNumber\">5</span>    <span>if:</span> <span>${{</span> <span>failure()</span> <span>}}</span>\n<span class=\"lineNumber\">6</span>    <span>uses:</span> <span>actions/heroku@1.0.0</span></code></pre> \n\n<p>â€‹\tè¿™é‡Œå°±å¯ä»¥æ ¹æ®ç¬¬ä¸€ä¸ªæ­¥éª¤ä½¿ç”¨çš„ç»“æœæ¥å†³å®šæ˜¯å¦å†ä½¿ç”¨å¦ä¸€ä¸ªè„šæœ¬ã€‚</p>\n</li>\n</ul>\n<h3>å‘å¸ƒä¸€ä¸ª React åº”ç”¨</h3>\n<p>ç°åœ¨ï¼Œæˆ‘çš„æ‰‹å¤´æœ‰ä¸€ä¸ªåä¸º<code>emoji_search_zh</code>çš„åº”ç”¨ï¼Œåœ¨è¿™ä¸ªåº”ç”¨é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æœç´¢ä¸­æ–‡å…³é”®å­—å»æ£€ç´¢<code>emoji</code>å­—ç¬¦ï¼Œå¹¶ä¸”å¯ä»¥å¾ˆæ–¹ä¾¿çš„å¤åˆ¶åˆ°å‰ªè´´æ¿ğŸ“‹ï¼ˆå¬èµ·æ¥ä¼¼ä¹æœ‰ç‚¹é¸¡è‚‹ğŸ‘¦ğŸ»ï¼‰ã€‚</p>\n<p>ç°åœ¨ï¼Œä¸€æ­¥æ­¥æ¥éƒ¨ç½²ï¼š</p>\n<h4>é…ç½® homepage</h4>\n<p>å½“åº”ç”¨å‡†å¤‡å¥½éƒ¨ç½²æ—¶ï¼Œå°†<code>homepage</code>æ·»åŠ åˆ°<code>package.json</code>ä¸Šã€‚</p>\n<pre><code><span>\"homepage\"</span>: <span>\"https://&#x3C;githubusername>.github.io/&#x3C;app>\"</span></code></pre> \n\n<blockquote>\n<p>æ³¨æ„æ›¿æ¢æ‰è´¦æˆ·åå’Œåº”ç”¨åç§°ï¼Œè¿™ä¸ªåç§°å¯ä»¥æ˜¯ä»“åº“å</p>\n</blockquote>\n<h4>å¯ç”¨ GitHub Pages</h4>\n<p>åˆ›å»ºä¸€ä¸ªåˆ†æ”¯ç”¨äºéƒ¨ç½²ï¼Œä¾‹å¦‚ï¼š<code>gh-pages</code>:</p>\n<p><code>git checkout -b gh-pages</code></p>\n<blockquote>\n<p>åˆ›å»ºåˆ†æ”¯æœ‰åˆ©äºä¿æŒæˆ‘ä»¬æºä»£ç å’Œåº”ç”¨éƒ¨ç½²çš„ç‹¬ç«‹æ€§</p>\n</blockquote>\n<h4>åˆ›å»ºå·¥ä½œæµ action</h4>\n<h3>å‚è€ƒ</h3>\n<ul>\n<li><a href=\"https://docs.github.com/cn/actions/quickstart\">GitHub Actions å¿«é€Ÿå…¥é—¨ - GitHub Docs</a></li>\n<li><a href=\"https://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html\">GitHub Actions å…¥é—¨æ•™ç¨‹ - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—</a></li>\n<li></li>\n</ul>\n","title":"github action æµ…è§£","date":"2021/11/28","tags":["Git"],"mainImg":"https://images.unsplash.com/photo-1633791583517-c828e6f851a9?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwxNjUyNjZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2MzgwODk0OTQ&ixlib=rb-1.2.1&q=80&w=1080","coverImg":"https://images.unsplash.com/photo-1633791583517-c828e6f851a9?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwxNjUyNjZ8MHwxfHJhbmRvbXx8fHx8fHx8fDE2MzgwODk0OTQ&ixlib=rb-1.2.1&q=80&w=400","intro":"æˆ‘éœ€è¦ä½¿ç”¨ GitHub action æ¥è‡ªåŠ¨éƒ¨ç½²ä¸€äº›åº”ç”¨ã€‚"}},"__N_SSG":true}